"use strict";var ot=Object.defineProperty;var Ye=r=>{throw TypeError(r)};var ct=(r,e,n)=>e in r?ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var xe=(r,e,n)=>ct(r,typeof e!="symbol"?e+"":e,n),Je=(r,e,n)=>e.has(r)||Ye("Cannot "+n);var me=(r,e,n)=>(Je(r,e,"read from private field"),n?n.call(r):e.get(r)),Oe=(r,e,n)=>e.has(r)?Ye("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,n),Me=(r,e,n,a)=>(Je(r,e,"write to private field"),a?a.call(r,n):e.set(r,n),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const electron=require("electron"),node_url=require("node:url"),fs=require("node:fs"),path=require("node:path"),require$$1$1=require("tty"),require$$1$2=require("util"),require$$0$2=require("os"),require$$0$4=require("stream"),require$$0$3=require("buffer"),require$$2$1=require("events"),process$2=require("node:process"),node_util=require("node:util"),crypto=require("node:crypto"),assert=require("node:assert"),os=require("node:os");var _documentCurrentScript=typeof document<"u"?document.currentScript:null,commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var n=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(a){var i=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:function(){return r[a]}})}),n}var lib$3={},src$1={exports:{}},browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var r=1e3,e=r*60,n=e*60,a=n*24,i=a*7,s=a*365.25;ms=function(u,f){f=f||{};var m=typeof u;if(m==="string"&&u.length>0)return o(u);if(m==="number"&&isFinite(u))return f.long?c(u):l(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(f){var m=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return m*s;case"weeks":case"week":case"w":return m*i;case"days":case"day":case"d":return m*a;case"hours":case"hour":case"hrs":case"hr":case"h":return m*n;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function l(u){var f=Math.abs(u);return f>=a?Math.round(u/a)+"d":f>=n?Math.round(u/n)+"h":f>=e?Math.round(u/e)+"m":f>=r?Math.round(u/r)+"s":u+"ms"}function c(u){var f=Math.abs(u);return f>=a?d(u,f,a,"day"):f>=n?d(u,f,n,"hour"):f>=e?d(u,f,e,"minute"):f>=r?d(u,f,r,"second"):u+" ms"}function d(u,f,m,h){var w=f>=m*1.5;return Math.round(u/m)+" "+h+(w?"s":"")}return ms}var common$3,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common$3;hasRequiredCommon=1;function r(e){a.debug=a,a.default=a,a.coerce=d,a.disable=l,a.enable=s,a.enabled=c,a.humanize=requireMs(),a.destroy=u,Object.keys(e).forEach(f=>{a[f]=e[f]}),a.names=[],a.skips=[],a.formatters={};function n(f){let m=0;for(let h=0;h<f.length;h++)m=(m<<5)-m+f.charCodeAt(h),m|=0;return a.colors[Math.abs(m)%a.colors.length]}a.selectColor=n;function a(f){let m,h=null,w,$;function _(...p){if(!_.enabled)return;const b=_,v=Number(new Date),j=v-(m||v);b.diff=j,b.prev=m,b.curr=v,m=v,p[0]=a.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let U=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(T,A)=>{if(T==="%%")return"%";U++;const ce=a.formatters[A];if(typeof ce=="function"){const V=p[U];T=ce.call(b,V),p.splice(U,1),U--}return T}),a.formatArgs.call(b,p),(b.log||a.log).apply(b,p)}return _.namespace=f,_.useColors=a.useColors(),_.color=a.selectColor(f),_.extend=i,_.destroy=a.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(w!==a.namespaces&&(w=a.namespaces,$=a.enabled(f)),$),set:p=>{h=p}}),typeof a.init=="function"&&a.init(_),_}function i(f,m){const h=a(this.namespace+(typeof m>"u"?":":m)+f);return h.log=this.log,h}function s(f){a.save(f),a.namespaces=f,a.names=[],a.skips=[];const m=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(const h of m)h[0]==="-"?a.skips.push(h.slice(1)):a.names.push(h)}function o(f,m){let h=0,w=0,$=-1,_=0;for(;h<f.length;)if(w<m.length&&(m[w]===f[h]||m[w]==="*"))m[w]==="*"?($=w,_=h,w++):(h++,w++);else if($!==-1)w=$+1,_++,h=_;else return!1;for(;w<m.length&&m[w]==="*";)w++;return w===m.length}function l(){const f=[...a.names,...a.skips.map(m=>"-"+m)].join(",");return a.enable(""),f}function c(f){for(const m of a.skips)if(o(f,m))return!1;for(const m of a.names)if(o(f,m))return!0;return!1}function d(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}return common$3=r,common$3}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(r,e){e.formatArgs=a,e.save=i,e.load=s,e.useColors=n,e.storage=o(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let u=0,f=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(u++,m==="%c"&&(f=u))}),c.splice(f,0,d)}e.log=console.debug||console.log||(()=>{});function i(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function s(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function o(){try{return localStorage}catch{}}r.exports=requireCommon()(e);const{formatters:l}=r.exports;l.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}(browser,browser.exports)),browser.exports}var node={exports:{}},hasFlag,hasRequiredHasFlag;function requireHasFlag(){return hasRequiredHasFlag||(hasRequiredHasFlag=1,hasFlag=(r,e=process.argv)=>{const n=r.startsWith("-")?"":r.length===1?"-":"--",a=e.indexOf(n+r),i=e.indexOf("--");return a!==-1&&(i===-1||a<i)}),hasFlag}var supportsColor_1,hasRequiredSupportsColor;function requireSupportsColor(){if(hasRequiredSupportsColor)return supportsColor_1;hasRequiredSupportsColor=1;const r=require$$0$2,e=require$$1$1,n=requireHasFlag(),{env:a}=process;let i;n("no-color")||n("no-colors")||n("color=false")||n("color=never")?i=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(i=1);function s(){if("FORCE_COLOR"in a)return a.FORCE_COLOR==="true"?1:a.FORCE_COLOR==="false"?0:a.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(a.FORCE_COLOR,10),3)}function o(d){return d===0?!1:{level:d,hasBasic:!0,has256:d>=2,has16m:d>=3}}function l(d,{streamIsTTY:u,sniffFlags:f=!0}={}){const m=s();m!==void 0&&(i=m);const h=f?i:m;if(h===0)return 0;if(f){if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2}if(d&&!u&&h===void 0)return 0;const w=h||0;if(a.TERM==="dumb")return w;if(process.platform==="win32"){const $=r.release().split(".");return Number($[0])>=10&&Number($[2])>=10586?Number($[2])>=14931?3:2:1}if("CI"in a)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some($=>$ in a)||a.CI_NAME==="codeship"?1:w;if("TEAMCITY_VERSION"in a)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(a.TEAMCITY_VERSION)?1:0;if(a.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in a){const $=Number.parseInt((a.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(a.TERM_PROGRAM){case"iTerm.app":return $>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(a.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(a.TERM)||"COLORTERM"in a?1:w}function c(d,u={}){const f=l(d,{streamIsTTY:d&&d.isTTY,...u});return o(f)}return supportsColor_1={supportsColor:c,stdout:c({isTTY:e.isatty(1)}),stderr:c({isTTY:e.isatty(2)})},supportsColor_1}var hasRequiredNode;function requireNode(){return hasRequiredNode||(hasRequiredNode=1,function(r,e){const n=require$$1$1,a=require$$1$2;e.init=u,e.log=l,e.formatArgs=s,e.save=c,e.load=d,e.useColors=i,e.destroy=a.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),e.colors=[6,2,3,4,5,1];try{const m=requireSupportsColor();m&&(m.stderr||m).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}e.inspectOpts=Object.keys(process.env).filter(m=>/^debug_/i.test(m)).reduce((m,h)=>{const w=h.substring(6).toLowerCase().replace(/_([a-z])/g,(_,p)=>p.toUpperCase());let $=process.env[h];return/^(yes|on|true|enabled)$/i.test($)?$=!0:/^(no|off|false|disabled)$/i.test($)?$=!1:$==="null"?$=null:$=Number($),m[w]=$,m},{});function i(){return"colors"in e.inspectOpts?!!e.inspectOpts.colors:n.isatty(process.stderr.fd)}function s(m){const{namespace:h,useColors:w}=this;if(w){const $=this.color,_="\x1B[3"+($<8?$:"8;5;"+$),p=`  ${_};1m${h} \x1B[0m`;m[0]=p+m[0].split(`
`).join(`
`+p),m.push(_+"m+"+r.exports.humanize(this.diff)+"\x1B[0m")}else m[0]=o()+h+" "+m[0]}function o(){return e.inspectOpts.hideDate?"":new Date().toISOString()+" "}function l(...m){return process.stderr.write(a.formatWithOptions(e.inspectOpts,...m)+`
`)}function c(m){m?process.env.DEBUG=m:delete process.env.DEBUG}function d(){return process.env.DEBUG}function u(m){m.inspectOpts={};const h=Object.keys(e.inspectOpts);for(let w=0;w<h.length;w++)m.inspectOpts[h[w]]=e.inspectOpts[h[w]]}r.exports=requireCommon()(e);const{formatters:f}=r.exports;f.o=function(m){return this.inspectOpts.colors=this.useColors,a.inspect(m,this.inspectOpts).split(`
`).map(h=>h.trim()).join(" ")},f.O=function(m){return this.inspectOpts.colors=this.useColors,a.inspect(m,this.inspectOpts)}}(node,node.exports)),node.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?src$1.exports=requireBrowser():src$1.exports=requireNode();var srcExports=src$1.exports,core$6={},core$5={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib$2={},EndOfFileStream={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.EndOfStreamError=r.defaultMessages=void 0,r.defaultMessages="End-Of-Stream";class e extends Error{constructor(){super(r.defaultMessages)}}r.EndOfStreamError=e})(EndOfFileStream);var StreamReader$1={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0});Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((e,n)=>{this.reject=n,this.resolve=e})}}Deferred$1.Deferred=Deferred;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.StreamReader=r.EndOfStreamError=void 0;const e=EndOfFileStream,n=Deferred$1;var a=EndOfFileStream;Object.defineProperty(r,"EndOfStreamError",{enumerable:!0,get:function(){return a.EndOfStreamError}});const i=1*1024*1024;class s{constructor(l){if(this.s=l,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!l.read||!l.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new e.EndOfStreamError)),this.s.once("error",c=>this.reject(c)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(l,c,d){const u=await this.read(l,c,d);return this.peekQueue.push(l.subarray(c,c+u)),u}async read(l,c,d){if(d===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new e.EndOfStreamError;let u=d,f=0;for(;this.peekQueue.length>0&&u>0;){const m=this.peekQueue.pop();if(!m)throw new Error("peekData should be defined");const h=Math.min(m.length,u);l.set(m.subarray(0,h),c+f),f+=h,u-=h,h<m.length&&this.peekQueue.push(m.subarray(h))}for(;u>0&&!this.endOfStream;){const m=Math.min(u,i),h=await this.readFromStream(l,c+f,m);if(f+=h,h<m)break;u-=h}return f}async readFromStream(l,c,d){const u=this.s.read(d);if(u)return l.set(u,c),u.length;{const f={buffer:l,offset:c,length:d,deferred:new n.Deferred};return this.deferred=f.deferred,this.s.once("readable",()=>{this.readDeferred(f)}),f.deferred.promise}}readDeferred(l){const c=this.s.read(l.length);c?(l.buffer.set(c,l.offset),l.deferred.resolve(c.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(l)})}reject(l){this.endOfStream=!0,this.deferred&&(this.deferred.reject(l),this.deferred=null)}}r.StreamReader=s})(StreamReader$1);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.StreamReader=r.EndOfStreamError=void 0;var e=EndOfFileStream;Object.defineProperty(r,"EndOfStreamError",{enumerable:!0,get:function(){return e.EndOfStreamError}});var n=StreamReader$1;Object.defineProperty(r,"StreamReader",{enumerable:!0,get:function(){return n.StreamReader}})})(lib$2);Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0});AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib$2;class AbstractTokenizer{constructor(e){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=e||{}}async readToken(e,n=this.position){const a=Buffer.alloc(e.len);if(await this.readBuffer(a,{position:n})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(a,0)}async peekToken(e,n=this.position){const a=Buffer.alloc(e.len);if(await this.peekBuffer(a,{position:n})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(a,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new peek_readable_1$2.EndOfStreamError;return e.get(this.numBuffer,0)}async ignore(e){if(this.fileInfo.size!==void 0){const n=this.fileInfo.size-this.position;if(e>n)return this.position+=n,n}return this.position+=e,e}async close(){}normalizeOptions(e,n){if(n&&n.position!==void 0&&n.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return n?{mayBeLess:n.mayBeLess===!0,offset:n.offset?n.offset:0,length:n.length?n.length:e.length-(n.offset?n.offset:0),position:n.position?n.position:this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer;Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0});ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib$2,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(e,n){super(n),this.streamReader=new peek_readable_1$1.StreamReader(e)}async getFileInfo(){return this.fileInfo}async readBuffer(e,n){const a=this.normalizeOptions(e,n),i=a.position-this.position;if(i>0)return await this.ignore(i),this.readBuffer(e,n);if(i<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(a.length===0)return 0;const s=await this.streamReader.read(e,a.offset,a.length);if(this.position+=s,(!n||!n.mayBeLess)&&s<a.length)throw new peek_readable_1$1.EndOfStreamError;return s}async peekBuffer(e,n){const a=this.normalizeOptions(e,n);let i=0;if(a.position){const s=a.position-this.position;if(s>0){const o=new Uint8Array(a.length+s);return i=await this.peekBuffer(o,{mayBeLess:a.mayBeLess}),e.set(o.subarray(s),a.offset),i-s}else if(s<0)throw new Error("Cannot peek from a negative offset in a stream")}if(a.length>0){try{i=await this.streamReader.peek(e,a.offset,a.length)}catch(s){if(n&&n.mayBeLess&&s instanceof peek_readable_1$1.EndOfStreamError)return 0;throw s}if(!a.mayBeLess&&i<a.length)throw new peek_readable_1$1.EndOfStreamError}return i}async ignore(e){const n=Math.min(maxBufferSize,e),a=new Uint8Array(n);let i=0;for(;i<e;){const s=e-i,o=await this.readBuffer(a,{length:Math.min(n,s)});if(o<0)return o;i+=o}return i}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0});BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib$2,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(e,n){super(n),this.uint8Array=e,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:e.length}async readBuffer(e,n){if(n&&n.position){if(n.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=n.position}const a=await this.peekBuffer(e,n);return this.position+=a,a}async peekBuffer(e,n){const a=this.normalizeOptions(e,n),i=Math.min(this.uint8Array.length-a.position,a.length);if(!a.mayBeLess&&i<a.length)throw new peek_readable_1.EndOfStreamError;return e.set(this.uint8Array.subarray(a.position,a.position+i),a.offset),i}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.fromBuffer=r.fromStream=r.EndOfStreamError=void 0;const e=ReadStreamTokenizer$1,n=BufferTokenizer$1;var a=lib$2;Object.defineProperty(r,"EndOfStreamError",{enumerable:!0,get:function(){return a.EndOfStreamError}});function i(o,l){return l=l||{},new e.ReadStreamTokenizer(o,l)}r.fromStream=i;function s(o,l){return new n.BufferTokenizer(o,l)}r.fromBuffer=s})(core$5);var ParserFactory$1={},lib$1={},ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(r,e,n,a,i){var s,o,l=i*8-a-1,c=(1<<l)-1,d=c>>1,u=-7,f=n?i-1:0,m=n?-1:1,h=r[e+f];for(f+=m,s=h&(1<<-u)-1,h>>=-u,u+=l;u>0;s=s*256+r[e+f],f+=m,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=a;u>0;o=o*256+r[e+f],f+=m,u-=8);if(s===0)s=1-d;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,a),s=s-d}return(h?-1:1)*o*Math.pow(2,s-a)};ieee754.write=function(r,e,n,a,i,s){var o,l,c,d=s*8-i-1,u=(1<<d)-1,f=u>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=a?0:s-1,w=a?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=m/c:e+=m*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(l=0,o=u):o+f>=1?(l=(e*c-1)*Math.pow(2,i),o=o+f):(l=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;r[n+h]=l&255,h+=w,l/=256,i-=8);for(o=o<<i|l,d+=i;d>0;r[n+h]=o&255,h+=w,o/=256,d-=8);r[n+h-w]|=$*128};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.AnsiStringType=r.StringType=r.BufferType=r.Uint8ArrayType=r.IgnoreType=r.Float80_LE=r.Float80_BE=r.Float64_LE=r.Float64_BE=r.Float32_LE=r.Float32_BE=r.Float16_LE=r.Float16_BE=r.INT64_BE=r.UINT64_BE=r.INT64_LE=r.UINT64_LE=r.INT32_LE=r.INT32_BE=r.INT24_BE=r.INT24_LE=r.INT16_LE=r.INT16_BE=r.INT8=r.UINT32_BE=r.UINT32_LE=r.UINT24_BE=r.UINT24_LE=r.UINT16_BE=r.UINT16_LE=r.UINT8=void 0;const e=ieee754;function n(c){return new DataView(c.buffer,c.byteOffset)}r.UINT8={len:1,get(c,d){return n(c).getUint8(d)},put(c,d,u){return n(c).setUint8(d,u),d+1}},r.UINT16_LE={len:2,get(c,d){return n(c).getUint16(d,!0)},put(c,d,u){return n(c).setUint16(d,u,!0),d+2}},r.UINT16_BE={len:2,get(c,d){return n(c).getUint16(d)},put(c,d,u){return n(c).setUint16(d,u),d+2}},r.UINT24_LE={len:3,get(c,d){const u=n(c);return u.getUint8(d)+(u.getUint16(d+1,!0)<<8)},put(c,d,u){const f=n(c);return f.setUint8(d,u&255),f.setUint16(d+1,u>>8,!0),d+3}},r.UINT24_BE={len:3,get(c,d){const u=n(c);return(u.getUint16(d)<<8)+u.getUint8(d+2)},put(c,d,u){const f=n(c);return f.setUint16(d,u>>8),f.setUint8(d+2,u&255),d+3}},r.UINT32_LE={len:4,get(c,d){return n(c).getUint32(d,!0)},put(c,d,u){return n(c).setUint32(d,u,!0),d+4}},r.UINT32_BE={len:4,get(c,d){return n(c).getUint32(d)},put(c,d,u){return n(c).setUint32(d,u),d+4}},r.INT8={len:1,get(c,d){return n(c).getInt8(d)},put(c,d,u){return n(c).setInt8(d,u),d+1}},r.INT16_BE={len:2,get(c,d){return n(c).getInt16(d)},put(c,d,u){return n(c).setInt16(d,u),d+2}},r.INT16_LE={len:2,get(c,d){return n(c).getInt16(d,!0)},put(c,d,u){return n(c).setInt16(d,u,!0),d+2}},r.INT24_LE={len:3,get(c,d){const u=r.UINT24_LE.get(c,d);return u>8388607?u-16777216:u},put(c,d,u){const f=n(c);return f.setUint8(d,u&255),f.setUint16(d+1,u>>8,!0),d+3}},r.INT24_BE={len:3,get(c,d){const u=r.UINT24_BE.get(c,d);return u>8388607?u-16777216:u},put(c,d,u){const f=n(c);return f.setUint16(d,u>>8),f.setUint8(d+2,u&255),d+3}},r.INT32_BE={len:4,get(c,d){return n(c).getInt32(d)},put(c,d,u){return n(c).setInt32(d,u),d+4}},r.INT32_LE={len:4,get(c,d){return n(c).getInt32(d,!0)},put(c,d,u){return n(c).setInt32(d,u,!0),d+4}},r.UINT64_LE={len:8,get(c,d){return n(c).getBigUint64(d,!0)},put(c,d,u){return n(c).setBigUint64(d,u,!0),d+8}},r.INT64_LE={len:8,get(c,d){return n(c).getBigInt64(d,!0)},put(c,d,u){return n(c).setBigInt64(d,u,!0),d+8}},r.UINT64_BE={len:8,get(c,d){return n(c).getBigUint64(d)},put(c,d,u){return n(c).setBigUint64(d,u),d+8}},r.INT64_BE={len:8,get(c,d){return n(c).getBigInt64(d)},put(c,d,u){return n(c).setBigInt64(d,u),d+8}},r.Float16_BE={len:2,get(c,d){return e.read(c,d,!1,10,this.len)},put(c,d,u){return e.write(c,u,d,!1,10,this.len),d+this.len}},r.Float16_LE={len:2,get(c,d){return e.read(c,d,!0,10,this.len)},put(c,d,u){return e.write(c,u,d,!0,10,this.len),d+this.len}},r.Float32_BE={len:4,get(c,d){return n(c).getFloat32(d)},put(c,d,u){return n(c).setFloat32(d,u),d+4}},r.Float32_LE={len:4,get(c,d){return n(c).getFloat32(d,!0)},put(c,d,u){return n(c).setFloat32(d,u,!0),d+4}},r.Float64_BE={len:8,get(c,d){return n(c).getFloat64(d)},put(c,d,u){return n(c).setFloat64(d,u),d+8}},r.Float64_LE={len:8,get(c,d){return n(c).getFloat64(d,!0)},put(c,d,u){return n(c).setFloat64(d,u,!0),d+8}},r.Float80_BE={len:10,get(c,d){return e.read(c,d,!1,63,this.len)},put(c,d,u){return e.write(c,u,d,!1,63,this.len),d+this.len}},r.Float80_LE={len:10,get(c,d){return e.read(c,d,!0,63,this.len)},put(c,d,u){return e.write(c,u,d,!0,63,this.len),d+this.len}};class a{constructor(d){this.len=d}get(d,u){}}r.IgnoreType=a;class i{constructor(d){this.len=d}get(d,u){return d.subarray(u,u+this.len)}}r.Uint8ArrayType=i;class s{constructor(d){this.len=d}get(d,u){return Buffer.from(d.subarray(u,u+this.len))}}r.BufferType=s;class o{constructor(d,u){this.len=d,this.encoding=u}get(d,u){return Buffer.from(d).toString(this.encoding,u,u+this.len)}}r.StringType=o;class l{constructor(d){this.len=d}static decode(d,u,f){let m="";for(let h=u;h<f;++h)m+=l.codePointToString(l.singleByteDecoder(d[h]));return m}static inRange(d,u,f){return u<=d&&d<=f}static codePointToString(d){return d<=65535?String.fromCharCode(d):(d-=65536,String.fromCharCode((d>>10)+55296,(d&1023)+56320))}static singleByteDecoder(d){if(l.inRange(d,0,127))return d;const u=l.windows1252[d-128];if(u===null)throw Error("invaliding encoding");return u}get(d,u=0){return l.decode(d,u,u+this.len)}}r.AnsiStringType=l,l.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1);var util$d={};util$d.stringToBytes=r=>[...r].map(e=>e.charCodeAt(0));util$d.tarHeaderChecksumMatches=(r,e=0)=>{const n=parseInt(r.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(n))return!1;let a=8*32;for(let i=e;i<e+148;i++)a+=r[i];for(let i=e+156;i<e+512;i++)a+=r[i];return n===a};util$d.uint32SyncSafeToken={get:(r,e)=>r[e+3]&127|r[e+2]<<7|r[e+1]<<14|r[e]<<21,len:4};var supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token$s=lib$1,strtok3$5=core$5,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util$d,supported=supported$1,minimumBytes=4100;async function fromStream(r){const e=await strtok3$5.fromStream(r);try{return await fromTokenizer(e)}finally{await e.close()}}async function fromBuffer(r){if(!(r instanceof Uint8Array||r instanceof ArrayBuffer||Buffer.isBuffer(r)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof r}\``);const e=r instanceof Buffer?r:Buffer.from(r);if(!(e&&e.length>1))return;const n=strtok3$5.fromBuffer(e);return fromTokenizer(n)}function _check(r,e,n){n={offset:0,...n};for(const[a,i]of e.entries())if(n.mask){if(i!==(n.mask[a]&r[a+n.offset]))return!1}else if(i!==r[a+n.offset])return!1;return!0}async function fromTokenizer(r){try{return _fromTokenizer(r)}catch(e){if(!(e instanceof strtok3$5.EndOfStreamError))throw e}}async function _fromTokenizer(r){let e=Buffer.alloc(minimumBytes);const n=12,a=(s,o)=>_check(e,s,o),i=(s,o)=>a(stringToBytes(s),o);if(r.fileInfo.size||(r.fileInfo.size=Number.MAX_SAFE_INTEGER),await r.peekBuffer(e,{length:n,mayBeLess:!0}),a([66,77]))return{ext:"bmp",mime:"image/bmp"};if(a([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(a([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(a([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(a([37,33]))return await r.peekBuffer(e,{length:24,mayBeLess:!0}),i("PS-Adobe-",{offset:2})&&i(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(a([31,160])||a([31,157]))return{ext:"Z",mime:"application/x-compress"};if(a([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(a([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(a([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(a([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(i("ID3")){await r.ignore(6);const s=await r.readToken(uint32SyncSafeToken);return r.position+s>r.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await r.ignore(s),fromTokenizer(r))}if(i("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((e[0]===67||e[0]===70)&&a([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(a([71,73,70]))return{ext:"gif",mime:"image/gif"};if(i("FLIF"))return{ext:"flif",mime:"image/flif"};if(i("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(i("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(i("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(i("FORM"))return{ext:"aif",mime:"audio/aiff"};if(i("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(a([80,75,3,4])){try{for(;r.position+30<r.fileInfo.size;){await r.readBuffer(e,{length:30});const s={compressedSize:e.readUInt32LE(18),uncompressedSize:e.readUInt32LE(22),filenameLength:e.readUInt16LE(26),extraFieldLength:e.readUInt16LE(28)};if(s.filename=await r.readToken(new Token$s.StringType(s.filenameLength,"utf-8")),await r.ignore(s.extraFieldLength),s.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(s.filename.endsWith(".rels")||s.filename.endsWith(".xml"))switch(s.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(s.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(s.filename.startsWith("3D/")&&s.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(s.filename==="mimetype"&&s.compressedSize===s.uncompressedSize)switch(await r.readToken(new Token$s.StringType(s.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(s.compressedSize===0){let o=-1;for(;o<0&&r.position<r.fileInfo.size;)await r.peekBuffer(e,{mayBeLess:!0}),o=e.indexOf("504B0304",0,"hex"),await r.ignore(o>=0?o:e.length)}else await r.ignore(s.compressedSize)}}catch(s){if(!(s instanceof strtok3$5.EndOfStreamError))throw s}return{ext:"zip",mime:"application/zip"}}if(i("OggS")){await r.ignore(28);const s=Buffer.alloc(8);return await r.readBuffer(s),_check(s,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(s,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(s,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(s,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(s,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(s,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(a([80,75])&&(e[2]===3||e[2]===5||e[2]===7)&&(e[3]===4||e[3]===6||e[3]===8))return{ext:"zip",mime:"application/zip"};if(i("ftyp",{offset:4})&&e[8]&96){const s=e.toString("binary",8,12).replace("\0"," ").trim();switch(s){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return s.startsWith("3g")?s.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(i("MThd"))return{ext:"mid",mime:"audio/midi"};if(i("wOFF")&&(a([0,1,0,0],{offset:4})||i("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(i("wOF2")&&(a([0,1,0,0],{offset:4})||i("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(a([212,195,178,161])||a([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(i("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(i("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(i("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(a([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(i("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(i("%PDF")){await r.ignore(1350);const s=10*1024*1024,o=Buffer.alloc(Math.min(s,r.fileInfo.size));return await r.readBuffer(o,{mayBeLess:!0}),o.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(a([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(a([73,73,42,0]))return i("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:a([28,0,254,0],{offset:8})||a([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:a([8,0,0,0],{offset:4})&&(a([45,0,254,0],{offset:8})||a([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(e=Buffer.alloc(24),await r.peekBuffer(e),(a([16,251,134,1],{offset:4})||a([8,0,0,0],{offset:4}))&&a([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(a([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(i("MAC "))return{ext:"ape",mime:"audio/ape"};if(a([26,69,223,163])){async function s(){const u=await r.peekNumber(Token$s.UINT8);let f=128,m=0;for(;!(u&f)&&f!==0;)++m,f>>=1;const h=Buffer.alloc(m+1);return await r.readBuffer(h),h}async function o(){const u=await s(),f=await s();f[0]^=128>>f.length-1;const m=Math.min(6,f.length);return{id:u.readUIntBE(0,u.length),len:f.readUIntBE(f.length-m,m)}}async function l(u,f){for(;f>0;){const m=await o();if(m.id===17026)return r.readToken(new Token$s.StringType(m.len,"utf-8"));await r.ignore(m.len),--f}}const c=await o();switch(await l(1,c.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(a([82,73,70,70])){if(a([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(a([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(a([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(i("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(a([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(i("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(i("MSCF")||i("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(a([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(a([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(a([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(a([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(i("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(i("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(a([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(i("IMPM"))return{ext:"it",mime:"audio/x-it"};if(i("-lh0-",{offset:2})||i("-lh1-",{offset:2})||i("-lh2-",{offset:2})||i("-lh3-",{offset:2})||i("-lh4-",{offset:2})||i("-lh5-",{offset:2})||i("-lh6-",{offset:2})||i("-lh7-",{offset:2})||i("-lzs-",{offset:2})||i("-lz4-",{offset:2})||i("-lz5-",{offset:2})||i("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(a([0,0,1,186])){if(a([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(a([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(i("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(a([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(i("<?xml "))return{ext:"xml",mime:"application/xml"};if(a([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(a([82,97,114,33,26,7])&&(e[6]===0||e[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(i("solid "))return{ext:"stl",mime:"model/stl"};if(i("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(i("!<arch>"))return await r.ignore(8),await r.readToken(new Token$s.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(a([137,80,78,71,13,10,26,10])){await r.ignore(8);async function s(){return{length:await r.readToken(Token$s.INT32_BE),type:await r.readToken(new Token$s.StringType(4,"binary"))}}do{const o=await s();if(o.length<0)return;switch(o.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await r.ignore(o.length+4)}}while(r.position+8<r.fileInfo.size);return{ext:"png",mime:"image/png"}}if(a([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(a([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(a([102,114,101,101],{offset:4})||a([109,100,97,116],{offset:4})||a([109,111,111,118],{offset:4})||a([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(a([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(i("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(a([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(a([48,38,178,117,142,102,207,17,166,217])){async function s(){const o=Buffer.alloc(16);return await r.readBuffer(o),{id:o,size:Number(await r.readToken(Token$s.UINT64_LE))}}for(await r.ignore(30);r.position+24<r.fileInfo.size;){const o=await s();let l=o.size-24;if(_check(o.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const c=Buffer.alloc(16);if(l-=await r.readBuffer(c),_check(c,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(c,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await r.ignore(l)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(a([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((a([126,16,4])||a([126,24,4]))&&a([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(a([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(a([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await r.ignore(20),await r.readToken(new Token$s.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(a([255,10])||a([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(a([0,0,1,186])||a([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(a([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(a([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(a([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(a([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await r.peekBuffer(e,{length:Math.min(256,r.fileInfo.size),mayBeLess:!0}),i("BEGIN:")){if(i("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(i("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(i("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(i("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(i("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(a([4,0,0,0])&&e.length>=16){const s=e.readUInt32LE(12);if(s>12&&e.length>=s+16)try{const o=e.slice(16,s+16).toString();if(JSON.parse(o).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(a([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(i("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(a([71],{offset:4})&&(a([71],{offset:192})||a([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(a([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(a([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(a([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(a([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(a([76,80],{offset:34})&&(a([0,0,1],{offset:8})||a([1,0,2],{offset:8})||a([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(a([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await r.peekBuffer(e,{length:Math.min(512,r.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(e))return{ext:"tar",mime:"application/x-tar"};if(a([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(i("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(e.length>=2&&a([255,224],{offset:0,mask:[255,224]})){if(a([16],{offset:1,mask:[22]}))return a([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(a([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(a([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(a([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream$1=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const r=new stream.PassThrough;let e;stream.pipeline?e=stream.pipeline(readableStream,r,()=>{}):e=readableStream.pipe(r);const n=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const a=await fromBuffer(n);r.fileType=a}catch(a){reject(a)}resolve(e)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream:stream$1};Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}});Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}});var core$4=fileType,contentType={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var PARAM_REGEXP=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,TEXT_REGEXP=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,TOKEN_REGEXP=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,QESC_REGEXP=/\\([\u000b\u0020-\u00ff])/g,QUOTE_REGEXP=/([\\"])/g,TYPE_REGEXP$1=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;contentType.format=format$5;contentType.parse=parse$a;function format$5(r){if(!r||typeof r!="object")throw new TypeError("argument obj is required");var e=r.parameters,n=r.type;if(!n||!TYPE_REGEXP$1.test(n))throw new TypeError("invalid type");var a=n;if(e&&typeof e=="object")for(var i,s=Object.keys(e).sort(),o=0;o<s.length;o++){if(i=s[o],!TOKEN_REGEXP.test(i))throw new TypeError("invalid parameter name");a+="; "+i+"="+qstring(e[i])}return a}function parse$a(r){if(!r)throw new TypeError("argument string is required");var e=typeof r=="object"?getcontenttype(r):r;if(typeof e!="string")throw new TypeError("argument string is required to be a string");var n=e.indexOf(";"),a=n!==-1?e.slice(0,n).trim():e.trim();if(!TYPE_REGEXP$1.test(a))throw new TypeError("invalid media type");var i=new ContentType$1(a.toLowerCase());if(n!==-1){var s,o,l;for(PARAM_REGEXP.lastIndex=n;o=PARAM_REGEXP.exec(e);){if(o.index!==n)throw new TypeError("invalid parameter format");n+=o[0].length,s=o[1].toLowerCase(),l=o[2],l.charCodeAt(0)===34&&(l=l.slice(1,-1),l.indexOf("\\")!==-1&&(l=l.replace(QESC_REGEXP,"$1"))),i.parameters[s]=l}if(n!==e.length)throw new TypeError("invalid parameter format")}return i}function getcontenttype(r){var e;if(typeof r.getHeader=="function"?e=r.getHeader("content-type"):typeof r.headers=="object"&&(e=r.headers&&r.headers["content-type"]),typeof e!="string")throw new TypeError("content-type header is missing from object");return e}function qstring(r){var e=String(r);if(TOKEN_REGEXP.test(e))return e;if(e.length>0&&!TEXT_REGEXP.test(e))throw new TypeError("invalid parameter value");return'"'+e.replace(QUOTE_REGEXP,"\\$1")+'"'}function ContentType$1(r){this.parameters=Object.create(null),this.type=r}var mediaTyper={};/*!
 * media-typer
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var SUBTYPE_NAME_REGEXP=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,TYPE_NAME_REGEXP=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,TYPE_REGEXP=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;mediaTyper.format=format$4;mediaTyper.parse=parse$9;mediaTyper.test=test;function format$4(r){if(!r||typeof r!="object")throw new TypeError("argument obj is required");var e=r.subtype,n=r.suffix,a=r.type;if(!a||!TYPE_NAME_REGEXP.test(a))throw new TypeError("invalid type");if(!e||!SUBTYPE_NAME_REGEXP.test(e))throw new TypeError("invalid subtype");var i=a+"/"+e;if(n){if(!TYPE_NAME_REGEXP.test(n))throw new TypeError("invalid suffix");i+="+"+n}return i}function test(r){if(!r)throw new TypeError("argument string is required");if(typeof r!="string")throw new TypeError("argument string is required to be a string");return TYPE_REGEXP.test(r.toLowerCase())}function parse$9(r){if(!r)throw new TypeError("argument string is required");if(typeof r!="string")throw new TypeError("argument string is required to be a string");var e=TYPE_REGEXP.exec(r.toLowerCase());if(!e)throw new TypeError("invalid media type");var n=e[1],a=e[2],i,s=a.lastIndexOf("+");return s!==-1&&(i=a.substr(s+1),a=a.substr(0,s)),new MediaType(n,a,i)}function MediaType(r,e,n){this.type=r,this.subtype=e,this.suffix=n}var MetadataCollector$1={},type$a={},types$1={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TrackType=r.TargetType=r.DataType=void 0,function(e){e[e.string=0]="string",e[e.uint=1]="uint",e[e.uid=2]="uid",e[e.bool=3]="bool",e[e.binary=4]="binary",e[e.float=5]="float"}(r.DataType||(r.DataType={})),function(e){e[e.shot=10]="shot",e[e.scene=20]="scene",e[e.track=30]="track",e[e.part=40]="part",e[e.album=50]="album",e[e.edition=60]="edition",e[e.collection=70]="collection"}(r.TargetType||(r.TargetType={})),function(e){e[e.video=1]="video",e[e.audio=2]="audio",e[e.complex=3]="complex",e[e.logo=4]="logo",e[e.subtitle=17]="subtitle",e[e.button=18]="button",e[e.control=32]="control"}(r.TrackType||(r.TrackType={}))})(types$1);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TrackType=void 0;var e=types$1;Object.defineProperty(r,"TrackType",{enumerable:!0,get:function(){return e.TrackType}})})(type$a);var GenericTagTypes={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.isUnique=r.isSingleton=r.commonTags=void 0,r.commonTags={year:{multiple:!1},track:{multiple:!1},disk:{multiple:!1},title:{multiple:!1},artist:{multiple:!1},artists:{multiple:!0,unique:!0},albumartist:{multiple:!1},album:{multiple:!1},date:{multiple:!1},originaldate:{multiple:!1},originalyear:{multiple:!1},comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:{multiple:!1},subtitle:{multiple:!0},discsubtitle:{multiple:!1},totaltracks:{multiple:!1},totaldiscs:{multiple:!1},compilation:{multiple:!1},rating:{multiple:!0},bpm:{multiple:!1},mood:{multiple:!1},media:{multiple:!1},catalognumber:{multiple:!0,unique:!0},tvShow:{multiple:!1},tvShowSort:{multiple:!1},tvSeason:{multiple:!1},tvEpisode:{multiple:!1},tvEpisodeId:{multiple:!1},tvNetwork:{multiple:!1},podcast:{multiple:!1},podcasturl:{multiple:!1},releasestatus:{multiple:!1},releasetype:{multiple:!0},releasecountry:{multiple:!1},script:{multiple:!1},language:{multiple:!1},copyright:{multiple:!1},license:{multiple:!1},encodedby:{multiple:!1},encodersettings:{multiple:!1},gapless:{multiple:!1},barcode:{multiple:!1},isrc:{multiple:!0},asin:{multiple:!1},musicbrainz_recordingid:{multiple:!1},musicbrainz_trackid:{multiple:!1},musicbrainz_albumid:{multiple:!1},musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:{multiple:!1},musicbrainz_workid:{multiple:!1},musicbrainz_trmid:{multiple:!1},musicbrainz_discid:{multiple:!1},acoustid_id:{multiple:!1},acoustid_fingerprint:{multiple:!1},musicip_puid:{multiple:!1},musicip_fingerprint:{multiple:!1},website:{multiple:!1},"performer:instrument":{multiple:!0,unique:!0},averageLevel:{multiple:!1},peakLevel:{multiple:!1},notes:{multiple:!0,unique:!1},key:{multiple:!1},originalalbum:{multiple:!1},originalartist:{multiple:!1},discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:{multiple:!1},discogs_label_id:{multiple:!1},discogs_master_release_id:{multiple:!1},discogs_votes:{multiple:!1},discogs_rating:{multiple:!1},replaygain_track_peak:{multiple:!1},replaygain_track_gain:{multiple:!1},replaygain_album_peak:{multiple:!1},replaygain_album_gain:{multiple:!1},replaygain_track_minmax:{multiple:!1},replaygain_album_minmax:{multiple:!1},replaygain_undo:{multiple:!1},description:{multiple:!0},longDescription:{multiple:!1},category:{multiple:!0},hdVideo:{multiple:!1},keywords:{multiple:!0},movement:{multiple:!1},movementIndex:{multiple:!1},movementTotal:{multiple:!1},podcastId:{multiple:!1},showMovement:{multiple:!1},stik:{multiple:!1}};function e(a){return r.commonTags.hasOwnProperty(a)&&!r.commonTags[a].multiple}r.isSingleton=e;function n(a){return!r.commonTags[a].multiple||r.commonTags[a].unique}r.isUnique=n})(GenericTagTypes);var CombinedTagMapper$1={},ID3v1TagMap={},GenericTagMapper={};Object.defineProperty(GenericTagMapper,"__esModule",{value:!0});GenericTagMapper.CommonTagMapper=void 0;class CommonTagMapper{static toIntOrNull(e){const n=parseInt(e,10);return isNaN(n)?null:n}static normalizeTrack(e){const n=e.toString().split("/");return{no:parseInt(n[0],10)||null,of:parseInt(n[1],10)||null}}constructor(e,n){this.tagTypes=e,this.tagMap=n}mapGenericTag(e,n){e={id:e.id,value:e.value},this.postMap(e,n);const a=this.getCommonName(e.id);return a?{id:a,value:e.value}:null}getCommonName(e){return this.tagMap[e]}postMap(e,n){}}CommonTagMapper.maxRatingScore=1;GenericTagMapper.CommonTagMapper=CommonTagMapper;Object.defineProperty(ID3v1TagMap,"__esModule",{value:!0});ID3v1TagMap.ID3v1TagMapper=void 0;const GenericTagMapper_1$6=GenericTagMapper,id3v1TagMap={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class ID3v1TagMapper extends GenericTagMapper_1$6.CommonTagMapper{constructor(){super(["ID3v1"],id3v1TagMap)}}ID3v1TagMap.ID3v1TagMapper=ID3v1TagMapper;var ID3v24TagMapper$1={},CaseInsensitiveTagMap$1={};Object.defineProperty(CaseInsensitiveTagMap$1,"__esModule",{value:!0});CaseInsensitiveTagMap$1.CaseInsensitiveTagMap=void 0;const GenericTagMapper_1$5=GenericTagMapper;class CaseInsensitiveTagMap extends GenericTagMapper_1$5.CommonTagMapper{constructor(e,n){const a={};for(const i of Object.keys(n))a[i.toUpperCase()]=n[i];super(e,a)}getCommonName(e){return this.tagMap[e.toUpperCase()]}}CaseInsensitiveTagMap$1.CaseInsensitiveTagMap=CaseInsensitiveTagMap;var Util={};Object.defineProperty(Util,"__esModule",{value:!0});Util.toRatio=Util.dbToRatio=Util.ratioToDb=Util.a2hex=Util.isBitSet=Util.getBitAllignedNumber=Util.stripNulls=Util.decodeString=Util.trimRightNull=Util.findZero=Util.getBit=void 0;function getBit(r,e,n){return(r[e]&1<<n)!==0}Util.getBit=getBit;function findZero(r,e,n,a){let i=e;if(a==="utf16le"){for(;r[i]!==0||r[i+1]!==0;){if(i>=n)return n;i+=2}return i}else{for(;r[i]!==0;){if(i>=n)return n;i++}return i}}Util.findZero=findZero;function trimRightNull(r){const e=r.indexOf("\0");return e===-1?r:r.substr(0,e)}Util.trimRightNull=trimRightNull;function swapBytes(r){const e=r.length;if(e&1)throw new Error("Buffer length must be even");for(let n=0;n<e;n+=2){const a=r[n];r[n]=r[n+1],r[n+1]=a}return r}function decodeString(r,e){if(r[0]===255&&r[1]===254)return decodeString(r.subarray(2),e);if(e==="utf16le"&&r[0]===254&&r[1]===255){if(r.length&1)throw new Error("Expected even number of octets for 16-bit unicode string");return decodeString(swapBytes(r),e)}return Buffer.from(r).toString(e)}Util.decodeString=decodeString;function stripNulls(r){return r=r.replace(/^\x00+/g,""),r=r.replace(/\x00+$/g,""),r}Util.stripNulls=stripNulls;function getBitAllignedNumber(r,e,n,a){const i=e+~~(n/8),s=n%8;let o=r[i];o&=255>>s;const l=8-s,c=a-l;return c<0?o>>=8-s-a:c>0&&(o<<=c,o|=getBitAllignedNumber(r,e,n+l,c)),o}Util.getBitAllignedNumber=getBitAllignedNumber;function isBitSet(r,e,n){return getBitAllignedNumber(r,e,n,1)===1}Util.isBitSet=isBitSet;function a2hex(r){const e=[];for(let n=0,a=r.length;n<a;n++){const i=Number(r.charCodeAt(n)).toString(16);e.push(i.length===1?"0"+i:i)}return e.join(" ")}Util.a2hex=a2hex;function ratioToDb(r){return 10*Math.log10(r)}Util.ratioToDb=ratioToDb;function dbToRatio(r){return Math.pow(10,r/10)}Util.dbToRatio=dbToRatio;function toRatio(r){const e=r.split(" ").map(n=>n.trim().toLowerCase());if(e.length>=1){const n=parseFloat(e[0]);return e.length===2&&e[1]==="db"?{dB:n,ratio:dbToRatio(n)}:{dB:ratioToDb(n),ratio:n}}}Util.toRatio=toRatio;Object.defineProperty(ID3v24TagMapper$1,"__esModule",{value:!0});ID3v24TagMapper$1.ID3v24TagMapper=void 0;const GenericTagMapper_1$4=GenericTagMapper,CaseInsensitiveTagMap_1$2=CaseInsensitiveTagMap$1,util$c=Util,id3v24TagMap={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer","USLT:description":"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"date",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl"};class ID3v24TagMapper extends CaseInsensitiveTagMap_1$2.CaseInsensitiveTagMap{static toRating(e){return{source:e.email,rating:e.rating>0?(e.rating-1)/254*GenericTagMapper_1$4.CommonTagMapper.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],id3v24TagMap)}postMap(e,n){switch(e.id){case"UFID":e.value.owner_identifier==="http://musicbrainz.org"&&(e.id+=":"+e.value.owner_identifier,e.value=util$c.decodeString(e.value.identifier,"latin1"));break;case"PRIV":switch(e.value.owner_identifier){case"AverageLevel":case"PeakValue":e.id+=":"+e.value.owner_identifier,e.value=e.value.data.length===4?e.value.data.readUInt32LE(0):null,e.value===null&&n.addWarning("Failed to parse PRIV:PeakValue");break;default:n.addWarning(`Unknown PRIV owner-identifier: ${e.value.owner_identifier}`)}break;case"COMM":e.value=e.value?e.value.text:null;break;case"POPM":e.value=ID3v24TagMapper.toRating(e.value);break}}}ID3v24TagMapper$1.ID3v24TagMapper=ID3v24TagMapper;var AsfTagMapper$1={};Object.defineProperty(AsfTagMapper$1,"__esModule",{value:!0});AsfTagMapper$1.AsfTagMapper=void 0;const GenericTagMapper_1$3=GenericTagMapper,asfTagMap={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};class AsfTagMapper extends GenericTagMapper_1$3.CommonTagMapper{static toRating(e){return{rating:parseFloat(e+1)/5}}constructor(){super(["asf"],asfTagMap)}postMap(e){switch(e.id){case"WM/SharedUserRating":const n=e.id.split(":");e.value=AsfTagMapper.toRating(e.value),e.id=n[0];break}}}AsfTagMapper$1.AsfTagMapper=AsfTagMapper;var ID3v22TagMapper={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ID3v22TagMapper=r.id3v22TagMap=void 0;const e=CaseInsensitiveTagMap$1;r.id3v22TagMap={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website","COM:iTunPGAP":"gapless",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class n extends e.CaseInsensitiveTagMap{constructor(){super(["ID3v2.2"],r.id3v22TagMap)}}r.ID3v22TagMapper=n})(ID3v22TagMapper);var APEv2TagMapper$1={};Object.defineProperty(APEv2TagMapper$1,"__esModule",{value:!0});APEv2TagMapper$1.APEv2TagMapper=void 0;const CaseInsensitiveTagMap_1$1=CaseInsensitiveTagMap$1,apev2TagMap={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};class APEv2TagMapper extends CaseInsensitiveTagMap_1$1.CaseInsensitiveTagMap{constructor(){super(["APEv2"],apev2TagMap)}}APEv2TagMapper$1.APEv2TagMapper=APEv2TagMapper;var MP4TagMapper={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MP4TagMapper=r.tagType=void 0;const e=CaseInsensitiveTagMap$1,n={"©nam":"title","©ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","©alb":"album","©day":"date","©cmt":"comment","©com":"comment",trkn:"track",disk:"disk","©gen":"genre",covr:"picture","©wrt":"composer","©lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","©grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","©cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","©too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear",desc:"description",ldes:"longDescription","©mvn":"movement","©mvi":"movementIndex","©mvc":"movementTotal","©wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};r.tagType="iTunes";class a extends e.CaseInsensitiveTagMap{constructor(){super([r.tagType],n)}postMap(s,o){switch(s.id){case"rate":s.value={source:void 0,rating:parseFloat(s.value)/100};break}}}r.MP4TagMapper=a})(MP4TagMapper);var VorbisTagMapper$1={};Object.defineProperty(VorbisTagMapper$1,"__esModule",{value:!0});VorbisTagMapper$1.VorbisTagMapper=void 0;const GenericTagMapper_1$2=GenericTagMapper,vorbisTagMap={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};class VorbisTagMapper extends GenericTagMapper_1$2.CommonTagMapper{static toRating(e,n,a){return{source:e&&e.toLowerCase(),rating:parseFloat(n)/a*GenericTagMapper_1$2.CommonTagMapper.maxRatingScore}}constructor(){super(["vorbis"],vorbisTagMap)}postMap(e){if(e.id==="RATING")e.value=VorbisTagMapper.toRating(void 0,e.value,100);else if(e.id.indexOf("RATING:")===0){const n=e.id.split(":");e.value=VorbisTagMapper.toRating(n[1],e.value,1),e.id=n[0]}}}VorbisTagMapper$1.VorbisTagMapper=VorbisTagMapper;var RiffInfoTagMap={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RiffInfoTagMapper=r.riffInfoTagMap=void 0;const e=GenericTagMapper;r.riffInfoTagMap={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class n extends e.CommonTagMapper{constructor(){super(["exif"],r.riffInfoTagMap)}}r.RiffInfoTagMapper=n})(RiffInfoTagMap);var MatroskaTagMapper$1={};Object.defineProperty(MatroskaTagMapper$1,"__esModule",{value:!0});MatroskaTagMapper$1.MatroskaTagMapper=void 0;const CaseInsensitiveTagMap_1=CaseInsensitiveTagMap$1,ebmlTagMap={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};class MatroskaTagMapper extends CaseInsensitiveTagMap_1.CaseInsensitiveTagMap{constructor(){super(["matroska"],ebmlTagMap)}}MatroskaTagMapper$1.MatroskaTagMapper=MatroskaTagMapper;var AiffTagMap={};Object.defineProperty(AiffTagMap,"__esModule",{value:!0});AiffTagMap.AiffTagMapper=void 0;const GenericTagMapper_1$1=GenericTagMapper,tagMap={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class AiffTagMapper extends GenericTagMapper_1$1.CommonTagMapper{constructor(){super(["AIFF"],tagMap)}}AiffTagMap.AiffTagMapper=AiffTagMapper;Object.defineProperty(CombinedTagMapper$1,"__esModule",{value:!0});CombinedTagMapper$1.CombinedTagMapper=void 0;const ID3v1TagMap_1=ID3v1TagMap,ID3v24TagMapper_1=ID3v24TagMapper$1,AsfTagMapper_1=AsfTagMapper$1,ID3v22TagMapper_1=ID3v22TagMapper,APEv2TagMapper_1=APEv2TagMapper$1,MP4TagMapper_1=MP4TagMapper,VorbisTagMapper_1=VorbisTagMapper$1,RiffInfoTagMap_1=RiffInfoTagMap,MatroskaTagMapper_1=MatroskaTagMapper$1,AiffTagMap_1=AiffTagMap;class CombinedTagMapper{constructor(){this.tagMappers={},[new ID3v1TagMap_1.ID3v1TagMapper,new ID3v22TagMapper_1.ID3v22TagMapper,new ID3v24TagMapper_1.ID3v24TagMapper,new MP4TagMapper_1.MP4TagMapper,new MP4TagMapper_1.MP4TagMapper,new VorbisTagMapper_1.VorbisTagMapper,new APEv2TagMapper_1.APEv2TagMapper,new AsfTagMapper_1.AsfTagMapper,new RiffInfoTagMap_1.RiffInfoTagMapper,new MatroskaTagMapper_1.MatroskaTagMapper,new AiffTagMap_1.AiffTagMapper].forEach(e=>{this.registerTagMapper(e)})}mapTag(e,n,a){if(this.tagMappers[e])return this.tagMappers[e].mapGenericTag(n,a);throw new Error("No generic tag mapper defined for tag-format: "+e)}registerTagMapper(e){for(const n of e.tagTypes)this.tagMappers[n]=e}}CombinedTagMapper$1.CombinedTagMapper=CombinedTagMapper;Object.defineProperty(MetadataCollector$1,"__esModule",{value:!0});MetadataCollector$1.joinArtists=MetadataCollector$1.MetadataCollector=void 0;const type_1$2=type$a,debug_1$o=srcExports,GenericTagTypes_1=GenericTagTypes,CombinedTagMapper_1=CombinedTagMapper$1,GenericTagMapper_1=GenericTagMapper,Util_1$1=Util,FileType$1=core$4,debug$p=(0,debug_1$o.default)("music-metadata:collector"),TagPriority=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];class MetadataCollector{constructor(e){this.opts=e,this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new CombinedTagMapper_1.CombinedTagMapper;let n=1;for(const a of TagPriority)this.originPriority[a]=n++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(e){debug$p(`streamInfo: type=${type_1$2.TrackType[e.type]}, codec=${e.codecName}`),this.format.trackInfo.push(e)}setFormat(e,n){debug$p(`format: ${e} = ${n}`),this.format[e]=n,this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:e,value:n}})}addTag(e,n,a){debug$p(`tag ${e}.${n} = ${a}`),this.native[e]||(this.format.tagTypes.push(e),this.native[e]=[]),this.native[e].push({id:n,value:a}),this.toCommon(e,n,a)}addWarning(e){this.quality.warnings.push({message:e})}postMap(e,n){switch(n.id){case"artist":if(this.commonOrigin.artist===this.originPriority[e])return this.postMap("artificial",{id:"artists",value:n.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:n.value});break;case"artists":if((!this.common.artist||this.commonOrigin.artist===this.originPriority.artificial)&&(!this.common.artists||this.common.artists.indexOf(n.value)===-1)){const o=(this.common.artists||[]).concat([n.value]),c={id:"artist",value:joinArtists(o)};this.setGenericTag("artificial",c)}break;case"picture":this.postFixPicture(n.value).then(o=>{o!==null&&(n.value=o,this.setGenericTag(e,n))});return;case"totaltracks":this.common.track.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(n.value);return;case"totaldiscs":this.common.disk.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(n.value);return;case"movementTotal":this.common.movementIndex.of=GenericTagMapper_1.CommonTagMapper.toIntOrNull(n.value);return;case"track":case"disk":case"movementIndex":const a=this.common[n.id].of;this.common[n.id]=GenericTagMapper_1.CommonTagMapper.normalizeTrack(n.value),this.common[n.id].of=a??this.common[n.id].of;return;case"bpm":case"year":case"originalyear":n.value=parseInt(n.value,10);break;case"date":const i=parseInt(n.value.substr(0,4),10);isNaN(i)||(this.common.year=i);break;case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":n.value=typeof n.value=="string"?parseInt(n.value,10):n.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":n.value=(0,Util_1$1.toRatio)(n.value);break;case"replaygain_track_minmax":n.value=n.value.split(",").map(o=>parseInt(o,10));break;case"replaygain_undo":const s=n.value.split(",").map(o=>parseInt(o,10));n.value={leftChannel:s[0],rightChannel:s[1]};break;case"gapless":case"compilation":case"podcast":case"showMovement":n.value=n.value==="1"||n.value===1;break;case"isrc":if(this.common[n.id]&&this.common[n.id].indexOf(n.value)!==-1)return;break}n.value!==null&&this.setGenericTag(e,n)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(e){if(e.data&&e.data.length>0){if(!e.format){const n=await FileType$1.fromBuffer(e.data);if(n)e.format=n.mime;else return null}switch(e.format=e.format.toLocaleLowerCase(),e.format){case"image/jpg":e.format="image/jpeg"}return e}return this.addWarning("Empty picture tag found"),null}toCommon(e,n,a){const i={id:n,value:a},s=this.tagMapper.mapTag(e,i,this);s&&this.postMap(e,s)}setGenericTag(e,n){debug$p(`common.${n.id} = ${n.value}`);const a=this.commonOrigin[n.id]||1e3,i=this.originPriority[e];if((0,GenericTagTypes_1.isSingleton)(n.id))if(i<=a)this.common[n.id]=n.value,this.commonOrigin[n.id]=i;else return debug$p(`Ignore native tag (singleton): ${e}.${n.id} = ${n.value}`);else if(i===a)!(0,GenericTagTypes_1.isUnique)(n.id)||this.common[n.id].indexOf(n.value)===-1?this.common[n.id].push(n.value):debug$p(`Ignore duplicate value: ${e}.${n.id} = ${n.value}`);else if(i<a)this.common[n.id]=[n.value],this.commonOrigin[n.id]=i;else return debug$p(`Ignore native tag (list): ${e}.${n.id} = ${n.value}`);this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:n.id,value:n.value}})}}MetadataCollector$1.MetadataCollector=MetadataCollector;function joinArtists(r){return r.length>2?r.slice(0,r.length-1).join(", ")+" & "+r[r.length-1]:r.join(" & ")}MetadataCollector$1.joinArtists=joinArtists;var AiffParser={},ID3v2Parser$1={},FrameParser$1={},ID3v2Token={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TextEncodingToken=r.ExtendedHeader=r.ID3v2Header=r.UINT32SYNCSAFE=r.AttachedPictureType=void 0;const e=lib$1,n=Util;(function(a){a[a.Other=0]="Other",a[a["32x32 pixels 'file icon' (PNG only)"]=1]="32x32 pixels 'file icon' (PNG only)",a[a["Other file icon"]=2]="Other file icon",a[a["Cover (front)"]=3]="Cover (front)",a[a["Cover (back)"]=4]="Cover (back)",a[a["Leaflet page"]=5]="Leaflet page",a[a["Media (e.g. label side of CD)"]=6]="Media (e.g. label side of CD)",a[a["Lead artist/lead performer/soloist"]=7]="Lead artist/lead performer/soloist",a[a["Artist/performer"]=8]="Artist/performer",a[a.Conductor=9]="Conductor",a[a["Band/Orchestra"]=10]="Band/Orchestra",a[a.Composer=11]="Composer",a[a["Lyricist/text writer"]=12]="Lyricist/text writer",a[a["Recording Location"]=13]="Recording Location",a[a["During recording"]=14]="During recording",a[a["During performance"]=15]="During performance",a[a["Movie/video screen capture"]=16]="Movie/video screen capture",a[a["A bright coloured fish"]=17]="A bright coloured fish",a[a.Illustration=18]="Illustration",a[a["Band/artist logotype"]=19]="Band/artist logotype",a[a["Publisher/Studio logotype"]=20]="Publisher/Studio logotype"})(r.AttachedPictureType||(r.AttachedPictureType={})),r.UINT32SYNCSAFE={get:(a,i)=>a[i+3]&127|a[i+2]<<7|a[i+1]<<14|a[i]<<21,len:4},r.ID3v2Header={len:10,get:(a,i)=>({fileIdentifier:new e.StringType(3,"ascii").get(a,i),version:{major:e.INT8.get(a,i+3),revision:e.INT8.get(a,i+4)},flags:{unsynchronisation:n.getBit(a,i+5,7),isExtendedHeader:n.getBit(a,i+5,6),expIndicator:n.getBit(a,i+5,5),footer:n.getBit(a,i+5,4)},size:r.UINT32SYNCSAFE.get(a,i+6)})},r.ExtendedHeader={len:10,get:(a,i)=>({size:e.UINT32_BE.get(a,i),extendedFlags:e.UINT16_BE.get(a,i+4),sizeOfPadding:e.UINT32_BE.get(a,i+6),crcDataPresent:n.getBit(a,i+4,31)})},r.TextEncodingToken={len:1,get:(a,i)=>{switch(a[i]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf16le",bom:!0};case 2:return{encoding:"utf16le",bom:!1};case 3:return{encoding:"utf8",bom:!1};default:return{encoding:"utf8",bom:!1}}}}})(ID3v2Token);var ID3v1Parser={},BasicParser$1={};Object.defineProperty(BasicParser$1,"__esModule",{value:!0});BasicParser$1.BasicParser=void 0;class BasicParser{init(e,n,a){return this.metadata=e,this.tokenizer=n,this.options=a,this}}BasicParser$1.BasicParser=BasicParser;var APEv2Parser$1={},APEv2Token={},FourCC={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.FourCcToken=void 0;const e=Util,n=/^[\x21-\x7e©][\x20-\x7e\x00()]{3}/;r.FourCcToken={len:4,get:(a,i)=>{const s=a.toString("binary",i,i+r.FourCcToken.len);if(!s.match(n))throw new Error(`FourCC contains invalid characters: ${e.a2hex(s)} "${s}"`);return s},put:(a,i,s)=>{const o=Buffer.from(s,"binary");if(o.length!==4)throw new Error("Invalid length");return o.copy(a,i)}}})(FourCC);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.isBitSet=r.parseTagFlags=r.TagField=r.TagItemHeader=r.TagFooter=r.Header=r.DescriptorParser=r.DataType=void 0;const e=lib$1,n=FourCC;(function(o){o[o.text_utf8=0]="text_utf8",o[o.binary=1]="binary",o[o.external_info=2]="external_info",o[o.reserved=3]="reserved"})(r.DataType||(r.DataType={})),r.DescriptorParser={len:52,get:(o,l)=>({ID:n.FourCcToken.get(o,l),version:e.UINT32_LE.get(o,l+4)/1e3,descriptorBytes:e.UINT32_LE.get(o,l+8),headerBytes:e.UINT32_LE.get(o,l+12),seekTableBytes:e.UINT32_LE.get(o,l+16),headerDataBytes:e.UINT32_LE.get(o,l+20),apeFrameDataBytes:e.UINT32_LE.get(o,l+24),apeFrameDataBytesHigh:e.UINT32_LE.get(o,l+28),terminatingDataBytes:e.UINT32_LE.get(o,l+32),fileMD5:new e.Uint8ArrayType(16).get(o,l+36)})},r.Header={len:24,get:(o,l)=>({compressionLevel:e.UINT16_LE.get(o,l),formatFlags:e.UINT16_LE.get(o,l+2),blocksPerFrame:e.UINT32_LE.get(o,l+4),finalFrameBlocks:e.UINT32_LE.get(o,l+8),totalFrames:e.UINT32_LE.get(o,l+12),bitsPerSample:e.UINT16_LE.get(o,l+16),channel:e.UINT16_LE.get(o,l+18),sampleRate:e.UINT32_LE.get(o,l+20)})},r.TagFooter={len:32,get:(o,l)=>({ID:new e.StringType(8,"ascii").get(o,l),version:e.UINT32_LE.get(o,l+8),size:e.UINT32_LE.get(o,l+12),fields:e.UINT32_LE.get(o,l+16),flags:i(e.UINT32_LE.get(o,l+20))})},r.TagItemHeader={len:8,get:(o,l)=>({size:e.UINT32_LE.get(o,l),flags:i(e.UINT32_LE.get(o,l+4))})};const a=o=>new e.Uint8ArrayType(o.size-r.TagFooter.len);r.TagField=a;function i(o){return{containsHeader:s(o,31),containsFooter:s(o,30),isHeader:s(o,31),readOnly:s(o,0),dataType:(o&6)>>1}}r.parseTagFlags=i;function s(o,l){return(o&1<<l)!==0}r.isBitSet=s})(APEv2Token);Object.defineProperty(APEv2Parser$1,"__esModule",{value:!0});APEv2Parser$1.APEv2Parser=void 0;const debug_1$n=srcExports,strtok3$4=core$5,token_types_1$2=lib$1,util$b=Util,BasicParser_1$b=BasicParser$1,APEv2Token_1=APEv2Token,debug$o=(0,debug_1$n.default)("music-metadata:parser:APEv2"),tagFormat$1="APEv2",preamble="APETAGEX";class APEv2Parser extends BasicParser_1$b.BasicParser{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(e,n,a){const i=new APEv2Parser;return i.init(e,n,a),i.tryParseApeHeader()}static calculateDuration(e){let n=e.totalFrames>1?e.blocksPerFrame*(e.totalFrames-1):0;return n+=e.finalFrameBlocks,n/e.sampleRate}static async findApeFooterOffset(e,n){const a=Buffer.alloc(APEv2Token_1.TagFooter.len);await e.randomRead(a,0,APEv2Token_1.TagFooter.len,n-APEv2Token_1.TagFooter.len);const i=APEv2Token_1.TagFooter.get(a,0);if(i.ID==="APETAGEX")return debug$o(`APE footer header at offset=${n}`),{footer:i,offset:n-i.size}}static parseTagFooter(e,n,a){const i=APEv2Token_1.TagFooter.get(n,n.length-APEv2Token_1.TagFooter.len);if(i.ID!==preamble)throw new Error("Unexpected APEv2 Footer ID preamble value.");strtok3$4.fromBuffer(n);const s=new APEv2Parser;return s.init(e,strtok3$4.fromBuffer(n),a),s.parseTags(i)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<APEv2Token_1.TagFooter.len){debug$o("No APEv2 header found, end-of-file reached");return}const e=await this.tokenizer.peekToken(APEv2Token_1.TagFooter);if(e.ID===preamble)return await this.tokenizer.ignore(APEv2Token_1.TagFooter.len),this.parseTags(e);if(debug$o(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const n=this.tokenizer.fileInfo.size-this.tokenizer.position,a=Buffer.alloc(n);return await this.tokenizer.readBuffer(a),APEv2Parser.parseTagFooter(this.metadata,a,this.options)}}async parse(){const e=await this.tokenizer.readToken(APEv2Token_1.DescriptorParser);if(e.ID!=="MAC ")throw new Error("Unexpected descriptor ID");this.ape.descriptor=e;const n=e.descriptorBytes-APEv2Token_1.DescriptorParser.len,a=await(n>0?this.parseDescriptorExpansion(n):this.parseHeader());return await this.tokenizer.ignore(a.forwardBytes),this.tryParseApeHeader()}async parseTags(e){const n=Buffer.alloc(256);let a=e.size-APEv2Token_1.TagFooter.len;debug$o(`Parse APE tags at offset=${this.tokenizer.position}, size=${a}`);for(let i=0;i<e.fields;i++){if(a<APEv2Token_1.TagItemHeader.len){this.metadata.addWarning(`APEv2 Tag-header: ${e.fields-i} items remaining, but no more tag data to read.`);break}const s=await this.tokenizer.readToken(APEv2Token_1.TagItemHeader);a-=APEv2Token_1.TagItemHeader.len+s.size,await this.tokenizer.peekBuffer(n,{length:Math.min(n.length,a)});let o=util$b.findZero(n,0,n.length);const l=await this.tokenizer.readToken(new token_types_1$2.StringType(o,"ascii"));switch(await this.tokenizer.ignore(1),a-=l.length+1,s.flags.dataType){case APEv2Token_1.DataType.text_utf8:{const d=(await this.tokenizer.readToken(new token_types_1$2.StringType(s.size,"utf8"))).split(/\x00/g);for(const u of d)this.metadata.addTag(tagFormat$1,l,u);break}case APEv2Token_1.DataType.binary:if(this.options.skipCovers)await this.tokenizer.ignore(s.size);else{const c=Buffer.alloc(s.size);await this.tokenizer.readBuffer(c),o=util$b.findZero(c,0,c.length);const d=c.toString("utf8",0,o),u=Buffer.from(c.slice(o+1));this.metadata.addTag(tagFormat$1,l,{description:d,data:u})}break;case APEv2Token_1.DataType.external_info:debug$o(`Ignore external info ${l}`),await this.tokenizer.ignore(s.size);break;case APEv2Token_1.DataType.reserved:debug$o(`Ignore external info ${l}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${l}"`),await this.tokenizer.ignore(s.size);break}}}async parseDescriptorExpansion(e){return await this.tokenizer.ignore(e),this.parseHeader()}async parseHeader(){const e=await this.tokenizer.readToken(APEv2Token_1.Header);return this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("numberOfChannels",e.channel),this.metadata.setFormat("duration",APEv2Parser.calculateDuration(e)),{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}}APEv2Parser$1.APEv2Parser=APEv2Parser;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.hasID3v1Header=r.ID3v1Parser=r.Genres=void 0;const e=srcExports,n=lib$1,a=Util,i=BasicParser$1,s=APEv2Parser$1,o=(0,e.default)("music-metadata:parser:ID3v1");r.Genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];const l={len:128,get:(f,m)=>{const h=new c(3).get(f,m);return h==="TAG"?{header:h,title:new c(30).get(f,m+3),artist:new c(30).get(f,m+33),album:new c(30).get(f,m+63),year:new c(4).get(f,m+93),comment:new c(28).get(f,m+97),zeroByte:n.UINT8.get(f,m+127),track:n.UINT8.get(f,m+126),genre:n.UINT8.get(f,m+127)}:null}};class c extends n.StringType{constructor(m){super(m,"binary")}get(m,h){let w=super.get(m,h);return w=a.trimRightNull(w),w=w.trim(),w.length>0?w:void 0}}class d extends i.BasicParser{static getGenre(m){if(m<r.Genres.length)return r.Genres[m]}async parse(){if(!this.tokenizer.fileInfo.size){o("Skip checking for ID3v1 because the file-size is unknown");return}if(this.options.apeHeader){this.tokenizer.ignore(this.options.apeHeader.offset-this.tokenizer.position);const w=new s.APEv2Parser;w.init(this.metadata,this.tokenizer,this.options),await w.parseTags(this.options.apeHeader.footer)}const m=this.tokenizer.fileInfo.size-l.len;if(this.tokenizer.position>m){o("Already consumed the last 128 bytes");return}const h=await this.tokenizer.readToken(l,m);if(h){o("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-l.len);for(const $ of["title","artist","album","comment","track","year"])h[$]&&h[$]!==""&&this.addTag($,h[$]);const w=d.getGenre(h.genre);w&&this.addTag("genre",w)}else o("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-l.len)}addTag(m,h){this.metadata.addTag("ID3v1",m,h)}}r.ID3v1Parser=d;async function u(f){if(f.fileSize>=128){const m=Buffer.alloc(3);return await f.randomRead(m,0,m.length,f.fileSize-128),m.toString("binary")==="TAG"}return!1}r.hasID3v1Header=u})(ID3v1Parser);Object.defineProperty(FrameParser$1,"__esModule",{value:!0});FrameParser$1.FrameParser=FrameParser$1.parseGenre=void 0;const debug_1$m=srcExports,Token$r=lib$1,util$a=Util,ID3v2Token_1$3=ID3v2Token,ID3v1Parser_1$3=ID3v1Parser,debug$n=(0,debug_1$m.default)("music-metadata:id3v2:frame-parser"),defaultEnc="latin1";function parseGenre(r){const e=[];let n,a="";for(const i of r)if(typeof n=="string")if(i==="("&&n==="")a+="(",n=void 0;else if(i===")"){a!==""&&(e.push(a),a="");const s=parseGenreCode(n);s&&e.push(s),n=void 0}else n+=i;else i==="("?n="":a+=i;return a&&(e.length===0&&a.match(/^\d*$/)&&(a=ID3v1Parser_1$3.Genres[a]),e.push(a)),e}FrameParser$1.parseGenre=parseGenre;function parseGenreCode(r){if(r==="RX")return"Remix";if(r==="CR")return"Cover";if(r.match(/^\d*$/))return ID3v1Parser_1$3.Genres[r]}class FrameParser{constructor(e,n){this.major=e,this.warningCollector=n}readData(e,n,a){if(e.length===0){this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${n}`);return}const{encoding:i,bom:s}=ID3v2Token_1$3.TextEncodingToken.get(e,0),o=e.length;let l=0,c=[];const d=FrameParser.getNullTerminatorLength(i);let u;const f={};switch(debug$n(`Parsing tag type=${n}, encoding=${i}, bom=${s}`),n!=="TXXX"&&n[0]==="T"?"T*":n){case"T*":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":let m;try{m=util$a.decodeString(e.slice(1),i).replace(/\x00+$/,"")}catch($){this.warningCollector.addWarning(`id3v2.${this.major} type=${n} header has invalid string value: ${$.message}`)}switch(n){case"TMCL":case"TIPL":case"IPLS":c=this.splitValue(n,m),c=FrameParser.functionList(c);break;case"TRK":case"TRCK":case"TPOS":c=m;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":c=this.splitValue(n,m);break;case"TCO":case"TCON":c=this.splitValue(n,m).map($=>parseGenre($)).reduce(($,_)=>$.concat(_),[]);break;case"PCS":case"PCST":c=this.major>=4?this.splitValue(n,m):[m],c=Array.isArray(c)&&c[0]===""?1:0;break;default:c=this.major>=4?this.splitValue(n,m):[m]}break;case"TXXX":c=FrameParser.readIdentifierAndData(e,l+1,o,i),c={description:c.id,text:this.splitValue(n,util$a.decodeString(c.data,i).replace(/\x00+$/,""))};break;case"PIC":case"APIC":if(a){const $={};switch(l+=1,this.major){case 2:$.format=util$a.decodeString(e.slice(l,l+3),"latin1"),l+=3;break;case 3:case 4:u=util$a.findZero(e,l,o,defaultEnc),$.format=util$a.decodeString(e.slice(l,u),defaultEnc),l=u+1;break;default:throw new Error("Warning: unexpected major versionIndex: "+this.major)}$.format=FrameParser.fixPictureMimeType($.format),$.type=ID3v2Token_1$3.AttachedPictureType[e[l]],l+=1,u=util$a.findZero(e,l,o,i),$.description=util$a.decodeString(e.slice(l,u),i),l=u+d,$.data=Buffer.from(e.slice(l,o)),c=$}break;case"CNT":case"PCNT":c=Token$r.UINT32_BE.get(e,0);break;case"SYLT":for(l+=7,c=[];l<o;){const $=e.slice(l,l=util$a.findZero(e,l,o,i));l+=5,c.push(util$a.decodeString($,i))}break;case"ULT":case"USLT":case"COM":case"COMM":l+=1,f.language=util$a.decodeString(e.slice(l,l+3),defaultEnc),l+=3,u=util$a.findZero(e,l,o,i),f.description=util$a.decodeString(e.slice(l,u),i),l=u+d,f.text=util$a.decodeString(e.slice(l,o),i).replace(/\x00+$/,""),c=[f];break;case"UFID":c=FrameParser.readIdentifierAndData(e,l,o,defaultEnc),c={owner_identifier:c.id,identifier:c.data};break;case"PRIV":c=FrameParser.readIdentifierAndData(e,l,o,defaultEnc),c={owner_identifier:c.id,data:c.data};break;case"POPM":u=util$a.findZero(e,l,o,defaultEnc);const h=util$a.decodeString(e.slice(l,u),defaultEnc);l=u+1;const w=o-l;c={email:h,rating:Token$r.UINT8.get(e,l),counter:w>=5?Token$r.UINT32_BE.get(e,l+1):void 0};break;case"GEOB":{u=util$a.findZero(e,l+1,o,i);const $=util$a.decodeString(e.slice(l+1,u),defaultEnc);l=u+1,u=util$a.findZero(e,l,o-l,i);const _=util$a.decodeString(e.slice(l,u),defaultEnc);l=u+1,u=util$a.findZero(e,l,o-l,i);const p=util$a.decodeString(e.slice(l,u),defaultEnc);c={type:$,filename:_,description:p,data:e.slice(l+1,o)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":c=util$a.decodeString(e.slice(l,u),defaultEnc);break;case"WXXX":{u=util$a.findZero(e,l+1,o,i);const $=util$a.decodeString(e.slice(l+1,u),i);l=u+(i==="utf16le"?2:1),c={description:$,url:util$a.decodeString(e.slice(l,o),defaultEnc)};break}case"WFD":case"WFED":c=util$a.decodeString(e.slice(l+1,util$a.findZero(e,l+1,o,i)),i);break;case"MCDI":{c=e.slice(0,o);break}default:debug$n("Warning: unsupported id3v2-tag-type: "+n);break}return c}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase(),e){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const n={};for(let a=0;a+1<e.length;a+=2){const i=e[a+1].split(",");n[e[a]]=n.hasOwnProperty(e[a])?n[e[a]].concat(i):i}return n}splitValue(e,n){let a;return this.major<4?(a=n.split(/\x00/g),a.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):a=n.split(/\//g)):a=n.split(/\x00/g),FrameParser.trimArray(a)}static trimArray(e){return e.map(n=>n.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,n,a,i){const s=util$a.findZero(e,n,a,i),o=util$a.decodeString(e.slice(n,s),i);return n=s+FrameParser.getNullTerminatorLength(i),{id:o,data:e.slice(n,a)}}static getNullTerminatorLength(e){return e==="utf16le"?2:1}}FrameParser$1.FrameParser=FrameParser;Object.defineProperty(ID3v2Parser$1,"__esModule",{value:!0});ID3v2Parser$1.ID3v2Parser=void 0;const Token$q=lib$1,util$9=Util,FrameParser_1=FrameParser$1,ID3v2Token_1$2=ID3v2Token;class ID3v2Parser{static removeUnsyncBytes(e){let n=0,a=0;for(;n<e.length-1;)n!==a&&(e[a]=e[n]),n+=e[n]===255&&e[n+1]===0?2:1,a++;return n<e.length&&(e[a++]=e[n]),e.slice(0,a)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw new Error("header versionIndex is incorrect")}}static readFrameFlags(e){return{status:{tag_alter_preservation:util$9.getBit(e,0,6),file_alter_preservation:util$9.getBit(e,0,5),read_only:util$9.getBit(e,0,4)},format:{grouping_identity:util$9.getBit(e,1,7),compression:util$9.getBit(e,1,3),encryption:util$9.getBit(e,1,2),unsynchronisation:util$9.getBit(e,1,1),data_length_indicator:util$9.getBit(e,1,0)}}}static readFrameData(e,n,a,i,s){const o=new FrameParser_1.FrameParser(a,s);switch(a){case 2:return o.readData(e,n.id,i);case 3:case 4:return n.flags.format.unsynchronisation&&(e=ID3v2Parser.removeUnsyncBytes(e)),n.flags.format.data_length_indicator&&(e=e.slice(4,e.length)),o.readData(e,n.id,i);default:throw new Error("Unexpected majorVer: "+a)}}static makeDescriptionTagName(e,n){return e+(n?":"+n:"")}async parse(e,n,a){this.tokenizer=n,this.metadata=e,this.options=a;const i=await this.tokenizer.readToken(ID3v2Token_1$2.ID3v2Header);if(i.fileIdentifier!=="ID3")throw new Error("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=i,this.headerType="ID3v2."+i.version.major,i.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(i.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(ID3v2Token_1$2.ExtendedHeader),n=e.size-ID3v2Token_1$2.ExtendedHeader.len;return n>0?this.parseExtendedHeaderData(n,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,n){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-n)}async parseId3Data(e){const n=await this.tokenizer.readToken(new Token$q.Uint8ArrayType(e));for(const a of this.parseMetadata(n))if(a.id==="TXXX"){if(a.value)for(const i of a.value.text)this.addTag(ID3v2Parser.makeDescriptionTagName(a.id,a.value.description),i)}else if(a.id==="COM")for(const i of a.value)this.addTag(ID3v2Parser.makeDescriptionTagName(a.id,i.description),i.text);else if(a.id==="COMM")for(const i of a.value)this.addTag(ID3v2Parser.makeDescriptionTagName(a.id,i.description),i);else if(Array.isArray(a.value))for(const i of a.value)this.addTag(a.id,i);else this.addTag(a.id,a.value)}addTag(e,n){this.metadata.addTag(this.headerType,e,n)}parseMetadata(e){let n=0;const a=[];for(;n!==e.length;){const i=ID3v2Parser.getFrameHeaderLength(this.id3Header.version.major);if(n+i>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const s=e.slice(n,n+=i),o=this.readFrameHeader(s,this.id3Header.version.major),l=e.slice(n,n+=o.length),c=ID3v2Parser.readFrameData(l,o,this.id3Header.version.major,!this.options.skipCovers,this.metadata);c&&a.push({id:o.id,value:c})}return a}readFrameHeader(e,n){let a;switch(n){case 2:a={id:Buffer.from(e.slice(0,3)).toString("ascii"),length:Token$q.UINT24_BE.get(e,3)},a.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${a.id}`);break;case 3:case 4:a={id:Buffer.from(e.slice(0,4)).toString("ascii"),length:(n===4?ID3v2Token_1$2.UINT32SYNCSAFE:Token$q.UINT32_BE).get(e,4),flags:ID3v2Parser.readFrameFlags(e.slice(8,10))},a.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${a.id}`);break;default:throw new Error("Unexpected majorVer: "+n)}return a}}ID3v2Parser$1.ID3v2Parser=ID3v2Parser;var AiffToken$1={};Object.defineProperty(AiffToken$1,"__esModule",{value:!0});AiffToken$1.Common=void 0;const Token$p=lib$1,FourCC_1$a=FourCC;class Common{constructor(e,n){this.isAifc=n;const a=n?22:18;if(e.chunkSize<a)throw new Error(`COMMON CHUNK size should always be at least ${a}`);this.len=e.chunkSize}get(e,n){const a=e.readUInt16BE(n+8)-16398,i=e.readUInt16BE(n+8+2),s={numChannels:e.readUInt16BE(n),numSampleFrames:e.readUInt32BE(n+2),sampleSize:e.readUInt16BE(n+6),sampleRate:a<0?i>>Math.abs(a):i<<a};if(this.isAifc){if(s.compressionType=FourCC_1$a.FourCcToken.get(e,n+18),this.len>22){const o=e.readInt8(n+22);if(o>0){const l=(o+1)%2;if(23+o+l===this.len)s.compressionName=new Token$p.StringType(o,"binary").get(e,n+23);else throw new Error("Illegal pstring length")}else s.compressionName=void 0}}else s.compressionName="PCM";return s}}AiffToken$1.Common=Common;var iff$1={};Object.defineProperty(iff$1,"__esModule",{value:!0});iff$1.Header=void 0;const Token$o=lib$1,FourCC_1$9=FourCC;iff$1.Header={len:8,get:(r,e)=>({chunkID:FourCC_1$9.FourCcToken.get(r,e),chunkSize:Number(BigInt(Token$o.UINT32_BE.get(r,e+4)))})};Object.defineProperty(AiffParser,"__esModule",{value:!0});AiffParser.AIFFParser=void 0;const Token$n=lib$1,debug_1$l=srcExports,strtok3$3=core$5,ID3v2Parser_1$4=ID3v2Parser$1,FourCC_1$8=FourCC,BasicParser_1$a=BasicParser$1,AiffToken=AiffToken$1,iff=iff$1,debug$m=(0,debug_1$l.default)("music-metadata:parser:aiff"),compressionTypes={NONE:"not compressed	PCM	Apple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float	Apple Computer",alaw:"ALaw 2:1	8-bit ITU-T G.711 A-law",ulaw:"µLaw 2:1	8-bit ITU-T G.711 µ-law	Apple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 µ-law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32	IEEE 32-bit float "};class AIFFParser extends BasicParser_1$a.BasicParser{async parse(){if((await this.tokenizer.readToken(iff.Header)).chunkID!=="FORM")throw new Error("Invalid Chunk-ID, expected 'FORM'");const n=await this.tokenizer.readToken(FourCC_1$8.FourCcToken);switch(n){case"AIFF":this.metadata.setFormat("container",n),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw Error("Unsupported AIFF type: "+n)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=iff.Header.len;){debug$m("Reading AIFF chunk at offset="+this.tokenizer.position);const a=await this.tokenizer.readToken(iff.Header),i=2*Math.round(a.chunkSize/2),s=await this.readData(a);await this.tokenizer.ignore(i-s)}}catch(a){if(a instanceof strtok3$3.EndOfStreamError)debug$m("End-of-stream");else throw a}}async readData(e){var n;switch(e.chunkID){case"COMM":const a=await this.tokenizer.readToken(new AiffToken.Common(e,this.isCompressed));return this.metadata.setFormat("bitsPerSample",a.sampleSize),this.metadata.setFormat("sampleRate",a.sampleRate),this.metadata.setFormat("numberOfChannels",a.numChannels),this.metadata.setFormat("numberOfSamples",a.numSampleFrames),this.metadata.setFormat("duration",a.numSampleFrames/a.sampleRate),this.metadata.setFormat("codec",(n=a.compressionName)!==null&&n!==void 0?n:compressionTypes[a.compressionType]),e.chunkSize;case"ID3 ":const i=await this.tokenizer.readToken(new Token$n.Uint8ArrayType(e.chunkSize)),s=strtok3$3.fromBuffer(i);return await new ID3v2Parser_1$4.ID3v2Parser().parse(this.metadata,s,this.options),e.chunkSize;case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*e.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(e);default:return debug$m(`Ignore chunk id=${e.chunkID}, size=${e.chunkSize}`),0}}async readTextChunk(e){return(await this.tokenizer.readToken(new Token$n.StringType(e.chunkSize,"ascii"))).split("\0").map(a=>a.trim()).filter(a=>a&&a.length>0).forEach(a=>{this.metadata.addTag("AIFF",e.chunkID,a.trim())}),e.chunkSize}}AiffParser.AIFFParser=AIFFParser;var AsfParser$1={},GUID$1={};Object.defineProperty(GUID$1,"__esModule",{value:!0});class GUID{static fromBin(e,n=0){return new GUID(this.decode(e,n))}static decode(e,n=0){return(e.readUInt32LE(n).toString(16)+"-"+e.readUInt16LE(n+4).toString(16)+"-"+e.readUInt16LE(n+6).toString(16)+"-"+e.readUInt16BE(n+8).toString(16)+"-"+e.slice(n+10,n+16).toString("hex")).toUpperCase()}static decodeMediaType(e){switch(e.str){case GUID.AudioMedia.str:return"audio";case GUID.VideoMedia.str:return"video";case GUID.CommandMedia.str:return"command";case GUID.Degradable_JPEG_Media.str:return"degradable-jpeg";case GUID.FileTransferMedia.str:return"file-transfer";case GUID.BinaryMedia.str:return"binary"}}static encode(e){const n=Buffer.alloc(16);return n.writeUInt32LE(parseInt(e.slice(0,8),16),0),n.writeUInt16LE(parseInt(e.slice(9,13),16),4),n.writeUInt16LE(parseInt(e.slice(14,18),16),6),Buffer.from(e.slice(19,23),"hex").copy(n,8),Buffer.from(e.slice(24),"hex").copy(n,10),n}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return GUID.encode(this.str)}}GUID.HeaderObject=new GUID("75B22630-668E-11CF-A6D9-00AA0062CE6C");GUID.DataObject=new GUID("75B22636-668E-11CF-A6D9-00AA0062CE6C");GUID.SimpleIndexObject=new GUID("33000890-E5B1-11CF-89F4-00A0C90349CB");GUID.IndexObject=new GUID("D6E229D3-35DA-11D1-9034-00A0C90349BE");GUID.MediaObjectIndexObject=new GUID("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C");GUID.TimecodeIndexObject=new GUID("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C");GUID.FilePropertiesObject=new GUID("8CABDCA1-A947-11CF-8EE4-00C00C205365");GUID.StreamPropertiesObject=new GUID("B7DC0791-A9B7-11CF-8EE6-00C00C205365");GUID.HeaderExtensionObject=new GUID("5FBF03B5-A92E-11CF-8EE3-00C00C205365");GUID.CodecListObject=new GUID("86D15240-311D-11D0-A3A4-00A0C90348F6");GUID.ScriptCommandObject=new GUID("1EFB1A30-0B62-11D0-A39B-00A0C90348F6");GUID.MarkerObject=new GUID("F487CD01-A951-11CF-8EE6-00C00C205365");GUID.BitrateMutualExclusionObject=new GUID("D6E229DC-35DA-11D1-9034-00A0C90349BE");GUID.ErrorCorrectionObject=new GUID("75B22635-668E-11CF-A6D9-00AA0062CE6C");GUID.ContentDescriptionObject=new GUID("75B22633-668E-11CF-A6D9-00AA0062CE6C");GUID.ExtendedContentDescriptionObject=new GUID("D2D0A440-E307-11D2-97F0-00A0C95EA850");GUID.ContentBrandingObject=new GUID("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E");GUID.StreamBitratePropertiesObject=new GUID("7BF875CE-468D-11D1-8D82-006097C9A2B2");GUID.ContentEncryptionObject=new GUID("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E");GUID.ExtendedContentEncryptionObject=new GUID("298AE614-2622-4C17-B935-DAE07EE9289C");GUID.DigitalSignatureObject=new GUID("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E");GUID.PaddingObject=new GUID("1806D474-CADF-4509-A4BA-9AABCB96AAE8");GUID.ExtendedStreamPropertiesObject=new GUID("14E6A5CB-C672-4332-8399-A96952065B5A");GUID.AdvancedMutualExclusionObject=new GUID("A08649CF-4775-4670-8A16-6E35357566CD");GUID.GroupMutualExclusionObject=new GUID("D1465A40-5A79-4338-B71B-E36B8FD6C249");GUID.StreamPrioritizationObject=new GUID("D4FED15B-88D3-454F-81F0-ED5C45999E24");GUID.BandwidthSharingObject=new GUID("A69609E6-517B-11D2-B6AF-00C04FD908E9");GUID.LanguageListObject=new GUID("7C4346A9-EFE0-4BFC-B229-393EDE415C85");GUID.MetadataObject=new GUID("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA");GUID.MetadataLibraryObject=new GUID("44231C94-9498-49D1-A141-1D134E457054");GUID.IndexParametersObject=new GUID("D6E229DF-35DA-11D1-9034-00A0C90349BE");GUID.MediaObjectIndexParametersObject=new GUID("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7");GUID.TimecodeIndexParametersObject=new GUID("F55E496D-9797-4B5D-8C8B-604DFE9BFB24");GUID.CompatibilityObject=new GUID("26F18B5D-4584-47EC-9F5F-0E651F0452C9");GUID.AdvancedContentEncryptionObject=new GUID("43058533-6981-49E6-9B74-AD12CB86D58C");GUID.AudioMedia=new GUID("F8699E40-5B4D-11CF-A8FD-00805F5C442B");GUID.VideoMedia=new GUID("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B");GUID.CommandMedia=new GUID("59DACFC0-59E6-11D0-A3AC-00A0C90348F6");GUID.JFIF_Media=new GUID("B61BE100-5B4E-11CF-A8FD-00805F5C442B");GUID.Degradable_JPEG_Media=new GUID("35907DE0-E415-11CF-A917-00805F5C442B");GUID.FileTransferMedia=new GUID("91BD222C-F21C-497A-8B6D-5AA86BFC0185");GUID.BinaryMedia=new GUID("3AFB65E2-47EF-40F2-AC2C-70A90D71D343");GUID.ASF_Index_Placeholder_Object=new GUID("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2");GUID$1.default=GUID;var AsfObject$1={},AsfUtil$1={};Object.defineProperty(AsfUtil$1,"__esModule",{value:!0});AsfUtil$1.AsfUtil=void 0;const Token$m=lib$1,util$8=Util;class AsfUtil{static getParserForAttr(e){return AsfUtil.attributeParsers[e]}static parseUnicodeAttr(e){return util$8.stripNulls(util$8.decodeString(e,"utf16le"))}static parseByteArrayAttr(e){return Buffer.from(e)}static parseBoolAttr(e,n=0){return AsfUtil.parseWordAttr(e,n)===1}static parseDWordAttr(e,n=0){return e.readUInt32LE(n)}static parseQWordAttr(e,n=0){return Token$m.UINT64_LE.get(e,n)}static parseWordAttr(e,n=0){return e.readUInt16LE(n)}}AsfUtil.attributeParsers=[AsfUtil.parseUnicodeAttr,AsfUtil.parseByteArrayAttr,AsfUtil.parseBoolAttr,AsfUtil.parseDWordAttr,AsfUtil.parseQWordAttr,AsfUtil.parseWordAttr,AsfUtil.parseByteArrayAttr];AsfUtil$1.AsfUtil=AsfUtil;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WmPictureToken=r.MetadataLibraryObjectState=r.MetadataObjectState=r.ExtendedStreamPropertiesObjectState=r.ExtendedContentDescriptionObjectState=r.ContentDescriptionObjectState=r.readCodecEntries=r.HeaderExtensionObject=r.StreamPropertiesObject=r.FilePropertiesObject=r.IgnoreObjectState=r.State=r.HeaderObjectToken=r.TopLevelHeaderObjectToken=r.DataType=void 0;const e=Util,n=lib$1,a=GUID$1,i=AsfUtil$1,s=ID3v2Token;(function(B){B[B.UnicodeString=0]="UnicodeString",B[B.ByteArray=1]="ByteArray",B[B.Bool=2]="Bool",B[B.DWord=3]="DWord",B[B.QWord=4]="QWord",B[B.Word=5]="Word"})(r.DataType||(r.DataType={})),r.TopLevelHeaderObjectToken={len:30,get:(B,T)=>({objectId:a.default.fromBin(new n.BufferType(16).get(B,T)),objectSize:Number(n.UINT64_LE.get(B,T+16)),numberOfHeaderObjects:n.UINT32_LE.get(B,T+24)})},r.HeaderObjectToken={len:24,get:(B,T)=>({objectId:a.default.fromBin(new n.BufferType(16).get(B,T)),objectSize:Number(n.UINT64_LE.get(B,T+16))})};class o{constructor(T){this.len=Number(T.objectSize)-r.HeaderObjectToken.len}postProcessTag(T,A,ce,V){if(A==="WM/Picture")T.push({id:A,value:U.fromBuffer(V)});else{const R=i.AsfUtil.getParserForAttr(ce);if(!R)throw new Error("unexpected value headerType: "+ce);T.push({id:A,value:R(V)})}}}r.State=o;class l extends o{constructor(T){super(T)}get(T,A){return null}}r.IgnoreObjectState=l;class c extends o{constructor(T){super(T)}get(T,A){return{fileId:a.default.fromBin(T,A),fileSize:n.UINT64_LE.get(T,A+16),creationDate:n.UINT64_LE.get(T,A+24),dataPacketsCount:n.UINT64_LE.get(T,A+32),playDuration:n.UINT64_LE.get(T,A+40),sendDuration:n.UINT64_LE.get(T,A+48),preroll:n.UINT64_LE.get(T,A+56),flags:{broadcast:e.getBit(T,A+64,24),seekable:e.getBit(T,A+64,25)},minimumDataPacketSize:n.UINT32_LE.get(T,A+68),maximumDataPacketSize:n.UINT32_LE.get(T,A+72),maximumBitrate:n.UINT32_LE.get(T,A+76)}}}c.guid=a.default.FilePropertiesObject,r.FilePropertiesObject=c;class d extends o{constructor(T){super(T)}get(T,A){return{streamType:a.default.decodeMediaType(a.default.fromBin(T,A)),errorCorrectionType:a.default.fromBin(T,A+8)}}}d.guid=a.default.StreamPropertiesObject,r.StreamPropertiesObject=d;class u{constructor(){this.len=22}get(T,A){return{reserved1:a.default.fromBin(T,A),reserved2:T.readUInt16LE(A+16),extensionDataSize:T.readUInt32LE(A+18)}}}u.guid=a.default.HeaderExtensionObject,r.HeaderExtensionObject=u;const f={len:20,get:(B,T)=>({entryCount:B.readUInt16LE(T+16)})};async function m(B){const T=await B.readNumber(n.UINT16_LE);return(await B.readToken(new n.StringType(T*2,"utf16le"))).replace("\0","")}async function h(B){const T=await B.readToken(f),A=[];for(let ce=0;ce<T.entryCount;++ce)A.push(await $(B));return A}r.readCodecEntries=h;async function w(B){const T=await B.readNumber(n.UINT16_LE),A=Buffer.alloc(T);return await B.readBuffer(A),A}async function $(B){const T=await B.readNumber(n.UINT16_LE);return{type:{videoCodec:(T&1)===1,audioCodec:(T&2)===2},codecName:await m(B),description:await m(B),information:await w(B)}}class _ extends o{constructor(T){super(T)}get(T,A){const ce=[];let V=A+10;for(let R=0;R<_.contentDescTags.length;++R){const z=T.readUInt16LE(A+R*2);if(z>0){const x=_.contentDescTags[R],M=V+z;ce.push({id:x,value:i.AsfUtil.parseUnicodeAttr(T.slice(V,M))}),V=M}}return ce}}_.guid=a.default.ContentDescriptionObject,_.contentDescTags=["Title","Author","Copyright","Description","Rating"],r.ContentDescriptionObjectState=_;class p extends o{constructor(T){super(T)}get(T,A){const ce=[],V=T.readUInt16LE(A);let R=A+2;for(let z=0;z<V;z+=1){const x=T.readUInt16LE(R);R+=2;const M=i.AsfUtil.parseUnicodeAttr(T.slice(R,R+x));R+=x;const q=T.readUInt16LE(R);R+=2;const X=T.readUInt16LE(R);R+=2;const Z=T.slice(R,R+X);R+=X,this.postProcessTag(ce,M,q,Z)}return ce}}p.guid=a.default.ExtendedContentDescriptionObject,r.ExtendedContentDescriptionObjectState=p;class b extends o{constructor(T){super(T)}get(T,A){return{startTime:n.UINT64_LE.get(T,A),endTime:n.UINT64_LE.get(T,A+8),dataBitrate:T.readInt32LE(A+12),bufferSize:T.readInt32LE(A+16),initialBufferFullness:T.readInt32LE(A+20),alternateDataBitrate:T.readInt32LE(A+24),alternateBufferSize:T.readInt32LE(A+28),alternateInitialBufferFullness:T.readInt32LE(A+32),maximumObjectSize:T.readInt32LE(A+36),flags:{reliableFlag:e.getBit(T,A+40,0),seekableFlag:e.getBit(T,A+40,1),resendLiveCleanpointsFlag:e.getBit(T,A+40,2)},streamNumber:T.readInt16LE(A+42),streamLanguageId:T.readInt16LE(A+44),averageTimePerFrame:T.readInt32LE(A+52),streamNameCount:T.readInt32LE(A+54),payloadExtensionSystems:T.readInt32LE(A+56),streamNames:[],streamPropertiesObject:null}}}b.guid=a.default.ExtendedStreamPropertiesObject,r.ExtendedStreamPropertiesObjectState=b;class v extends o{constructor(T){super(T)}get(T,A){const ce=[],V=Buffer.from(T),R=V.readUInt16LE(A);let z=A+2;for(let x=0;x<R;x+=1){z+=4;const M=V.readUInt16LE(z);z+=2;const q=V.readUInt16LE(z);z+=2;const X=V.readUInt32LE(z);z+=4;const Z=i.AsfUtil.parseUnicodeAttr(V.slice(z,z+M));z+=M;const L=V.slice(z,z+X);z+=X,this.postProcessTag(ce,Z,q,L)}return ce}}v.guid=a.default.MetadataObject,r.MetadataObjectState=v;class j extends v{constructor(T){super(T)}}j.guid=a.default.MetadataLibraryObject,r.MetadataLibraryObjectState=j;class U{static fromBase64(T){return this.fromBuffer(Buffer.from(T,"base64"))}static fromBuffer(T){return new U(T.length).get(T,0)}constructor(T){this.len=T}get(T,A){const ce=T.readUInt8(A++),V=T.readInt32LE(A);let R=5;for(;T.readUInt16BE(R)!==0;)R+=2;const z=T.slice(5,R).toString("utf16le");for(;T.readUInt16BE(R)!==0;)R+=2;const x=T.slice(5,R).toString("utf16le");return{type:s.AttachedPictureType[ce],format:z,description:x,size:V,data:T.slice(R+4)}}}r.WmPictureToken=U})(AsfObject$1);Object.defineProperty(AsfParser$1,"__esModule",{value:!0});AsfParser$1.AsfParser=void 0;const debug_1$k=srcExports,type_1$1=type$a,GUID_1=GUID$1,AsfObject=AsfObject$1,BasicParser_1$9=BasicParser$1,debug$l=(0,debug_1$k.default)("music-metadata:parser:ASF"),headerType="asf";class AsfParser extends BasicParser_1$9.BasicParser{async parse(){const e=await this.tokenizer.readToken(AsfObject.TopLevelHeaderObjectToken);if(!e.objectId.equals(GUID_1.default.HeaderObject))throw new Error("expected asf header; but was not found; got: "+e.objectId.str);try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(n){debug$l("Error while parsing ASF: %s",n)}}async parseObjectHeader(e){let n;do{const a=await this.tokenizer.readToken(AsfObject.HeaderObjectToken);switch(debug$l("header GUID=%s",a.objectId.str),a.objectId.str){case AsfObject.FilePropertiesObject.guid.str:const i=await this.tokenizer.readToken(new AsfObject.FilePropertiesObject(a));this.metadata.setFormat("duration",Number(i.playDuration/BigInt(1e3))/1e4-Number(i.preroll)/1e3),this.metadata.setFormat("bitrate",i.maximumBitrate);break;case AsfObject.StreamPropertiesObject.guid.str:const s=await this.tokenizer.readToken(new AsfObject.StreamPropertiesObject(a));this.metadata.setFormat("container","ASF/"+s.streamType);break;case AsfObject.HeaderExtensionObject.guid.str:const o=await this.tokenizer.readToken(new AsfObject.HeaderExtensionObject);await this.parseExtensionObject(o.extensionDataSize);break;case AsfObject.ContentDescriptionObjectState.guid.str:n=await this.tokenizer.readToken(new AsfObject.ContentDescriptionObjectState(a)),this.addTags(n);break;case AsfObject.ExtendedContentDescriptionObjectState.guid.str:n=await this.tokenizer.readToken(new AsfObject.ExtendedContentDescriptionObjectState(a)),this.addTags(n);break;case GUID_1.default.CodecListObject.str:const l=await AsfObject.readCodecEntries(this.tokenizer);l.forEach(d=>{this.metadata.addStreamInfo({type:d.type.videoCodec?type_1$1.TrackType.video:type_1$1.TrackType.audio,codecName:d.codecName})});const c=l.filter(d=>d.type.audioCodec).map(d=>d.codecName).join("/");this.metadata.setFormat("codec",c);break;case GUID_1.default.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(a.objectSize-AsfObject.HeaderObjectToken.len);break;case GUID_1.default.PaddingObject.str:debug$l("Padding: %s bytes",a.objectSize-AsfObject.HeaderObjectToken.len),await this.tokenizer.ignore(a.objectSize-AsfObject.HeaderObjectToken.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+a.objectId.str),debug$l("Ignore ASF-Object-GUID: %s",a.objectId.str),await this.tokenizer.readToken(new AsfObject.IgnoreObjectState(a))}}while(--e)}addTags(e){e.forEach(n=>{this.metadata.addTag(headerType,n.id,n.value)})}async parseExtensionObject(e){do{const n=await this.tokenizer.readToken(AsfObject.HeaderObjectToken),a=n.objectSize-AsfObject.HeaderObjectToken.len;switch(n.objectId.str){case AsfObject.ExtendedStreamPropertiesObjectState.guid.str:await this.tokenizer.readToken(new AsfObject.ExtendedStreamPropertiesObjectState(n));break;case AsfObject.MetadataObjectState.guid.str:const i=await this.tokenizer.readToken(new AsfObject.MetadataObjectState(n));this.addTags(i);break;case AsfObject.MetadataLibraryObjectState.guid.str:const s=await this.tokenizer.readToken(new AsfObject.MetadataLibraryObjectState(n));this.addTags(s);break;case GUID_1.default.PaddingObject.str:await this.tokenizer.ignore(a);break;case GUID_1.default.CompatibilityObject.str:this.tokenizer.ignore(a);break;case GUID_1.default.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(a);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+n.objectId.str),await this.tokenizer.readToken(new AsfObject.IgnoreObjectState(n));break}e-=n.objectSize}while(e>0)}}AsfParser$1.AsfParser=AsfParser;var FlacParser$1={},Vorbis={};Object.defineProperty(Vorbis,"__esModule",{value:!0});Vorbis.IdentificationHeader=Vorbis.CommonHeader=Vorbis.VorbisPictureToken=void 0;const Token$l=lib$1,ID3v2Token_1$1=ID3v2Token;class VorbisPictureToken{static fromBase64(e){return this.fromBuffer(Buffer.from(e,"base64"))}static fromBuffer(e){return new VorbisPictureToken(e.length).get(e,0)}constructor(e){this.len=e}get(e,n){const a=ID3v2Token_1$1.AttachedPictureType[Token$l.UINT32_BE.get(e,n)],i=Token$l.UINT32_BE.get(e,n+=4),s=e.toString("utf-8",n+=4,n+i),o=Token$l.UINT32_BE.get(e,n+=i),l=e.toString("utf-8",n+=4,n+o),c=Token$l.UINT32_BE.get(e,n+=o),d=Token$l.UINT32_BE.get(e,n+=4),u=Token$l.UINT32_BE.get(e,n+=4),f=Token$l.UINT32_BE.get(e,n+=4),m=Token$l.UINT32_BE.get(e,n+=4),h=Buffer.from(e.slice(n+=4,n+m));return{type:a,format:s,description:l,width:c,height:d,colour_depth:u,indexed_color:f,data:h}}}Vorbis.VorbisPictureToken=VorbisPictureToken;Vorbis.CommonHeader={len:7,get:(r,e)=>({packetType:r.readUInt8(e),vorbis:new Token$l.StringType(6,"ascii").get(r,e+1)})};Vorbis.IdentificationHeader={len:23,get:(r,e)=>{const n=new DataView(r.buffer,r.byteOffset);return{version:n.getUint32(e+0,!0),channelMode:n.getUint8(e+4),sampleRate:n.getUint32(e+5,!0),bitrateMax:n.getUint32(e+9,!0),bitrateNominal:n.getUint32(e+13,!0),bitrateMin:n.getUint32(e+17,!0)}}};var AbstractID3Parser$1={};Object.defineProperty(AbstractID3Parser$1,"__esModule",{value:!0});AbstractID3Parser$1.AbstractID3Parser=void 0;const core_1$4=core$5,debug_1$j=srcExports,ID3v2Token_1=ID3v2Token,ID3v2Parser_1$3=ID3v2Parser$1,ID3v1Parser_1$2=ID3v1Parser,BasicParser_1$8=BasicParser$1,debug$k=(0,debug_1$j.default)("music-metadata:parser:ID3");class AbstractID3Parser extends BasicParser_1$8.BasicParser{constructor(){super(...arguments),this.id3parser=new ID3v2Parser_1$3.ID3v2Parser}static async startsWithID3v2Header(e){return(await e.peekToken(ID3v2Token_1.ID3v2Header)).fileIdentifier==="ID3"}async parse(){try{await this.parseID3v2()}catch(e){if(e instanceof core_1$4.EndOfStreamError)debug$k("End-of-stream");else throw e}}finalize(){}async parseID3v2(){await this.tryReadId3v2Headers(),debug$k("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny()?this.finalize():(await new ID3v1Parser_1$2.ID3v1Parser().init(this.metadata,this.tokenizer,this.options).parse(),this.finalize())}async tryReadId3v2Headers(){if((await this.tokenizer.peekToken(ID3v2Token_1.ID3v2Header)).fileIdentifier==="ID3")return debug$k("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}AbstractID3Parser$1.AbstractID3Parser=AbstractID3Parser;var VorbisParser$1={},VorbisDecoder$1={};Object.defineProperty(VorbisDecoder$1,"__esModule",{value:!0});VorbisDecoder$1.VorbisDecoder=void 0;const Token$k=lib$1;class VorbisDecoder{constructor(e,n){this.data=e,this.offset=n}readInt32(){const e=Token$k.UINT32_LE.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),n=Buffer.from(this.data).toString("utf-8",this.offset,this.offset+e);return this.offset+=e,n}parseUserComment(){const e=this.offset,n=this.readStringUtf8(),a=n.indexOf("=");return{key:n.slice(0,a).toUpperCase(),value:n.slice(a+1),len:this.offset-e}}}VorbisDecoder$1.VorbisDecoder=VorbisDecoder;Object.defineProperty(VorbisParser$1,"__esModule",{value:!0});VorbisParser$1.VorbisParser=void 0;const Token$j=lib$1,debug_1$i=srcExports,VorbisDecoder_1$1=VorbisDecoder$1,Vorbis_1$1=Vorbis,debug$j=(0,debug_1$i.default)("music-metadata:parser:ogg:vorbis1");class VorbisParser{constructor(e,n){this.metadata=e,this.options=n,this.pageSegments=[]}parsePage(e,n){if(e.headerType.firstPage)this.parseFirstPage(e,n);else{if(e.headerType.continued){if(this.pageSegments.length===0)throw new Error("Cannot continue on previous page");this.pageSegments.push(n)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const a=Buffer.concat(this.pageSegments);this.parseFullPage(a)}this.pageSegments=e.headerType.lastPage?[]:[n]}}e.headerType.lastPage&&this.calculateDuration(e)}flush(){this.parseFullPage(Buffer.concat(this.pageSegments))}parseUserComment(e,n){const i=new VorbisDecoder_1$1.VorbisDecoder(e,n).parseUserComment();return this.addTag(i.key,i.value),i.len}addTag(e,n){if(e==="METADATA_BLOCK_PICTURE"&&typeof n=="string"){if(this.options.skipCovers){debug$j("Ignore picture");return}n=Vorbis_1$1.VorbisPictureToken.fromBase64(n),debug$j(`Push picture: id=${e}, format=${n.format}`)}else debug$j(`Push tag: id=${e}, value=${n}`);this.metadata.addTag("vorbis",e,n)}calculateDuration(e){this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",e.absoluteGranulePosition),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate))}parseFirstPage(e,n){this.metadata.setFormat("codec","Vorbis I"),debug$j("Parse first page");const a=Vorbis_1$1.CommonHeader.get(n,0);if(a.vorbis!=="vorbis")throw new Error("Metadata does not look like Vorbis");if(a.packetType===1){const i=Vorbis_1$1.IdentificationHeader.get(n,Vorbis_1$1.CommonHeader.len);this.metadata.setFormat("sampleRate",i.sampleRate),this.metadata.setFormat("bitrate",i.bitrateNominal),this.metadata.setFormat("numberOfChannels",i.channelMode),debug$j("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",i.sampleRate,i.bitrateNominal,i.channelMode)}else throw new Error("First Ogg page should be type 1: the identification header")}parseFullPage(e){const n=Vorbis_1$1.CommonHeader.get(e,0);switch(debug$j("Parse full page: type=%s, byteLength=%s",n.packetType,e.byteLength),n.packetType){case 3:return this.parseUserCommentList(e,Vorbis_1$1.CommonHeader.len)}}parseUserCommentList(e,n){const a=Token$j.UINT32_LE.get(e,n);n+=4,n+=a;let i=Token$j.UINT32_LE.get(e,n);for(n+=4;i-- >0;)n+=this.parseUserComment(e,n)}}VorbisParser$1.VorbisParser=VorbisParser;Object.defineProperty(FlacParser$1,"__esModule",{value:!0});FlacParser$1.FlacParser=void 0;const token_types_1$1=lib$1,debug_1$h=srcExports,util$7=Util,Vorbis_1=Vorbis,AbstractID3Parser_1$3=AbstractID3Parser$1,FourCC_1$7=FourCC,VorbisParser_1$3=VorbisParser$1,VorbisDecoder_1=VorbisDecoder$1,debug$i=(0,debug_1$h.default)("music-metadata:parser:FLAC");var BlockType;(function(r){r[r.STREAMINFO=0]="STREAMINFO",r[r.PADDING=1]="PADDING",r[r.APPLICATION=2]="APPLICATION",r[r.SEEKTABLE=3]="SEEKTABLE",r[r.VORBIS_COMMENT=4]="VORBIS_COMMENT",r[r.CUESHEET=5]="CUESHEET",r[r.PICTURE=6]="PICTURE"})(BlockType||(BlockType={}));class FlacParser extends AbstractID3Parser_1$3.AbstractID3Parser{constructor(){super(...arguments),this.padding=0}init(e,n,a){return super.init(e,n,a),this.vorbisParser=new VorbisParser_1$3.VorbisParser(e,a),this}async postId3v2Parse(){if((await this.tokenizer.readToken(FourCC_1$7.FourCcToken)).toString()!=="fLaC")throw new Error("Invalid FLAC preamble");let n;do n=await this.tokenizer.readToken(Metadata.BlockHeader),await this.parseDataBlock(n);while(!n.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const a=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*a/this.metadata.format.duration)}}parseDataBlock(e){switch(debug$i(`blockHeader type=${e.type}, length=${e.length}`),e.type){case BlockType.STREAMINFO:return this.parseBlockStreamInfo(e.length);case BlockType.PADDING:this.padding+=e.length;break;case BlockType.APPLICATION:break;case BlockType.SEEKTABLE:break;case BlockType.VORBIS_COMMENT:return this.parseComment(e.length);case BlockType.CUESHEET:break;case BlockType.PICTURE:return this.parsePicture(e.length).then();default:this.metadata.addWarning("Unknown block type: "+e.type)}return this.tokenizer.ignore(e.length).then()}async parseBlockStreamInfo(e){if(e!==Metadata.BlockStreamInfo.len)throw new Error("Unexpected block-stream-info length");const n=await this.tokenizer.readToken(Metadata.BlockStreamInfo);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",n.channels),this.metadata.setFormat("bitsPerSample",n.bitsPerSample),this.metadata.setFormat("sampleRate",n.sampleRate),n.totalSamples>0&&this.metadata.setFormat("duration",n.totalSamples/n.sampleRate)}async parseComment(e){const n=await this.tokenizer.readToken(new token_types_1$1.Uint8ArrayType(e)),a=new VorbisDecoder_1.VorbisDecoder(n,0);a.readStringUtf8();const i=a.readInt32();for(let s=0;s<i;s++){const o=a.parseUserComment();this.vorbisParser.addTag(o.key,o.value)}}async parsePicture(e){if(this.options.skipCovers)return this.tokenizer.ignore(e);{const n=await this.tokenizer.readToken(new Vorbis_1.VorbisPictureToken(e));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",n)}}}FlacParser$1.FlacParser=FlacParser;class Metadata{}Metadata.BlockHeader={len:4,get:(r,e)=>({lastBlock:util$7.getBit(r,e,7),type:util$7.getBitAllignedNumber(r,e,1,7),length:token_types_1$1.UINT24_BE.get(r,e+1)})};Metadata.BlockStreamInfo={len:34,get:(r,e)=>({minimumBlockSize:token_types_1$1.UINT16_BE.get(r,e),maximumBlockSize:token_types_1$1.UINT16_BE.get(r,e+2)/1e3,minimumFrameSize:token_types_1$1.UINT24_BE.get(r,e+4),maximumFrameSize:token_types_1$1.UINT24_BE.get(r,e+7),sampleRate:token_types_1$1.UINT24_BE.get(r,e+10)>>4,channels:util$7.getBitAllignedNumber(r,e+12,4,3)+1,bitsPerSample:util$7.getBitAllignedNumber(r,e+12,7,5)+1,totalSamples:util$7.getBitAllignedNumber(r,e+13,4,36),fileMD5:new token_types_1$1.Uint8ArrayType(16).get(r,e+18)})};var MP4Parser$1={},Atom$1={},AtomToken$2={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ChapterText=r.StcoAtom=r.StszAtom=r.StscAtom=r.SampleToChunkToken=r.SttsAtom=r.TimeToSampleToken=r.SoundSampleDescriptionV0=r.SoundSampleDescriptionVersion=r.StsdAtom=r.TrackHeaderAtom=r.NameAtom=r.DataAtom=r.MvhdAtom=r.MdhdAtom=r.FixedLengthAtom=r.mhdr=r.tkhd=r.ftyp=r.ExtendedSize=r.Header=void 0;const e=lib$1,n=srcExports,a=FourCC,i=(0,n.default)("music-metadata:parser:MP4:atom");r.Header={len:8,get:(B,T)=>{const A=e.UINT32_BE.get(B,T);if(A<0)throw new Error("Invalid atom header length");return{length:BigInt(A),name:new e.StringType(4,"binary").get(B,T+4)}},put:(B,T,A)=>(e.UINT32_BE.put(B,T,Number(A.length)),a.FourCcToken.put(B,T+4,A.name))},r.ExtendedSize=e.UINT64_BE,r.ftyp={len:4,get:(B,T)=>({type:new e.StringType(4,"ascii").get(B,T)})},r.tkhd={len:4,get:(B,T)=>({type:new e.StringType(4,"ascii").get(B,T)})},r.mhdr={len:8,get:(B,T)=>({version:e.UINT8.get(B,T),flags:e.UINT24_BE.get(B,T+1),nextItemID:e.UINT32_BE.get(B,T+4)})};class s{constructor(T,A,ce){if(this.len=T,T<A)throw new Error(`Atom ${ce} expected to be ${A}, but specifies ${T} bytes long.`);T>A&&i(`Warning: atom ${ce} expected to be ${A}, but was actually ${T} bytes long.`)}}r.FixedLengthAtom=s;const o={len:4,get:(B,T)=>{const A=e.UINT32_BE.get(B,T)-2082844800;return new Date(A*1e3)}};class l extends s{constructor(T){super(T,24,"mdhd"),this.len=T}get(T,A){return{version:e.UINT8.get(T,A+0),flags:e.UINT24_BE.get(T,A+1),creationTime:o.get(T,A+4),modificationTime:o.get(T,A+8),timeScale:e.UINT32_BE.get(T,A+12),duration:e.UINT32_BE.get(T,A+16),language:e.UINT16_BE.get(T,A+20),quality:e.UINT16_BE.get(T,A+22)}}}r.MdhdAtom=l;class c extends s{constructor(T){super(T,100,"mvhd"),this.len=T}get(T,A){return{version:e.UINT8.get(T,A),flags:e.UINT24_BE.get(T,A+1),creationTime:o.get(T,A+4),modificationTime:o.get(T,A+8),timeScale:e.UINT32_BE.get(T,A+12),duration:e.UINT32_BE.get(T,A+16),preferredRate:e.UINT32_BE.get(T,A+20),preferredVolume:e.UINT16_BE.get(T,A+24),previewTime:e.UINT32_BE.get(T,A+72),previewDuration:e.UINT32_BE.get(T,A+76),posterTime:e.UINT32_BE.get(T,A+80),selectionTime:e.UINT32_BE.get(T,A+84),selectionDuration:e.UINT32_BE.get(T,A+88),currentTime:e.UINT32_BE.get(T,A+92),nextTrackID:e.UINT32_BE.get(T,A+96)}}}r.MvhdAtom=c;class d{constructor(T){this.len=T}get(T,A){return{type:{set:e.UINT8.get(T,A+0),type:e.UINT24_BE.get(T,A+1)},locale:e.UINT24_BE.get(T,A+4),value:Buffer.from(new e.Uint8ArrayType(this.len-8).get(T,A+8))}}}r.DataAtom=d;class u{constructor(T){this.len=T}get(T,A){return{version:e.UINT8.get(T,A),flags:e.UINT24_BE.get(T,A+1),name:new e.StringType(this.len-4,"utf-8").get(T,A+4)}}}r.NameAtom=u;class f{constructor(T){this.len=T}get(T,A){return{version:e.UINT8.get(T,A),flags:e.UINT24_BE.get(T,A+1),creationTime:o.get(T,A+4),modificationTime:o.get(T,A+8),trackId:e.UINT32_BE.get(T,A+12),duration:e.UINT32_BE.get(T,A+20),layer:e.UINT16_BE.get(T,A+24),alternateGroup:e.UINT16_BE.get(T,A+26),volume:e.UINT16_BE.get(T,A+28)}}}r.TrackHeaderAtom=f;const m={len:8,get:(B,T)=>({version:e.UINT8.get(B,T),flags:e.UINT24_BE.get(B,T+1),numberOfEntries:e.UINT32_BE.get(B,T+4)})};class h{constructor(T){this.len=T}get(T,A){return{dataFormat:a.FourCcToken.get(T,A),dataReferenceIndex:e.UINT16_BE.get(T,A+10),description:new e.Uint8ArrayType(this.len-12).get(T,A+12)}}}class w{constructor(T){this.len=T}get(T,A){const ce=m.get(T,A);A+=m.len;const V=[];for(let R=0;R<ce.numberOfEntries;++R){const z=e.UINT32_BE.get(T,A);A+=e.UINT32_BE.len,V.push(new h(z).get(T,A)),A+=z}return{header:ce,table:V}}}r.StsdAtom=w,r.SoundSampleDescriptionVersion={len:8,get(B,T){return{version:e.INT16_BE.get(B,T),revision:e.INT16_BE.get(B,T+2),vendor:e.INT32_BE.get(B,T+4)}}},r.SoundSampleDescriptionV0={len:12,get(B,T){return{numAudioChannels:e.INT16_BE.get(B,T+0),sampleSize:e.INT16_BE.get(B,T+2),compressionId:e.INT16_BE.get(B,T+4),packetSize:e.INT16_BE.get(B,T+6),sampleRate:e.UINT16_BE.get(B,T+8)+e.UINT16_BE.get(B,T+10)/1e4}}};class ${constructor(T,A){this.len=T,this.token=A}get(T,A){const ce=e.INT32_BE.get(T,A+4);return{version:e.INT8.get(T,A+0),flags:e.INT24_BE.get(T,A+1),numberOfEntries:ce,entries:U(T,this.token,A+8,this.len-8,ce)}}}r.TimeToSampleToken={len:8,get(B,T){return{count:e.INT32_BE.get(B,T+0),duration:e.INT32_BE.get(B,T+4)}}};class _ extends ${constructor(T){super(T,r.TimeToSampleToken),this.len=T}}r.SttsAtom=_,r.SampleToChunkToken={len:12,get(B,T){return{firstChunk:e.INT32_BE.get(B,T),samplesPerChunk:e.INT32_BE.get(B,T+4),sampleDescriptionId:e.INT32_BE.get(B,T+8)}}};class p extends ${constructor(T){super(T,r.SampleToChunkToken),this.len=T}}r.StscAtom=p;class b{constructor(T){this.len=T}get(T,A){const ce=e.INT32_BE.get(T,A+8);return{version:e.INT8.get(T,A),flags:e.INT24_BE.get(T,A+1),sampleSize:e.INT32_BE.get(T,A+4),numberOfEntries:ce,entries:U(T,e.INT32_BE,A+12,this.len-12,ce)}}}r.StszAtom=b;class v extends ${constructor(T){super(T,e.INT32_BE),this.len=T}}r.StcoAtom=v;class j{constructor(T){this.len=T}get(T,A){const ce=e.INT16_BE.get(T,A+0);return new e.StringType(ce,"utf-8").get(T,A+2)}}r.ChapterText=j;function U(B,T,A,ce,V){if(i(`remainingLen=${ce}, numberOfEntries=${V} * token-len=${T.len}`),ce===0)return[];if(ce!==V*T.len)throw new Error("mismatch number-of-entries with remaining atom-length");const R=[];for(let z=0;z<V;++z)R.push(T.get(B,A)),A+=T.len;return R}})(AtomToken$2);Object.defineProperty(Atom$1,"__esModule",{value:!0});Atom$1.Atom=void 0;const debug_1$g=srcExports,AtomToken$1=AtomToken$2,debug$h=(0,debug_1$g.default)("music-metadata:parser:MP4:Atom");class Atom{static async readAtom(e,n,a,i){const s=e.position,o=await e.readToken(AtomToken$1.Header);o.length===BigInt(1)&&(o.length=await e.readToken(AtomToken$1.ExtendedSize));const c=new Atom(o,o.length===BigInt(1),a),d=c.getPayloadLength(i);return debug$h(`parse atom name=${c.atomPath}, extended=${c.extended}, offset=${s}, len=${c.header.length}`),await c.readData(e,n,d),c}constructor(e,n,a){this.header=e,this.extended=n,this.parent=a,this.children=[],this.atomPath=(this.parent?this.parent.atomPath+".":"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(this.header.length===BigInt(0)?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,n,a){for(;a>0;){const i=await Atom.readAtom(e,n,this,a);this.children.push(i),a-=i.header.length===BigInt(0)?a:Number(i.header.length)}}async readData(e,n,a){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(e,n,this.getPayloadLength(a));case"meta":const s=(await e.peekToken(AtomToken$1.Header)).name==="hdlr"?0:4;return await e.ignore(s),this.readAtoms(e,n,this.getPayloadLength(a)-s);case"mdhd":case"mvhd":case"tkhd":case"stsz":case"mdat":default:return n(this,a)}}}Atom$1.Atom=Atom;Object.defineProperty(MP4Parser$1,"__esModule",{value:!0});MP4Parser$1.MP4Parser=void 0;const debug_1$f=srcExports,Token$i=lib$1,BasicParser_1$7=BasicParser$1,ID3v1Parser_1$1=ID3v1Parser,type_1=type$a,Atom_1=Atom$1,AtomToken=AtomToken$2,debug$g=(0,debug_1$f.default)("music-metadata:parser:MP4"),tagFormat="iTunes",encoderDict={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function distinct(r,e,n){return n.indexOf(r)===e}class MP4Parser extends BasicParser_1$7.BasicParser{constructor(){super(...arguments),this.atomParsers={mvhd:async e=>{const n=await this.tokenizer.readToken(new AtomToken.MvhdAtom(e));this.metadata.setFormat("creationTime",n.creationTime),this.metadata.setFormat("modificationTime",n.modificationTime)},mdhd:async e=>{const n=await this.tokenizer.readToken(new AtomToken.MdhdAtom(e)),a=this.getTrackDescription();a.creationTime=n.creationTime,a.modificationTime=n.modificationTime,a.timeScale=n.timeScale,a.duration=n.duration},chap:async e=>{const n=this.getTrackDescription(),a=[];for(;e>=Token$i.UINT32_BE.len;)a.push(await this.tokenizer.readNumber(Token$i.UINT32_BE)),e-=Token$i.UINT32_BE.len;n.chapterList=a},tkhd:async e=>{const n=await this.tokenizer.readToken(new AtomToken.TrackHeaderAtom(e));this.tracks.push(n)},mdat:async e=>{if(this.audioLengthInBytes=e,this.calculateBitRate(),this.options.includeChapters){const n=this.tracks.filter(a=>a.chapterList);if(n.length===1){const a=n[0].chapterList,i=this.tracks.filter(s=>a.indexOf(s.trackId)!==-1);if(i.length===1)return this.parseChapterTrack(i[0],n[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const n=[];for(;e>0;){const i=await this.tokenizer.readToken(AtomToken.ftyp);e-=AtomToken.ftyp.len;const s=i.type.replace(/\W/g,"");s.length>0&&n.push(s)}debug$g(`ftyp: ${n.join("/")}`);const a=n.filter(distinct).join("/");this.metadata.setFormat("container",a)},stsd:async e=>{const n=await this.tokenizer.readToken(new AtomToken.StsdAtom(e)),a=this.getTrackDescription();a.soundSampleDescription=n.table.map(i=>this.parseSoundSampleDescription(i))},stsc:async e=>{const n=await this.tokenizer.readToken(new AtomToken.StscAtom(e));this.getTrackDescription().sampleToChunkTable=n.entries},stts:async e=>{const n=await this.tokenizer.readToken(new AtomToken.SttsAtom(e));this.getTrackDescription().timeToSampleTable=n.entries},stsz:async e=>{const n=await this.tokenizer.readToken(new AtomToken.StszAtom(e)),a=this.getTrackDescription();a.sampleSize=n.sampleSize,a.sampleSizeTable=n.entries},stco:async e=>{const n=await this.tokenizer.readToken(new AtomToken.StcoAtom(e));this.getTrackDescription().chunkOffsetTable=n.entries},date:async e=>{const n=await this.tokenizer.readToken(new Token$i.StringType(e,"utf-8"));this.addTag("date",n)}}}static read_BE_Integer(e,n){const a=(n?"INT":"UINT")+e.length*8+(e.length>1?"_BE":""),i=Token$i[a];if(!i)throw new Error('Token for integer type not found: "'+a+'"');return Number(i.get(e,0))}async parse(){this.tracks=[];let e=this.tokenizer.fileInfo.size;for(;!this.tokenizer.fileInfo.size||e>0;){try{if((await this.tokenizer.peekToken(AtomToken.Header)).name==="\0\0\0\0"){const o=`Error at offset=${this.tokenizer.position}: box.id=0`;debug$g(o),this.addWarning(o);break}}catch(s){const o=`Error at offset=${this.tokenizer.position}: ${s.message}`;debug$g(o),this.addWarning(o);break}const i=await Atom_1.Atom.readAtom(this.tokenizer,(s,o)=>this.handleAtom(s,o),null,e);e-=i.header.length===BigInt(0)?e:Number(i.header.length)}const n=[];this.tracks.forEach(i=>{const s=[];i.soundSampleDescription.forEach(o=>{const l={},c=encoderDict[o.dataFormat];if(c?(s.push(c.format),l.codecName=c.format):l.codecName=`<${o.dataFormat}>`,o.description){const{description:d}=o;d.sampleRate>0&&(l.type=type_1.TrackType.audio,l.audio={samplingFrequency:d.sampleRate,bitDepth:d.sampleSize,channels:d.numAudioChannels})}this.metadata.addStreamInfo(l)}),s.length>=1&&n.push(s.join("/"))}),n.length>0&&this.metadata.setFormat("codec",n.filter(distinct).join("+"));const a=this.tracks.filter(i=>i.soundSampleDescription.length>=1&&i.soundSampleDescription[0].description&&i.soundSampleDescription[0].description.numAudioChannels>0);if(a.length>=1){const i=a[0];if(i.timeScale>0){const l=i.duration/i.timeScale;this.metadata.setFormat("duration",l)}const s=i.soundSampleDescription[0];if(s.description&&(this.metadata.setFormat("sampleRate",s.description.sampleRate),this.metadata.setFormat("bitsPerSample",s.description.sampleSize),this.metadata.setFormat("numberOfChannels",s.description.numAudioChannels),i.timeScale===0&&i.timeToSampleTable.length>0)){const c=i.timeToSampleTable.map(d=>d.count*d.duration).reduce((d,u)=>d+u)/s.description.sampleRate;this.metadata.setFormat("duration",c)}const o=encoderDict[s.dataFormat];o&&this.metadata.setFormat("lossless",!o.lossy),this.calculateBitRate()}}async handleAtom(e,n){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](n);debug$g(`No parser for atom path=${e.atomPath}, payload-len=${n}, ignoring atom`),await this.tokenizer.ignore(n)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}addTag(e,n){this.metadata.addTag(tagFormat,e,n)}addWarning(e){debug$g("Warning: "+e),this.metadata.addWarning(e)}parseMetadataItemData(e){let n=e.header.name;return e.readAtoms(this.tokenizer,async(a,i)=>{const s=a.getPayloadLength(i);switch(a.header.name){case"data":return this.parseValueAtom(n,a);case"name":case"mean":case"rate":const o=await this.tokenizer.readToken(new AtomToken.NameAtom(s));n+=":"+o.name;break;default:const l=await this.tokenizer.readToken(new Token$i.BufferType(s));this.addWarning("Unsupported meta-item: "+n+"["+a.header.name+"] => value="+l.toString("hex")+" ascii="+l.toString("ascii"))}},e.getPayloadLength(0))}async parseValueAtom(e,n){const a=await this.tokenizer.readToken(new AtomToken.DataAtom(Number(n.header.length)-AtomToken.Header.len));if(a.type.set!==0)throw new Error("Unsupported type-set != 0: "+a.type.set);switch(a.type.type){case 0:switch(e){case"trkn":case"disk":const i=Token$i.UINT8.get(a.value,3),s=Token$i.UINT8.get(a.value,5);this.addTag(e,i+"/"+s);break;case"gnre":const o=Token$i.UINT8.get(a.value,1),l=ID3v1Parser_1$1.Genres[o-1];this.addTag(e,l);break;case"rate":const c=a.value.toString("ascii");this.addTag(e,c);break;default:debug$g("unknown proprietary value type for: "+n.atomPath)}break;case 1:case 18:this.addTag(e,a.value.toString("utf-8"));break;case 13:if(this.options.skipCovers)break;this.addTag(e,{format:"image/jpeg",data:Buffer.from(a.value)});break;case 14:if(this.options.skipCovers)break;this.addTag(e,{format:"image/png",data:Buffer.from(a.value)});break;case 21:this.addTag(e,MP4Parser.read_BE_Integer(a.value,!0));break;case 22:this.addTag(e,MP4Parser.read_BE_Integer(a.value,!1));break;case 65:this.addTag(e,a.value.readInt8(0));break;case 66:this.addTag(e,a.value.readInt16BE(0));break;case 67:this.addTag(e,a.value.readInt32BE(0));break;default:this.addWarning(`atom key=${e}, has unknown well-known-type (data-type): ${a.type.type}`)}}parseSoundSampleDescription(e){const n={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let a=0;const i=AtomToken.SoundSampleDescriptionVersion.get(e.description,a);return a+=AtomToken.SoundSampleDescriptionVersion.len,i.version===0||i.version===1?n.description=AtomToken.SoundSampleDescriptionV0.get(e.description,a):debug$g(`Warning: sound-sample-description ${i} not implemented`),n}async parseChapterTrack(e,n,a){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const i=[];for(let s=0;s<e.chunkOffsetTable.length&&a>0;++s){const l=e.chunkOffsetTable[s]-this.tokenizer.position,c=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[s];if(a-=l+c,a<0)throw new Error("Chapter chunk exceeding token length");await this.tokenizer.ignore(l);const d=await this.tokenizer.readToken(new AtomToken.ChapterText(c));debug$g(`Chapter ${s+1}: ${d}`);const u={title:d,sampleOffset:this.findSampleOffset(n,this.tokenizer.position)};debug$g(`Chapter title=${u.title}, offset=${u.sampleOffset}/${this.tracks[0].duration}`),i.push(u)}this.metadata.setFormat("chapters",i),await this.tokenizer.ignore(a)}findSampleOffset(e,n){let a=0;e.timeToSampleTable.forEach(s=>{a+=s.count*s.duration}),debug$g(`Total duration=${a}`);let i=0;for(;i<e.chunkOffsetTable.length&&e.chunkOffsetTable[i]<n;)++i;return this.getChunkDuration(i+1,e)}getChunkDuration(e,n){let a=0,i=n.timeToSampleTable[a].count,s=n.timeToSampleTable[a].duration,o=1,l=this.getSamplesPerChunk(o,n.sampleToChunkTable),c=0;for(;o<e;){const d=Math.min(i,l);c+=d*s,i-=d,l-=d,l===0?(++o,l=this.getSamplesPerChunk(o,n.sampleToChunkTable)):(++a,i=n.timeToSampleTable[a].count,s=n.timeToSampleTable[a].duration)}return c}getSamplesPerChunk(e,n){for(let a=0;a<n.length-1;++a)if(e>=n[a].firstChunk&&e<n[a+1].firstChunk)return n[a].samplesPerChunk;return n[n.length-1].samplesPerChunk}}MP4Parser$1.MP4Parser=MP4Parser;var MpegParser$1={},XingTag={},ExtendedLameHeader={},ReplayGainDataFormat={};Object.defineProperty(ReplayGainDataFormat,"__esModule",{value:!0});ReplayGainDataFormat.ReplayGain=void 0;const common$2=Util;var NameCode;(function(r){r[r.not_set=0]="not_set",r[r.radio=1]="radio",r[r.audiophile=2]="audiophile"})(NameCode||(NameCode={}));var ReplayGainOriginator;(function(r){r[r.unspecified=0]="unspecified",r[r.engineer=1]="engineer",r[r.user=2]="user",r[r.automatic=3]="automatic",r[r.rms_average=4]="rms_average"})(ReplayGainOriginator||(ReplayGainOriginator={}));ReplayGainDataFormat.ReplayGain={len:2,get:(r,e)=>{const n=common$2.getBitAllignedNumber(r,e,0,3),a=common$2.getBitAllignedNumber(r,e,6,1),i=common$2.getBitAllignedNumber(r,e,7,9)/10;if(n>0)return{type:common$2.getBitAllignedNumber(r,e,0,3),origin:common$2.getBitAllignedNumber(r,e,3,3),adjustment:a?-i:i}}};Object.defineProperty(ExtendedLameHeader,"__esModule",{value:!0});ExtendedLameHeader.ExtendedLameHeader=void 0;const Token$h=lib$1,common$1=Util,ReplayGainDataFormat_1=ReplayGainDataFormat;ExtendedLameHeader.ExtendedLameHeader={len:27,get:(r,e)=>{const n=Token$h.UINT32_BE.get(r,e+2);return{revision:common$1.getBitAllignedNumber(r,e,0,4),vbr_method:common$1.getBitAllignedNumber(r,e,4,4),lowpass_filter:100*Token$h.UINT8.get(r,e+1),track_peak:n===0?void 0:n/Math.pow(2,23),track_gain:ReplayGainDataFormat_1.ReplayGain.get(r,6),album_gain:ReplayGainDataFormat_1.ReplayGain.get(r,8),music_length:Token$h.UINT32_BE.get(r,e+20),music_crc:Token$h.UINT8.get(r,e+24),header_crc:Token$h.UINT16_BE.get(r,e+24)}}};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.readXingHeader=r.XingHeaderFlags=r.LameEncoderVersion=r.InfoTagHeaderTag=void 0;const e=lib$1,n=Util,a=ExtendedLameHeader;r.InfoTagHeaderTag=new e.StringType(4,"ascii"),r.LameEncoderVersion=new e.StringType(6,"ascii"),r.XingHeaderFlags={len:4,get:(s,o)=>({frames:n.isBitSet(s,o,31),bytes:n.isBitSet(s,o,30),toc:n.isBitSet(s,o,29),vbrScale:n.isBitSet(s,o,28)})};async function i(s){const o=await s.readToken(r.XingHeaderFlags),l={};if(o.frames&&(l.numFrames=await s.readToken(e.UINT32_BE)),o.bytes&&(l.streamSize=await s.readToken(e.UINT32_BE)),o.toc&&(l.toc=Buffer.alloc(100),await s.readBuffer(l.toc)),o.vbrScale&&(l.vbrScale=await s.readToken(e.UINT32_BE)),await s.peekToken(new e.StringType(4,"ascii"))==="LAME"&&(await s.ignore(4),l.lame={version:await s.readToken(new e.StringType(5,"ascii"))},l.lame.version.match(/\d+.\d+/g))){const f=l.lame.version.match(/\d+.\d+/g)[0].split(".").map(m=>parseInt(m,10));f[0]>=3&&f[1]>=90&&(l.lame.extended=await s.readToken(a.ExtendedLameHeader))}return l}r.readXingHeader=i})(XingTag);Object.defineProperty(MpegParser$1,"__esModule",{value:!0});MpegParser$1.MpegParser=void 0;const Token$g=lib$1,core_1$3=core$5,debug_1$e=srcExports,common=Util,AbstractID3Parser_1$2=AbstractID3Parser$1,XingTag_1=XingTag,debug$f=(0,debug_1$e.default)("music-metadata:parser:mpeg"),maxPeekLen=1024,MPEG4={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,void 0,void 0,-1]},MPEG4_ChannelConfigurations=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class MpegFrameHeader{constructor(e,n){this.versionIndex=common.getBitAllignedNumber(e,n+1,3,2),this.layer=MpegFrameHeader.LayerDescription[common.getBitAllignedNumber(e,n+1,5,2)],this.versionIndex>1&&this.layer===0?this.parseAdtsHeader(e,n):this.parseMpegHeader(e,n),this.isProtectedByCRC=!common.isBitSet(e,n+1,7)}calcDuration(e){return e*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return MpegFrameHeader.samplesInFrameTable[this.version===1?0:1][this.layer]}calculateSideInfoLength(){if(this.layer!==3)return 2;if(this.channelModeIndex===3){if(this.version===1)return 17;if(this.version===2||this.version===2.5)return 9}else{if(this.version===1)return 32;if(this.version===2||this.version===2.5)return 17}}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(e,n){this.container="MPEG",this.bitrateIndex=common.getBitAllignedNumber(e,n+2,0,4),this.sampRateFreqIndex=common.getBitAllignedNumber(e,n+2,4,2),this.padding=common.isBitSet(e,n+2,6),this.privateBit=common.isBitSet(e,n+2,7),this.channelModeIndex=common.getBitAllignedNumber(e,n+3,0,2),this.modeExtension=common.getBitAllignedNumber(e,n+3,2,2),this.isCopyrighted=common.isBitSet(e,n+3,4),this.isOriginalMedia=common.isBitSet(e,n+3,5),this.emphasis=common.getBitAllignedNumber(e,n+3,7,2),this.version=MpegFrameHeader.VersionID[this.versionIndex],this.channelMode=MpegFrameHeader.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const a=this.calcBitrate();if(!a)throw new Error("Cannot determine bit-rate");if(this.bitrate=a*1e3,this.samplingRate=this.calcSamplingRate(),this.samplingRate==null)throw new Error("Cannot determine sampling-rate")}parseAdtsHeader(e,n){debug$f("layer=0 => ADTS"),this.version=this.versionIndex===2?4:2,this.container="ADTS/MPEG-"+this.version;const a=common.getBitAllignedNumber(e,n+2,0,2);this.codec="AAC",this.codecProfile=MPEG4.AudioObjectTypes[a],debug$f(`MPEG-4 audio-codec=${this.codec}`);const i=common.getBitAllignedNumber(e,n+2,2,4);this.samplingRate=MPEG4.SamplingFrequencies[i],debug$f(`sampling-rate=${this.samplingRate}`);const s=common.getBitAllignedNumber(e,n+2,7,3);this.mp4ChannelConfig=MPEG4_ChannelConfigurations[s],debug$f(`channel-config=${this.mp4ChannelConfig.join("+")}`),this.frameLength=common.getBitAllignedNumber(e,n+3,6,2)<<11}calcBitrate(){if(this.bitrateIndex===0||this.bitrateIndex===15)return;const e=`${Math.floor(this.version)}${this.layer}`;return MpegFrameHeader.bitrate_index[this.bitrateIndex][e]}calcSamplingRate(){return this.sampRateFreqIndex===3?null:MpegFrameHeader.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}MpegFrameHeader.SyncByte1=255;MpegFrameHeader.SyncByte2=224;MpegFrameHeader.VersionID=[2.5,null,2,1];MpegFrameHeader.LayerDescription=[0,3,2,1];MpegFrameHeader.ChannelMode=["stereo","joint_stereo","dual_channel","mono"];MpegFrameHeader.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}};MpegFrameHeader.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}};MpegFrameHeader.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];const FrameHeader={len:4,get:(r,e)=>new MpegFrameHeader(r,e)};function getVbrCodecProfile(r){return"V"+Math.floor((100-r)/10)}class MpegParser extends AbstractID3Parser_1$2.AbstractID3Parser{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.calculateEofDuration=!1,this.buf_frame_header=Buffer.alloc(4),this.syncPeek={buf:Buffer.alloc(maxPeekLen),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let e=!1;for(;!e;)await this.sync(),e=await this.parseCommonMpegHeader()}catch(e){if(e instanceof core_1$3.EndOfStreamError){if(debug$f("End-of-stream"),this.calculateEofDuration){const n=this.frameCount*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",n);const a=n/this.metadata.format.sampleRate;debug$f(`Calculate duration at EOF: ${a} sec.`,a),this.metadata.setFormat("duration",a)}}else throw e}}finalize(){const e=this.metadata.format,n=this.metadata.native.hasOwnProperty("ID3v1");if(e.duration&&this.tokenizer.fileInfo.size){const a=this.tokenizer.fileInfo.size-this.mpegOffset-(n?128:0);e.codecProfile&&e.codecProfile[0]==="V"&&this.metadata.setFormat("bitrate",a*8/e.duration)}else if(this.tokenizer.fileInfo.size&&e.codecProfile==="CBR"){const a=this.tokenizer.fileInfo.size-this.mpegOffset-(n?128:0),i=Math.round(a/this.frame_size)*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",i);const s=i/e.sampleRate;debug$f("Calculate CBR duration based on file size: %s",s),this.metadata.setFormat("duration",s)}}async sync(){let e=!1;for(;;){let n=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:maxPeekLen,mayBeLess:!0}),this.syncPeek.len<=163)throw new core_1$3.EndOfStreamError;for(;;)if(e&&(this.syncPeek.buf[n]&224)===224){this.buf_frame_header[0]=MpegFrameHeader.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[n],await this.tokenizer.ignore(n),debug$f(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(debug$f(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),this.syncFrameCount=this.frameCount;return}else if(e=!1,n=this.syncPeek.buf.indexOf(MpegFrameHeader.SyncByte1,n),n===-1){if(this.syncPeek.len<this.syncPeek.buf.length)throw new core_1$3.EndOfStreamError;await this.tokenizer.ignore(this.syncPeek.len);break}else++n,e=!0}}async parseCommonMpegHeader(){this.frameCount===0&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header,{offset:1,length:3});let e;try{e=FrameHeader.get(this.buf_frame_header,0)}catch(n){return await this.tokenizer.ignore(1),this.metadata.addWarning("Parse error: "+n.message),!1}return await this.tokenizer.ignore(3),this.metadata.setFormat("container",e.container),this.metadata.setFormat("codec",e.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",e.samplingRate),this.frameCount++,e.version>=2&&e.layer===0?this.parseAdts(e):this.parseAudioFrameHeader(e)}async parseAudioFrameHeader(e){this.metadata.setFormat("numberOfChannels",e.channelMode==="mono"?1:2),this.metadata.setFormat("bitrate",e.bitrate),this.frameCount<20*1e4&&debug$f("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,e.layer,e.bitrate,e.samplingRate);const n=e.calcSlotSize();if(n===null)throw new Error("invalid slot_size");const a=e.calcSamplesPerFrame();debug$f(`samples_per_frame=${a}`);const s=a/8*e.bitrate/e.samplingRate+(e.padding?n:0);if(this.frame_size=Math.floor(s),this.audioFrameHeader=e,this.bitrates.push(e.bitrate),this.frameCount===1)return this.offset=FrameHeader.len,await this.skipSideInformation(),!1;if(this.frameCount===3){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=a,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&this.frameCount===4&&(this.samplesPerFrame=a,this.calculateEofDuration=!0),this.offset=4,e.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(e){const n=Buffer.alloc(3);await this.tokenizer.readBuffer(n),e.frameLength+=common.getBitAllignedNumber(n,0,0,11),this.totalDataLength+=e.frameLength,this.samplesPerFrame=1024;const a=e.samplingRate/this.samplesPerFrame,s=8*(this.frameCount===0?0:this.totalDataLength/this.frameCount)*a+.5;if(this.metadata.setFormat("bitrate",s),debug$f(`frame-count=${this.frameCount}, size=${e.frameLength} bytes, bit-rate=${s}`),await this.tokenizer.ignore(e.frameLength>7?e.frameLength-7:1),this.frameCount===3)if(this.metadata.setFormat("codecProfile",e.codecProfile),e.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",e.mp4ChannelConfig.length),this.options.duration)this.calculateEofDuration=!0;else return!0;return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(Token$g.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){const e=this.audioFrameHeader.calculateSideInfoLength();await this.tokenizer.readToken(new Token$g.Uint8ArrayType(e)),this.offset+=e,await this.readXtraInfoHeader()}async readXtraInfoHeader(){const e=await this.tokenizer.readToken(XingTag_1.InfoTagHeaderTag);switch(this.offset+=XingTag_1.InfoTagHeaderTag.len,e){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":const a=await this.readXingInfoHeader(),i=getVbrCodecProfile(a.vbrScale);return this.metadata.setFormat("codecProfile",i),null;case"Xtra":break;case"LAME":const s=await this.tokenizer.readToken(XingTag_1.LameEncoderVersion);if(this.frame_size>=this.offset+XingTag_1.LameEncoderVersion.len)return this.offset+=XingTag_1.LameEncoderVersion.len,this.metadata.setFormat("tool","LAME "+s),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}const n=this.frame_size-this.offset;return n<0?this.metadata.addWarning("Frame "+this.frameCount+"corrupt: negative frameDataLeft"):await this.skipFrameData(n),null}async readXingInfoHeader(){const e=this.tokenizer.position,n=await(0,XingTag_1.readXingHeader)(this.tokenizer);if(this.offset+=this.tokenizer.position-e,n.lame&&(this.metadata.setFormat("tool","LAME "+common.stripNulls(n.lame.version)),n.lame.extended&&(this.metadata.setFormat("trackPeakLevel",n.lame.extended.track_peak),n.lame.extended.track_gain&&this.metadata.setFormat("trackGain",n.lame.extended.track_gain.adjustment),n.lame.extended.album_gain&&this.metadata.setFormat("albumGain",n.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",n.lame.extended.music_length/1e3))),n.streamSize){const i=this.audioFrameHeader.calcDuration(n.numFrames);return this.metadata.setFormat("duration",i),debug$f("Get duration from Xing header: %s",this.metadata.format.duration),n}const a=this.frame_size-this.offset;return await this.skipFrameData(a),n}async skipFrameData(e){if(e<0)throw new Error("frame-data-left cannot be negative");await this.tokenizer.ignore(e),this.countSkipFrameData+=e}areAllSame(e){const n=e[0];return e.every(a=>a===n)}}MpegParser$1.MpegParser=MpegParser;var musepack={},MpcSv8Parser$1={},StreamVersion8={};Object.defineProperty(StreamVersion8,"__esModule",{value:!0});StreamVersion8.StreamReader=void 0;const Token$f=lib$1,debug_1$d=srcExports,util$6=Util,debug$e=(0,debug_1$d.default)("music-metadata:parser:musepack:sv8"),PacketKey=new Token$f.StringType(2,"binary"),SH_part1={len:5,get:(r,e)=>({crc:Token$f.UINT32_LE.get(r,e),streamVersion:Token$f.UINT8.get(r,e+4)})},SH_part3={len:2,get:(r,e)=>({sampleFrequency:[44100,48e3,37800,32e3][util$6.getBitAllignedNumber(r,e,0,3)],maxUsedBands:util$6.getBitAllignedNumber(r,e,3,5),channelCount:util$6.getBitAllignedNumber(r,e+1,0,4)+1,msUsed:util$6.isBitSet(r,e+1,4),audioBlockFrames:util$6.getBitAllignedNumber(r,e+1,5,3)})};class StreamReader{constructor(e){this.tokenizer=e}async readPacketHeader(){const e=await this.tokenizer.readToken(PacketKey),n=await this.readVariableSizeField();return{key:e,payloadLength:n.value-2-n.len}}async readStreamHeader(e){const n={};debug$e(`Reading SH at offset=${this.tokenizer.position}`);const a=await this.tokenizer.readToken(SH_part1);e-=SH_part1.len,Object.assign(n,a),debug$e(`SH.streamVersion = ${a.streamVersion}`);const i=await this.readVariableSizeField();e-=i.len,n.sampleCount=i.value;const s=await this.readVariableSizeField();e-=s.len,n.beginningOfSilence=s.value;const o=await this.tokenizer.readToken(SH_part3);return e-=SH_part3.len,Object.assign(n,o),await this.tokenizer.ignore(e),n}async readVariableSizeField(e=1,n=0){let a=await this.tokenizer.readNumber(Token$f.UINT8);return a&128?(a&=127,a+=n,this.readVariableSizeField(e+1,a<<7)):{len:e,value:n+a}}}StreamVersion8.StreamReader=StreamReader;Object.defineProperty(MpcSv8Parser$1,"__esModule",{value:!0});MpcSv8Parser$1.MpcSv8Parser=void 0;const debug_1$c=srcExports,BasicParser_1$6=BasicParser$1,APEv2Parser_1$4=APEv2Parser$1,FourCC_1$6=FourCC,SV8=StreamVersion8,debug$d=(0,debug_1$c.default)("music-metadata:parser:musepack");class MpcSv8Parser extends BasicParser_1$6.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){if(await this.tokenizer.readToken(FourCC_1$6.FourCcToken)!=="MPCK")throw new Error("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const e=new SV8.StreamReader(this.tokenizer);do{const n=await e.readPacketHeader();switch(debug$d(`packet-header key=${n.key}, payloadLength=${n.payloadLength}`),n.key){case"SH":const a=await e.readStreamHeader(n.payloadLength);this.metadata.setFormat("numberOfSamples",a.sampleCount),this.metadata.setFormat("sampleRate",a.sampleFrequency),this.metadata.setFormat("duration",a.sampleCount/a.sampleFrequency),this.metadata.setFormat("numberOfChannels",a.channelCount);break;case"AP":this.audioLength+=n.payloadLength,await this.tokenizer.ignore(n.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(n.payloadLength);break;case"SE":return this.metadata.setFormat("bitrate",this.audioLength*8/this.metadata.format.duration),APEv2Parser_1$4.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new Error(`Unexpected header: ${n.key}`)}}while(!0)}}MpcSv8Parser$1.MpcSv8Parser=MpcSv8Parser;var MpcSv7Parser$1={},BitReader$1={};Object.defineProperty(BitReader$1,"__esModule",{value:!0});BitReader$1.BitReader=void 0;const Token$e=lib$1;class BitReader{constructor(e){this.tokenizer=e,this.pos=0,this.dword=void 0}async read(e){for(;this.dword===void 0;)this.dword=await this.tokenizer.readToken(Token$e.UINT32_LE);let n=this.dword;return this.pos+=e,this.pos<32?(n>>>=32-this.pos,n&(1<<e)-1):(this.pos-=32,this.pos===0?(this.dword=void 0,n&(1<<e)-1):(this.dword=await this.tokenizer.readToken(Token$e.UINT32_LE),this.pos&&(n<<=this.pos,n|=this.dword>>>32-this.pos),n&(1<<e)-1))}async ignore(e){if(this.pos>0){const i=32-this.pos;this.dword=void 0,e-=i,this.pos=0}const n=e%32,a=(e-n)/32;return await this.tokenizer.ignore(a*4),this.read(n)}}BitReader$1.BitReader=BitReader;var StreamVersion7={};Object.defineProperty(StreamVersion7,"__esModule",{value:!0});StreamVersion7.Header=void 0;const Token$d=lib$1,util$5=Util;StreamVersion7.Header={len:6*4,get:(r,e)=>{const n={signature:Buffer.from(r).toString("latin1",e,e+3),streamMinorVersion:util$5.getBitAllignedNumber(r,e+3,0,4),streamMajorVersion:util$5.getBitAllignedNumber(r,e+3,4,4),frameCount:Token$d.UINT32_LE.get(r,e+4),maxLevel:Token$d.UINT16_LE.get(r,e+8),sampleFrequency:[44100,48e3,37800,32e3][util$5.getBitAllignedNumber(r,e+10,0,2)],link:util$5.getBitAllignedNumber(r,e+10,2,2),profile:util$5.getBitAllignedNumber(r,e+10,4,4),maxBand:util$5.getBitAllignedNumber(r,e+11,0,6),intensityStereo:util$5.isBitSet(r,e+11,6),midSideStereo:util$5.isBitSet(r,e+11,7),titlePeak:Token$d.UINT16_LE.get(r,e+12),titleGain:Token$d.UINT16_LE.get(r,e+14),albumPeak:Token$d.UINT16_LE.get(r,e+16),albumGain:Token$d.UINT16_LE.get(r,e+18),lastFrameLength:Token$d.UINT32_LE.get(r,e+20)>>>20&2047,trueGapless:util$5.isBitSet(r,e+23,0)};return n.lastFrameLength=n.trueGapless?Token$d.UINT32_LE.get(r,20)>>>20&2047:0,n}};Object.defineProperty(MpcSv7Parser$1,"__esModule",{value:!0});MpcSv7Parser$1.MpcSv7Parser=void 0;const debug_1$b=srcExports,BasicParser_1$5=BasicParser$1,APEv2Parser_1$3=APEv2Parser$1,BitReader_1=BitReader$1,SV7=StreamVersion7,debug$c=(0,debug_1$b.default)("music-metadata:parser:musepack");class MpcSv7Parser extends BasicParser_1$5.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){const e=await this.tokenizer.readToken(SV7.Header);if(e.signature!=="MP+")throw new Error("Unexpected magic number");debug$c(`stream-version=${e.streamMajorVersion}.${e.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",e.sampleFrequency);const n=1152*(e.frameCount-1)+e.lastFrameLength;this.metadata.setFormat("numberOfSamples",n),this.duration=n/e.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new BitReader_1.BitReader(this.tokenizer),this.metadata.setFormat("numberOfChannels",e.midSideStereo||e.intensityStereo?2:1);const a=await this.bitreader.read(8);return this.metadata.setFormat("codec",(a/100).toFixed(2)),await this.skipAudioData(e.frameCount),debug$c(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),APEv2Parser_1$3.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(e){for(;e-- >0;){const a=await this.bitreader.read(20);this.audioLength+=20+a,await this.bitreader.ignore(a)}const n=await this.bitreader.read(11);this.audioLength+=n,this.metadata.setFormat("bitrate",this.audioLength/this.duration)}}MpcSv7Parser$1.MpcSv7Parser=MpcSv7Parser;Object.defineProperty(musepack,"__esModule",{value:!0});const debug_1$a=srcExports,Token$c=lib$1,AbstractID3Parser_1$1=AbstractID3Parser$1,MpcSv8Parser_1=MpcSv8Parser$1,MpcSv7Parser_1=MpcSv7Parser$1,debug$b=(0,debug_1$a.default)("music-metadata:parser:musepack");class MusepackParser extends AbstractID3Parser_1$1.AbstractID3Parser{async postId3v2Parse(){const e=await this.tokenizer.peekToken(new Token$c.StringType(3,"binary"));let n;switch(e){case"MP+":{debug$b("Musepack stream-version 7"),n=new MpcSv7Parser_1.MpcSv7Parser;break}case"MPC":{debug$b("Musepack stream-version 8"),n=new MpcSv8Parser_1.MpcSv8Parser;break}default:throw new Error("Invalid Musepack signature prefix")}return n.init(this.metadata,this.tokenizer,this.options),n.parse()}}musepack.default=MusepackParser;var OggParser$1={},OpusParser$1={},Opus$1={};Object.defineProperty(Opus$1,"__esModule",{value:!0});Opus$1.IdHeader=void 0;const Token$b=lib$1;class IdHeader{constructor(e){if(this.len=e,e<19)throw new Error("ID-header-page 0 should be at least 19 bytes long")}get(e,n){return{magicSignature:new Token$b.StringType(8,"ascii").get(e,n+0),version:e.readUInt8(n+8),channelCount:e.readUInt8(n+9),preSkip:e.readInt16LE(n+10),inputSampleRate:e.readInt32LE(n+12),outputGain:e.readInt16LE(n+16),channelMapping:e.readUInt8(n+18)}}}Opus$1.IdHeader=IdHeader;Object.defineProperty(OpusParser$1,"__esModule",{value:!0});OpusParser$1.OpusParser=void 0;const Token$a=lib$1,VorbisParser_1$2=VorbisParser$1,Opus=Opus$1;class OpusParser extends VorbisParser_1$2.VorbisParser{constructor(e,n,a){super(e,n),this.tokenizer=a,this.lastPos=-1}parseFirstPage(e,n){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new Opus.IdHeader(n.length).get(n,0),this.idHeader.magicSignature!=="OpusHead")throw new Error("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}parseFullPage(e){switch(new Token$a.StringType(8,"ascii").get(e,0)){case"OpusTags":this.parseUserCommentList(e,8),this.lastPos=this.tokenizer.position-e.length;break}}calculateDuration(e){if(this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0){const n=e.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",n),this.metadata.setFormat("duration",n/48e3),this.lastPos!==-1&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const a=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*a/this.metadata.format.duration)}}}}OpusParser$1.OpusParser=OpusParser;var SpeexParser$1={},Speex$1={};Object.defineProperty(Speex$1,"__esModule",{value:!0});Speex$1.Header=void 0;const Token$9=lib$1,util$4=Util;Speex$1.Header={len:80,get:(r,e)=>({speex:new Token$9.StringType(8,"ascii").get(r,e+0),version:util$4.trimRightNull(new Token$9.StringType(20,"ascii").get(r,e+8)),version_id:r.readInt32LE(e+28),header_size:r.readInt32LE(e+32),rate:r.readInt32LE(e+36),mode:r.readInt32LE(e+40),mode_bitstream_version:r.readInt32LE(e+44),nb_channels:r.readInt32LE(e+48),bitrate:r.readInt32LE(e+52),frame_size:r.readInt32LE(e+56),vbr:r.readInt32LE(e+60),frames_per_packet:r.readInt32LE(e+64),extra_headers:r.readInt32LE(e+68),reserved1:r.readInt32LE(e+72),reserved2:r.readInt32LE(e+76)})};Object.defineProperty(SpeexParser$1,"__esModule",{value:!0});SpeexParser$1.SpeexParser=void 0;const debug_1$9=srcExports,VorbisParser_1$1=VorbisParser$1,Speex=Speex$1,debug$a=(0,debug_1$9.default)("music-metadata:parser:ogg:speex");class SpeexParser extends VorbisParser_1$1.VorbisParser{constructor(e,n,a){super(e,n),this.tokenizer=a}parseFirstPage(e,n){debug$a("First Ogg/Speex page");const a=Speex.Header.get(n,0);this.metadata.setFormat("codec",`Speex ${a.version}`),this.metadata.setFormat("numberOfChannels",a.nb_channels),this.metadata.setFormat("sampleRate",a.rate),a.bitrate!==-1&&this.metadata.setFormat("bitrate",a.bitrate)}}SpeexParser$1.SpeexParser=SpeexParser;var TheoraParser$1={},Theora={};Object.defineProperty(Theora,"__esModule",{value:!0});Theora.IdentificationHeader=void 0;const Token$8=lib$1;Theora.IdentificationHeader={len:42,get:(r,e)=>({id:new Token$8.StringType(7,"ascii").get(r,e),vmaj:r.readUInt8(e+7),vmin:r.readUInt8(e+8),vrev:r.readUInt8(e+9),vmbw:r.readUInt16BE(e+10),vmbh:r.readUInt16BE(e+17),nombr:Token$8.UINT24_BE.get(r,e+37),nqual:r.readUInt8(e+40)})};Object.defineProperty(TheoraParser$1,"__esModule",{value:!0});TheoraParser$1.TheoraParser=void 0;const debug_1$8=srcExports,Theora_1=Theora,debug$9=(0,debug_1$8.default)("music-metadata:parser:ogg:theora");class TheoraParser{constructor(e,n,a){this.metadata=e,this.tokenizer=a}parsePage(e,n){e.headerType.firstPage&&this.parseFirstPage(e,n)}flush(){debug$9("flush")}calculateDuration(e){debug$9("duration calculation not implemented")}parseFirstPage(e,n){debug$9("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const a=Theora_1.IdentificationHeader.get(n,0);this.metadata.setFormat("bitrate",a.nombr)}}TheoraParser$1.TheoraParser=TheoraParser;Object.defineProperty(OggParser$1,"__esModule",{value:!0});OggParser$1.OggParser=OggParser$1.SegmentTable=void 0;const Token$7=lib$1,core_1$2=core$5,debug_1$7=srcExports,util$3=Util,FourCC_1$5=FourCC,BasicParser_1$4=BasicParser$1,VorbisParser_1=VorbisParser$1,OpusParser_1=OpusParser$1,SpeexParser_1=SpeexParser$1,TheoraParser_1=TheoraParser$1,debug$8=(0,debug_1$7.default)("music-metadata:parser:ogg");class SegmentTable{static sum(e,n,a){let i=0;for(let s=n;s<n+a;++s)i+=e[s];return i}constructor(e){this.len=e.page_segments}get(e,n){return{totalPageSize:SegmentTable.sum(e,n,this.len)}}}OggParser$1.SegmentTable=SegmentTable;class OggParser extends BasicParser_1$4.BasicParser{async parse(){debug$8("pos=%s, parsePage()",this.tokenizer.position);try{let e;do{if(e=await this.tokenizer.readToken(OggParser.Header),e.capturePattern!=="OggS")throw new Error("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=e,this.pageNumber=e.pageSequenceNo,debug$8("page#=%s, Ogg.id=%s",e.pageSequenceNo,e.capturePattern);const n=await this.tokenizer.readToken(new SegmentTable(e));debug$8("totalPageSize=%s",n.totalPageSize);const a=await this.tokenizer.readToken(new Token$7.Uint8ArrayType(n.totalPageSize));if(debug$8("firstPage=%s, lastPage=%s, continued=%s",e.headerType.firstPage,e.headerType.lastPage,e.headerType.continued),e.headerType.firstPage){const i=new Token$7.StringType(7,"ascii").get(Buffer.from(a),0);switch(i){case"vorbis":debug$8("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new VorbisParser_1.VorbisParser(this.metadata,this.options);break;case"OpusHea":debug$8("Set page consumer to Ogg/Opus"),this.pageConsumer=new OpusParser_1.OpusParser(this.metadata,this.options,this.tokenizer);break;case"Speex  ":debug$8("Set page consumer to Ogg/Speex"),this.pageConsumer=new SpeexParser_1.SpeexParser(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":debug$8("Set page consumer to Ogg/Theora"),this.pageConsumer=new TheoraParser_1.TheoraParser(this.metadata,this.options,this.tokenizer);break;default:throw new Error("gg audio-codec not recognized (id="+i+")")}}this.pageConsumer.parsePage(e,a)}while(!e.headerType.lastPage)}catch(e){if(e instanceof core_1$2.EndOfStreamError)this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),debug$8("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header);else if(e.message.startsWith("FourCC"))this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),this.pageConsumer.flush());else throw e}}}OggParser.Header={len:27,get:(r,e)=>({capturePattern:FourCC_1$5.FourCcToken.get(r,e),version:Token$7.UINT8.get(r,e+4),headerType:{continued:util$3.getBit(r,e+5,0),firstPage:util$3.getBit(r,e+5,1),lastPage:util$3.getBit(r,e+5,2)},absoluteGranulePosition:Number(Token$7.UINT64_LE.get(r,e+6)),streamSerialNumber:Token$7.UINT32_LE.get(r,e+14),pageSequenceNo:Token$7.UINT32_LE.get(r,e+18),pageChecksum:Token$7.UINT32_LE.get(r,e+22),page_segments:Token$7.UINT8.get(r,e+26)})};OggParser$1.OggParser=OggParser;var WaveParser$1={},RiffChunk={};Object.defineProperty(RiffChunk,"__esModule",{value:!0});RiffChunk.ListInfoTagValue=RiffChunk.Header=void 0;const Token$6=lib$1;RiffChunk.Header={len:8,get:(r,e)=>({chunkID:r.toString("binary",e,e+4),chunkSize:Token$6.UINT32_LE.get(r,4)})};class ListInfoTagValue{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=this.len&1}get(e,n){return new Token$6.StringType(this.tagHeader.chunkSize,"ascii").get(e,n)}}RiffChunk.ListInfoTagValue=ListInfoTagValue;var WaveChunk$1={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.FactChunk=r.Format=r.WaveFormat=void 0,function(a){a[a.PCM=1]="PCM",a[a.ADPCM=2]="ADPCM",a[a.IEEE_FLOAT=3]="IEEE_FLOAT",a[a.MPEG_ADTS_AAC=5632]="MPEG_ADTS_AAC",a[a.MPEG_LOAS=5634]="MPEG_LOAS",a[a.RAW_AAC1=255]="RAW_AAC1",a[a.DOLBY_AC3_SPDIF=146]="DOLBY_AC3_SPDIF",a[a.DVM=8192]="DVM",a[a.RAW_SPORT=576]="RAW_SPORT",a[a.ESST_AC3=577]="ESST_AC3",a[a.DRM=9]="DRM",a[a.DTS2=8193]="DTS2",a[a.MPEG=80]="MPEG"}(r.WaveFormat||(r.WaveFormat={}));class e{constructor(i){if(i.chunkSize<16)throw new Error("Invalid chunk size");this.len=i.chunkSize}get(i,s){return{wFormatTag:i.readUInt16LE(s),nChannels:i.readUInt16LE(s+2),nSamplesPerSec:i.readUInt32LE(s+4),nAvgBytesPerSec:i.readUInt32LE(s+8),nBlockAlign:i.readUInt16LE(s+12),wBitsPerSample:i.readUInt16LE(s+14)}}}r.Format=e;class n{constructor(i){if(i.chunkSize<4)throw new Error("Invalid fact chunk size.");this.len=i.chunkSize}get(i,s){return{dwSampleLength:i.readUInt32LE(s)}}}r.FactChunk=n})(WaveChunk$1);var BwfChunk={};Object.defineProperty(BwfChunk,"__esModule",{value:!0});BwfChunk.BroadcastAudioExtensionChunk=void 0;const Token$5=lib$1,Util_1=Util;BwfChunk.BroadcastAudioExtensionChunk={len:420,get:(r,e)=>({description:(0,Util_1.stripNulls)(new Token$5.StringType(256,"ascii").get(r,e)).trim(),originator:(0,Util_1.stripNulls)(new Token$5.StringType(32,"ascii").get(r,e+256)).trim(),originatorReference:(0,Util_1.stripNulls)(new Token$5.StringType(32,"ascii").get(r,e+288)).trim(),originationDate:(0,Util_1.stripNulls)(new Token$5.StringType(10,"ascii").get(r,e+320)).trim(),originationTime:(0,Util_1.stripNulls)(new Token$5.StringType(8,"ascii").get(r,e+330)).trim(),timeReferenceLow:Token$5.UINT32_LE.get(r,e+338),timeReferenceHigh:Token$5.UINT32_LE.get(r,e+342),version:Token$5.UINT16_LE.get(r,e+346),umid:new Token$5.Uint8ArrayType(64).get(r,e+348),loudnessValue:Token$5.UINT16_LE.get(r,e+412),maxTruePeakLevel:Token$5.UINT16_LE.get(r,e+414),maxMomentaryLoudness:Token$5.UINT16_LE.get(r,e+416),maxShortTermLoudness:Token$5.UINT16_LE.get(r,e+418)})};Object.defineProperty(WaveParser$1,"__esModule",{value:!0});WaveParser$1.WaveParser=void 0;const strtok3$2=core$5,Token$4=lib$1,debug_1$6=srcExports,riff=RiffChunk,WaveChunk=WaveChunk$1,ID3v2Parser_1$2=ID3v2Parser$1,util$2=Util,FourCC_1$4=FourCC,BasicParser_1$3=BasicParser$1,BwfChunk_1=BwfChunk,debug$7=(0,debug_1$6.default)("music-metadata:parser:RIFF");class WaveParser extends BasicParser_1$3.BasicParser{async parse(){const e=await this.tokenizer.readToken(riff.Header);if(debug$7(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),e.chunkID==="RIFF")return this.parseRiffChunk(e.chunkSize).catch(n=>{if(!(n instanceof strtok3$2.EndOfStreamError))throw n})}async parseRiffChunk(e){const n=await this.tokenizer.readToken(FourCC_1$4.FourCcToken);switch(this.metadata.setFormat("container",n),n){case"WAVE":return this.readWaveChunk(e-FourCC_1$4.FourCcToken.len);default:throw new Error(`Unsupported RIFF format: RIFF/${n}`)}}async readWaveChunk(e){for(;e>=riff.Header.len;){const n=await this.tokenizer.readToken(riff.Header);switch(e-=riff.Header.len+n.chunkSize,n.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=n,debug$7(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${n.chunkID}`),n.chunkID){case"LIST":await this.parseListTag(n);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new WaveChunk.FactChunk(n));break;case"fmt ":const a=await this.tokenizer.readToken(new WaveChunk.Format(n));let i=WaveChunk.WaveFormat[a.wFormatTag];i||(debug$7("WAVE/non-PCM format="+a.wFormatTag),i="non-PCM ("+a.wFormatTag+")"),this.metadata.setFormat("codec",i),this.metadata.setFormat("bitsPerSample",a.wBitsPerSample),this.metadata.setFormat("sampleRate",a.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",a.nChannels),this.metadata.setFormat("bitrate",a.nBlockAlign*a.nSamplesPerSec*8),this.blockAlign=a.nBlockAlign;break;case"id3 ":case"ID3 ":const s=await this.tokenizer.readToken(new Token$4.Uint8ArrayType(n.chunkSize)),o=strtok3$2.fromBuffer(s);await new ID3v2Parser_1$2.ID3v2Parser().parse(this.metadata,o,this.options);break;case"data":this.metadata.format.lossless!==!1&&this.metadata.setFormat("lossless",!0);let l=n.chunkSize;if(this.tokenizer.fileInfo.size){const f=this.tokenizer.fileInfo.size-this.tokenizer.position;f<l&&(this.metadata.addWarning("data chunk length exceeding file length"),l=f)}const c=this.fact?this.fact.dwSampleLength:l===4294967295?void 0:l/this.blockAlign;c&&(this.metadata.setFormat("numberOfSamples",c),this.metadata.setFormat("duration",c/this.metadata.format.sampleRate)),this.metadata.format.codec==="ADPCM"?this.metadata.setFormat("bitrate",352e3):this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(n.chunkSize);break;case"bext":const d=await this.tokenizer.readToken(BwfChunk_1.BroadcastAudioExtensionChunk);Object.keys(d).forEach(f=>{this.metadata.addTag("exif","bext."+f,d[f])});const u=n.chunkSize-BwfChunk_1.BroadcastAudioExtensionChunk.len;await this.tokenizer.ignore(u);break;case"\0\0\0\0":debug$7(`Ignore padding chunk: RIFF/${n.chunkID} of ${n.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+n.chunkID),await this.tokenizer.ignore(n.chunkSize);break;default:debug$7(`Ignore chunk: RIFF/${n.chunkID} of ${n.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+n.chunkID),await this.tokenizer.ignore(n.chunkSize)}this.header.chunkSize%2===1&&(debug$7("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const n=await this.tokenizer.readToken(new Token$4.StringType(4,"binary"));switch(debug$7("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,n),n){case"INFO":return this.parseRiffInfoTags(e.chunkSize-4);case"adtl":default:return this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/"+n),debug$7("Ignoring chunkID=RIFF/WAVE/LIST/"+n),this.tokenizer.ignore(e.chunkSize-4).then()}}async parseRiffInfoTags(e){for(;e>=8;){const n=await this.tokenizer.readToken(riff.Header),a=new riff.ListInfoTagValue(n),i=await this.tokenizer.readToken(a);this.addTag(n.chunkID,util$2.stripNulls(i)),e-=8+a.len}if(e!==0)throw Error("Illegal remaining size: "+e)}addTag(e,n){this.metadata.addTag("exif",e,n)}}WaveParser$1.WaveParser=WaveParser;var WavPackParser$1={},WavPackToken={};Object.defineProperty(WavPackToken,"__esModule",{value:!0});WavPackToken.WavPack=void 0;const Token$3=lib$1,FourCC_1$3=FourCC,SampleRates=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1];class WavPack{static isBitSet(e,n){return WavPack.getBitAllignedNumber(e,n,1)===1}static getBitAllignedNumber(e,n,a){return e>>>n&4294967295>>>32-a}}WavPack.BlockHeaderToken={len:32,get:(r,e)=>{const n=Token$3.UINT32_LE.get(r,e+24),a={BlockID:FourCC_1$3.FourCcToken.get(r,e),blockSize:Token$3.UINT32_LE.get(r,e+4),version:Token$3.UINT16_LE.get(r,e+8),totalSamples:Token$3.UINT32_LE.get(r,e+12),blockIndex:Token$3.UINT32_LE.get(r,e+16),blockSamples:Token$3.UINT32_LE.get(r,e+20),flags:{bitsPerSample:(1+WavPack.getBitAllignedNumber(n,0,2))*8,isMono:WavPack.isBitSet(n,2),isHybrid:WavPack.isBitSet(n,3),isJointStereo:WavPack.isBitSet(n,4),crossChannel:WavPack.isBitSet(n,5),hybridNoiseShaping:WavPack.isBitSet(n,6),floatingPoint:WavPack.isBitSet(n,7),samplingRate:SampleRates[WavPack.getBitAllignedNumber(n,23,4)],isDSD:WavPack.isBitSet(n,31)},crc:new Token$3.Uint8ArrayType(4).get(r,e+28)};return a.flags.isDSD&&(a.totalSamples*=8),a}};WavPack.MetadataIdToken={len:1,get:(r,e)=>({functionId:WavPack.getBitAllignedNumber(r[e],0,6),isOptional:WavPack.isBitSet(r[e],5),isOddSize:WavPack.isBitSet(r[e],6),largeBlock:WavPack.isBitSet(r[e],7)})};WavPackToken.WavPack=WavPack;Object.defineProperty(WavPackParser$1,"__esModule",{value:!0});WavPackParser$1.WavPackParser=void 0;const Token$2=lib$1,APEv2Parser_1$2=APEv2Parser$1,FourCC_1$2=FourCC,BasicParser_1$2=BasicParser$1,WavPackToken_1=WavPackToken,debug_1$5=srcExports,debug$6=(0,debug_1$5.default)("music-metadata:parser:WavPack");class WavPackParser extends BasicParser_1$2.BasicParser{async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),APEv2Parser_1$2.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if(await this.tokenizer.peekToken(FourCC_1$2.FourCcToken)!=="wvpk")break;const n=await this.tokenizer.readToken(WavPackToken_1.WavPack.BlockHeaderToken);if(n.BlockID!=="wvpk")throw new Error("Invalid WavPack Block-ID");debug$6(`WavPack header blockIndex=${n.blockIndex}, len=${WavPackToken_1.WavPack.BlockHeaderToken.len}`),n.blockIndex===0&&!this.metadata.format.container&&(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!n.flags.isHybrid),this.metadata.setFormat("bitsPerSample",n.flags.bitsPerSample),n.flags.isDSD||(this.metadata.setFormat("sampleRate",n.flags.samplingRate),this.metadata.setFormat("duration",n.totalSamples/n.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",n.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",n.totalSamples),this.metadata.setFormat("codec",n.flags.isDSD?"DSD":"PCM"));const a=n.blockSize-(WavPackToken_1.WavPack.BlockHeaderToken.len-8);await(n.blockIndex===0?this.parseMetadataSubBlock(n,a):this.tokenizer.ignore(a)),n.blockSamples>0&&(this.audioDataSize+=n.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=WavPackToken_1.WavPack.BlockHeaderToken.len);this.metadata.setFormat("bitrate",this.audioDataSize*8/this.metadata.format.duration)}async parseMetadataSubBlock(e,n){for(;n>WavPackToken_1.WavPack.MetadataIdToken.len;){const a=await this.tokenizer.readToken(WavPackToken_1.WavPack.MetadataIdToken),i=await this.tokenizer.readNumber(a.largeBlock?Token$2.UINT24_LE:Token$2.UINT8),s=Buffer.alloc(i*2-(a.isOddSize?1:0));switch(await this.tokenizer.readBuffer(s),debug$6(`Metadata Sub-Blocks functionId=0x${a.functionId.toString(16)}, id.largeBlock=${a.largeBlock},data-size=${s.length}`),a.functionId){case 0:break;case 14:debug$6("ID_DSD_BLOCK");const o=1<<s.readUInt8(0),l=e.flags.samplingRate*o*8;if(!e.flags.isDSD)throw new Error("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",l),this.metadata.setFormat("duration",e.totalSamples/l);break;case 36:debug$6("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",s);break;case 47:debug$6(`ID_BLOCK_CHECKSUM: checksum=${s.toString("hex")}`);break;default:debug$6(`Ignore unsupported meta-sub-block-id functionId=0x${a.functionId.toString(16)}`);break}n-=WavPackToken_1.WavPack.MetadataIdToken.len+(a.largeBlock?Token$2.UINT24_LE.len:Token$2.UINT8.len)+i*2,debug$6(`remainingLength=${n}`),a.isOddSize&&this.tokenizer.ignore(1)}if(n!==0)throw new Error("metadata-sub-block should fit it remaining length")}}WavPackParser$1.WavPackParser=WavPackParser;var DsfParser$1={},DsfChunk={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.FormatChunk=r.ChannelType=r.DsdChunk=r.ChunkHeader=void 0;const e=lib$1,n=FourCC;r.ChunkHeader={len:12,get:(a,i)=>({id:n.FourCcToken.get(a,i),size:e.UINT64_LE.get(a,i+4)})},r.DsdChunk={len:16,get:(a,i)=>({fileSize:e.INT64_LE.get(a,i),metadataPointer:e.INT64_LE.get(a,i+8)})},function(a){a[a.mono=1]="mono",a[a.stereo=2]="stereo",a[a.channels=3]="channels",a[a.quad=4]="quad",a[a["4 channels"]=5]="4 channels",a[a["5 channels"]=6]="5 channels",a[a["5.1 channels"]=7]="5.1 channels"}(r.ChannelType||(r.ChannelType={})),r.FormatChunk={len:40,get:(a,i)=>({formatVersion:e.INT32_LE.get(a,i),formatID:e.INT32_LE.get(a,i+4),channelType:e.INT32_LE.get(a,i+8),channelNum:e.INT32_LE.get(a,i+12),samplingFrequency:e.INT32_LE.get(a,i+16),bitsPerSample:e.INT32_LE.get(a,i+20),sampleCount:e.INT64_LE.get(a,i+24),blockSizePerChannel:e.INT32_LE.get(a,i+32)})}})(DsfChunk);Object.defineProperty(DsfParser$1,"__esModule",{value:!0});DsfParser$1.DsfParser=void 0;const debug_1$4=srcExports,AbstractID3Parser_1=AbstractID3Parser$1,DsfChunk_1=DsfChunk,ID3v2Parser_1$1=ID3v2Parser$1,debug$5=(0,debug_1$4.default)("music-metadata:parser:DSF");class DsfParser extends AbstractID3Parser_1.AbstractID3Parser{async postId3v2Parse(){const e=this.tokenizer.position,n=await this.tokenizer.readToken(DsfChunk_1.ChunkHeader);if(n.id!=="DSD ")throw new Error("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const a=await this.tokenizer.readToken(DsfChunk_1.DsdChunk);if(a.metadataPointer===BigInt(0))debug$5("No ID3v2 tag present");else return debug$5(`expect ID3v2 at offset=${a.metadataPointer}`),await this.parseChunks(a.fileSize-n.size),await this.tokenizer.ignore(Number(a.metadataPointer)-this.tokenizer.position-e),new ID3v2Parser_1$1.ID3v2Parser().parse(this.metadata,this.tokenizer,this.options)}async parseChunks(e){for(;e>=DsfChunk_1.ChunkHeader.len;){const n=await this.tokenizer.readToken(DsfChunk_1.ChunkHeader);switch(debug$5(`Parsing chunk name=${n.id} size=${n.size}`),n.id){case"fmt ":const a=await this.tokenizer.readToken(DsfChunk_1.FormatChunk);this.metadata.setFormat("numberOfChannels",a.channelNum),this.metadata.setFormat("sampleRate",a.samplingFrequency),this.metadata.setFormat("bitsPerSample",a.bitsPerSample),this.metadata.setFormat("numberOfSamples",a.sampleCount),this.metadata.setFormat("duration",Number(a.sampleCount)/a.samplingFrequency);const i=a.bitsPerSample*a.samplingFrequency*a.channelNum;this.metadata.setFormat("bitrate",i);return;default:this.tokenizer.ignore(Number(n.size)-DsfChunk_1.ChunkHeader.len);break}e-=n.size}}}DsfParser$1.DsfParser=DsfParser;var DsdiffParser$1={},DsdiffToken={};Object.defineProperty(DsdiffToken,"__esModule",{value:!0});DsdiffToken.ChunkHeader64=void 0;const Token$1=lib$1,FourCC_1$1=FourCC;DsdiffToken.ChunkHeader64={len:12,get:(r,e)=>({chunkID:FourCC_1$1.FourCcToken.get(r,e),chunkSize:Token$1.INT64_BE.get(r,e+4)})};Object.defineProperty(DsdiffParser$1,"__esModule",{value:!0});DsdiffParser$1.DsdiffParser=void 0;const Token=lib$1,debug_1$3=srcExports,strtok3$1=core$5,FourCC_1=FourCC,BasicParser_1$1=BasicParser$1,ID3v2Parser_1=ID3v2Parser$1,DsdiffToken_1=DsdiffToken,debug$4=(0,debug_1$3.default)("music-metadata:parser:aiff");class DsdiffParser extends BasicParser_1$1.BasicParser{async parse(){const e=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);if(e.chunkID!=="FRM8")throw new Error("Unexpected chunk-ID");const n=(await this.tokenizer.readToken(FourCC_1.FourCcToken)).trim();switch(n){case"DSD":return this.metadata.setFormat("container",`DSDIFF/${n}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(FourCC_1.FourCcToken.len));default:throw Error(`Unsupported DSDIFF type: ${n}`)}}async readFmt8Chunks(e){for(;e>=DsdiffToken_1.ChunkHeader64.len;){const n=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);debug$4(`Chunk id=${n.chunkID}`),await this.readData(n),e-=BigInt(DsdiffToken_1.ChunkHeader64.len)+n.chunkSize}}async readData(e){debug$4(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);const n=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":const i=await this.tokenizer.readToken(Token.UINT32_LE);debug$4(`DSDIFF version=${i}`);break;case"PROP":if(await this.tokenizer.readToken(FourCC_1.FourCcToken)!=="SND ")throw new Error("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(FourCC_1.FourCcToken.len));break;case"ID3":const o=await this.tokenizer.readToken(new Token.Uint8ArrayType(Number(e.chunkSize))),l=strtok3$1.fromBuffer(o);await new ID3v2Parser_1.ID3v2Parser().parse(this.metadata,l,this.options);break;default:debug$4(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);break;case"DSD":this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break}const a=e.chunkSize-BigInt(this.tokenizer.position-n);a>0&&(debug$4(`After Parsing chunk, remaining ${a} bytes`),await this.tokenizer.ignore(Number(a)))}async handleSoundPropertyChunks(e){for(debug$4(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){const n=await this.tokenizer.readToken(DsdiffToken_1.ChunkHeader64);debug$4(`Sound-property-chunk[ID=${n.chunkID}, size=${n.chunkSize}]`);const a=this.tokenizer.position;switch(n.chunkID.trim()){case"FS":const s=await this.tokenizer.readToken(Token.UINT32_BE);this.metadata.setFormat("sampleRate",s);break;case"CHNL":const o=await this.tokenizer.readToken(Token.UINT16_BE);this.metadata.setFormat("numberOfChannels",o),await this.handleChannelChunks(n.chunkSize-BigInt(Token.UINT16_BE.len));break;case"CMPR":const l=(await this.tokenizer.readToken(FourCC_1.FourCcToken)).trim(),c=await this.tokenizer.readToken(Token.UINT8),d=await this.tokenizer.readToken(new Token.StringType(c,"ascii"));l==="DSD"&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${l} (${d})`);break;case"ABSS":const u=await this.tokenizer.readToken(Token.UINT16_BE),f=await this.tokenizer.readToken(Token.UINT8),m=await this.tokenizer.readToken(Token.UINT8),h=await this.tokenizer.readToken(Token.UINT32_BE);debug$4(`ABSS ${u}:${f}:${m}.${h}`);break;case"LSCO":const w=await this.tokenizer.readToken(Token.UINT16_BE);debug$4(`LSCO lsConfig=${w}`);break;case"COMT":default:debug$4(`Unknown sound-property-chunk[ID=${n.chunkID}, size=${n.chunkSize}]`),await this.tokenizer.ignore(Number(n.chunkSize))}const i=n.chunkSize-BigInt(this.tokenizer.position-a);i>0&&(debug$4(`After Parsing sound-property-chunk ${n.chunkSize}, remaining ${i} bytes`),await this.tokenizer.ignore(Number(i))),e-=BigInt(DsdiffToken_1.ChunkHeader64.len)+n.chunkSize,debug$4(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const n=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",n)}}async handleChannelChunks(e){debug$4(`Parsing channel-chunks, remainingSize=${e}`);const n=[];for(;e>=FourCC_1.FourCcToken.len;){const a=await this.tokenizer.readToken(FourCC_1.FourCcToken);debug$4(`Channel[ID=${a}]`),n.push(a),e-=BigInt(FourCC_1.FourCcToken.len)}return debug$4(`Channels: ${n.join(", ")}`),n}}DsdiffParser$1.DsdiffParser=DsdiffParser;var MatroskaParser$1={},MatroskaDtd={};Object.defineProperty(MatroskaDtd,"__esModule",{value:!0});MatroskaDtd.elements=void 0;const types_1$2=types$1;MatroskaDtd.elements={440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:types_1$2.DataType.uint},17143:{name:"ebmlReadVersion",value:types_1$2.DataType.uint},17138:{name:"ebmlMaxIDWidth",value:types_1$2.DataType.uint},17139:{name:"ebmlMaxSizeWidth",value:types_1$2.DataType.uint},17026:{name:"docType",value:types_1$2.DataType.string},17031:{name:"docTypeVersion",value:types_1$2.DataType.uint},17029:{name:"docTypeReadVersion",value:types_1$2.DataType.uint}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",container:{21419:{name:"seekId",value:types_1$2.DataType.binary},21420:{name:"seekPosition",value:types_1$2.DataType.uint}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:types_1$2.DataType.uid},29572:{name:"filename",value:types_1$2.DataType.string},3979555:{name:"prevUID",value:types_1$2.DataType.uid},3965867:{name:"prevFilename",value:types_1$2.DataType.string},4110627:{name:"nextUID",value:types_1$2.DataType.uid},4096955:{name:"nextFilename",value:types_1$2.DataType.string},2807729:{name:"timecodeScale",value:types_1$2.DataType.uint},17545:{name:"duration",value:types_1$2.DataType.float},17505:{name:"dateUTC",value:types_1$2.DataType.uint},31657:{name:"title",value:types_1$2.DataType.string},19840:{name:"muxingApp",value:types_1$2.DataType.string},22337:{name:"writingApp",value:types_1$2.DataType.string}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:types_1$2.DataType.uid},163:{name:"unknown",value:types_1$2.DataType.binary},167:{name:"position",value:types_1$2.DataType.uid},171:{name:"prevSize",value:types_1$2.DataType.uid}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:types_1$2.DataType.uint},29637:{name:"uid",value:types_1$2.DataType.uid},131:{name:"trackType",value:types_1$2.DataType.uint},185:{name:"flagEnabled",value:types_1$2.DataType.bool},136:{name:"flagDefault",value:types_1$2.DataType.bool},21930:{name:"flagForced",value:types_1$2.DataType.bool},156:{name:"flagLacing",value:types_1$2.DataType.bool},28135:{name:"minCache",value:types_1$2.DataType.uint},28136:{name:"maxCache",value:types_1$2.DataType.uint},2352003:{name:"defaultDuration",value:types_1$2.DataType.uint},2306383:{name:"timecodeScale",value:types_1$2.DataType.float},21358:{name:"name",value:types_1$2.DataType.string},2274716:{name:"language",value:types_1$2.DataType.string},134:{name:"codecID",value:types_1$2.DataType.string},25506:{name:"codecPrivate",value:types_1$2.DataType.binary},2459272:{name:"codecName",value:types_1$2.DataType.string},3839639:{name:"codecSettings",value:types_1$2.DataType.string},3883072:{name:"codecInfoUrl",value:types_1$2.DataType.string},2536e3:{name:"codecDownloadUrl",value:types_1$2.DataType.string},170:{name:"codecDecodeAll",value:types_1$2.DataType.bool},28587:{name:"trackOverlay",value:types_1$2.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:types_1$2.DataType.bool},21432:{name:"stereoMode",value:types_1$2.DataType.uint},176:{name:"pixelWidth",value:types_1$2.DataType.uint},186:{name:"pixelHeight",value:types_1$2.DataType.uint},21680:{name:"displayWidth",value:types_1$2.DataType.uint},21690:{name:"displayHeight",value:types_1$2.DataType.uint},21683:{name:"aspectRatioType",value:types_1$2.DataType.uint},3061028:{name:"colourSpace",value:types_1$2.DataType.uint},3126563:{name:"gammaValue",value:types_1$2.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:types_1$2.DataType.float},30901:{name:"outputSamplingFrequency",value:types_1$2.DataType.float},159:{name:"channels",value:types_1$2.DataType.uint},148:{name:"channels",value:types_1$2.DataType.uint},32123:{name:"channelPositions",value:types_1$2.DataType.binary},25188:{name:"bitDepth",value:types_1$2.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:types_1$2.DataType.uint},20530:{name:"scope",value:types_1$2.DataType.bool},20531:{name:"type",value:types_1$2.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:types_1$2.DataType.uint},16981:{name:"contentCompSettings",value:types_1$2.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:types_1$2.DataType.uint},18402:{name:"contentEncKeyID",value:types_1$2.DataType.binary},18403:{name:"contentSignature ",value:types_1$2.DataType.binary},18404:{name:"ContentSigKeyID  ",value:types_1$2.DataType.binary},18405:{name:"contentSigAlgo ",value:types_1$2.DataType.uint},18406:{name:"contentSigHashAlgo ",value:types_1$2.DataType.uint}}},25188:{name:"bitDepth",value:types_1$2.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:types_1$2.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:types_1$2.DataType.uint},241:{name:"clusterPosition",value:types_1$2.DataType.uint},21368:{name:"blockNumber",value:types_1$2.DataType.uint},234:{name:"codecState",value:types_1$2.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:types_1$2.DataType.uint},151:{name:"cluster",value:types_1$2.DataType.uint},21343:{name:"number",value:types_1$2.DataType.uint},235:{name:"codecState",value:types_1$2.DataType.uint}}},240:{name:"relativePosition",value:types_1$2.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:types_1$2.DataType.string},18030:{name:"name",value:types_1$2.DataType.string},18016:{name:"mimeType",value:types_1$2.DataType.string},18012:{name:"data",value:types_1$2.DataType.binary},18094:{name:"uid",value:types_1$2.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:types_1$2.DataType.uid},145:{name:"timeStart",value:types_1$2.DataType.uint},146:{name:"timeEnd",value:types_1$2.DataType.uid},152:{name:"hidden",value:types_1$2.DataType.bool},17816:{name:"enabled",value:types_1$2.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:types_1$2.DataType.uid},128:{name:"display",container:{133:{name:"string",value:types_1$2.DataType.string},17276:{name:"language ",value:types_1$2.DataType.string},17278:{name:"country ",value:types_1$2.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:types_1$2.DataType.uid},25540:{name:"tagChapterUID",value:types_1$2.DataType.uint},25542:{name:"tagAttachmentUID",value:types_1$2.DataType.uid},25546:{name:"targetType",value:types_1$2.DataType.string},26826:{name:"targetTypeValue",value:types_1$2.DataType.uint},25545:{name:"tagEditionUID",value:types_1$2.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:types_1$2.DataType.string},17543:{name:"string",value:types_1$2.DataType.string},17541:{name:"binary",value:types_1$2.DataType.binary},17530:{name:"language",value:types_1$2.DataType.string},17531:{name:"languageIETF",value:types_1$2.DataType.string},17540:{name:"default",value:types_1$2.DataType.bool}}}}}}}}}};Object.defineProperty(MatroskaParser$1,"__esModule",{value:!0});MatroskaParser$1.MatroskaParser=void 0;const token_types_1=lib$1,debug_1$2=srcExports,BasicParser_1=BasicParser$1,types_1$1=types$1,matroskaDtd=MatroskaDtd,debug$3=(0,debug_1$2.default)("music-metadata:parser:matroska");class MatroskaParser extends BasicParser_1.BasicParser{constructor(){super(),this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.parserMap.set(types_1$1.DataType.uint,e=>this.readUint(e)),this.parserMap.set(types_1$1.DataType.string,e=>this.readString(e)),this.parserMap.set(types_1$1.DataType.binary,e=>this.readBuffer(e)),this.parserMap.set(types_1$1.DataType.uid,async e=>await this.readUint(e)===1),this.parserMap.set(types_1$1.DataType.bool,e=>this.readFlag(e)),this.parserMap.set(types_1$1.DataType.float,e=>this.readFloat(e))}init(e,n,a){return super.init(e,n,a),this}async parse(){const e=await this.parseContainer(matroskaDtd.elements,this.tokenizer.fileInfo.size,[]);if(this.metadata.setFormat("container",`EBML/${e.ebml.docType}`),e.segment){const n=e.segment.info;if(n){const i=n.timecodeScale?n.timecodeScale:1e6;if(typeof n.duration=="number"){const s=n.duration*i/1e9;this.addTag("segment:title",n.title),this.metadata.setFormat("duration",s)}}const a=e.segment.tracks;if(a&&a.entries){a.entries.forEach(s=>{const o={codecName:s.codecID.replace("A_","").replace("V_",""),codecSettings:s.codecSettings,flagDefault:s.flagDefault,flagLacing:s.flagLacing,flagEnabled:s.flagEnabled,language:s.language,name:s.name,type:s.trackType,audio:s.audio,video:s.video};this.metadata.addStreamInfo(o)});const i=a.entries.filter(s=>s.trackType===types_1$1.TrackType.audio.valueOf()).reduce((s,o)=>!s||!s.flagDefault&&o.flagDefault||o.trackNumber&&o.trackNumber<s.trackNumber?o:s,null);i&&(this.metadata.setFormat("codec",i.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",i.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",i.audio.channels)),e.segment.tags&&e.segment.tags.tag.forEach(s=>{const o=s.target,l=o!=null&&o.targetTypeValue?types_1$1.TargetType[o.targetTypeValue]:o!=null&&o.targetType?o.targetType:"track";s.simpleTags.forEach(c=>{const d=c.string?c.string:c.binary;this.addTag(`${l}:${c.name}`,d)})}),e.segment.attachments&&e.segment.attachments.attachedFiles.filter(s=>s.mimeType.startsWith("image/")).map(s=>({data:s.data,format:s.mimeType,description:s.description,name:s.name})).forEach(s=>{this.addTag("picture",s)})}}}async parseContainer(e,n,a){const i={};for(;this.tokenizer.position<n;){let s;try{s=await this.readElement()}catch(l){if(l.message==="End-Of-Stream")break;throw l}const o=e[s.id];if(o)if(debug$3(`Element: name=${o.name}, container=${!!o.container}`),o.container){const l=await this.parseContainer(o.container,s.len>=0?this.tokenizer.position+s.len:-1,a.concat([o.name]));o.multiple?(i[o.name]||(i[o.name]=[]),i[o.name].push(l)):i[o.name]=l}else i[o.name]=await this.parserMap.get(o.value)(s);else switch(s.id){case 236:this.padding+=s.len,await this.tokenizer.ignore(s.len);break;default:debug$3(`parseEbml: path=${a.join("/")}, unknown element: id=${s.id.toString(16)}`),this.padding+=s.len,await this.tokenizer.ignore(s.len)}}return i}async readVintData(e){const n=await this.tokenizer.peekNumber(token_types_1.UINT8);let a=128,i=1;for(;!(n&a);){if(i>e)throw new Error("VINT value exceeding maximum size");++i,a>>=1}const s=Buffer.alloc(i);return await this.tokenizer.readBuffer(s),s}async readElement(){const e=await this.readVintData(this.ebmlMaxIDLength),n=await this.readVintData(this.ebmlMaxSizeLength);n[0]^=128>>n.length-1;const a=Math.min(6,n.length);return{id:e.readUIntBE(0,e.length),len:n.readUIntBE(n.length-a,a)}}isMaxValue(e){if(e.length===this.ebmlMaxSizeLength){for(let n=1;n<this.ebmlMaxSizeLength;++n)if(e[n]!==255)return!1;return!0}return!1}async readFloat(e){switch(e.len){case 0:return 0;case 4:return this.tokenizer.readNumber(token_types_1.Float32_BE);case 8:return this.tokenizer.readNumber(token_types_1.Float64_BE);case 10:return this.tokenizer.readNumber(token_types_1.Float64_BE);default:throw new Error(`Invalid IEEE-754 float length: ${e.len}`)}}async readFlag(e){return await this.readUint(e)===1}async readUint(e){const n=await this.readBuffer(e),a=Math.min(6,e.len);return n.readUIntBE(e.len-a,a)}async readString(e){return(await this.tokenizer.readToken(new token_types_1.StringType(e.len,"utf-8"))).replace(/\00.*$/g,"")}async readBuffer(e){const n=Buffer.alloc(e.len);return await this.tokenizer.readBuffer(n),n}addTag(e,n){this.metadata.addTag("matroska",e,n)}}MatroskaParser$1.MatroskaParser=MatroskaParser;Object.defineProperty(ParserFactory$1,"__esModule",{value:!0});ParserFactory$1.ParserFactory=ParserFactory$1.parseHttpContentType=void 0;const FileType=core$4,ContentType=contentType,MimeType=mediaTyper,debug_1$1=srcExports,MetadataCollector_1=MetadataCollector$1,AiffParser_1=AiffParser,APEv2Parser_1$1=APEv2Parser$1,AsfParser_1=AsfParser$1,FlacParser_1=FlacParser$1,MP4Parser_1=MP4Parser$1,MpegParser_1=MpegParser$1,musepack_1=musepack,OggParser_1=OggParser$1,WaveParser_1=WaveParser$1,WavPackParser_1=WavPackParser$1,DsfParser_1=DsfParser$1,DsdiffParser_1=DsdiffParser$1,MatroskaParser_1=MatroskaParser$1,debug$2=(0,debug_1$1.default)("music-metadata:parser:factory");function parseHttpContentType(r){const e=ContentType.parse(r),n=MimeType.parse(e.type);return{type:n.type,subtype:n.subtype,suffix:n.suffix,parameters:e.parameters}}ParserFactory$1.parseHttpContentType=parseHttpContentType;async function parse$8(r,e,n={}){const a=await ParserFactory.loadParser(e),i=new MetadataCollector_1.MetadataCollector(n);return await a.init(i,r,n).parse(),i.toCommonMetadata()}class ParserFactory{static async parseOnContentType(e,n){const{mimeType:a,path:i,url:s}=await e.fileInfo,o=ParserFactory.getParserIdForMimeType(a)||ParserFactory.getParserIdForExtension(i)||ParserFactory.getParserIdForExtension(s);return o||debug$2("No parser found for MIME-type / extension: "+a),this.parse(e,o,n)}static async parse(e,n,a){if(!n){debug$2("Guess parser on content...");const i=Buffer.alloc(4100);if(await e.peekBuffer(i,{mayBeLess:!0}),e.fileInfo.path&&(n=this.getParserIdForExtension(e.fileInfo.path)),!n){const s=await FileType.fromBuffer(i);if(!s)throw new Error("Failed to determine audio format");if(debug$2(`Guessed file type is mime=${s.mime}, extension=${s.ext}`),n=ParserFactory.getParserIdForMimeType(s.mime),!n)throw new Error("Guessed MIME-type not supported: "+s.mime)}}return parse$8(e,n,a)}static getParserIdForExtension(e){if(!e)return;switch(this.getExtension(e).toLocaleLowerCase()||e){case".mp2":case".mp3":case".m2a":case".aac":return"mpeg";case".ape":return"apev2";case".mp4":case".m4a":case".m4b":case".m4pa":case".m4v":case".m4r":case".3gp":return"mp4";case".wma":case".wmv":case".asf":return"asf";case".flac":return"flac";case".ogg":case".ogv":case".oga":case".ogm":case".ogx":case".opus":case".spx":return"ogg";case".aif":case".aiff":case".aifc":return"aiff";case".wav":case".bwf":return"riff";case".wv":case".wvp":return"wavpack";case".mpc":return"musepack";case".dsf":return"dsf";case".dff":return"dsdiff";case".mka":case".mkv":case".mk3d":case".mks":case".webm":return"matroska"}}static async loadParser(e){switch(e){case"aiff":return new AiffParser_1.AIFFParser;case"adts":case"mpeg":return new MpegParser_1.MpegParser;case"apev2":return new APEv2Parser_1$1.APEv2Parser;case"asf":return new AsfParser_1.AsfParser;case"dsf":return new DsfParser_1.DsfParser;case"dsdiff":return new DsdiffParser_1.DsdiffParser;case"flac":return new FlacParser_1.FlacParser;case"mp4":return new MP4Parser_1.MP4Parser;case"musepack":return new musepack_1.default;case"ogg":return new OggParser_1.OggParser;case"riff":return new WaveParser_1.WaveParser;case"wavpack":return new WavPackParser_1.WavPackParser;case"matroska":return new MatroskaParser_1.MatroskaParser;default:throw new Error(`Unknown parser type: ${e}`)}}static getExtension(e){const n=e.lastIndexOf(".");return n===-1?"":e.slice(n)}static getParserIdForMimeType(e){let n;try{n=parseHttpContentType(e)}catch{debug$2(`Invalid HTTP Content-Type header value: ${e}`);return}const a=n.subtype.indexOf("x-")===0?n.subtype.substring(2):n.subtype;switch(n.type){case"audio":switch(a){case"mp3":case"mpeg":return"mpeg";case"aac":case"aacp":return"adts";case"flac":return"flac";case"ape":case"monkeys-audio":return"apev2";case"mp4":case"m4a":return"mp4";case"ogg":case"opus":case"speex":return"ogg";case"ms-wma":case"ms-wmv":case"ms-asf":return"asf";case"aiff":case"aif":case"aifc":return"aiff";case"vnd.wave":case"wav":case"wave":return"riff";case"wavpack":return"wavpack";case"musepack":return"musepack";case"matroska":case"webm":return"matroska";case"dsf":return"dsf"}break;case"video":switch(a){case"ms-asf":case"ms-wmv":return"asf";case"m4v":case"mp4":return"mp4";case"ogg":return"ogg";case"matroska":case"webm":return"matroska"}break;case"application":switch(a){case"vnd.ms-asf":return"asf";case"ogg":return"ogg"}break}}}ParserFactory$1.ParserFactory=ParserFactory;var RandomUint8ArrayReader$1={};Object.defineProperty(RandomUint8ArrayReader$1,"__esModule",{value:!0});RandomUint8ArrayReader$1.RandomUint8ArrayReader=void 0;class RandomUint8ArrayReader{constructor(e){this.uint8Array=e,this.fileSize=e.length}async randomRead(e,n,a,i){return e.set(this.uint8Array.subarray(i,i+a),n),a}}RandomUint8ArrayReader$1.RandomUint8ArrayReader=RandomUint8ArrayReader;var Lyrics3={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.getLyricsHeaderLength=r.endTag2=void 0,r.endTag2="LYRICS200";async function e(n){if(n.fileSize>=143){const a=Buffer.alloc(15);await n.randomRead(a,0,a.length,n.fileSize-143);const i=a.toString("binary");if(i.substr(6)===r.endTag2)return parseInt(i.substr(0,6),10)+15}return 0}r.getLyricsHeaderLength=e})(Lyrics3);Object.defineProperty(core$6,"__esModule",{value:!0});core$6.scanAppendingHeaders=core$6.selectCover=core$6.ratingToStars=core$6.orderTags=core$6.parseFromTokenizer=core$6.parseBuffer=core$6.parseStream=void 0;const strtok3=core$5,ParserFactory_1=ParserFactory$1,RandomUint8ArrayReader_1=RandomUint8ArrayReader$1,APEv2Parser_1=APEv2Parser$1,ID3v1Parser_1=ID3v1Parser,Lyrics3_1=Lyrics3;function parseStream(r,e,n={}){return parseFromTokenizer(strtok3.fromStream(r,typeof e=="string"?{mimeType:e}:e),n)}core$6.parseStream=parseStream;async function parseBuffer(r,e,n={}){const a=new RandomUint8ArrayReader_1.RandomUint8ArrayReader(r);await scanAppendingHeaders(a,n);const i=strtok3.fromBuffer(r,typeof e=="string"?{mimeType:e}:e);return parseFromTokenizer(i,n)}core$6.parseBuffer=parseBuffer;function parseFromTokenizer(r,e){return ParserFactory_1.ParserFactory.parseOnContentType(r,e)}core$6.parseFromTokenizer=parseFromTokenizer;function orderTags(r){const e={};for(const n of r)(e[n.id]=e[n.id]||[]).push(n.value);return e}core$6.orderTags=orderTags;function ratingToStars(r){return r===void 0?0:1+Math.round(r*4)}core$6.ratingToStars=ratingToStars;function selectCover(r){return r?r.reduce((e,n)=>n.name&&n.name.toLowerCase()in["front","cover","cover (front)"]?n:e):null}core$6.selectCover=selectCover;async function scanAppendingHeaders(r,e={}){let n=r.fileSize;if(await(0,ID3v1Parser_1.hasID3v1Header)(r)){n-=128;const a=await(0,Lyrics3_1.getLyricsHeaderLength)(r);n-=a}e.apeHeader=await APEv2Parser_1.APEv2Parser.findApeFooterOffset(r,n)}core$6.scanAppendingHeaders=scanAppendingHeaders;var lib={},ours={exports:{}},stream={exports:{}},primordials,hasRequiredPrimordials;function requirePrimordials(){if(hasRequiredPrimordials)return primordials;hasRequiredPrimordials=1;class r extends Error{constructor(n){if(!Array.isArray(n))throw new TypeError(`Expected input to be an Array, got ${typeof n}`);let a="";for(let i=0;i<n.length;i++)a+=`    ${n[i].stack}
`;super(a),this.name="AggregateError",this.errors=n}}return primordials={AggregateError:r,ArrayIsArray(e){return Array.isArray(e)},ArrayPrototypeIncludes(e,n){return e.includes(n)},ArrayPrototypeIndexOf(e,n){return e.indexOf(n)},ArrayPrototypeJoin(e,n){return e.join(n)},ArrayPrototypeMap(e,n){return e.map(n)},ArrayPrototypePop(e,n){return e.pop(n)},ArrayPrototypePush(e,n){return e.push(n)},ArrayPrototypeSlice(e,n,a){return e.slice(n,a)},Error,FunctionPrototypeCall(e,n,...a){return e.call(n,...a)},FunctionPrototypeSymbolHasInstance(e,n){return Function.prototype[Symbol.hasInstance].call(e,n)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(e,n){return Object.defineProperties(e,n)},ObjectDefineProperty(e,n,a){return Object.defineProperty(e,n,a)},ObjectGetOwnPropertyDescriptor(e,n){return Object.getOwnPropertyDescriptor(e,n)},ObjectKeys(e){return Object.keys(e)},ObjectSetPrototypeOf(e,n){return Object.setPrototypeOf(e,n)},Promise,PromisePrototypeCatch(e,n){return e.catch(n)},PromisePrototypeThen(e,n,a){return e.then(n,a)},PromiseReject(e){return Promise.reject(e)},PromiseResolve(e){return Promise.resolve(e)},ReflectApply:Reflect.apply,RegExpPrototypeTest(e,n){return e.test(n)},SafeSet:Set,String,StringPrototypeSlice(e,n,a){return e.slice(n,a)},StringPrototypeToLowerCase(e){return e.toLowerCase()},StringPrototypeToUpperCase(e){return e.toUpperCase()},StringPrototypeTrim(e){return e.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(e,n,a){return e.set(n,a)},Boolean,Uint8Array},primordials}var util$1={exports:{}},inspect,hasRequiredInspect;function requireInspect(){return hasRequiredInspect||(hasRequiredInspect=1,inspect={format(r,...e){return r.replace(/%([sdifj])/g,function(...[n,a]){const i=e.shift();return a==="f"?i.toFixed(6):a==="j"?JSON.stringify(i):a==="s"&&typeof i=="object"?`${i.constructor!==Object?i.constructor.name:""} {}`.trim():i.toString()})},inspect(r){switch(typeof r){case"string":if(r.includes("'"))if(r.includes('"')){if(!r.includes("`")&&!r.includes("${"))return`\`${r}\``}else return`"${r}"`;return`'${r}'`;case"number":return isNaN(r)?"NaN":Object.is(r,-0)?String(r):r;case"bigint":return`${String(r)}n`;case"boolean":case"undefined":return String(r);case"object":return"{}"}}}),inspect}var errors$1,hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors$1;hasRequiredErrors=1;const{format:r,inspect:e}=requireInspect(),{AggregateError:n}=requirePrimordials(),a=globalThis.AggregateError||n,i=Symbol("kIsNodeError"),s=["string","function","number","object","Function","Object","boolean","bigint","symbol"],o=/^([A-Z][a-z0-9]*)+$/,l="__node_internal_",c={};function d(_,p){if(!_)throw new c.ERR_INTERNAL_ASSERTION(p)}function u(_){let p="",b=_.length;const v=_[0]==="-"?1:0;for(;b>=v+4;b-=3)p=`_${_.slice(b-3,b)}${p}`;return`${_.slice(0,b)}${p}`}function f(_,p,b){if(typeof p=="function")return d(p.length<=b.length,`Code: ${_}; The provided arguments length (${b.length}) does not match the required ones (${p.length}).`),p(...b);const v=(p.match(/%[dfijoOs]/g)||[]).length;return d(v===b.length,`Code: ${_}; The provided arguments length (${b.length}) does not match the required ones (${v}).`),b.length===0?p:r(p,...b)}function m(_,p,b){b||(b=Error);class v extends b{constructor(...U){super(f(_,p,U))}toString(){return`${this.name} [${_}]: ${this.message}`}}Object.defineProperties(v.prototype,{name:{value:b.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${_}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),v.prototype.code=_,v.prototype[i]=!0,c[_]=v}function h(_){const p=l+_.name;return Object.defineProperty(_,"name",{value:p}),_}function w(_,p){if(_&&p&&_!==p){if(Array.isArray(p.errors))return p.errors.push(_),p;const b=new a([p,_],p.message);return b.code=p.code,b}return _||p}class $ extends Error{constructor(p="The operation was aborted",b=void 0){if(b!==void 0&&typeof b!="object")throw new c.ERR_INVALID_ARG_TYPE("options","Object",b);super(p,b),this.code="ABORT_ERR",this.name="AbortError"}}return m("ERR_ASSERTION","%s",Error),m("ERR_INVALID_ARG_TYPE",(_,p,b)=>{d(typeof _=="string","'name' must be a string"),Array.isArray(p)||(p=[p]);let v="The ";_.endsWith(" argument")?v+=`${_} `:v+=`"${_}" ${_.includes(".")?"property":"argument"} `,v+="must be ";const j=[],U=[],B=[];for(const A of p)d(typeof A=="string","All expected entries have to be of type string"),s.includes(A)?j.push(A.toLowerCase()):o.test(A)?U.push(A):(d(A!=="object",'The value "object" should be written as "Object"'),B.push(A));if(U.length>0){const A=j.indexOf("object");A!==-1&&(j.splice(j,A,1),U.push("Object"))}if(j.length>0){switch(j.length){case 1:v+=`of type ${j[0]}`;break;case 2:v+=`one of type ${j[0]} or ${j[1]}`;break;default:{const A=j.pop();v+=`one of type ${j.join(", ")}, or ${A}`}}(U.length>0||B.length>0)&&(v+=" or ")}if(U.length>0){switch(U.length){case 1:v+=`an instance of ${U[0]}`;break;case 2:v+=`an instance of ${U[0]} or ${U[1]}`;break;default:{const A=U.pop();v+=`an instance of ${U.join(", ")}, or ${A}`}}B.length>0&&(v+=" or ")}switch(B.length){case 0:break;case 1:B[0].toLowerCase()!==B[0]&&(v+="an "),v+=`${B[0]}`;break;case 2:v+=`one of ${B[0]} or ${B[1]}`;break;default:{const A=B.pop();v+=`one of ${B.join(", ")}, or ${A}`}}if(b==null)v+=`. Received ${b}`;else if(typeof b=="function"&&b.name)v+=`. Received function ${b.name}`;else if(typeof b=="object"){var T;if((T=b.constructor)!==null&&T!==void 0&&T.name)v+=`. Received an instance of ${b.constructor.name}`;else{const A=e(b,{depth:-1});v+=`. Received ${A}`}}else{let A=e(b,{colors:!1});A.length>25&&(A=`${A.slice(0,25)}...`),v+=`. Received type ${typeof b} (${A})`}return v},TypeError),m("ERR_INVALID_ARG_VALUE",(_,p,b="is invalid")=>{let v=e(p);return v.length>128&&(v=v.slice(0,128)+"..."),`The ${_.includes(".")?"property":"argument"} '${_}' ${b}. Received ${v}`},TypeError),m("ERR_INVALID_RETURN_VALUE",(_,p,b)=>{var v;const j=b!=null&&(v=b.constructor)!==null&&v!==void 0&&v.name?`instance of ${b.constructor.name}`:`type ${typeof b}`;return`Expected ${_} to be returned from the "${p}" function but got ${j}.`},TypeError),m("ERR_MISSING_ARGS",(..._)=>{d(_.length>0,"At least one arg needs to be specified");let p;const b=_.length;switch(_=(Array.isArray(_)?_:[_]).map(v=>`"${v}"`).join(" or "),b){case 1:p+=`The ${_[0]} argument`;break;case 2:p+=`The ${_[0]} and ${_[1]} arguments`;break;default:{const v=_.pop();p+=`The ${_.join(", ")}, and ${v} arguments`}break}return`${p} must be specified`},TypeError),m("ERR_OUT_OF_RANGE",(_,p,b)=>{d(p,'Missing "range" argument');let v;if(Number.isInteger(b)&&Math.abs(b)>2**32)v=u(String(b));else if(typeof b=="bigint"){v=String(b);const j=BigInt(2)**BigInt(32);(b>j||b<-j)&&(v=u(v)),v+="n"}else v=e(b);return`The value of "${_}" is out of range. It must be ${p}. Received ${v}`},RangeError),m("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),m("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),m("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),m("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),m("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),m("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),m("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),m("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),m("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),m("ERR_STREAM_WRITE_AFTER_END","write after end",Error),m("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),errors$1={AbortError:$,aggregateTwoErrors:h(w),hideStackFrames:h,codes:c},errors$1}const privateData=new WeakMap,wrappers=new WeakMap;function pd(r){const e=privateData.get(r);return console.assert(e!=null,"'this' is expected an Event object, but got",r),e}function setCancelFlag(r){if(r.passiveListener!=null){typeof console<"u"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",r.passiveListener);return}r.event.cancelable&&(r.canceled=!0,typeof r.event.preventDefault=="function"&&r.event.preventDefault())}function Event$1(r,e){privateData.set(this,{eventTarget:r,event:e,eventPhase:2,currentTarget:r,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:e.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(e);for(let a=0;a<n.length;++a){const i=n[a];i in this||Object.defineProperty(this,i,defineRedirectDescriptor(i))}}Event$1.prototype={get type(){return pd(this).event.type},get target(){return pd(this).eventTarget},get currentTarget(){return pd(this).currentTarget},composedPath(){const r=pd(this).currentTarget;return r==null?[]:[r]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return pd(this).eventPhase},stopPropagation(){const r=pd(this);r.stopped=!0,typeof r.event.stopPropagation=="function"&&r.event.stopPropagation()},stopImmediatePropagation(){const r=pd(this);r.stopped=!0,r.immediateStopped=!0,typeof r.event.stopImmediatePropagation=="function"&&r.event.stopImmediatePropagation()},get bubbles(){return!!pd(this).event.bubbles},get cancelable(){return!!pd(this).event.cancelable},preventDefault(){setCancelFlag(pd(this))},get defaultPrevented(){return pd(this).canceled},get composed(){return!!pd(this).event.composed},get timeStamp(){return pd(this).timeStamp},get srcElement(){return pd(this).eventTarget},get cancelBubble(){return pd(this).stopped},set cancelBubble(r){if(!r)return;const e=pd(this);e.stopped=!0,typeof e.event.cancelBubble=="boolean"&&(e.event.cancelBubble=!0)},get returnValue(){return!pd(this).canceled},set returnValue(r){r||setCancelFlag(pd(this))},initEvent(){}};Object.defineProperty(Event$1.prototype,"constructor",{value:Event$1,configurable:!0,writable:!0});typeof window<"u"&&typeof window.Event<"u"&&(Object.setPrototypeOf(Event$1.prototype,window.Event.prototype),wrappers.set(window.Event.prototype,Event$1));function defineRedirectDescriptor(r){return{get(){return pd(this).event[r]},set(e){pd(this).event[r]=e},configurable:!0,enumerable:!0}}function defineCallDescriptor(r){return{value(){const e=pd(this).event;return e[r].apply(e,arguments)},configurable:!0,enumerable:!0}}function defineWrapper(r,e){const n=Object.keys(e);if(n.length===0)return r;function a(i,s){r.call(this,i,s)}a.prototype=Object.create(r.prototype,{constructor:{value:a,configurable:!0,writable:!0}});for(let i=0;i<n.length;++i){const s=n[i];if(!(s in r.prototype)){const l=typeof Object.getOwnPropertyDescriptor(e,s).value=="function";Object.defineProperty(a.prototype,s,l?defineCallDescriptor(s):defineRedirectDescriptor(s))}}return a}function getWrapper(r){if(r==null||r===Object.prototype)return Event$1;let e=wrappers.get(r);return e==null&&(e=defineWrapper(getWrapper(Object.getPrototypeOf(r)),r),wrappers.set(r,e)),e}function wrapEvent(r,e){const n=getWrapper(Object.getPrototypeOf(e));return new n(r,e)}function isStopped(r){return pd(r).immediateStopped}function setEventPhase(r,e){pd(r).eventPhase=e}function setCurrentTarget(r,e){pd(r).currentTarget=e}function setPassiveListener(r,e){pd(r).passiveListener=e}const listenersMap=new WeakMap,CAPTURE=1,BUBBLE=2,ATTRIBUTE=3;function isObject$1(r){return r!==null&&typeof r=="object"}function getListeners(r){const e=listenersMap.get(r);if(e==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function defineEventAttributeDescriptor(r){return{get(){let n=getListeners(this).get(r);for(;n!=null;){if(n.listenerType===ATTRIBUTE)return n.listener;n=n.next}return null},set(e){typeof e!="function"&&!isObject$1(e)&&(e=null);const n=getListeners(this);let a=null,i=n.get(r);for(;i!=null;)i.listenerType===ATTRIBUTE?a!==null?a.next=i.next:i.next!==null?n.set(r,i.next):n.delete(r):a=i,i=i.next;if(e!==null){const s={listener:e,listenerType:ATTRIBUTE,passive:!1,once:!1,next:null};a===null?n.set(r,s):a.next=s}},configurable:!0,enumerable:!0}}function defineEventAttribute(r,e){Object.defineProperty(r,`on${e}`,defineEventAttributeDescriptor(e))}function defineCustomEventTarget(r){function e(){EventTarget$1.call(this)}e.prototype=Object.create(EventTarget$1.prototype,{constructor:{value:e,configurable:!0,writable:!0}});for(let n=0;n<r.length;++n)defineEventAttribute(e.prototype,r[n]);return e}function EventTarget$1(){if(this instanceof EventTarget$1){listenersMap.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return defineCustomEventTarget(arguments[0]);if(arguments.length>0){const r=new Array(arguments.length);for(let e=0;e<arguments.length;++e)r[e]=arguments[e];return defineCustomEventTarget(r)}throw new TypeError("Cannot call a class as a function")}EventTarget$1.prototype={addEventListener(r,e,n){if(e==null)return;if(typeof e!="function"&&!isObject$1(e))throw new TypeError("'listener' should be a function or an object.");const a=getListeners(this),i=isObject$1(n),o=(i?!!n.capture:!!n)?CAPTURE:BUBBLE,l={listener:e,listenerType:o,passive:i&&!!n.passive,once:i&&!!n.once,next:null};let c=a.get(r);if(c===void 0){a.set(r,l);return}let d=null;for(;c!=null;){if(c.listener===e&&c.listenerType===o)return;d=c,c=c.next}d.next=l},removeEventListener(r,e,n){if(e==null)return;const a=getListeners(this),s=(isObject$1(n)?!!n.capture:!!n)?CAPTURE:BUBBLE;let o=null,l=a.get(r);for(;l!=null;){if(l.listener===e&&l.listenerType===s){o!==null?o.next=l.next:l.next!==null?a.set(r,l.next):a.delete(r);return}o=l,l=l.next}},dispatchEvent(r){if(r==null||typeof r.type!="string")throw new TypeError('"event.type" should be a string.');const e=getListeners(this),n=r.type;let a=e.get(n);if(a==null)return!0;const i=wrapEvent(this,r);let s=null;for(;a!=null;){if(a.once?s!==null?s.next=a.next:a.next!==null?e.set(n,a.next):e.delete(n):s=a,setPassiveListener(i,a.passive?a.listener:null),typeof a.listener=="function")try{a.listener.call(this,i)}catch(o){typeof console<"u"&&typeof console.error=="function"&&console.error(o)}else a.listenerType!==ATTRIBUTE&&typeof a.listener.handleEvent=="function"&&a.listener.handleEvent(i);if(isStopped(i))break;a=a.next}return setPassiveListener(i,null),setEventPhase(i,0),setCurrentTarget(i,null),!i.defaultPrevented}};Object.defineProperty(EventTarget$1.prototype,"constructor",{value:EventTarget$1,configurable:!0,writable:!0});typeof window<"u"&&typeof window.EventTarget<"u"&&Object.setPrototypeOf(EventTarget$1.prototype,window.EventTarget.prototype);class AbortSignal extends EventTarget$1{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){const e=abortedFlags.get(this);if(typeof e!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return e}}defineEventAttribute(AbortSignal.prototype,"abort");function createAbortSignal(){const r=Object.create(AbortSignal.prototype);return EventTarget$1.call(r),abortedFlags.set(r,!1),r}function abortSignal(r){abortedFlags.get(r)===!1&&(abortedFlags.set(r,!0),r.dispatchEvent({type:"abort"}))}const abortedFlags=new WeakMap;Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class AbortController{constructor(){signals.set(this,createAbortSignal())}get signal(){return getSignal(this)}abort(){abortSignal(getSignal(this))}}const signals=new WeakMap;function getSignal(r){const e=signals.get(r);if(e==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${r===null?"null":typeof r}`);return e}Object.defineProperties(AbortController.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(AbortController.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});const abortController=Object.freeze(Object.defineProperty({__proto__:null,AbortController,AbortSignal,default:AbortController},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(abortController);var hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(r){const e=require$$0$3,{format:n,inspect:a}=requireInspect(),{codes:{ERR_INVALID_ARG_TYPE:i}}=requireErrors(),{kResistStopPropagation:s,AggregateError:o,SymbolDispose:l}=requirePrimordials(),c=globalThis.AbortSignal||require$$0$1.AbortSignal,d=globalThis.AbortController||require$$0$1.AbortController,u=Object.getPrototypeOf(async function(){}).constructor,f=globalThis.Blob||e.Blob,m=typeof f<"u"?function(_){return _ instanceof f}:function(_){return!1},h=($,_)=>{if($!==void 0&&($===null||typeof $!="object"||!("aborted"in $)))throw new i(_,"AbortSignal",$)},w=($,_)=>{if(typeof $!="function")throw new i(_,"Function",$)};r.exports={AggregateError:o,kEmptyObject:Object.freeze({}),once($){let _=!1;return function(...p){_||(_=!0,$.apply(this,p))}},createDeferredPromise:function(){let $,_;return{promise:new Promise((b,v)=>{$=b,_=v}),resolve:$,reject:_}},promisify($){return new Promise((_,p)=>{$((b,...v)=>b?p(b):_(...v))})},debuglog(){return function(){}},format:n,inspect:a,types:{isAsyncFunction($){return $ instanceof u},isArrayBufferView($){return ArrayBuffer.isView($)}},isBlob:m,deprecate($,_){return $},addAbortListener:require$$2$1.addAbortListener||function(_,p){if(_===void 0)throw new i("signal","AbortSignal",_);h(_,"signal"),w(p,"listener");let b;return _.aborted?queueMicrotask(()=>p()):(_.addEventListener("abort",p,{__proto__:null,once:!0,[s]:!0}),b=()=>{_.removeEventListener("abort",p)}),{__proto__:null,[l](){var v;(v=b)===null||v===void 0||v()}}},AbortSignalAny:c.any||function(_){if(_.length===1)return _[0];const p=new d,b=()=>p.abort();return _.forEach(v=>{h(v,"signals"),v.addEventListener("abort",b,{once:!0})}),p.signal.addEventListener("abort",()=>{_.forEach(v=>v.removeEventListener("abort",b))},{once:!0}),p.signal}},r.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}(util$1)),util$1.exports}var operators={},validators,hasRequiredValidators;function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1;const{ArrayIsArray:r,ArrayPrototypeIncludes:e,ArrayPrototypeJoin:n,ArrayPrototypeMap:a,NumberIsInteger:i,NumberIsNaN:s,NumberMAX_SAFE_INTEGER:o,NumberMIN_SAFE_INTEGER:l,NumberParseInt:c,ObjectPrototypeHasOwnProperty:d,RegExpPrototypeExec:u,String:f,StringPrototypeToUpperCase:m,StringPrototypeTrim:h}=requirePrimordials(),{hideStackFrames:w,codes:{ERR_SOCKET_BAD_PORT:$,ERR_INVALID_ARG_TYPE:_,ERR_INVALID_ARG_VALUE:p,ERR_OUT_OF_RANGE:b,ERR_UNKNOWN_SIGNAL:v}}=requireErrors(),{normalizeEncoding:j}=requireUtil(),{isAsyncFunction:U,isArrayBufferView:B}=requireUtil().types,T={};function A(D){return D===(D|0)}function ce(D){return D===D>>>0}const V=/^[0-7]+$/,R="must be a 32-bit unsigned integer or an octal string";function z(D,J,ne){if(typeof D>"u"&&(D=ne),typeof D=="string"){if(u(V,D)===null)throw new p(J,D,R);D=c(D,8)}return q(D,J),D}const x=w((D,J,ne=l,Y=o)=>{if(typeof D!="number")throw new _(J,"number",D);if(!i(D))throw new b(J,"an integer",D);if(D<ne||D>Y)throw new b(J,`>= ${ne} && <= ${Y}`,D)}),M=w((D,J,ne=-2147483648,Y=2147483647)=>{if(typeof D!="number")throw new _(J,"number",D);if(!i(D))throw new b(J,"an integer",D);if(D<ne||D>Y)throw new b(J,`>= ${ne} && <= ${Y}`,D)}),q=w((D,J,ne=!1)=>{if(typeof D!="number")throw new _(J,"number",D);if(!i(D))throw new b(J,"an integer",D);const Y=ne?1:0,fe=4294967295;if(D<Y||D>fe)throw new b(J,`>= ${Y} && <= ${fe}`,D)});function X(D,J){if(typeof D!="string")throw new _(J,"string",D)}function Z(D,J,ne=void 0,Y){if(typeof D!="number")throw new _(J,"number",D);if(ne!=null&&D<ne||Y!=null&&D>Y||(ne!=null||Y!=null)&&s(D))throw new b(J,`${ne!=null?`>= ${ne}`:""}${ne!=null&&Y!=null?" && ":""}${Y!=null?`<= ${Y}`:""}`,D)}const L=w((D,J,ne)=>{if(!e(ne,D)){const fe="must be one of: "+n(a(ne,_e=>typeof _e=="string"?`'${_e}'`:f(_e)),", ");throw new p(J,D,fe)}});function K(D,J){if(typeof D!="boolean")throw new _(J,"boolean",D)}function y(D,J,ne){return D==null||!d(D,J)?ne:D[J]}const E=w((D,J,ne=null)=>{const Y=y(ne,"allowArray",!1),fe=y(ne,"allowFunction",!1);if(!y(ne,"nullable",!1)&&D===null||!Y&&r(D)||typeof D!="object"&&(!fe||typeof D!="function"))throw new _(J,"Object",D)}),C=w((D,J)=>{if(D!=null&&typeof D!="object"&&typeof D!="function")throw new _(J,"a dictionary",D)}),S=w((D,J,ne=0)=>{if(!r(D))throw new _(J,"Array",D);if(D.length<ne){const Y=`must be longer than ${ne}`;throw new p(J,D,Y)}});function g(D,J){S(D,J);for(let ne=0;ne<D.length;ne++)X(D[ne],`${J}[${ne}]`)}function k(D,J){S(D,J);for(let ne=0;ne<D.length;ne++)K(D[ne],`${J}[${ne}]`)}function G(D,J){S(D,J);for(let ne=0;ne<D.length;ne++){const Y=D[ne],fe=`${J}[${ne}]`;if(Y==null)throw new _(fe,"AbortSignal",Y);le(Y,fe)}}function ee(D,J="signal"){if(X(D,J),T[D]===void 0)throw T[m(D)]!==void 0?new v(D+" (signals must use all capital letters)"):new v(D)}const N=w((D,J="buffer")=>{if(!B(D))throw new _(J,["Buffer","TypedArray","DataView"],D)});function H(D,J){const ne=j(J),Y=D.length;if(ne==="hex"&&Y%2!==0)throw new p("encoding",J,`is invalid for data of length ${Y}`)}function Q(D,J="Port",ne=!0){if(typeof D!="number"&&typeof D!="string"||typeof D=="string"&&h(D).length===0||+D!==+D>>>0||D>65535||D===0&&!ne)throw new $(J,D,ne);return D|0}const le=w((D,J)=>{if(D!==void 0&&(D===null||typeof D!="object"||!("aborted"in D)))throw new _(J,"AbortSignal",D)}),ue=w((D,J)=>{if(typeof D!="function")throw new _(J,"Function",D)}),O=w((D,J)=>{if(typeof D!="function"||U(D))throw new _(J,"Function",D)}),F=w((D,J)=>{if(D!==void 0)throw new _(J,"undefined",D)});function W(D,J,ne){if(!e(ne,D))throw new _(J,`('${n(ne,"|")}')`,D)}const ie=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function ae(D,J){if(typeof D>"u"||!u(ie,D))throw new p(J,D,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function te(D){if(typeof D=="string")return ae(D,"hints"),D;if(r(D)){const J=D.length;let ne="";if(J===0)return ne;for(let Y=0;Y<J;Y++){const fe=D[Y];ae(fe,"hints"),ne+=fe,Y!==J-1&&(ne+=", ")}return ne}throw new p("hints",D,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}return validators={isInt32:A,isUint32:ce,parseFileMode:z,validateArray:S,validateStringArray:g,validateBooleanArray:k,validateAbortSignalArray:G,validateBoolean:K,validateBuffer:N,validateDictionary:C,validateEncoding:H,validateFunction:ue,validateInt32:M,validateInteger:x,validateNumber:Z,validateObject:E,validateOneOf:L,validatePlainFunction:O,validatePort:Q,validateSignalName:ee,validateString:X,validateUint32:q,validateUndefined:F,validateUnion:W,validateAbortSignal:le,validateLinkHeaderValue:te},validators}var endOfStream={exports:{}},process$1,hasRequiredProcess;function requireProcess(){return hasRequiredProcess||(hasRequiredProcess=1,process$1=commonjsGlobal.process),process$1}var utils$1,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils$1;hasRequiredUtils=1;const{SymbolAsyncIterator:r,SymbolIterator:e,SymbolFor:n}=requirePrimordials(),a=n("nodejs.stream.destroyed"),i=n("nodejs.stream.errored"),s=n("nodejs.stream.readable"),o=n("nodejs.stream.writable"),l=n("nodejs.stream.disturbed"),c=n("nodejs.webstream.isClosedPromise"),d=n("nodejs.webstream.controllerErrorFunction");function u(y,E=!1){var C;return!!(y&&typeof y.pipe=="function"&&typeof y.on=="function"&&(!E||typeof y.pause=="function"&&typeof y.resume=="function")&&(!y._writableState||((C=y._readableState)===null||C===void 0?void 0:C.readable)!==!1)&&(!y._writableState||y._readableState))}function f(y){var E;return!!(y&&typeof y.write=="function"&&typeof y.on=="function"&&(!y._readableState||((E=y._writableState)===null||E===void 0?void 0:E.writable)!==!1))}function m(y){return!!(y&&typeof y.pipe=="function"&&y._readableState&&typeof y.on=="function"&&typeof y.write=="function")}function h(y){return y&&(y._readableState||y._writableState||typeof y.write=="function"&&typeof y.on=="function"||typeof y.pipe=="function"&&typeof y.on=="function")}function w(y){return!!(y&&!h(y)&&typeof y.pipeThrough=="function"&&typeof y.getReader=="function"&&typeof y.cancel=="function")}function $(y){return!!(y&&!h(y)&&typeof y.getWriter=="function"&&typeof y.abort=="function")}function _(y){return!!(y&&!h(y)&&typeof y.readable=="object"&&typeof y.writable=="object")}function p(y){return w(y)||$(y)||_(y)}function b(y,E){return y==null?!1:E===!0?typeof y[r]=="function":E===!1?typeof y[e]=="function":typeof y[r]=="function"||typeof y[e]=="function"}function v(y){if(!h(y))return null;const E=y._writableState,C=y._readableState,S=E||C;return!!(y.destroyed||y[a]||S!=null&&S.destroyed)}function j(y){if(!f(y))return null;if(y.writableEnded===!0)return!0;const E=y._writableState;return E!=null&&E.errored?!1:typeof(E==null?void 0:E.ended)!="boolean"?null:E.ended}function U(y,E){if(!f(y))return null;if(y.writableFinished===!0)return!0;const C=y._writableState;return C!=null&&C.errored?!1:typeof(C==null?void 0:C.finished)!="boolean"?null:!!(C.finished||E===!1&&C.ended===!0&&C.length===0)}function B(y){if(!u(y))return null;if(y.readableEnded===!0)return!0;const E=y._readableState;return!E||E.errored?!1:typeof(E==null?void 0:E.ended)!="boolean"?null:E.ended}function T(y,E){if(!u(y))return null;const C=y._readableState;return C!=null&&C.errored?!1:typeof(C==null?void 0:C.endEmitted)!="boolean"?null:!!(C.endEmitted||E===!1&&C.ended===!0&&C.length===0)}function A(y){return y&&y[s]!=null?y[s]:typeof(y==null?void 0:y.readable)!="boolean"?null:v(y)?!1:u(y)&&y.readable&&!T(y)}function ce(y){return y&&y[o]!=null?y[o]:typeof(y==null?void 0:y.writable)!="boolean"?null:v(y)?!1:f(y)&&y.writable&&!j(y)}function V(y,E){return h(y)?v(y)?!0:!((E==null?void 0:E.readable)!==!1&&A(y)||(E==null?void 0:E.writable)!==!1&&ce(y)):null}function R(y){var E,C;return h(y)?y.writableErrored?y.writableErrored:(E=(C=y._writableState)===null||C===void 0?void 0:C.errored)!==null&&E!==void 0?E:null:null}function z(y){var E,C;return h(y)?y.readableErrored?y.readableErrored:(E=(C=y._readableState)===null||C===void 0?void 0:C.errored)!==null&&E!==void 0?E:null:null}function x(y){if(!h(y))return null;if(typeof y.closed=="boolean")return y.closed;const E=y._writableState,C=y._readableState;return typeof(E==null?void 0:E.closed)=="boolean"||typeof(C==null?void 0:C.closed)=="boolean"?(E==null?void 0:E.closed)||(C==null?void 0:C.closed):typeof y._closed=="boolean"&&M(y)?y._closed:null}function M(y){return typeof y._closed=="boolean"&&typeof y._defaultKeepAlive=="boolean"&&typeof y._removedConnection=="boolean"&&typeof y._removedContLen=="boolean"}function q(y){return typeof y._sent100=="boolean"&&M(y)}function X(y){var E;return typeof y._consuming=="boolean"&&typeof y._dumped=="boolean"&&((E=y.req)===null||E===void 0?void 0:E.upgradeOrConnect)===void 0}function Z(y){if(!h(y))return null;const E=y._writableState,C=y._readableState,S=E||C;return!S&&q(y)||!!(S&&S.autoDestroy&&S.emitClose&&S.closed===!1)}function L(y){var E;return!!(y&&((E=y[l])!==null&&E!==void 0?E:y.readableDidRead||y.readableAborted))}function K(y){var E,C,S,g,k,G,ee,N,H,Q;return!!(y&&((E=(C=(S=(g=(k=(G=y[i])!==null&&G!==void 0?G:y.readableErrored)!==null&&k!==void 0?k:y.writableErrored)!==null&&g!==void 0?g:(ee=y._readableState)===null||ee===void 0?void 0:ee.errorEmitted)!==null&&S!==void 0?S:(N=y._writableState)===null||N===void 0?void 0:N.errorEmitted)!==null&&C!==void 0?C:(H=y._readableState)===null||H===void 0?void 0:H.errored)!==null&&E!==void 0?E:!((Q=y._writableState)===null||Q===void 0)&&Q.errored))}return utils$1={isDestroyed:v,kIsDestroyed:a,isDisturbed:L,kIsDisturbed:l,isErrored:K,kIsErrored:i,isReadable:A,kIsReadable:s,kIsClosedPromise:c,kControllerErrorFunction:d,kIsWritable:o,isClosed:x,isDuplexNodeStream:m,isFinished:V,isIterable:b,isReadableNodeStream:u,isReadableStream:w,isReadableEnded:B,isReadableFinished:T,isReadableErrored:z,isNodeStream:h,isWebStream:p,isWritable:ce,isWritableNodeStream:f,isWritableStream:$,isWritableEnded:j,isWritableFinished:U,isWritableErrored:R,isServerRequest:X,isServerResponse:q,willEmitClose:Z,isTransformStream:_},utils$1}var hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream.exports;hasRequiredEndOfStream=1;const r=requireProcess(),{AbortError:e,codes:n}=requireErrors(),{ERR_INVALID_ARG_TYPE:a,ERR_STREAM_PREMATURE_CLOSE:i}=n,{kEmptyObject:s,once:o}=requireUtil(),{validateAbortSignal:l,validateFunction:c,validateObject:d,validateBoolean:u}=requireValidators(),{Promise:f,PromisePrototypeThen:m,SymbolDispose:h}=requirePrimordials(),{isClosed:w,isReadable:$,isReadableNodeStream:_,isReadableStream:p,isReadableFinished:b,isReadableErrored:v,isWritable:j,isWritableNodeStream:U,isWritableStream:B,isWritableFinished:T,isWritableErrored:A,isNodeStream:ce,willEmitClose:V,kIsClosedPromise:R}=requireUtils();let z;function x(L){return L.setHeader&&typeof L.abort=="function"}const M=()=>{};function q(L,K,y){var E,C;if(arguments.length===2?(y=K,K=s):K==null?K=s:d(K,"options"),c(y,"callback"),l(K.signal,"options.signal"),y=o(y),p(L)||B(L))return X(L,K,y);if(!ce(L))throw new a("stream",["ReadableStream","WritableStream","Stream"],L);const S=(E=K.readable)!==null&&E!==void 0?E:_(L),g=(C=K.writable)!==null&&C!==void 0?C:U(L),k=L._writableState,G=L._readableState,ee=()=>{L.writable||Q()};let N=V(L)&&_(L)===S&&U(L)===g,H=T(L,!1);const Q=()=>{H=!0,L.destroyed&&(N=!1),!(N&&(!L.readable||S))&&(!S||le)&&y.call(L)};let le=b(L,!1);const ue=()=>{le=!0,L.destroyed&&(N=!1),!(N&&(!L.writable||g))&&(!g||H)&&y.call(L)},O=D=>{y.call(L,D)};let F=w(L);const W=()=>{F=!0;const D=A(L)||v(L);if(D&&typeof D!="boolean")return y.call(L,D);if(S&&!le&&_(L,!0)&&!b(L,!1))return y.call(L,new i);if(g&&!H&&!T(L,!1))return y.call(L,new i);y.call(L)},ie=()=>{F=!0;const D=A(L)||v(L);if(D&&typeof D!="boolean")return y.call(L,D);y.call(L)},ae=()=>{L.req.on("finish",Q)};x(L)?(L.on("complete",Q),N||L.on("abort",W),L.req?ae():L.on("request",ae)):g&&!k&&(L.on("end",ee),L.on("close",ee)),!N&&typeof L.aborted=="boolean"&&L.on("aborted",W),L.on("end",ue),L.on("finish",Q),K.error!==!1&&L.on("error",O),L.on("close",W),F?r.nextTick(W):k!=null&&k.errorEmitted||G!=null&&G.errorEmitted?N||r.nextTick(ie):(!S&&(!N||$(L))&&(H||j(L)===!1)||!g&&(!N||j(L))&&(le||$(L)===!1)||G&&L.req&&L.aborted)&&r.nextTick(ie);const te=()=>{y=M,L.removeListener("aborted",W),L.removeListener("complete",Q),L.removeListener("abort",W),L.removeListener("request",ae),L.req&&L.req.removeListener("finish",Q),L.removeListener("end",ee),L.removeListener("close",ee),L.removeListener("finish",Q),L.removeListener("end",ue),L.removeListener("error",O),L.removeListener("close",W)};if(K.signal&&!F){const D=()=>{const J=y;te(),J.call(L,new e(void 0,{cause:K.signal.reason}))};if(K.signal.aborted)r.nextTick(D);else{z=z||requireUtil().addAbortListener;const J=z(K.signal,D),ne=y;y=o((...Y)=>{J[h](),ne.apply(L,Y)})}}return te}function X(L,K,y){let E=!1,C=M;if(K.signal)if(C=()=>{E=!0,y.call(L,new e(void 0,{cause:K.signal.reason}))},K.signal.aborted)r.nextTick(C);else{z=z||requireUtil().addAbortListener;const g=z(K.signal,C),k=y;y=o((...G)=>{g[h](),k.apply(L,G)})}const S=(...g)=>{E||r.nextTick(()=>y.apply(L,g))};return m(L[R].promise,S,S),M}function Z(L,K){var y;let E=!1;return K===null&&(K=s),(y=K)!==null&&y!==void 0&&y.cleanup&&(u(K.cleanup,"cleanup"),E=K.cleanup),new f((C,S)=>{const g=q(L,K,k=>{E&&g(),k?S(k):C()})})}return endOfStream.exports=q,endOfStream.exports.finished=Z,endOfStream.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;const r=requireProcess(),{aggregateTwoErrors:e,codes:{ERR_MULTIPLE_CALLBACK:n},AbortError:a}=requireErrors(),{Symbol:i}=requirePrimordials(),{kIsDestroyed:s,isDestroyed:o,isFinished:l,isServerRequest:c}=requireUtils(),d=i("kDestroy"),u=i("kConstruct");function f(V,R,z){V&&(V.stack,R&&!R.errored&&(R.errored=V),z&&!z.errored&&(z.errored=V))}function m(V,R){const z=this._readableState,x=this._writableState,M=x||z;return x!=null&&x.destroyed||z!=null&&z.destroyed?(typeof R=="function"&&R(),this):(f(V,x,z),x&&(x.destroyed=!0),z&&(z.destroyed=!0),M.constructed?h(this,V,R):this.once(d,function(q){h(this,e(q,V),R)}),this)}function h(V,R,z){let x=!1;function M(q){if(x)return;x=!0;const X=V._readableState,Z=V._writableState;f(q,Z,X),Z&&(Z.closed=!0),X&&(X.closed=!0),typeof z=="function"&&z(q),q?r.nextTick(w,V,q):r.nextTick($,V)}try{V._destroy(R||null,M)}catch(q){M(q)}}function w(V,R){_(V,R),$(V)}function $(V){const R=V._readableState,z=V._writableState;z&&(z.closeEmitted=!0),R&&(R.closeEmitted=!0),(z!=null&&z.emitClose||R!=null&&R.emitClose)&&V.emit("close")}function _(V,R){const z=V._readableState,x=V._writableState;x!=null&&x.errorEmitted||z!=null&&z.errorEmitted||(x&&(x.errorEmitted=!0),z&&(z.errorEmitted=!0),V.emit("error",R))}function p(){const V=this._readableState,R=this._writableState;V&&(V.constructed=!0,V.closed=!1,V.closeEmitted=!1,V.destroyed=!1,V.errored=null,V.errorEmitted=!1,V.reading=!1,V.ended=V.readable===!1,V.endEmitted=V.readable===!1),R&&(R.constructed=!0,R.destroyed=!1,R.closed=!1,R.closeEmitted=!1,R.errored=null,R.errorEmitted=!1,R.finalCalled=!1,R.prefinished=!1,R.ended=R.writable===!1,R.ending=R.writable===!1,R.finished=R.writable===!1)}function b(V,R,z){const x=V._readableState,M=V._writableState;if(M!=null&&M.destroyed||x!=null&&x.destroyed)return this;x!=null&&x.autoDestroy||M!=null&&M.autoDestroy?V.destroy(R):R&&(R.stack,M&&!M.errored&&(M.errored=R),x&&!x.errored&&(x.errored=R),z?r.nextTick(_,V,R):_(V,R))}function v(V,R){if(typeof V._construct!="function")return;const z=V._readableState,x=V._writableState;z&&(z.constructed=!1),x&&(x.constructed=!1),V.once(u,R),!(V.listenerCount(u)>1)&&r.nextTick(j,V)}function j(V){let R=!1;function z(x){if(R){b(V,x??new n);return}R=!0;const M=V._readableState,q=V._writableState,X=q||M;M&&(M.constructed=!0),q&&(q.constructed=!0),X.destroyed?V.emit(d,x):x?b(V,x,!0):r.nextTick(U,V)}try{V._construct(x=>{r.nextTick(z,x)})}catch(x){r.nextTick(z,x)}}function U(V){V.emit(u)}function B(V){return(V==null?void 0:V.setHeader)&&typeof V.abort=="function"}function T(V){V.emit("close")}function A(V,R){V.emit("error",R),r.nextTick(T,V)}function ce(V,R){!V||o(V)||(!R&&!l(V)&&(R=new a),c(V)?(V.socket=null,V.destroy(R)):B(V)?V.abort():B(V.req)?V.req.abort():typeof V.destroy=="function"?V.destroy(R):typeof V.close=="function"?V.close():R?r.nextTick(A,V,R):r.nextTick(T,V),V.destroyed||(V[s]=!0))}return destroy_1={construct:v,destroyer:ce,destroy:m,undestroy:p,errorOrDestroy:b},destroy_1}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;const{ArrayIsArray:r,ObjectSetPrototypeOf:e}=requirePrimordials(),{EventEmitter:n}=require$$2$1;function a(s){n.call(this,s)}e(a.prototype,n.prototype),e(a,n),a.prototype.pipe=function(s,o){const l=this;function c($){s.writable&&s.write($)===!1&&l.pause&&l.pause()}l.on("data",c);function d(){l.readable&&l.resume&&l.resume()}s.on("drain",d),!s._isStdio&&(!o||o.end!==!1)&&(l.on("end",f),l.on("close",m));let u=!1;function f(){u||(u=!0,s.end())}function m(){u||(u=!0,typeof s.destroy=="function"&&s.destroy())}function h($){w(),n.listenerCount(this,"error")===0&&this.emit("error",$)}i(l,"error",h),i(s,"error",h);function w(){l.removeListener("data",c),s.removeListener("drain",d),l.removeListener("end",f),l.removeListener("close",m),l.removeListener("error",h),s.removeListener("error",h),l.removeListener("end",w),l.removeListener("close",w),s.removeListener("close",w)}return l.on("end",w),l.on("close",w),s.on("close",w),s.emit("pipe",l),s};function i(s,o,l){if(typeof s.prependListener=="function")return s.prependListener(o,l);!s._events||!s._events[o]?s.on(o,l):r(s._events[o])?s._events[o].unshift(l):s._events[o]=[l,s._events[o]]}return legacy={Stream:a,prependListener:i},legacy}var addAbortSignal={exports:{}},hasRequiredAddAbortSignal;function requireAddAbortSignal(){return hasRequiredAddAbortSignal||(hasRequiredAddAbortSignal=1,function(r){const{SymbolDispose:e}=requirePrimordials(),{AbortError:n,codes:a}=requireErrors(),{isNodeStream:i,isWebStream:s,kControllerErrorFunction:o}=requireUtils(),l=requireEndOfStream(),{ERR_INVALID_ARG_TYPE:c}=a;let d;const u=(f,m)=>{if(typeof f!="object"||!("aborted"in f))throw new c(m,"AbortSignal",f)};r.exports.addAbortSignal=function(m,h){if(u(m,"signal"),!i(h)&&!s(h))throw new c("stream",["ReadableStream","WritableStream","Stream"],h);return r.exports.addAbortSignalNoValidate(m,h)},r.exports.addAbortSignalNoValidate=function(f,m){if(typeof f!="object"||!("aborted"in f))return m;const h=i(m)?()=>{m.destroy(new n(void 0,{cause:f.reason}))}:()=>{m[o](new n(void 0,{cause:f.reason}))};if(f.aborted)h();else{d=d||requireUtil().addAbortListener;const w=d(f,h);l(m,w[e])}return m}}(addAbortSignal)),addAbortSignal.exports}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;const{StringPrototypeSlice:r,SymbolIterator:e,TypedArrayPrototypeSet:n,Uint8Array:a}=requirePrimordials(),{Buffer:i}=require$$0$3,{inspect:s}=requireUtil();return buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(l){const c={data:l,next:null};this.length>0?this.tail.next=c:this.head=c,this.tail=c,++this.length}unshift(l){const c={data:l,next:this.head};this.length===0&&(this.tail=c),this.head=c,++this.length}shift(){if(this.length===0)return;const l=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,l}clear(){this.head=this.tail=null,this.length=0}join(l){if(this.length===0)return"";let c=this.head,d=""+c.data;for(;(c=c.next)!==null;)d+=l+c.data;return d}concat(l){if(this.length===0)return i.alloc(0);const c=i.allocUnsafe(l>>>0);let d=this.head,u=0;for(;d;)n(c,d.data,u),u+=d.data.length,d=d.next;return c}consume(l,c){const d=this.head.data;if(l<d.length){const u=d.slice(0,l);return this.head.data=d.slice(l),u}return l===d.length?this.shift():c?this._getString(l):this._getBuffer(l)}first(){return this.head.data}*[e](){for(let l=this.head;l;l=l.next)yield l.data}_getString(l){let c="",d=this.head,u=0;do{const f=d.data;if(l>f.length)c+=f,l-=f.length;else{l===f.length?(c+=f,++u,d.next?this.head=d.next:this.head=this.tail=null):(c+=r(f,0,l),this.head=d,d.data=r(f,l));break}++u}while((d=d.next)!==null);return this.length-=u,c}_getBuffer(l){const c=i.allocUnsafe(l),d=l;let u=this.head,f=0;do{const m=u.data;if(l>m.length)n(c,m,d-l),l-=m.length;else{l===m.length?(n(c,m,d-l),++f,u.next?this.head=u.next:this.head=this.tail=null):(n(c,new a(m.buffer,m.byteOffset,l),d-l),this.head=u,u.data=m.slice(l));break}++f}while((u=u.next)!==null);return this.length-=f,c}[Symbol.for("nodejs.util.inspect.custom")](l,c){return s(this,{...c,depth:0,customInspect:!1})}},buffer_list}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;const{MathFloor:r,NumberIsInteger:e}=requirePrimordials(),{validateInteger:n}=requireValidators(),{ERR_INVALID_ARG_VALUE:a}=requireErrors().codes;let i=16*1024,s=16;function o(u,f,m){return u.highWaterMark!=null?u.highWaterMark:f?u[m]:null}function l(u){return u?s:i}function c(u,f){n(f,"value",0),u?s=f:i=f}function d(u,f,m,h){const w=o(f,h,m);if(w!=null){if(!e(w)||w<0){const $=h?`options.${m}`:"options.highWaterMark";throw new a($,w)}return r(w)}return l(u.objectMode)}return state={getHighWaterMark:d,getDefaultHighWaterMark:l,setDefaultHighWaterMark:c},state}var string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,function(r,e){var n=require$$0$3,a=n.Buffer;function i(o,l){for(var c in o)l[c]=o[c]}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?r.exports=n:(i(n,e),e.Buffer=s);function s(o,l,c){return a(o,l,c)}s.prototype=Object.create(a.prototype),i(a,s),s.from=function(o,l,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return a(o,l,c)},s.alloc=function(o,l,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var d=a(o);return l!==void 0?typeof c=="string"?d.fill(l,c):d.fill(l):d.fill(0),d},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return a(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(o)}}(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var r=requireSafeBuffer().Buffer,e=r.isEncoding||function(p){switch(p=""+p,p&&p.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(p){if(!p)return"utf8";for(var b;;)switch(p){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return p;default:if(b)return;p=(""+p).toLowerCase(),b=!0}}function a(p){var b=n(p);if(typeof b!="string"&&(r.isEncoding===e||!e(p)))throw new Error("Unknown encoding: "+p);return b||p}string_decoder.StringDecoder=i;function i(p){this.encoding=a(p);var b;switch(this.encoding){case"utf16le":this.text=f,this.end=m,b=4;break;case"utf8":this.fillLast=c,b=4;break;case"base64":this.text=h,this.end=w,b=3;break;default:this.write=$,this.end=_;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(b)}i.prototype.write=function(p){if(p.length===0)return"";var b,v;if(this.lastNeed){if(b=this.fillLast(p),b===void 0)return"";v=this.lastNeed,this.lastNeed=0}else v=0;return v<p.length?b?b+this.text(p,v):this.text(p,v):b||""},i.prototype.end=u,i.prototype.text=d,i.prototype.fillLast=function(p){if(this.lastNeed<=p.length)return p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);p.copy(this.lastChar,this.lastTotal-this.lastNeed,0,p.length),this.lastNeed-=p.length};function s(p){return p<=127?0:p>>5===6?2:p>>4===14?3:p>>3===30?4:p>>6===2?-1:-2}function o(p,b,v){var j=b.length-1;if(j<v)return 0;var U=s(b[j]);return U>=0?(U>0&&(p.lastNeed=U-1),U):--j<v||U===-2?0:(U=s(b[j]),U>=0?(U>0&&(p.lastNeed=U-2),U):--j<v||U===-2?0:(U=s(b[j]),U>=0?(U>0&&(U===2?U=0:p.lastNeed=U-3),U):0))}function l(p,b,v){if((b[0]&192)!==128)return p.lastNeed=0,"�";if(p.lastNeed>1&&b.length>1){if((b[1]&192)!==128)return p.lastNeed=1,"�";if(p.lastNeed>2&&b.length>2&&(b[2]&192)!==128)return p.lastNeed=2,"�"}}function c(p){var b=this.lastTotal-this.lastNeed,v=l(this,p);if(v!==void 0)return v;if(this.lastNeed<=p.length)return p.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);p.copy(this.lastChar,b,0,p.length),this.lastNeed-=p.length}function d(p,b){var v=o(this,p,b);if(!this.lastNeed)return p.toString("utf8",b);this.lastTotal=v;var j=p.length-(v-this.lastNeed);return p.copy(this.lastChar,0,j),p.toString("utf8",b,j)}function u(p){var b=p&&p.length?this.write(p):"";return this.lastNeed?b+"�":b}function f(p,b){if((p.length-b)%2===0){var v=p.toString("utf16le",b);if(v){var j=v.charCodeAt(v.length-1);if(j>=55296&&j<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1],v.slice(0,-1)}return v}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=p[p.length-1],p.toString("utf16le",b,p.length-1)}function m(p){var b=p&&p.length?this.write(p):"";if(this.lastNeed){var v=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,v)}return b}function h(p,b){var v=(p.length-b)%3;return v===0?p.toString("base64",b):(this.lastNeed=3-v,this.lastTotal=3,v===1?this.lastChar[0]=p[p.length-1]:(this.lastChar[0]=p[p.length-2],this.lastChar[1]=p[p.length-1]),p.toString("base64",b,p.length-v))}function w(p){var b=p&&p.length?this.write(p):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function $(p){return p.toString(this.encoding)}function _(p){return p&&p.length?this.write(p):""}return string_decoder}var from_1,hasRequiredFrom;function requireFrom(){if(hasRequiredFrom)return from_1;hasRequiredFrom=1;const r=requireProcess(),{PromisePrototypeThen:e,SymbolAsyncIterator:n,SymbolIterator:a}=requirePrimordials(),{Buffer:i}=require$$0$3,{ERR_INVALID_ARG_TYPE:s,ERR_STREAM_NULL_VALUES:o}=requireErrors().codes;function l(c,d,u){let f;if(typeof d=="string"||d instanceof i)return new c({objectMode:!0,...u,read(){this.push(d),this.push(null)}});let m;if(d&&d[n])m=!0,f=d[n]();else if(d&&d[a])m=!1,f=d[a]();else throw new s("iterable",["Iterable"],d);const h=new c({objectMode:!0,highWaterMark:1,...u});let w=!1;h._read=function(){w||(w=!0,_())},h._destroy=function(p,b){e($(p),()=>r.nextTick(b,p),v=>r.nextTick(b,v||p))};async function $(p){const b=p!=null,v=typeof f.throw=="function";if(b&&v){const{value:j,done:U}=await f.throw(p);if(await j,U)return}if(typeof f.return=="function"){const{value:j}=await f.return();await j}}async function _(){for(;;){try{const{value:p,done:b}=m?await f.next():f.next();if(b)h.push(null);else{const v=p&&typeof p.then=="function"?await p:p;if(v===null)throw w=!1,new o;if(h.push(v))continue;w=!1}}catch(p){h.destroy(p)}break}}return h}return from_1=l,from_1}var readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const r=requireProcess(),{ArrayPrototypeIndexOf:e,NumberIsInteger:n,NumberIsNaN:a,NumberParseInt:i,ObjectDefineProperties:s,ObjectKeys:o,ObjectSetPrototypeOf:l,Promise:c,SafeSet:d,SymbolAsyncDispose:u,SymbolAsyncIterator:f,Symbol:m}=requirePrimordials();readable=Y,Y.ReadableState=ne;const{EventEmitter:h}=require$$2$1,{Stream:w,prependListener:$}=requireLegacy(),{Buffer:_}=require$$0$3,{addAbortSignal:p}=requireAddAbortSignal(),b=requireEndOfStream();let v=requireUtil().debuglog("stream",I=>{v=I});const j=requireBuffer_list(),U=requireDestroy(),{getHighWaterMark:B,getDefaultHighWaterMark:T}=requireState(),{aggregateTwoErrors:A,codes:{ERR_INVALID_ARG_TYPE:ce,ERR_METHOD_NOT_IMPLEMENTED:V,ERR_OUT_OF_RANGE:R,ERR_STREAM_PUSH_AFTER_EOF:z,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:x},AbortError:M}=requireErrors(),{validateObject:q}=requireValidators(),X=m("kPaused"),{StringDecoder:Z}=requireString_decoder(),L=requireFrom();l(Y.prototype,w.prototype),l(Y,w);const K=()=>{},{errorOrDestroy:y}=U,E=1,C=2,S=4,g=8,k=16,G=32,ee=64,N=128,H=256,Q=512,le=1024,ue=2048,O=4096,F=8192,W=16384,ie=32768,ae=65536,te=1<<17,D=1<<18;function J(I){return{enumerable:!1,get(){return(this.state&I)!==0},set(P){P?this.state|=I:this.state&=~I}}}s(ne.prototype,{objectMode:J(E),ended:J(C),endEmitted:J(S),reading:J(g),constructed:J(k),sync:J(G),needReadable:J(ee),emittedReadable:J(N),readableListening:J(H),resumeScheduled:J(Q),errorEmitted:J(le),emitClose:J(ue),autoDestroy:J(O),destroyed:J(F),closed:J(W),closeEmitted:J(ie),multiAwaitDrain:J(ae),readingMore:J(te),dataEmitted:J(D)});function ne(I,P,se){typeof se!="boolean"&&(se=P instanceof requireDuplex()),this.state=ue|O|k|G,I&&I.objectMode&&(this.state|=E),se&&I&&I.readableObjectMode&&(this.state|=E),this.highWaterMark=I?B(this,I,"readableHighWaterMark",se):T(!1),this.buffer=new j,this.length=0,this.pipes=[],this.flowing=null,this[X]=null,I&&I.emitClose===!1&&(this.state&=-2049),I&&I.autoDestroy===!1&&(this.state&=-4097),this.errored=null,this.defaultEncoding=I&&I.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,I&&I.encoding&&(this.decoder=new Z(I.encoding),this.encoding=I.encoding)}function Y(I){if(!(this instanceof Y))return new Y(I);const P=this instanceof requireDuplex();this._readableState=new ne(I,this,P),I&&(typeof I.read=="function"&&(this._read=I.read),typeof I.destroy=="function"&&(this._destroy=I.destroy),typeof I.construct=="function"&&(this._construct=I.construct),I.signal&&!P&&p(I.signal,this)),w.call(this,I),U.construct(this,()=>{this._readableState.needReadable&&be(this,this._readableState)})}Y.prototype.destroy=U.destroy,Y.prototype._undestroy=U.undestroy,Y.prototype._destroy=function(I,P){P(I)},Y.prototype[h.captureRejectionSymbol]=function(I){this.destroy(I)},Y.prototype[u]=function(){let I;return this.destroyed||(I=this.readableEnded?null:new M,this.destroy(I)),new c((P,se)=>b(this,oe=>oe&&oe!==I?se(oe):P(null)))},Y.prototype.push=function(I,P){return fe(this,I,P,!1)},Y.prototype.unshift=function(I,P){return fe(this,I,P,!0)};function fe(I,P,se,oe){v("readableAddChunk",P);const de=I._readableState;let $e;if(de.state&E||(typeof P=="string"?(se=se||de.defaultEncoding,de.encoding!==se&&(oe&&de.encoding?P=_.from(P,se).toString(de.encoding):(P=_.from(P,se),se=""))):P instanceof _?se="":w._isUint8Array(P)?(P=w._uint8ArrayToBuffer(P),se=""):P!=null&&($e=new ce("chunk",["string","Buffer","Uint8Array"],P))),$e)y(I,$e);else if(P===null)de.state&=-9,ye(I,de);else if(de.state&E||P&&P.length>0)if(oe)if(de.state&S)y(I,new x);else{if(de.destroyed||de.errored)return!1;_e(I,de,P,!0)}else if(de.ended)y(I,new z);else{if(de.destroyed||de.errored)return!1;de.state&=-9,de.decoder&&!se?(P=de.decoder.write(P),de.objectMode||P.length!==0?_e(I,de,P,!1):be(I,de)):_e(I,de,P,!1)}else oe||(de.state&=-9,be(I,de));return!de.ended&&(de.length<de.highWaterMark||de.length===0)}function _e(I,P,se,oe){P.flowing&&P.length===0&&!P.sync&&I.listenerCount("data")>0?(P.state&ae?P.awaitDrainWriters.clear():P.awaitDrainWriters=null,P.dataEmitted=!0,I.emit("data",se)):(P.length+=P.objectMode?1:se.length,oe?P.buffer.unshift(se):P.buffer.push(se),P.state&ee&&Ee(I)),be(I,P)}Y.prototype.isPaused=function(){const I=this._readableState;return I[X]===!0||I.flowing===!1},Y.prototype.setEncoding=function(I){const P=new Z(I);this._readableState.decoder=P,this._readableState.encoding=this._readableState.decoder.encoding;const se=this._readableState.buffer;let oe="";for(const de of se)oe+=P.write(de);return se.clear(),oe!==""&&se.push(oe),this._readableState.length=oe.length,this};const pe=1073741824;function ge(I){if(I>pe)throw new R("size","<= 1GiB",I);return I--,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,I|=I>>>16,I++,I}function he(I,P){return I<=0||P.length===0&&P.ended?0:P.state&E?1:a(I)?P.flowing&&P.length?P.buffer.first().length:P.length:I<=P.length?I:P.ended?P.length:0}Y.prototype.read=function(I){v("read",I),I===void 0?I=NaN:n(I)||(I=i(I,10));const P=this._readableState,se=I;if(I>P.highWaterMark&&(P.highWaterMark=ge(I)),I!==0&&(P.state&=-129),I===0&&P.needReadable&&((P.highWaterMark!==0?P.length>=P.highWaterMark:P.length>0)||P.ended))return v("read: emitReadable",P.length,P.ended),P.length===0&&P.ended?Ne(this):Ee(this),null;if(I=he(I,P),I===0&&P.ended)return P.length===0&&Ne(this),null;let oe=(P.state&ee)!==0;if(v("need readable",oe),(P.length===0||P.length-I<P.highWaterMark)&&(oe=!0,v("length less than watermark",oe)),P.ended||P.reading||P.destroyed||P.errored||!P.constructed)oe=!1,v("reading, ended or constructing",oe);else if(oe){v("do read"),P.state|=g|G,P.length===0&&(P.state|=ee);try{this._read(P.highWaterMark)}catch($e){y(this,$e)}P.state&=-33,P.reading||(I=he(se,P))}let de;return I>0?de=Ge(I,P):de=null,de===null?(P.needReadable=P.length<=P.highWaterMark,I=0):(P.length-=I,P.multiAwaitDrain?P.awaitDrainWriters.clear():P.awaitDrainWriters=null),P.length===0&&(P.ended||(P.needReadable=!0),se!==I&&P.ended&&Ne(this)),de!==null&&!P.errorEmitted&&!P.closeEmitted&&(P.dataEmitted=!0,this.emit("data",de)),de};function ye(I,P){if(v("onEofChunk"),!P.ended){if(P.decoder){const se=P.decoder.end();se&&se.length&&(P.buffer.push(se),P.length+=P.objectMode?1:se.length)}P.ended=!0,P.sync?Ee(I):(P.needReadable=!1,P.emittedReadable=!0,Ce(I))}}function Ee(I){const P=I._readableState;v("emitReadable",P.needReadable,P.emittedReadable),P.needReadable=!1,P.emittedReadable||(v("emitReadable",P.flowing),P.emittedReadable=!0,r.nextTick(Ce,I))}function Ce(I){const P=I._readableState;v("emitReadable_",P.destroyed,P.length,P.ended),!P.destroyed&&!P.errored&&(P.length||P.ended)&&(I.emit("readable"),P.emittedReadable=!1),P.needReadable=!P.flowing&&!P.ended&&P.length<=P.highWaterMark,ze(I)}function be(I,P){!P.readingMore&&P.constructed&&(P.readingMore=!0,r.nextTick(Ze,I,P))}function Ze(I,P){for(;!P.reading&&!P.ended&&(P.length<P.highWaterMark||P.flowing&&P.length===0);){const se=P.length;if(v("maybeReadMore read 0"),I.read(0),se===P.length)break}P.readingMore=!1}Y.prototype._read=function(I){throw new V("_read()")},Y.prototype.pipe=function(I,P){const se=this,oe=this._readableState;oe.pipes.length===1&&(oe.multiAwaitDrain||(oe.multiAwaitDrain=!0,oe.awaitDrainWriters=new d(oe.awaitDrainWriters?[oe.awaitDrainWriters]:[]))),oe.pipes.push(I),v("pipe count=%d opts=%j",oe.pipes.length,P);const $e=(!P||P.end!==!1)&&I!==r.stdout&&I!==r.stderr?He:De;oe.endEmitted?r.nextTick($e):se.once("end",$e),I.on("unpipe",ve);function ve(Re,Se){v("onunpipe"),Re===se&&Se&&Se.hasUnpiped===!1&&(Se.hasUnpiped=!0,st())}function He(){v("onend"),I.end()}let Ae,We=!1;function st(){v("cleanup"),I.removeListener("close",Le),I.removeListener("finish",je),Ae&&I.removeListener("drain",Ae),I.removeListener("error",Be),I.removeListener("unpipe",ve),se.removeListener("end",He),se.removeListener("end",De),se.removeListener("data",Ke),We=!0,Ae&&oe.awaitDrainWriters&&(!I._writableState||I._writableState.needDrain)&&Ae()}function Xe(){We||(oe.pipes.length===1&&oe.pipes[0]===I?(v("false write response, pause",0),oe.awaitDrainWriters=I,oe.multiAwaitDrain=!1):oe.pipes.length>1&&oe.pipes.includes(I)&&(v("false write response, pause",oe.awaitDrainWriters.size),oe.awaitDrainWriters.add(I)),se.pause()),Ae||(Ae=Qe(se,I),I.on("drain",Ae))}se.on("data",Ke);function Ke(Re){v("ondata");const Se=I.write(Re);v("dest.write",Se),Se===!1&&Xe()}function Be(Re){if(v("onerror",Re),De(),I.removeListener("error",Be),I.listenerCount("error")===0){const Se=I._writableState||I._readableState;Se&&!Se.errorEmitted?y(I,Re):I.emit("error",Re)}}$(I,"error",Be);function Le(){I.removeListener("finish",je),De()}I.once("close",Le);function je(){v("onfinish"),I.removeListener("close",Le),De()}I.once("finish",je);function De(){v("unpipe"),se.unpipe(I)}return I.emit("pipe",se),I.writableNeedDrain===!0?Xe():oe.flowing||(v("pipe resume"),se.resume()),I};function Qe(I,P){return function(){const oe=I._readableState;oe.awaitDrainWriters===P?(v("pipeOnDrain",1),oe.awaitDrainWriters=null):oe.multiAwaitDrain&&(v("pipeOnDrain",oe.awaitDrainWriters.size),oe.awaitDrainWriters.delete(P)),(!oe.awaitDrainWriters||oe.awaitDrainWriters.size===0)&&I.listenerCount("data")&&I.resume()}}Y.prototype.unpipe=function(I){const P=this._readableState,se={hasUnpiped:!1};if(P.pipes.length===0)return this;if(!I){const de=P.pipes;P.pipes=[],this.pause();for(let $e=0;$e<de.length;$e++)de[$e].emit("unpipe",this,{hasUnpiped:!1});return this}const oe=e(P.pipes,I);return oe===-1?this:(P.pipes.splice(oe,1),P.pipes.length===0&&this.pause(),I.emit("unpipe",this,se),this)},Y.prototype.on=function(I,P){const se=w.prototype.on.call(this,I,P),oe=this._readableState;return I==="data"?(oe.readableListening=this.listenerCount("readable")>0,oe.flowing!==!1&&this.resume()):I==="readable"&&!oe.endEmitted&&!oe.readableListening&&(oe.readableListening=oe.needReadable=!0,oe.flowing=!1,oe.emittedReadable=!1,v("on readable",oe.length,oe.reading),oe.length?Ee(this):oe.reading||r.nextTick(et,this)),se},Y.prototype.addListener=Y.prototype.on,Y.prototype.removeListener=function(I,P){const se=w.prototype.removeListener.call(this,I,P);return I==="readable"&&r.nextTick(Ue,this),se},Y.prototype.off=Y.prototype.removeListener,Y.prototype.removeAllListeners=function(I){const P=w.prototype.removeAllListeners.apply(this,arguments);return(I==="readable"||I===void 0)&&r.nextTick(Ue,this),P};function Ue(I){const P=I._readableState;P.readableListening=I.listenerCount("readable")>0,P.resumeScheduled&&P[X]===!1?P.flowing=!0:I.listenerCount("data")>0?I.resume():P.readableListening||(P.flowing=null)}function et(I){v("readable nexttick read 0"),I.read(0)}Y.prototype.resume=function(){const I=this._readableState;return I.flowing||(v("resume"),I.flowing=!I.readableListening,tt(this,I)),I[X]=!1,this};function tt(I,P){P.resumeScheduled||(P.resumeScheduled=!0,r.nextTick(rt,I,P))}function rt(I,P){v("resume",P.reading),P.reading||I.read(0),P.resumeScheduled=!1,I.emit("resume"),ze(I),P.flowing&&!P.reading&&I.read(0)}Y.prototype.pause=function(){return v("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(v("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[X]=!0,this};function ze(I){const P=I._readableState;for(v("flow",P.flowing);P.flowing&&I.read()!==null;);}Y.prototype.wrap=function(I){let P=!1;I.on("data",oe=>{!this.push(oe)&&I.pause&&(P=!0,I.pause())}),I.on("end",()=>{this.push(null)}),I.on("error",oe=>{y(this,oe)}),I.on("close",()=>{this.destroy()}),I.on("destroy",()=>{this.destroy()}),this._read=()=>{P&&I.resume&&(P=!1,I.resume())};const se=o(I);for(let oe=1;oe<se.length;oe++){const de=se[oe];this[de]===void 0&&typeof I[de]=="function"&&(this[de]=I[de].bind(I))}return this},Y.prototype[f]=function(){return qe(this)},Y.prototype.iterator=function(I){return I!==void 0&&q(I,"options"),qe(this,I)};function qe(I,P){typeof I.read!="function"&&(I=Y.wrap(I,{objectMode:!0}));const se=nt(I,P);return se.stream=I,se}async function*nt(I,P){let se=K;function oe(ve){this===I?(se(),se=K):se=ve}I.on("readable",oe);let de;const $e=b(I,{writable:!1},ve=>{de=ve?A(de,ve):null,se(),se=K});try{for(;;){const ve=I.destroyed?null:I.read();if(ve!==null)yield ve;else{if(de)throw de;if(de===null)return;await new c(oe)}}}catch(ve){throw de=A(de,ve),de}finally{(de||(P==null?void 0:P.destroyOnReturn)!==!1)&&(de===void 0||I._readableState.autoDestroy)?U.destroyer(I,null):(I.off("readable",oe),$e())}}s(Y.prototype,{readable:{__proto__:null,get(){const I=this._readableState;return!!I&&I.readable!==!1&&!I.destroyed&&!I.errorEmitted&&!I.endEmitted},set(I){this._readableState&&(this._readableState.readable=!!I)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(I){this._readableState&&(this._readableState.flowing=I)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(I){this._readableState&&(this._readableState.destroyed=I)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),s(ne.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[X]!==!1},set(I){this[X]=!!I}}}),Y._fromList=Ge;function Ge(I,P){if(P.length===0)return null;let se;return P.objectMode?se=P.buffer.shift():!I||I>=P.length?(P.decoder?se=P.buffer.join(""):P.buffer.length===1?se=P.buffer.first():se=P.buffer.concat(P.length),P.buffer.clear()):se=P.buffer.consume(I,P.decoder),se}function Ne(I){const P=I._readableState;v("endReadable",P.endEmitted),P.endEmitted||(P.ended=!0,r.nextTick(at,P,I))}function at(I,P){if(v("endReadableNT",I.endEmitted,I.length),!I.errored&&!I.closeEmitted&&!I.endEmitted&&I.length===0){if(I.endEmitted=!0,P.emit("end"),P.writable&&P.allowHalfOpen===!1)r.nextTick(it,P);else if(I.autoDestroy){const se=P._writableState;(!se||se.autoDestroy&&(se.finished||se.writable===!1))&&P.destroy()}}}function it(I){I.writable&&!I.writableEnded&&!I.destroyed&&I.end()}Y.from=function(I,P){return L(Y,I,P)};let Fe;function Ve(){return Fe===void 0&&(Fe={}),Fe}return Y.fromWeb=function(I,P){return Ve().newStreamReadableFromReadableStream(I,P)},Y.toWeb=function(I,P){return Ve().newReadableStreamFromStreamReadable(I,P)},Y.wrap=function(I,P){var se,oe;return new Y({objectMode:(se=(oe=I.readableObjectMode)!==null&&oe!==void 0?oe:I.objectMode)!==null&&se!==void 0?se:!0,...P,destroy(de,$e){U.destroyer(I,de),$e(de)}}).wrap(I)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const r=requireProcess(),{ArrayPrototypeSlice:e,Error:n,FunctionPrototypeSymbolHasInstance:a,ObjectDefineProperty:i,ObjectDefineProperties:s,ObjectSetPrototypeOf:o,StringPrototypeToLowerCase:l,Symbol:c,SymbolHasInstance:d}=requirePrimordials();writable=q,q.WritableState=x;const{EventEmitter:u}=require$$2$1,f=requireLegacy().Stream,{Buffer:m}=require$$0$3,h=requireDestroy(),{addAbortSignal:w}=requireAddAbortSignal(),{getHighWaterMark:$,getDefaultHighWaterMark:_}=requireState(),{ERR_INVALID_ARG_TYPE:p,ERR_METHOD_NOT_IMPLEMENTED:b,ERR_MULTIPLE_CALLBACK:v,ERR_STREAM_CANNOT_PIPE:j,ERR_STREAM_DESTROYED:U,ERR_STREAM_ALREADY_FINISHED:B,ERR_STREAM_NULL_VALUES:T,ERR_STREAM_WRITE_AFTER_END:A,ERR_UNKNOWN_ENCODING:ce}=requireErrors().codes,{errorOrDestroy:V}=h;o(q.prototype,f.prototype),o(q,f);function R(){}const z=c("kOnFinished");function x(O,F,W){typeof W!="boolean"&&(W=F instanceof requireDuplex()),this.objectMode=!!(O&&O.objectMode),W&&(this.objectMode=this.objectMode||!!(O&&O.writableObjectMode)),this.highWaterMark=O?$(this,O,"writableHighWaterMark",W):_(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const ie=!!(O&&O.decodeStrings===!1);this.decodeStrings=!ie,this.defaultEncoding=O&&O.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=y.bind(void 0,F),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,M(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!O||O.emitClose!==!1,this.autoDestroy=!O||O.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[z]=[]}function M(O){O.buffered=[],O.bufferedIndex=0,O.allBuffers=!0,O.allNoop=!0}x.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},i(x.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function q(O){const F=this instanceof requireDuplex();if(!F&&!a(q,this))return new q(O);this._writableState=new x(O,this,F),O&&(typeof O.write=="function"&&(this._write=O.write),typeof O.writev=="function"&&(this._writev=O.writev),typeof O.destroy=="function"&&(this._destroy=O.destroy),typeof O.final=="function"&&(this._final=O.final),typeof O.construct=="function"&&(this._construct=O.construct),O.signal&&w(O.signal,this)),f.call(this,O),h.construct(this,()=>{const W=this._writableState;W.writing||g(this,W),N(this,W)})}i(q,d,{__proto__:null,value:function(O){return a(this,O)?!0:this!==q?!1:O&&O._writableState instanceof x}}),q.prototype.pipe=function(){V(this,new j)};function X(O,F,W,ie){const ae=O._writableState;if(typeof W=="function")ie=W,W=ae.defaultEncoding;else{if(!W)W=ae.defaultEncoding;else if(W!=="buffer"&&!m.isEncoding(W))throw new ce(W);typeof ie!="function"&&(ie=R)}if(F===null)throw new T;if(!ae.objectMode)if(typeof F=="string")ae.decodeStrings!==!1&&(F=m.from(F,W),W="buffer");else if(F instanceof m)W="buffer";else if(f._isUint8Array(F))F=f._uint8ArrayToBuffer(F),W="buffer";else throw new p("chunk",["string","Buffer","Uint8Array"],F);let te;return ae.ending?te=new A:ae.destroyed&&(te=new U("write")),te?(r.nextTick(ie,te),V(O,te,!0),te):(ae.pendingcb++,Z(O,ae,F,W,ie))}q.prototype.write=function(O,F,W){return X(this,O,F,W)===!0},q.prototype.cork=function(){this._writableState.corked++},q.prototype.uncork=function(){const O=this._writableState;O.corked&&(O.corked--,O.writing||g(this,O))},q.prototype.setDefaultEncoding=function(F){if(typeof F=="string"&&(F=l(F)),!m.isEncoding(F))throw new ce(F);return this._writableState.defaultEncoding=F,this};function Z(O,F,W,ie,ae){const te=F.objectMode?1:W.length;F.length+=te;const D=F.length<F.highWaterMark;return D||(F.needDrain=!0),F.writing||F.corked||F.errored||!F.constructed?(F.buffered.push({chunk:W,encoding:ie,callback:ae}),F.allBuffers&&ie!=="buffer"&&(F.allBuffers=!1),F.allNoop&&ae!==R&&(F.allNoop=!1)):(F.writelen=te,F.writecb=ae,F.writing=!0,F.sync=!0,O._write(W,ie,F.onwrite),F.sync=!1),D&&!F.errored&&!F.destroyed}function L(O,F,W,ie,ae,te,D){F.writelen=ie,F.writecb=D,F.writing=!0,F.sync=!0,F.destroyed?F.onwrite(new U("write")):W?O._writev(ae,F.onwrite):O._write(ae,te,F.onwrite),F.sync=!1}function K(O,F,W,ie){--F.pendingcb,ie(W),S(F),V(O,W)}function y(O,F){const W=O._writableState,ie=W.sync,ae=W.writecb;if(typeof ae!="function"){V(O,new v);return}W.writing=!1,W.writecb=null,W.length-=W.writelen,W.writelen=0,F?(F.stack,W.errored||(W.errored=F),O._readableState&&!O._readableState.errored&&(O._readableState.errored=F),ie?r.nextTick(K,O,W,F,ae):K(O,W,F,ae)):(W.buffered.length>W.bufferedIndex&&g(O,W),ie?W.afterWriteTickInfo!==null&&W.afterWriteTickInfo.cb===ae?W.afterWriteTickInfo.count++:(W.afterWriteTickInfo={count:1,cb:ae,stream:O,state:W},r.nextTick(E,W.afterWriteTickInfo)):C(O,W,1,ae))}function E({stream:O,state:F,count:W,cb:ie}){return F.afterWriteTickInfo=null,C(O,F,W,ie)}function C(O,F,W,ie){for(!F.ending&&!O.destroyed&&F.length===0&&F.needDrain&&(F.needDrain=!1,O.emit("drain"));W-- >0;)F.pendingcb--,ie();F.destroyed&&S(F),N(O,F)}function S(O){if(O.writing)return;for(let ae=O.bufferedIndex;ae<O.buffered.length;++ae){var F;const{chunk:te,callback:D}=O.buffered[ae],J=O.objectMode?1:te.length;O.length-=J,D((F=O.errored)!==null&&F!==void 0?F:new U("write"))}const W=O[z].splice(0);for(let ae=0;ae<W.length;ae++){var ie;W[ae]((ie=O.errored)!==null&&ie!==void 0?ie:new U("end"))}M(O)}function g(O,F){if(F.corked||F.bufferProcessing||F.destroyed||!F.constructed)return;const{buffered:W,bufferedIndex:ie,objectMode:ae}=F,te=W.length-ie;if(!te)return;let D=ie;if(F.bufferProcessing=!0,te>1&&O._writev){F.pendingcb-=te-1;const J=F.allNoop?R:Y=>{for(let fe=D;fe<W.length;++fe)W[fe].callback(Y)},ne=F.allNoop&&D===0?W:e(W,D);ne.allBuffers=F.allBuffers,L(O,F,!0,F.length,ne,"",J),M(F)}else{do{const{chunk:J,encoding:ne,callback:Y}=W[D];W[D++]=null;const fe=ae?1:J.length;L(O,F,!1,fe,J,ne,Y)}while(D<W.length&&!F.writing);D===W.length?M(F):D>256?(W.splice(0,D),F.bufferedIndex=0):F.bufferedIndex=D}F.bufferProcessing=!1}q.prototype._write=function(O,F,W){if(this._writev)this._writev([{chunk:O,encoding:F}],W);else throw new b("_write()")},q.prototype._writev=null,q.prototype.end=function(O,F,W){const ie=this._writableState;typeof O=="function"?(W=O,O=null,F=null):typeof F=="function"&&(W=F,F=null);let ae;if(O!=null){const te=X(this,O,F);te instanceof n&&(ae=te)}return ie.corked&&(ie.corked=1,this.uncork()),ae||(!ie.errored&&!ie.ending?(ie.ending=!0,N(this,ie,!0),ie.ended=!0):ie.finished?ae=new B("end"):ie.destroyed&&(ae=new U("end"))),typeof W=="function"&&(ae||ie.finished?r.nextTick(W,ae):ie[z].push(W)),this};function k(O){return O.ending&&!O.destroyed&&O.constructed&&O.length===0&&!O.errored&&O.buffered.length===0&&!O.finished&&!O.writing&&!O.errorEmitted&&!O.closeEmitted}function G(O,F){let W=!1;function ie(ae){if(W){V(O,ae??v());return}if(W=!0,F.pendingcb--,ae){const te=F[z].splice(0);for(let D=0;D<te.length;D++)te[D](ae);V(O,ae,F.sync)}else k(F)&&(F.prefinished=!0,O.emit("prefinish"),F.pendingcb++,r.nextTick(H,O,F))}F.sync=!0,F.pendingcb++;try{O._final(ie)}catch(ae){ie(ae)}F.sync=!1}function ee(O,F){!F.prefinished&&!F.finalCalled&&(typeof O._final=="function"&&!F.destroyed?(F.finalCalled=!0,G(O,F)):(F.prefinished=!0,O.emit("prefinish")))}function N(O,F,W){k(F)&&(ee(O,F),F.pendingcb===0&&(W?(F.pendingcb++,r.nextTick((ie,ae)=>{k(ae)?H(ie,ae):ae.pendingcb--},O,F)):k(F)&&(F.pendingcb++,H(O,F))))}function H(O,F){F.pendingcb--,F.finished=!0;const W=F[z].splice(0);for(let ie=0;ie<W.length;ie++)W[ie]();if(O.emit("finish"),F.autoDestroy){const ie=O._readableState;(!ie||ie.autoDestroy&&(ie.endEmitted||ie.readable===!1))&&O.destroy()}}s(q.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(O){this._writableState&&(this._writableState.destroyed=O)}},writable:{__proto__:null,get(){const O=this._writableState;return!!O&&O.writable!==!1&&!O.destroyed&&!O.errored&&!O.ending&&!O.ended},set(O){this._writableState&&(this._writableState.writable=!!O)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const O=this._writableState;return O?!O.destroyed&&!O.ending&&O.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Q=h.destroy;q.prototype.destroy=function(O,F){const W=this._writableState;return!W.destroyed&&(W.bufferedIndex<W.buffered.length||W[z].length)&&r.nextTick(S,W),Q.call(this,O,F),this},q.prototype._undestroy=h.undestroy,q.prototype._destroy=function(O,F){F(O)},q.prototype[u.captureRejectionSymbol]=function(O){this.destroy(O)};let le;function ue(){return le===void 0&&(le={}),le}return q.fromWeb=function(O,F){return ue().newStreamWritableFromWritableStream(O,F)},q.toWeb=function(O){return ue().newWritableStreamFromStreamWritable(O)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const r=requireProcess(),e=require$$0$3,{isReadable:n,isWritable:a,isIterable:i,isNodeStream:s,isReadableNodeStream:o,isWritableNodeStream:l,isDuplexNodeStream:c,isReadableStream:d,isWritableStream:u}=requireUtils(),f=requireEndOfStream(),{AbortError:m,codes:{ERR_INVALID_ARG_TYPE:h,ERR_INVALID_RETURN_VALUE:w}}=requireErrors(),{destroyer:$}=requireDestroy(),_=requireDuplex(),p=requireReadable(),b=requireWritable(),{createDeferredPromise:v}=requireUtil(),j=requireFrom(),U=globalThis.Blob||e.Blob,B=typeof U<"u"?function(x){return x instanceof U}:function(x){return!1},T=globalThis.AbortController||require$$0$1.AbortController,{FunctionPrototypeCall:A}=requirePrimordials();class ce extends _{constructor(x){super(x),(x==null?void 0:x.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(x==null?void 0:x.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function z(x,M){if(c(x))return x;if(o(x))return R({readable:x});if(l(x))return R({writable:x});if(s(x))return R({writable:!1,readable:!1});if(d(x))return R({readable:p.fromWeb(x)});if(u(x))return R({writable:b.fromWeb(x)});if(typeof x=="function"){const{value:X,write:Z,final:L,destroy:K}=V(x);if(i(X))return j(ce,X,{objectMode:!0,write:Z,final:L,destroy:K});const y=X==null?void 0:X.then;if(typeof y=="function"){let E;const C=A(y,X,S=>{if(S!=null)throw new w("nully","body",S)},S=>{$(E,S)});return E=new ce({objectMode:!0,readable:!1,write:Z,final(S){L(async()=>{try{await C,r.nextTick(S,null)}catch(g){r.nextTick(S,g)}})},destroy:K})}throw new w("Iterable, AsyncIterable or AsyncFunction",M,X)}if(B(x))return z(x.arrayBuffer());if(i(x))return j(ce,x,{objectMode:!0,writable:!1});if(d(x==null?void 0:x.readable)&&u(x==null?void 0:x.writable))return ce.fromWeb(x);if(typeof(x==null?void 0:x.writable)=="object"||typeof(x==null?void 0:x.readable)=="object"){const X=x!=null&&x.readable?o(x==null?void 0:x.readable)?x==null?void 0:x.readable:z(x.readable):void 0,Z=x!=null&&x.writable?l(x==null?void 0:x.writable)?x==null?void 0:x.writable:z(x.writable):void 0;return R({readable:X,writable:Z})}const q=x==null?void 0:x.then;if(typeof q=="function"){let X;return A(q,x,Z=>{Z!=null&&X.push(Z),X.push(null)},Z=>{$(X,Z)}),X=new ce({objectMode:!0,writable:!1,read(){}})}throw new h(M,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],x)};function V(z){let{promise:x,resolve:M}=v();const q=new T,X=q.signal;return{value:z(async function*(){for(;;){const L=x;x=null;const{chunk:K,done:y,cb:E}=await L;if(r.nextTick(E),y)return;if(X.aborted)throw new m(void 0,{cause:X.reason});({promise:x,resolve:M}=v()),yield K}}(),{signal:X}),write(L,K,y){const E=M;M=null,E({chunk:L,done:!1,cb:y})},final(L){const K=M;M=null,K({done:!0,cb:L})},destroy(L,K){q.abort(),K(L)}}}function R(z){const x=z.readable&&typeof z.readable.read!="function"?p.wrap(z.readable):z.readable,M=z.writable;let q=!!n(x),X=!!a(M),Z,L,K,y,E;function C(S){const g=y;y=null,g?g(S):S&&E.destroy(S)}return E=new ce({readableObjectMode:!!(x!=null&&x.readableObjectMode),writableObjectMode:!!(M!=null&&M.writableObjectMode),readable:q,writable:X}),X&&(f(M,S=>{X=!1,S&&$(x,S),C(S)}),E._write=function(S,g,k){M.write(S,g)?k():Z=k},E._final=function(S){M.end(),L=S},M.on("drain",function(){if(Z){const S=Z;Z=null,S()}}),M.on("finish",function(){if(L){const S=L;L=null,S()}})),q&&(f(x,S=>{q=!1,S&&$(x,S),C(S)}),x.on("readable",function(){if(K){const S=K;K=null,S()}}),x.on("end",function(){E.push(null)}),E._read=function(){for(;;){const S=x.read();if(S===null){K=E._read;return}if(!E.push(S))return}}),E._destroy=function(S,g){!S&&y!==null&&(S=new m),K=null,Z=null,L=null,y===null?g(S):(y=g,$(M,S),$(x,S))},E}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:r,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:n,ObjectSetPrototypeOf:a}=requirePrimordials();duplex=o;const i=requireReadable(),s=requireWritable();a(o.prototype,i.prototype),a(o,i);{const u=n(s.prototype);for(let f=0;f<u.length;f++){const m=u[f];o.prototype[m]||(o.prototype[m]=s.prototype[m])}}function o(u){if(!(this instanceof o))return new o(u);i.call(this,u),s.call(this,u),u?(this.allowHalfOpen=u.allowHalfOpen!==!1,u.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),u.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}r(o.prototype,{writable:{__proto__:null,...e(s.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(s.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(s.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(s.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(s.prototype,"writableLength")},writableFinished:{__proto__:null,...e(s.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(s.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(s.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(s.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(u){this._readableState&&this._writableState&&(this._readableState.destroyed=u,this._writableState.destroyed=u)}}});let l;function c(){return l===void 0&&(l={}),l}o.fromWeb=function(u,f){return c().newStreamDuplexFromReadableWritablePair(u,f)},o.toWeb=function(u){return c().newReadableWritablePairFromDuplex(u)};let d;return o.from=function(u){return d||(d=requireDuplexify()),d(u,"body")},duplex}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1;const{ObjectSetPrototypeOf:r,Symbol:e}=requirePrimordials();transform=o;const{ERR_METHOD_NOT_IMPLEMENTED:n}=requireErrors().codes,a=requireDuplex(),{getHighWaterMark:i}=requireState();r(o.prototype,a.prototype),r(o,a);const s=e("kCallback");function o(d){if(!(this instanceof o))return new o(d);const u=d?i(this,d,"readableHighWaterMark",!0):null;u===0&&(d={...d,highWaterMark:null,readableHighWaterMark:u,writableHighWaterMark:d.writableHighWaterMark||0}),a.call(this,d),this._readableState.sync=!1,this[s]=null,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",c)}function l(d){typeof this._flush=="function"&&!this.destroyed?this._flush((u,f)=>{if(u){d?d(u):this.destroy(u);return}f!=null&&this.push(f),this.push(null),d&&d()}):(this.push(null),d&&d())}function c(){this._final!==l&&l.call(this)}return o.prototype._final=l,o.prototype._transform=function(d,u,f){throw new n("_transform()")},o.prototype._write=function(d,u,f){const m=this._readableState,h=this._writableState,w=m.length;this._transform(d,u,($,_)=>{if($){f($);return}_!=null&&this.push(_),h.ended||w===m.length||m.length<m.highWaterMark?f():this[s]=f})},o.prototype._read=function(){if(this[s]){const d=this[s];this[s]=null,d()}},transform}var passthrough,hasRequiredPassthrough;function requirePassthrough(){if(hasRequiredPassthrough)return passthrough;hasRequiredPassthrough=1;const{ObjectSetPrototypeOf:r}=requirePrimordials();passthrough=n;const e=requireTransform();r(n.prototype,e.prototype),r(n,e);function n(a){if(!(this instanceof n))return new n(a);e.call(this,a)}return n.prototype._transform=function(a,i,s){s(null,a)},passthrough}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;const r=requireProcess(),{ArrayIsArray:e,Promise:n,SymbolAsyncIterator:a,SymbolDispose:i}=requirePrimordials(),s=requireEndOfStream(),{once:o}=requireUtil(),l=requireDestroy(),c=requireDuplex(),{aggregateTwoErrors:d,codes:{ERR_INVALID_ARG_TYPE:u,ERR_INVALID_RETURN_VALUE:f,ERR_MISSING_ARGS:m,ERR_STREAM_DESTROYED:h,ERR_STREAM_PREMATURE_CLOSE:w},AbortError:$}=requireErrors(),{validateFunction:_,validateAbortSignal:p}=requireValidators(),{isIterable:b,isReadable:v,isReadableNodeStream:j,isNodeStream:U,isTransformStream:B,isWebStream:T,isReadableStream:A,isReadableFinished:ce}=requireUtils(),V=globalThis.AbortController||require$$0$1.AbortController;let R,z,x;function M(S,g,k){let G=!1;S.on("close",()=>{G=!0});const ee=s(S,{readable:g,writable:k},N=>{G=!N});return{destroy:N=>{G||(G=!0,l.destroyer(S,N||new h("pipe")))},cleanup:ee}}function q(S){return _(S[S.length-1],"streams[stream.length - 1]"),S.pop()}function X(S){if(b(S))return S;if(j(S))return Z(S);throw new u("val",["Readable","Iterable","AsyncIterable"],S)}async function*Z(S){z||(z=requireReadable()),yield*z.prototype[a].call(S)}async function L(S,g,k,{end:G}){let ee,N=null;const H=ue=>{if(ue&&(ee=ue),N){const O=N;N=null,O()}},Q=()=>new n((ue,O)=>{ee?O(ee):N=()=>{ee?O(ee):ue()}});g.on("drain",H);const le=s(g,{readable:!1},H);try{g.writableNeedDrain&&await Q();for await(const ue of S)g.write(ue)||await Q();G&&(g.end(),await Q()),k()}catch(ue){k(ee!==ue?d(ee,ue):ue)}finally{le(),g.off("drain",H)}}async function K(S,g,k,{end:G}){B(g)&&(g=g.writable);const ee=g.getWriter();try{for await(const N of S)await ee.ready,ee.write(N).catch(()=>{});await ee.ready,G&&await ee.close(),k()}catch(N){try{await ee.abort(N),k(N)}catch(H){k(H)}}}function y(...S){return E(S,o(q(S)))}function E(S,g,k){if(S.length===1&&e(S[0])&&(S=S[0]),S.length<2)throw new m("streams");const G=new V,ee=G.signal,N=k==null?void 0:k.signal,H=[];p(N,"options.signal");function Q(){ae(new $)}x=x||requireUtil().addAbortListener;let le;N&&(le=x(N,Q));let ue,O;const F=[];let W=0;function ie(ne){ae(ne,--W===0)}function ae(ne,Y){var fe;if(ne&&(!ue||ue.code==="ERR_STREAM_PREMATURE_CLOSE")&&(ue=ne),!(!ue&&!Y)){for(;F.length;)F.shift()(ue);(fe=le)===null||fe===void 0||fe[i](),G.abort(),Y&&(ue||H.forEach(_e=>_e()),r.nextTick(g,ue,O))}}let te;for(let ne=0;ne<S.length;ne++){const Y=S[ne],fe=ne<S.length-1,_e=ne>0,pe=fe||(k==null?void 0:k.end)!==!1,ge=ne===S.length-1;if(U(Y)){let he=function(ye){ye&&ye.name!=="AbortError"&&ye.code!=="ERR_STREAM_PREMATURE_CLOSE"&&ie(ye)};if(pe){const{destroy:ye,cleanup:Ee}=M(Y,fe,_e);F.push(ye),v(Y)&&ge&&H.push(Ee)}Y.on("error",he),v(Y)&&ge&&H.push(()=>{Y.removeListener("error",he)})}if(ne===0)if(typeof Y=="function"){if(te=Y({signal:ee}),!b(te))throw new f("Iterable, AsyncIterable or Stream","source",te)}else b(Y)||j(Y)||B(Y)?te=Y:te=c.from(Y);else if(typeof Y=="function"){if(B(te)){var D;te=X((D=te)===null||D===void 0?void 0:D.readable)}else te=X(te);if(te=Y(te,{signal:ee}),fe){if(!b(te,!0))throw new f("AsyncIterable",`transform[${ne-1}]`,te)}else{var J;R||(R=requirePassthrough());const he=new R({objectMode:!0}),ye=(J=te)===null||J===void 0?void 0:J.then;if(typeof ye=="function")W++,ye.call(te,be=>{O=be,be!=null&&he.write(be),pe&&he.end(),r.nextTick(ie)},be=>{he.destroy(be),r.nextTick(ie,be)});else if(b(te,!0))W++,L(te,he,ie,{end:pe});else if(A(te)||B(te)){const be=te.readable||te;W++,L(be,he,ie,{end:pe})}else throw new f("AsyncIterable or Promise","destination",te);te=he;const{destroy:Ee,cleanup:Ce}=M(te,!1,!0);F.push(Ee),ge&&H.push(Ce)}}else if(U(Y)){if(j(te)){W+=2;const he=C(te,Y,ie,{end:pe});v(Y)&&ge&&H.push(he)}else if(B(te)||A(te)){const he=te.readable||te;W++,L(he,Y,ie,{end:pe})}else if(b(te))W++,L(te,Y,ie,{end:pe});else throw new u("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],te);te=Y}else if(T(Y)){if(j(te))W++,K(X(te),Y,ie,{end:pe});else if(A(te)||b(te))W++,K(te,Y,ie,{end:pe});else if(B(te))W++,K(te.readable,Y,ie,{end:pe});else throw new u("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],te);te=Y}else te=c.from(Y)}return(ee!=null&&ee.aborted||N!=null&&N.aborted)&&r.nextTick(Q),te}function C(S,g,k,{end:G}){let ee=!1;if(g.on("close",()=>{ee||k(new w)}),S.pipe(g,{end:!1}),G){let N=function(){ee=!0,g.end()};ce(S)?r.nextTick(N):S.once("end",N)}else k();return s(S,{readable:!0,writable:!1},N=>{const H=S._readableState;N&&N.code==="ERR_STREAM_PREMATURE_CLOSE"&&H&&H.ended&&!H.errored&&!H.errorEmitted?S.once("end",k).once("error",k):k(N)}),s(g,{readable:!1,writable:!0},k)}return pipeline_1={pipelineImpl:E,pipeline:y},pipeline_1}var compose,hasRequiredCompose;function requireCompose(){if(hasRequiredCompose)return compose;hasRequiredCompose=1;const{pipeline:r}=requirePipeline(),e=requireDuplex(),{destroyer:n}=requireDestroy(),{isNodeStream:a,isReadable:i,isWritable:s,isWebStream:o,isTransformStream:l,isWritableStream:c,isReadableStream:d}=requireUtils(),{AbortError:u,codes:{ERR_INVALID_ARG_VALUE:f,ERR_MISSING_ARGS:m}}=requireErrors(),h=requireEndOfStream();return compose=function(...$){if($.length===0)throw new m("streams");if($.length===1)return e.from($[0]);const _=[...$];if(typeof $[0]=="function"&&($[0]=e.from($[0])),typeof $[$.length-1]=="function"){const R=$.length-1;$[R]=e.from($[R])}for(let R=0;R<$.length;++R)if(!(!a($[R])&&!o($[R]))){if(R<$.length-1&&!(i($[R])||d($[R])||l($[R])))throw new f(`streams[${R}]`,_[R],"must be readable");if(R>0&&!(s($[R])||c($[R])||l($[R])))throw new f(`streams[${R}]`,_[R],"must be writable")}let p,b,v,j,U;function B(R){const z=j;j=null,z?z(R):R?U.destroy(R):!V&&!ce&&U.destroy()}const T=$[0],A=r($,B),ce=!!(s(T)||c(T)||l(T)),V=!!(i(A)||d(A)||l(A));if(U=new e({writableObjectMode:!!(T!=null&&T.writableObjectMode),readableObjectMode:!!(A!=null&&A.readableObjectMode),writable:ce,readable:V}),ce){if(a(T))U._write=function(z,x,M){T.write(z,x)?M():p=M},U._final=function(z){T.end(),b=z},T.on("drain",function(){if(p){const z=p;p=null,z()}});else if(o(T)){const x=(l(T)?T.writable:T).getWriter();U._write=async function(M,q,X){try{await x.ready,x.write(M).catch(()=>{}),X()}catch(Z){X(Z)}},U._final=async function(M){try{await x.ready,x.close().catch(()=>{}),b=M}catch(q){M(q)}}}const R=l(A)?A.readable:A;h(R,()=>{if(b){const z=b;b=null,z()}})}if(V){if(a(A))A.on("readable",function(){if(v){const R=v;v=null,R()}}),A.on("end",function(){U.push(null)}),U._read=function(){for(;;){const R=A.read();if(R===null){v=U._read;return}if(!U.push(R))return}};else if(o(A)){const z=(l(A)?A.readable:A).getReader();U._read=async function(){for(;;)try{const{value:x,done:M}=await z.read();if(!U.push(x))return;if(M){U.push(null);return}}catch{return}}}}return U._destroy=function(R,z){!R&&j!==null&&(R=new u),v=null,p=null,b=null,j===null?z(R):(j=z,a(A)&&n(A,R))},U},compose}var hasRequiredOperators;function requireOperators(){if(hasRequiredOperators)return operators;hasRequiredOperators=1;const r=globalThis.AbortController||require$$0$1.AbortController,{codes:{ERR_INVALID_ARG_VALUE:e,ERR_INVALID_ARG_TYPE:n,ERR_MISSING_ARGS:a,ERR_OUT_OF_RANGE:i},AbortError:s}=requireErrors(),{validateAbortSignal:o,validateInteger:l,validateObject:c}=requireValidators(),d=requirePrimordials().Symbol("kWeak"),u=requirePrimordials().Symbol("kResistStopPropagation"),{finished:f}=requireEndOfStream(),m=requireCompose(),{addAbortSignalNoValidate:h}=requireAddAbortSignal(),{isWritable:w,isNodeStream:$}=requireUtils(),{deprecate:_}=requireUtil(),{ArrayPrototypePush:p,Boolean:b,MathFloor:v,Number:j,NumberIsNaN:U,Promise:B,PromiseReject:T,PromiseResolve:A,PromisePrototypeThen:ce,Symbol:V}=requirePrimordials(),R=V("kEmpty"),z=V("kEof");function x(N,H){if(H!=null&&c(H,"options"),(H==null?void 0:H.signal)!=null&&o(H.signal,"options.signal"),$(N)&&!w(N))throw new e("stream",N,"must be writable");const Q=m(this,N);return H!=null&&H.signal&&h(H.signal,Q),Q}function M(N,H){if(typeof N!="function")throw new n("fn",["Function","AsyncFunction"],N);H!=null&&c(H,"options"),(H==null?void 0:H.signal)!=null&&o(H.signal,"options.signal");let Q=1;(H==null?void 0:H.concurrency)!=null&&(Q=v(H.concurrency));let le=Q-1;return(H==null?void 0:H.highWaterMark)!=null&&(le=v(H.highWaterMark)),l(Q,"options.concurrency",1),l(le,"options.highWaterMark",0),le+=Q,(async function*(){const O=requireUtil().AbortSignalAny([H==null?void 0:H.signal].filter(b)),F=this,W=[],ie={signal:O};let ae,te,D=!1,J=0;function ne(){D=!0,Y()}function Y(){J-=1,fe()}function fe(){te&&!D&&J<Q&&W.length<le&&(te(),te=null)}async function _e(){try{for await(let pe of F){if(D)return;if(O.aborted)throw new s;try{if(pe=N(pe,ie),pe===R)continue;pe=A(pe)}catch(ge){pe=T(ge)}J+=1,ce(pe,Y,ne),W.push(pe),ae&&(ae(),ae=null),!D&&(W.length>=le||J>=Q)&&await new B(ge=>{te=ge})}W.push(z)}catch(pe){const ge=T(pe);ce(ge,Y,ne),W.push(ge)}finally{D=!0,ae&&(ae(),ae=null)}}_e();try{for(;;){for(;W.length>0;){const pe=await W[0];if(pe===z)return;if(O.aborted)throw new s;pe!==R&&(yield pe),W.shift(),fe()}await new B(pe=>{ae=pe})}}finally{D=!0,te&&(te(),te=null)}}).call(this)}function q(N=void 0){return N!=null&&c(N,"options"),(N==null?void 0:N.signal)!=null&&o(N.signal,"options.signal"),(async function*(){let Q=0;for await(const ue of this){var le;if(N!=null&&(le=N.signal)!==null&&le!==void 0&&le.aborted)throw new s({cause:N.signal.reason});yield[Q++,ue]}}).call(this)}async function X(N,H=void 0){for await(const Q of y.call(this,N,H))return!0;return!1}async function Z(N,H=void 0){if(typeof N!="function")throw new n("fn",["Function","AsyncFunction"],N);return!await X.call(this,async(...Q)=>!await N(...Q),H)}async function L(N,H){for await(const Q of y.call(this,N,H))return Q}async function K(N,H){if(typeof N!="function")throw new n("fn",["Function","AsyncFunction"],N);async function Q(le,ue){return await N(le,ue),R}for await(const le of M.call(this,Q,H));}function y(N,H){if(typeof N!="function")throw new n("fn",["Function","AsyncFunction"],N);async function Q(le,ue){return await N(le,ue)?le:R}return M.call(this,Q,H)}class E extends a{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function C(N,H,Q){var le;if(typeof N!="function")throw new n("reducer",["Function","AsyncFunction"],N);Q!=null&&c(Q,"options"),(Q==null?void 0:Q.signal)!=null&&o(Q.signal,"options.signal");let ue=arguments.length>1;if(Q!=null&&(le=Q.signal)!==null&&le!==void 0&&le.aborted){const ae=new s(void 0,{cause:Q.signal.reason});throw this.once("error",()=>{}),await f(this.destroy(ae)),ae}const O=new r,F=O.signal;if(Q!=null&&Q.signal){const ae={once:!0,[d]:this,[u]:!0};Q.signal.addEventListener("abort",()=>O.abort(),ae)}let W=!1;try{for await(const ae of this){var ie;if(W=!0,Q!=null&&(ie=Q.signal)!==null&&ie!==void 0&&ie.aborted)throw new s;ue?H=await N(H,ae,{signal:F}):(H=ae,ue=!0)}if(!W&&!ue)throw new E}finally{O.abort()}return H}async function S(N){N!=null&&c(N,"options"),(N==null?void 0:N.signal)!=null&&o(N.signal,"options.signal");const H=[];for await(const le of this){var Q;if(N!=null&&(Q=N.signal)!==null&&Q!==void 0&&Q.aborted)throw new s(void 0,{cause:N.signal.reason});p(H,le)}return H}function g(N,H){const Q=M.call(this,N,H);return(async function*(){for await(const ue of Q)yield*ue}).call(this)}function k(N){if(N=j(N),U(N))return 0;if(N<0)throw new i("number",">= 0",N);return N}function G(N,H=void 0){return H!=null&&c(H,"options"),(H==null?void 0:H.signal)!=null&&o(H.signal,"options.signal"),N=k(N),(async function*(){var le;if(H!=null&&(le=H.signal)!==null&&le!==void 0&&le.aborted)throw new s;for await(const O of this){var ue;if(H!=null&&(ue=H.signal)!==null&&ue!==void 0&&ue.aborted)throw new s;N--<=0&&(yield O)}}).call(this)}function ee(N,H=void 0){return H!=null&&c(H,"options"),(H==null?void 0:H.signal)!=null&&o(H.signal,"options.signal"),N=k(N),(async function*(){var le;if(H!=null&&(le=H.signal)!==null&&le!==void 0&&le.aborted)throw new s;for await(const O of this){var ue;if(H!=null&&(ue=H.signal)!==null&&ue!==void 0&&ue.aborted)throw new s;if(N-- >0&&(yield O),N<=0)return}}).call(this)}return operators.streamReturningOperators={asIndexedPairs:_(q,"readable.asIndexedPairs will be removed in a future version."),drop:G,filter:y,flatMap:g,map:M,take:ee,compose:x},operators.promiseReturningOperators={every:Z,forEach:K,reduce:C,toArray:S,some:X,find:L},operators}var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:r,Promise:e}=requirePrimordials(),{isIterable:n,isNodeStream:a,isWebStream:i}=requireUtils(),{pipelineImpl:s}=requirePipeline(),{finished:o}=requireEndOfStream();requireStream();function l(...c){return new e((d,u)=>{let f,m;const h=c[c.length-1];if(h&&typeof h=="object"&&!a(h)&&!n(h)&&!i(h)){const w=r(c);f=w.signal,m=w.end}s(c,(w,$)=>{w?u(w):d($)},{signal:f,end:m})})}return promises={finished:o,pipeline:l},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:r}=require$$0$3,{ObjectDefineProperty:e,ObjectKeys:n,ReflectApply:a}=requirePrimordials(),{promisify:{custom:i}}=requireUtil(),{streamReturningOperators:s,promiseReturningOperators:o}=requireOperators(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:l}}=requireErrors(),c=requireCompose(),{setDefaultHighWaterMark:d,getDefaultHighWaterMark:u}=requireState(),{pipeline:f}=requirePipeline(),{destroyer:m}=requireDestroy(),h=requireEndOfStream(),w=requirePromises(),$=requireUtils(),_=stream.exports=requireLegacy().Stream;_.isDestroyed=$.isDestroyed,_.isDisturbed=$.isDisturbed,_.isErrored=$.isErrored,_.isReadable=$.isReadable,_.isWritable=$.isWritable,_.Readable=requireReadable();for(const b of n(s)){let j=function(...U){if(new.target)throw l();return _.Readable.from(a(v,this,U))};const v=s[b];e(j,"name",{__proto__:null,value:v.name}),e(j,"length",{__proto__:null,value:v.length}),e(_.Readable.prototype,b,{__proto__:null,value:j,enumerable:!1,configurable:!0,writable:!0})}for(const b of n(o)){let j=function(...U){if(new.target)throw l();return a(v,this,U)};const v=o[b];e(j,"name",{__proto__:null,value:v.name}),e(j,"length",{__proto__:null,value:v.length}),e(_.Readable.prototype,b,{__proto__:null,value:j,enumerable:!1,configurable:!0,writable:!0})}_.Writable=requireWritable(),_.Duplex=requireDuplex(),_.Transform=requireTransform(),_.PassThrough=requirePassthrough(),_.pipeline=f;const{addAbortSignal:p}=requireAddAbortSignal();return _.addAbortSignal=p,_.finished=h,_.destroy=m,_.compose=c,_.setDefaultHighWaterMark=d,_.getDefaultHighWaterMark=u,e(_,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return w}}),e(f,i,{__proto__:null,enumerable:!0,get(){return w.pipeline}}),e(h,i,{__proto__:null,enumerable:!0,get(){return w.finished}}),_.Stream=_,_._isUint8Array=function(v){return v instanceof Uint8Array},_._uint8ArrayToBuffer=function(v){return r.from(v.buffer,v.byteOffset,v.byteLength)},stream.exports}ours.exports;(function(r){const e=require$$0$4;if(e&&process.env.READABLE_STREAM==="disable"){const n=e.promises;r.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,r.exports._isUint8Array=e._isUint8Array,r.exports.isDisturbed=e.isDisturbed,r.exports.isErrored=e.isErrored,r.exports.isReadable=e.isReadable,r.exports.Readable=e.Readable,r.exports.Writable=e.Writable,r.exports.Duplex=e.Duplex,r.exports.Transform=e.Transform,r.exports.PassThrough=e.PassThrough,r.exports.addAbortSignal=e.addAbortSignal,r.exports.finished=e.finished,r.exports.destroy=e.destroy,r.exports.pipeline=e.pipeline,r.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return n}}),r.exports.Stream=e.Stream}else{const n=requireStream(),a=requirePromises(),i=n.Readable.destroy;r.exports=n.Readable,r.exports._uint8ArrayToBuffer=n._uint8ArrayToBuffer,r.exports._isUint8Array=n._isUint8Array,r.exports.isDisturbed=n.isDisturbed,r.exports.isErrored=n.isErrored,r.exports.isReadable=n.isReadable,r.exports.Readable=n.Readable,r.exports.Writable=n.Writable,r.exports.Duplex=n.Duplex,r.exports.Transform=n.Transform,r.exports.PassThrough=n.PassThrough,r.exports.addAbortSignal=n.addAbortSignal,r.exports.finished=n.finished,r.exports.destroy=n.destroy,r.exports.destroy=i,r.exports.pipeline=n.pipeline,r.exports.compose=n.compose,Object.defineProperty(n,"promises",{configurable:!0,enumerable:!0,get(){return a}}),r.exports.Stream=n.Stream}r.exports.default=r.exports})(ours);var oursExports=ours.exports;Object.defineProperty(lib,"__esModule",{value:!0});lib.ReadableWebToNodeStream=void 0;const readable_stream_1=oursExports;class ReadableWebToNodeStream extends readable_stream_1.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}_read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read().then(e=>{delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}).catch(e=>{this.destroy(e)})}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}lib.ReadableWebToNodeStream=ReadableWebToNodeStream;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.fetchFromUrl=r.parseBlob=r.parseReadableStream=r.parseNodeStream=r.selectCover=r.ratingToStars=r.orderTags=r.parseFromTokenizer=r.parseBuffer=void 0;const e=srcExports,n=core$6,a=lib,i=e("music-metadata-browser:main");var s=core$6;Object.defineProperty(r,"parseBuffer",{enumerable:!0,get:function(){return s.parseBuffer}}),Object.defineProperty(r,"parseFromTokenizer",{enumerable:!0,get:function(){return s.parseFromTokenizer}}),Object.defineProperty(r,"orderTags",{enumerable:!0,get:function(){return s.orderTags}}),Object.defineProperty(r,"ratingToStars",{enumerable:!0,get:function(){return s.ratingToStars}}),Object.defineProperty(r,"selectCover",{enumerable:!0,get:function(){return s.selectCover}}),r.parseNodeStream=n.parseStream;async function o(u,f,m){const h=new a.ReadableWebToNodeStream(u),w=await(0,r.parseNodeStream)(h,typeof f=="string"?{mimeType:f}:f,m);return await h.close(),w}r.parseReadableStream=o;async function l(u,f){u.type,u.size,u instanceof File&&u.name;const m=u.stream?u.stream():c(u);return o(m,{mimeType:u.type,size:u.size},f)}r.parseBlob=l;function c(u){const f=new FileReader;return new ReadableStream({start(m){f.onloadend=h=>{let w=h.target.result;w instanceof ArrayBuffer&&(w=new Uint8Array(w)),m.enqueue(w),m.close()},f.onerror=h=>{m.close()},f.onabort=h=>{m.close()},f.readAsArrayBuffer(u)}})}async function d(u,f){const m=await fetch(u),h={size:parseInt(m.headers.get("Content-Length"),10),mimeType:m.headers.get("Content-Type")};if(m.ok)if(m.body){const w=await o(m.body,h,f);return i("Closing HTTP-readable-stream..."),m.body.locked||await m.body.cancel(),i("HTTP-readable-stream closed."),w}else return l(await m.blob(),f);else throw new Error(`HTTP error status=${m.status}: ${m.statusText}`)}r.fetchFromUrl=d})(lib$3);const isObject=r=>{const e=typeof r;return r!==null&&(e==="object"||e==="function")},disallowedKeys=new Set(["__proto__","prototype","constructor"]),digits=new Set("0123456789");function getPathSegments(r){const e=[];let n="",a="start",i=!1;for(const s of r)switch(s){case"\\":{if(a==="index")throw new Error("Invalid character in an index");if(a==="indexEnd")throw new Error("Invalid character after an index");i&&(n+=s),a="property",i=!i;break}case".":{if(a==="index")throw new Error("Invalid character in an index");if(a==="indexEnd"){a="property";break}if(i){i=!1,n+=s;break}if(disallowedKeys.has(n))return[];e.push(n),n="",a="property";break}case"[":{if(a==="index")throw new Error("Invalid character in an index");if(a==="indexEnd"){a="index";break}if(i){i=!1,n+=s;break}if(a==="property"){if(disallowedKeys.has(n))return[];e.push(n),n=""}a="index";break}case"]":{if(a==="index"){e.push(Number.parseInt(n,10)),n="",a="indexEnd";break}if(a==="indexEnd")throw new Error("Invalid character after an index")}default:{if(a==="index"&&!digits.has(s))throw new Error("Invalid character in an index");if(a==="indexEnd")throw new Error("Invalid character after an index");a==="start"&&(a="property"),i&&(i=!1,n+="\\"),n+=s}}switch(i&&(n+="\\"),a){case"property":{if(disallowedKeys.has(n))return[];e.push(n);break}case"index":throw new Error("Index was not closed");case"start":{e.push("");break}}return e}function isStringIndex(r,e){if(typeof e!="number"&&Array.isArray(r)){const n=Number.parseInt(e,10);return Number.isInteger(n)&&r[n]===r[e]}return!1}function assertNotStringIndex(r,e){if(isStringIndex(r,e))throw new Error("Cannot use string index")}function getProperty(r,e,n){if(!isObject(r)||typeof e!="string")return n===void 0?r:n;const a=getPathSegments(e);if(a.length===0)return n;for(let i=0;i<a.length;i++){const s=a[i];if(isStringIndex(r,s)?r=i===a.length-1?void 0:null:r=r[s],r==null){if(i!==a.length-1)return n;break}}return r===void 0?n:r}function setProperty(r,e,n){if(!isObject(r)||typeof e!="string")return r;const a=r,i=getPathSegments(e);for(let s=0;s<i.length;s++){const o=i[s];assertNotStringIndex(r,o),s===i.length-1?r[o]=n:isObject(r[o])||(r[o]=typeof i[s+1]=="number"?[]:{}),r=r[o]}return a}function deleteProperty(r,e){if(!isObject(r)||typeof e!="string")return!1;const n=getPathSegments(e);for(let a=0;a<n.length;a++){const i=n[a];if(assertNotStringIndex(r,i),a===n.length-1)return delete r[i],!0;if(r=r[i],!isObject(r))return!1}}function hasProperty(r,e){if(!isObject(r)||typeof e!="string")return!1;const n=getPathSegments(e);if(n.length===0)return!1;for(const a of n){if(!isObject(r)||!(a in r)||isStringIndex(r,a))return!1;r=r[a]}return!0}const homedir=os.homedir(),tmpdir=os.tmpdir(),{env}=process$2,macos=r=>{const e=path.join(homedir,"Library");return{data:path.join(e,"Application Support",r),config:path.join(e,"Preferences",r),cache:path.join(e,"Caches",r),log:path.join(e,"Logs",r),temp:path.join(tmpdir,r)}},windows=r=>{const e=env.APPDATA||path.join(homedir,"AppData","Roaming"),n=env.LOCALAPPDATA||path.join(homedir,"AppData","Local");return{data:path.join(n,r,"Data"),config:path.join(e,r,"Config"),cache:path.join(n,r,"Cache"),log:path.join(n,r,"Log"),temp:path.join(tmpdir,r)}},linux=r=>{const e=path.basename(homedir);return{data:path.join(env.XDG_DATA_HOME||path.join(homedir,".local","share"),r),config:path.join(env.XDG_CONFIG_HOME||path.join(homedir,".config"),r),cache:path.join(env.XDG_CACHE_HOME||path.join(homedir,".cache"),r),log:path.join(env.XDG_STATE_HOME||path.join(homedir,".local","state"),r),temp:path.join(tmpdir,e,r)}};function envPaths(r,{suffix:e="nodejs"}={}){if(typeof r!="string")throw new TypeError(`Expected a string, got ${typeof r}`);return e&&(r+=`-${e}`),process$2.platform==="darwin"?macos(r):process$2.platform==="win32"?windows(r):linux(r)}const attemptifyAsync=(r,e)=>function(...a){return r.apply(void 0,a).catch(e)},attemptifySync=(r,e)=>function(...a){try{return r.apply(void 0,a)}catch(i){return e(i)}},IS_USER_ROOT=process$2.getuid?!process$2.getuid():!1,LIMIT_FILES_DESCRIPTORS=1e4,NOOP=()=>{},Handlers={isChangeErrorOk:r=>{if(!Handlers.isNodeError(r))return!1;const{code:e}=r;return e==="ENOSYS"||!IS_USER_ROOT&&(e==="EINVAL"||e==="EPERM")},isNodeError:r=>r instanceof Error,isRetriableError:r=>{if(!Handlers.isNodeError(r))return!1;const{code:e}=r;return e==="EMFILE"||e==="ENFILE"||e==="EAGAIN"||e==="EBUSY"||e==="EACCESS"||e==="EACCES"||e==="EACCS"||e==="EPERM"},onChangeError:r=>{if(!Handlers.isNodeError(r))throw r;if(!Handlers.isChangeErrorOk(r))throw r}};class RetryfyQueue{constructor(){this.interval=25,this.intervalId=void 0,this.limit=LIMIT_FILES_DESCRIPTORS,this.queueActive=new Set,this.queueWaiting=new Set,this.init=()=>{this.intervalId||(this.intervalId=setInterval(this.tick,this.interval))},this.reset=()=>{this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId)},this.add=e=>{this.queueWaiting.add(e),this.queueActive.size<this.limit/2?this.tick():this.init()},this.remove=e=>{this.queueWaiting.delete(e),this.queueActive.delete(e)},this.schedule=()=>new Promise(e=>{const n=()=>this.remove(a),a=()=>e(n);this.add(a)}),this.tick=()=>{if(!(this.queueActive.size>=this.limit)){if(!this.queueWaiting.size)return this.reset();for(const e of this.queueWaiting){if(this.queueActive.size>=this.limit)break;this.queueWaiting.delete(e),this.queueActive.add(e),e()}}}}}const RetryfyQueue$1=new RetryfyQueue,retryifyAsync=(r,e)=>function(a){return function i(...s){return RetryfyQueue$1.schedule().then(o=>{const l=d=>(o(),d),c=d=>{if(o(),Date.now()>=a)throw d;if(e(d)){const u=Math.round(100*Math.random());return new Promise(m=>setTimeout(m,u)).then(()=>i.apply(void 0,s))}throw d};return r.apply(void 0,s).then(l,c)})}},retryifySync=(r,e)=>function(a){return function i(...s){try{return r.apply(void 0,s)}catch(o){if(Date.now()>a)throw o;if(e(o))return i.apply(void 0,s);throw o}}},FS={attempt:{chmod:attemptifyAsync(node_util.promisify(fs.chmod),Handlers.onChangeError),chown:attemptifyAsync(node_util.promisify(fs.chown),Handlers.onChangeError),close:attemptifyAsync(node_util.promisify(fs.close),NOOP),fsync:attemptifyAsync(node_util.promisify(fs.fsync),NOOP),mkdir:attemptifyAsync(node_util.promisify(fs.mkdir),NOOP),realpath:attemptifyAsync(node_util.promisify(fs.realpath),NOOP),stat:attemptifyAsync(node_util.promisify(fs.stat),NOOP),unlink:attemptifyAsync(node_util.promisify(fs.unlink),NOOP),chmodSync:attemptifySync(fs.chmodSync,Handlers.onChangeError),chownSync:attemptifySync(fs.chownSync,Handlers.onChangeError),closeSync:attemptifySync(fs.closeSync,NOOP),existsSync:attemptifySync(fs.existsSync,NOOP),fsyncSync:attemptifySync(fs.fsync,NOOP),mkdirSync:attemptifySync(fs.mkdirSync,NOOP),realpathSync:attemptifySync(fs.realpathSync,NOOP),statSync:attemptifySync(fs.statSync,NOOP),unlinkSync:attemptifySync(fs.unlinkSync,NOOP)},retry:{close:retryifyAsync(node_util.promisify(fs.close),Handlers.isRetriableError),fsync:retryifyAsync(node_util.promisify(fs.fsync),Handlers.isRetriableError),open:retryifyAsync(node_util.promisify(fs.open),Handlers.isRetriableError),readFile:retryifyAsync(node_util.promisify(fs.readFile),Handlers.isRetriableError),rename:retryifyAsync(node_util.promisify(fs.rename),Handlers.isRetriableError),stat:retryifyAsync(node_util.promisify(fs.stat),Handlers.isRetriableError),write:retryifyAsync(node_util.promisify(fs.write),Handlers.isRetriableError),writeFile:retryifyAsync(node_util.promisify(fs.writeFile),Handlers.isRetriableError),closeSync:retryifySync(fs.closeSync,Handlers.isRetriableError),fsyncSync:retryifySync(fs.fsyncSync,Handlers.isRetriableError),openSync:retryifySync(fs.openSync,Handlers.isRetriableError),readFileSync:retryifySync(fs.readFileSync,Handlers.isRetriableError),renameSync:retryifySync(fs.renameSync,Handlers.isRetriableError),statSync:retryifySync(fs.statSync,Handlers.isRetriableError),writeSync:retryifySync(fs.writeSync,Handlers.isRetriableError),writeFileSync:retryifySync(fs.writeFileSync,Handlers.isRetriableError)}},DEFAULT_ENCODING="utf8",DEFAULT_FILE_MODE=438,DEFAULT_FOLDER_MODE=511,DEFAULT_WRITE_OPTIONS={},DEFAULT_USER_UID=os.userInfo().uid,DEFAULT_USER_GID=os.userInfo().gid,DEFAULT_TIMEOUT_SYNC=1e3,IS_POSIX=!!process$2.getuid;process$2.getuid&&process$2.getuid();const LIMIT_BASENAME_LENGTH=128,isException=r=>r instanceof Error&&"code"in r,isString=r=>typeof r=="string",isUndefined=r=>r===void 0,IS_LINUX=process$2.platform==="linux",IS_WINDOWS=process$2.platform==="win32",Signals=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"];IS_WINDOWS||Signals.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");IS_LINUX&&Signals.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED");class Interceptor{constructor(){this.callbacks=new Set,this.exited=!1,this.exit=e=>{if(!this.exited){this.exited=!0;for(const n of this.callbacks)n();e&&(IS_WINDOWS&&e!=="SIGINT"&&e!=="SIGTERM"&&e!=="SIGKILL"?process$2.kill(process$2.pid,"SIGTERM"):process$2.kill(process$2.pid,e))}},this.hook=()=>{process$2.once("exit",()=>this.exit());for(const e of Signals)try{process$2.once(e,()=>this.exit(e))}catch{}},this.register=e=>(this.callbacks.add(e),()=>{this.callbacks.delete(e)}),this.hook()}}const Interceptor$1=new Interceptor,whenExit=Interceptor$1.register,Temp={store:{},create:r=>{const e=`000000${Math.floor(Math.random()*16777215).toString(16)}`.slice(-6),i=`.tmp-${Date.now().toString().slice(-10)}${e}`;return`${r}${i}`},get:(r,e,n=!0)=>{const a=Temp.truncate(e(r));return a in Temp.store?Temp.get(r,e,n):(Temp.store[a]=n,[a,()=>delete Temp.store[a]])},purge:r=>{Temp.store[r]&&(delete Temp.store[r],FS.attempt.unlink(r))},purgeSync:r=>{Temp.store[r]&&(delete Temp.store[r],FS.attempt.unlinkSync(r))},purgeSyncAll:()=>{for(const r in Temp.store)Temp.purgeSync(r)},truncate:r=>{const e=path.basename(r);if(e.length<=LIMIT_BASENAME_LENGTH)return r;const n=/^(\.?)(.*?)((?:\.[^.]+)?(?:\.tmp-\d{10}[a-f0-9]{6})?)$/.exec(e);if(!n)return r;const a=e.length-LIMIT_BASENAME_LENGTH;return`${r.slice(0,-e.length)}${n[1]}${n[2].slice(0,-a)}${n[3]}`}};whenExit(Temp.purgeSyncAll);function writeFileSync(r,e,n=DEFAULT_WRITE_OPTIONS){if(isString(n))return writeFileSync(r,e,{encoding:n});const a=Date.now()+((n.timeout??DEFAULT_TIMEOUT_SYNC)||-1);let i=null,s=null,o=null;try{const l=FS.attempt.realpathSync(r),c=!!l;r=l||r,[s,i]=Temp.get(r,n.tmpCreate||Temp.create,n.tmpPurge!==!1);const d=IS_POSIX&&isUndefined(n.chown),u=isUndefined(n.mode);if(c&&(d||u)){const f=FS.attempt.statSync(r);f&&(n={...n},d&&(n.chown={uid:f.uid,gid:f.gid}),u&&(n.mode=f.mode))}if(!c){const f=path.dirname(r);FS.attempt.mkdirSync(f,{mode:DEFAULT_FOLDER_MODE,recursive:!0})}o=FS.retry.openSync(a)(s,"w",n.mode||DEFAULT_FILE_MODE),n.tmpCreated&&n.tmpCreated(s),isString(e)?FS.retry.writeSync(a)(o,e,0,n.encoding||DEFAULT_ENCODING):isUndefined(e)||FS.retry.writeSync(a)(o,e,0,e.length,0),n.fsync!==!1&&(n.fsyncWait!==!1?FS.retry.fsyncSync(a)(o):FS.attempt.fsync(o)),FS.retry.closeSync(a)(o),o=null,n.chown&&(n.chown.uid!==DEFAULT_USER_UID||n.chown.gid!==DEFAULT_USER_GID)&&FS.attempt.chownSync(s,n.chown.uid,n.chown.gid),n.mode&&n.mode!==DEFAULT_FILE_MODE&&FS.attempt.chmodSync(s,n.mode);try{FS.retry.renameSync(a)(s,r)}catch(f){if(!isException(f)||f.code!=="ENAMETOOLONG")throw f;FS.retry.renameSync(a)(s,Temp.truncate(r))}i(),s=null}finally{o&&FS.attempt.closeSync(o),s&&Temp.purge(s)}}var _2020={exports:{}},core$3={},validate={},boolSchema={},errors={},codegen={},code$1={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.regexpCode=r.getEsmExportName=r.getProperty=r.safeStringify=r.stringify=r.strConcat=r.addCodeArg=r.str=r._=r.nil=r._Code=r.Name=r.IDENTIFIER=r._CodeOrName=void 0;class e{}r._CodeOrName=e,r.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class n extends e{constructor(b){if(super(),!r.IDENTIFIER.test(b))throw new Error("CodeGen: name must be a valid identifier");this.str=b}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}r.Name=n;class a extends e{constructor(b){super(),this._items=typeof b=="string"?[b]:b}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const b=this._items[0];return b===""||b==='""'}get str(){var b;return(b=this._str)!==null&&b!==void 0?b:this._str=this._items.reduce((v,j)=>`${v}${j}`,"")}get names(){var b;return(b=this._names)!==null&&b!==void 0?b:this._names=this._items.reduce((v,j)=>(j instanceof n&&(v[j.str]=(v[j.str]||0)+1),v),{})}}r._Code=a,r.nil=new a("");function i(p,...b){const v=[p[0]];let j=0;for(;j<b.length;)l(v,b[j]),v.push(p[++j]);return new a(v)}r._=i;const s=new a("+");function o(p,...b){const v=[h(p[0])];let j=0;for(;j<b.length;)v.push(s),l(v,b[j]),v.push(s,h(p[++j]));return c(v),new a(v)}r.str=o;function l(p,b){b instanceof a?p.push(...b._items):b instanceof n?p.push(b):p.push(f(b))}r.addCodeArg=l;function c(p){let b=1;for(;b<p.length-1;){if(p[b]===s){const v=d(p[b-1],p[b+1]);if(v!==void 0){p.splice(b-1,3,v);continue}p[b++]="+"}b++}}function d(p,b){if(b==='""')return p;if(p==='""')return b;if(typeof p=="string")return b instanceof n||p[p.length-1]!=='"'?void 0:typeof b!="string"?`${p.slice(0,-1)}${b}"`:b[0]==='"'?p.slice(0,-1)+b.slice(1):void 0;if(typeof b=="string"&&b[0]==='"'&&!(p instanceof n))return`"${p}${b.slice(1)}`}function u(p,b){return b.emptyStr()?p:p.emptyStr()?b:o`${p}${b}`}r.strConcat=u;function f(p){return typeof p=="number"||typeof p=="boolean"||p===null?p:h(Array.isArray(p)?p.join(","):p)}function m(p){return new a(h(p))}r.stringify=m;function h(p){return JSON.stringify(p).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}r.safeStringify=h;function w(p){return typeof p=="string"&&r.IDENTIFIER.test(p)?new a(`.${p}`):i`[${p}]`}r.getProperty=w;function $(p){if(typeof p=="string"&&r.IDENTIFIER.test(p))return new a(`${p}`);throw new Error(`CodeGen: invalid export name: ${p}, use explicit $id name mapping`)}r.getEsmExportName=$;function _(p){return new a(p.toString())}r.regexpCode=_})(code$1);var scope={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ValueScope=r.ValueScopeName=r.Scope=r.varKinds=r.UsedValueState=void 0;const e=code$1;class n extends Error{constructor(d){super(`CodeGen: "code" for ${d} not defined`),this.value=d.value}}var a;(function(c){c[c.Started=0]="Started",c[c.Completed=1]="Completed"})(a||(r.UsedValueState=a={})),r.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class i{constructor({prefixes:d,parent:u}={}){this._names={},this._prefixes=d,this._parent=u}toName(d){return d instanceof e.Name?d:this.name(d)}name(d){return new e.Name(this._newName(d))}_newName(d){const u=this._names[d]||this._nameGroup(d);return`${d}${u.index++}`}_nameGroup(d){var u,f;if(!((f=(u=this._parent)===null||u===void 0?void 0:u._prefixes)===null||f===void 0)&&f.has(d)||this._prefixes&&!this._prefixes.has(d))throw new Error(`CodeGen: prefix "${d}" is not allowed in this scope`);return this._names[d]={prefix:d,index:0}}}r.Scope=i;class s extends e.Name{constructor(d,u){super(u),this.prefix=d}setValue(d,{property:u,itemIndex:f}){this.value=d,this.scopePath=(0,e._)`.${new e.Name(u)}[${f}]`}}r.ValueScopeName=s;const o=(0,e._)`\n`;class l extends i{constructor(d){super(d),this._values={},this._scope=d.scope,this.opts={...d,_n:d.lines?o:e.nil}}get(){return this._scope}name(d){return new s(d,this._newName(d))}value(d,u){var f;if(u.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const m=this.toName(d),{prefix:h}=m,w=(f=u.key)!==null&&f!==void 0?f:u.ref;let $=this._values[h];if($){const b=$.get(w);if(b)return b}else $=this._values[h]=new Map;$.set(w,m);const _=this._scope[h]||(this._scope[h]=[]),p=_.length;return _[p]=u.ref,m.setValue(u,{property:h,itemIndex:p}),m}getValue(d,u){const f=this._values[d];if(f)return f.get(u)}scopeRefs(d,u=this._values){return this._reduceValues(u,f=>{if(f.scopePath===void 0)throw new Error(`CodeGen: name "${f}" has no value`);return(0,e._)`${d}${f.scopePath}`})}scopeCode(d=this._values,u,f){return this._reduceValues(d,m=>{if(m.value===void 0)throw new Error(`CodeGen: name "${m}" has no value`);return m.value.code},u,f)}_reduceValues(d,u,f={},m){let h=e.nil;for(const w in d){const $=d[w];if(!$)continue;const _=f[w]=f[w]||new Map;$.forEach(p=>{if(_.has(p))return;_.set(p,a.Started);let b=u(p);if(b){const v=this.opts.es5?r.varKinds.var:r.varKinds.const;h=(0,e._)`${h}${v} ${p} = ${b};${this.opts._n}`}else if(b=m==null?void 0:m(p))h=(0,e._)`${h}${b}${this.opts._n}`;else throw new n(p);_.set(p,a.Completed)})}return h}}r.ValueScope=l})(scope);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.or=r.and=r.not=r.CodeGen=r.operators=r.varKinds=r.ValueScopeName=r.ValueScope=r.Scope=r.Name=r.regexpCode=r.stringify=r.getProperty=r.nil=r.strConcat=r.str=r._=void 0;const e=code$1,n=scope;var a=code$1;Object.defineProperty(r,"_",{enumerable:!0,get:function(){return a._}}),Object.defineProperty(r,"str",{enumerable:!0,get:function(){return a.str}}),Object.defineProperty(r,"strConcat",{enumerable:!0,get:function(){return a.strConcat}}),Object.defineProperty(r,"nil",{enumerable:!0,get:function(){return a.nil}}),Object.defineProperty(r,"getProperty",{enumerable:!0,get:function(){return a.getProperty}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return a.stringify}}),Object.defineProperty(r,"regexpCode",{enumerable:!0,get:function(){return a.regexpCode}}),Object.defineProperty(r,"Name",{enumerable:!0,get:function(){return a.Name}});var i=scope;Object.defineProperty(r,"Scope",{enumerable:!0,get:function(){return i.Scope}}),Object.defineProperty(r,"ValueScope",{enumerable:!0,get:function(){return i.ValueScope}}),Object.defineProperty(r,"ValueScopeName",{enumerable:!0,get:function(){return i.ValueScopeName}}),Object.defineProperty(r,"varKinds",{enumerable:!0,get:function(){return i.varKinds}}),r.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class s{optimizeNodes(){return this}optimizeNames(g,k){return this}}class o extends s{constructor(g,k,G){super(),this.varKind=g,this.name=k,this.rhs=G}render({es5:g,_n:k}){const G=g?n.varKinds.var:this.varKind,ee=this.rhs===void 0?"":` = ${this.rhs}`;return`${G} ${this.name}${ee};`+k}optimizeNames(g,k){if(g[this.name.str])return this.rhs&&(this.rhs=M(this.rhs,g,k)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class l extends s{constructor(g,k,G){super(),this.lhs=g,this.rhs=k,this.sideEffects=G}render({_n:g}){return`${this.lhs} = ${this.rhs};`+g}optimizeNames(g,k){if(!(this.lhs instanceof e.Name&&!g[this.lhs.str]&&!this.sideEffects))return this.rhs=M(this.rhs,g,k),this}get names(){const g=this.lhs instanceof e.Name?{}:{...this.lhs.names};return x(g,this.rhs)}}class c extends l{constructor(g,k,G,ee){super(g,G,ee),this.op=k}render({_n:g}){return`${this.lhs} ${this.op}= ${this.rhs};`+g}}class d extends s{constructor(g){super(),this.label=g,this.names={}}render({_n:g}){return`${this.label}:`+g}}class u extends s{constructor(g){super(),this.label=g,this.names={}}render({_n:g}){return`break${this.label?` ${this.label}`:""};`+g}}class f extends s{constructor(g){super(),this.error=g}render({_n:g}){return`throw ${this.error};`+g}get names(){return this.error.names}}class m extends s{constructor(g){super(),this.code=g}render({_n:g}){return`${this.code};`+g}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(g,k){return this.code=M(this.code,g,k),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class h extends s{constructor(g=[]){super(),this.nodes=g}render(g){return this.nodes.reduce((k,G)=>k+G.render(g),"")}optimizeNodes(){const{nodes:g}=this;let k=g.length;for(;k--;){const G=g[k].optimizeNodes();Array.isArray(G)?g.splice(k,1,...G):G?g[k]=G:g.splice(k,1)}return g.length>0?this:void 0}optimizeNames(g,k){const{nodes:G}=this;let ee=G.length;for(;ee--;){const N=G[ee];N.optimizeNames(g,k)||(q(g,N.names),G.splice(ee,1))}return G.length>0?this:void 0}get names(){return this.nodes.reduce((g,k)=>z(g,k.names),{})}}class w extends h{render(g){return"{"+g._n+super.render(g)+"}"+g._n}}class $ extends h{}class _ extends w{}_.kind="else";class p extends w{constructor(g,k){super(k),this.condition=g}render(g){let k=`if(${this.condition})`+super.render(g);return this.else&&(k+="else "+this.else.render(g)),k}optimizeNodes(){super.optimizeNodes();const g=this.condition;if(g===!0)return this.nodes;let k=this.else;if(k){const G=k.optimizeNodes();k=this.else=Array.isArray(G)?new _(G):G}if(k)return g===!1?k instanceof p?k:k.nodes:this.nodes.length?this:new p(X(g),k instanceof p?[k]:k.nodes);if(!(g===!1||!this.nodes.length))return this}optimizeNames(g,k){var G;if(this.else=(G=this.else)===null||G===void 0?void 0:G.optimizeNames(g,k),!!(super.optimizeNames(g,k)||this.else))return this.condition=M(this.condition,g,k),this}get names(){const g=super.names;return x(g,this.condition),this.else&&z(g,this.else.names),g}}p.kind="if";class b extends w{}b.kind="for";class v extends b{constructor(g){super(),this.iteration=g}render(g){return`for(${this.iteration})`+super.render(g)}optimizeNames(g,k){if(super.optimizeNames(g,k))return this.iteration=M(this.iteration,g,k),this}get names(){return z(super.names,this.iteration.names)}}class j extends b{constructor(g,k,G,ee){super(),this.varKind=g,this.name=k,this.from=G,this.to=ee}render(g){const k=g.es5?n.varKinds.var:this.varKind,{name:G,from:ee,to:N}=this;return`for(${k} ${G}=${ee}; ${G}<${N}; ${G}++)`+super.render(g)}get names(){const g=x(super.names,this.from);return x(g,this.to)}}class U extends b{constructor(g,k,G,ee){super(),this.loop=g,this.varKind=k,this.name=G,this.iterable=ee}render(g){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(g)}optimizeNames(g,k){if(super.optimizeNames(g,k))return this.iterable=M(this.iterable,g,k),this}get names(){return z(super.names,this.iterable.names)}}class B extends w{constructor(g,k,G){super(),this.name=g,this.args=k,this.async=G}render(g){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(g)}}B.kind="func";class T extends h{render(g){return"return "+super.render(g)}}T.kind="return";class A extends w{render(g){let k="try"+super.render(g);return this.catch&&(k+=this.catch.render(g)),this.finally&&(k+=this.finally.render(g)),k}optimizeNodes(){var g,k;return super.optimizeNodes(),(g=this.catch)===null||g===void 0||g.optimizeNodes(),(k=this.finally)===null||k===void 0||k.optimizeNodes(),this}optimizeNames(g,k){var G,ee;return super.optimizeNames(g,k),(G=this.catch)===null||G===void 0||G.optimizeNames(g,k),(ee=this.finally)===null||ee===void 0||ee.optimizeNames(g,k),this}get names(){const g=super.names;return this.catch&&z(g,this.catch.names),this.finally&&z(g,this.finally.names),g}}class ce extends w{constructor(g){super(),this.error=g}render(g){return`catch(${this.error})`+super.render(g)}}ce.kind="catch";class V extends w{render(g){return"finally"+super.render(g)}}V.kind="finally";class R{constructor(g,k={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...k,_n:k.lines?`
`:""},this._extScope=g,this._scope=new n.Scope({parent:g}),this._nodes=[new $]}toString(){return this._root.render(this.opts)}name(g){return this._scope.name(g)}scopeName(g){return this._extScope.name(g)}scopeValue(g,k){const G=this._extScope.value(g,k);return(this._values[G.prefix]||(this._values[G.prefix]=new Set)).add(G),G}getScopeValue(g,k){return this._extScope.getValue(g,k)}scopeRefs(g){return this._extScope.scopeRefs(g,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(g,k,G,ee){const N=this._scope.toName(k);return G!==void 0&&ee&&(this._constants[N.str]=G),this._leafNode(new o(g,N,G)),N}const(g,k,G){return this._def(n.varKinds.const,g,k,G)}let(g,k,G){return this._def(n.varKinds.let,g,k,G)}var(g,k,G){return this._def(n.varKinds.var,g,k,G)}assign(g,k,G){return this._leafNode(new l(g,k,G))}add(g,k){return this._leafNode(new c(g,r.operators.ADD,k))}code(g){return typeof g=="function"?g():g!==e.nil&&this._leafNode(new m(g)),this}object(...g){const k=["{"];for(const[G,ee]of g)k.length>1&&k.push(","),k.push(G),(G!==ee||this.opts.es5)&&(k.push(":"),(0,e.addCodeArg)(k,ee));return k.push("}"),new e._Code(k)}if(g,k,G){if(this._blockNode(new p(g)),k&&G)this.code(k).else().code(G).endIf();else if(k)this.code(k).endIf();else if(G)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(g){return this._elseNode(new p(g))}else(){return this._elseNode(new _)}endIf(){return this._endBlockNode(p,_)}_for(g,k){return this._blockNode(g),k&&this.code(k).endFor(),this}for(g,k){return this._for(new v(g),k)}forRange(g,k,G,ee,N=this.opts.es5?n.varKinds.var:n.varKinds.let){const H=this._scope.toName(g);return this._for(new j(N,H,k,G),()=>ee(H))}forOf(g,k,G,ee=n.varKinds.const){const N=this._scope.toName(g);if(this.opts.es5){const H=k instanceof e.Name?k:this.var("_arr",k);return this.forRange("_i",0,(0,e._)`${H}.length`,Q=>{this.var(N,(0,e._)`${H}[${Q}]`),G(N)})}return this._for(new U("of",ee,N,k),()=>G(N))}forIn(g,k,G,ee=this.opts.es5?n.varKinds.var:n.varKinds.const){if(this.opts.ownProperties)return this.forOf(g,(0,e._)`Object.keys(${k})`,G);const N=this._scope.toName(g);return this._for(new U("in",ee,N,k),()=>G(N))}endFor(){return this._endBlockNode(b)}label(g){return this._leafNode(new d(g))}break(g){return this._leafNode(new u(g))}return(g){const k=new T;if(this._blockNode(k),this.code(g),k.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(T)}try(g,k,G){if(!k&&!G)throw new Error('CodeGen: "try" without "catch" and "finally"');const ee=new A;if(this._blockNode(ee),this.code(g),k){const N=this.name("e");this._currNode=ee.catch=new ce(N),k(N)}return G&&(this._currNode=ee.finally=new V,this.code(G)),this._endBlockNode(ce,V)}throw(g){return this._leafNode(new f(g))}block(g,k){return this._blockStarts.push(this._nodes.length),g&&this.code(g).endBlock(k),this}endBlock(g){const k=this._blockStarts.pop();if(k===void 0)throw new Error("CodeGen: not in self-balancing block");const G=this._nodes.length-k;if(G<0||g!==void 0&&G!==g)throw new Error(`CodeGen: wrong number of nodes: ${G} vs ${g} expected`);return this._nodes.length=k,this}func(g,k=e.nil,G,ee){return this._blockNode(new B(g,k,G)),ee&&this.code(ee).endFunc(),this}endFunc(){return this._endBlockNode(B)}optimize(g=1){for(;g-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(g){return this._currNode.nodes.push(g),this}_blockNode(g){this._currNode.nodes.push(g),this._nodes.push(g)}_endBlockNode(g,k){const G=this._currNode;if(G instanceof g||k&&G instanceof k)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${k?`${g.kind}/${k.kind}`:g.kind}"`)}_elseNode(g){const k=this._currNode;if(!(k instanceof p))throw new Error('CodeGen: "else" without "if"');return this._currNode=k.else=g,this}get _root(){return this._nodes[0]}get _currNode(){const g=this._nodes;return g[g.length-1]}set _currNode(g){const k=this._nodes;k[k.length-1]=g}}r.CodeGen=R;function z(S,g){for(const k in g)S[k]=(S[k]||0)+(g[k]||0);return S}function x(S,g){return g instanceof e._CodeOrName?z(S,g.names):S}function M(S,g,k){if(S instanceof e.Name)return G(S);if(!ee(S))return S;return new e._Code(S._items.reduce((N,H)=>(H instanceof e.Name&&(H=G(H)),H instanceof e._Code?N.push(...H._items):N.push(H),N),[]));function G(N){const H=k[N.str];return H===void 0||g[N.str]!==1?N:(delete g[N.str],H)}function ee(N){return N instanceof e._Code&&N._items.some(H=>H instanceof e.Name&&g[H.str]===1&&k[H.str]!==void 0)}}function q(S,g){for(const k in g)S[k]=(S[k]||0)-(g[k]||0)}function X(S){return typeof S=="boolean"||typeof S=="number"||S===null?!S:(0,e._)`!${C(S)}`}r.not=X;const Z=E(r.operators.AND);function L(...S){return S.reduce(Z)}r.and=L;const K=E(r.operators.OR);function y(...S){return S.reduce(K)}r.or=y;function E(S){return(g,k)=>g===e.nil?k:k===e.nil?g:(0,e._)`${C(g)} ${S} ${C(k)}`}function C(S){return S instanceof e.Name?S:(0,e._)`(${S})`}})(codegen);var util={};Object.defineProperty(util,"__esModule",{value:!0});util.checkStrictMode=util.getErrorPath=util.Type=util.useFunc=util.setEvaluated=util.evaluatedPropsToName=util.mergeEvaluated=util.eachItem=util.unescapeJsonPointer=util.escapeJsonPointer=util.escapeFragment=util.unescapeFragment=util.schemaRefOrVal=util.schemaHasRulesButRef=util.schemaHasRules=util.checkUnknownRules=util.alwaysValidSchema=util.toHash=void 0;const codegen_1$z=codegen,code_1$a=code$1;function toHash(r){const e={};for(const n of r)e[n]=!0;return e}util.toHash=toHash;function alwaysValidSchema(r,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(checkUnknownRules(r,e),!schemaHasRules(e,r.self.RULES.all))}util.alwaysValidSchema=alwaysValidSchema;function checkUnknownRules(r,e=r.schema){const{opts:n,self:a}=r;if(!n.strictSchema||typeof e=="boolean")return;const i=a.RULES.keywords;for(const s in e)i[s]||checkStrictMode(r,`unknown keyword: "${s}"`)}util.checkUnknownRules=checkUnknownRules;function schemaHasRules(r,e){if(typeof r=="boolean")return!r;for(const n in r)if(e[n])return!0;return!1}util.schemaHasRules=schemaHasRules;function schemaHasRulesButRef(r,e){if(typeof r=="boolean")return!r;for(const n in r)if(n!=="$ref"&&e.all[n])return!0;return!1}util.schemaHasRulesButRef=schemaHasRulesButRef;function schemaRefOrVal({topSchemaRef:r,schemaPath:e},n,a,i){if(!i){if(typeof n=="number"||typeof n=="boolean")return n;if(typeof n=="string")return(0,codegen_1$z._)`${n}`}return(0,codegen_1$z._)`${r}${e}${(0,codegen_1$z.getProperty)(a)}`}util.schemaRefOrVal=schemaRefOrVal;function unescapeFragment(r){return unescapeJsonPointer(decodeURIComponent(r))}util.unescapeFragment=unescapeFragment;function escapeFragment(r){return encodeURIComponent(escapeJsonPointer(r))}util.escapeFragment=escapeFragment;function escapeJsonPointer(r){return typeof r=="number"?`${r}`:r.replace(/~/g,"~0").replace(/\//g,"~1")}util.escapeJsonPointer=escapeJsonPointer;function unescapeJsonPointer(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}util.unescapeJsonPointer=unescapeJsonPointer;function eachItem(r,e){if(Array.isArray(r))for(const n of r)e(n);else e(r)}util.eachItem=eachItem;function makeMergeEvaluated({mergeNames:r,mergeToName:e,mergeValues:n,resultToName:a}){return(i,s,o,l)=>{const c=o===void 0?s:o instanceof codegen_1$z.Name?(s instanceof codegen_1$z.Name?r(i,s,o):e(i,s,o),o):s instanceof codegen_1$z.Name?(e(i,o,s),s):n(s,o);return l===codegen_1$z.Name&&!(c instanceof codegen_1$z.Name)?a(i,c):c}}util.mergeEvaluated={props:makeMergeEvaluated({mergeNames:(r,e,n)=>r.if((0,codegen_1$z._)`${n} !== true && ${e} !== undefined`,()=>{r.if((0,codegen_1$z._)`${e} === true`,()=>r.assign(n,!0),()=>r.assign(n,(0,codegen_1$z._)`${n} || {}`).code((0,codegen_1$z._)`Object.assign(${n}, ${e})`))}),mergeToName:(r,e,n)=>r.if((0,codegen_1$z._)`${n} !== true`,()=>{e===!0?r.assign(n,!0):(r.assign(n,(0,codegen_1$z._)`${n} || {}`),setEvaluated(r,n,e))}),mergeValues:(r,e)=>r===!0?!0:{...r,...e},resultToName:evaluatedPropsToName}),items:makeMergeEvaluated({mergeNames:(r,e,n)=>r.if((0,codegen_1$z._)`${n} !== true && ${e} !== undefined`,()=>r.assign(n,(0,codegen_1$z._)`${e} === true ? true : ${n} > ${e} ? ${n} : ${e}`)),mergeToName:(r,e,n)=>r.if((0,codegen_1$z._)`${n} !== true`,()=>r.assign(n,e===!0?!0:(0,codegen_1$z._)`${n} > ${e} ? ${n} : ${e}`)),mergeValues:(r,e)=>r===!0?!0:Math.max(r,e),resultToName:(r,e)=>r.var("items",e)})};function evaluatedPropsToName(r,e){if(e===!0)return r.var("props",!0);const n=r.var("props",(0,codegen_1$z._)`{}`);return e!==void 0&&setEvaluated(r,n,e),n}util.evaluatedPropsToName=evaluatedPropsToName;function setEvaluated(r,e,n){Object.keys(n).forEach(a=>r.assign((0,codegen_1$z._)`${e}${(0,codegen_1$z.getProperty)(a)}`,!0))}util.setEvaluated=setEvaluated;const snippets={};function useFunc(r,e){return r.scopeValue("func",{ref:e,code:snippets[e.code]||(snippets[e.code]=new code_1$a._Code(e.code))})}util.useFunc=useFunc;var Type;(function(r){r[r.Num=0]="Num",r[r.Str=1]="Str"})(Type||(util.Type=Type={}));function getErrorPath(r,e,n){if(r instanceof codegen_1$z.Name){const a=e===Type.Num;return n?a?(0,codegen_1$z._)`"[" + ${r} + "]"`:(0,codegen_1$z._)`"['" + ${r} + "']"`:a?(0,codegen_1$z._)`"/" + ${r}`:(0,codegen_1$z._)`"/" + ${r}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return n?(0,codegen_1$z.getProperty)(r).toString():"/"+escapeJsonPointer(r)}util.getErrorPath=getErrorPath;function checkStrictMode(r,e,n=r.opts.strictSchema){if(n){if(e=`strict mode: ${e}`,n===!0)throw new Error(e);r.self.logger.warn(e)}}util.checkStrictMode=checkStrictMode;var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$y=codegen,names={data:new codegen_1$y.Name("data"),valCxt:new codegen_1$y.Name("valCxt"),instancePath:new codegen_1$y.Name("instancePath"),parentData:new codegen_1$y.Name("parentData"),parentDataProperty:new codegen_1$y.Name("parentDataProperty"),rootData:new codegen_1$y.Name("rootData"),dynamicAnchors:new codegen_1$y.Name("dynamicAnchors"),vErrors:new codegen_1$y.Name("vErrors"),errors:new codegen_1$y.Name("errors"),this:new codegen_1$y.Name("this"),self:new codegen_1$y.Name("self"),scope:new codegen_1$y.Name("scope"),json:new codegen_1$y.Name("json"),jsonPos:new codegen_1$y.Name("jsonPos"),jsonLen:new codegen_1$y.Name("jsonLen"),jsonPart:new codegen_1$y.Name("jsonPart")};names$1.default=names;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.extendErrors=r.resetErrorsCount=r.reportExtraError=r.reportError=r.keyword$DataError=r.keywordError=void 0;const e=codegen,n=util,a=names$1;r.keywordError={message:({keyword:_})=>(0,e.str)`must pass "${_}" keyword validation`},r.keyword$DataError={message:({keyword:_,schemaType:p})=>p?(0,e.str)`"${_}" keyword must be ${p} ($data)`:(0,e.str)`"${_}" keyword is invalid ($data)`};function i(_,p=r.keywordError,b,v){const{it:j}=_,{gen:U,compositeRule:B,allErrors:T}=j,A=f(_,p,b);v??(B||T)?c(U,A):d(j,(0,e._)`[${A}]`)}r.reportError=i;function s(_,p=r.keywordError,b){const{it:v}=_,{gen:j,compositeRule:U,allErrors:B}=v,T=f(_,p,b);c(j,T),U||B||d(v,a.default.vErrors)}r.reportExtraError=s;function o(_,p){_.assign(a.default.errors,p),_.if((0,e._)`${a.default.vErrors} !== null`,()=>_.if(p,()=>_.assign((0,e._)`${a.default.vErrors}.length`,p),()=>_.assign(a.default.vErrors,null)))}r.resetErrorsCount=o;function l({gen:_,keyword:p,schemaValue:b,data:v,errsCount:j,it:U}){if(j===void 0)throw new Error("ajv implementation error");const B=_.name("err");_.forRange("i",j,a.default.errors,T=>{_.const(B,(0,e._)`${a.default.vErrors}[${T}]`),_.if((0,e._)`${B}.instancePath === undefined`,()=>_.assign((0,e._)`${B}.instancePath`,(0,e.strConcat)(a.default.instancePath,U.errorPath))),_.assign((0,e._)`${B}.schemaPath`,(0,e.str)`${U.errSchemaPath}/${p}`),U.opts.verbose&&(_.assign((0,e._)`${B}.schema`,b),_.assign((0,e._)`${B}.data`,v))})}r.extendErrors=l;function c(_,p){const b=_.const("err",p);_.if((0,e._)`${a.default.vErrors} === null`,()=>_.assign(a.default.vErrors,(0,e._)`[${b}]`),(0,e._)`${a.default.vErrors}.push(${b})`),_.code((0,e._)`${a.default.errors}++`)}function d(_,p){const{gen:b,validateName:v,schemaEnv:j}=_;j.$async?b.throw((0,e._)`new ${_.ValidationError}(${p})`):(b.assign((0,e._)`${v}.errors`,p),b.return(!1))}const u={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function f(_,p,b){const{createErrors:v}=_.it;return v===!1?(0,e._)`{}`:m(_,p,b)}function m(_,p,b={}){const{gen:v,it:j}=_,U=[h(j,b),w(_,b)];return $(_,p,U),v.object(...U)}function h({errorPath:_},{instancePath:p}){const b=p?(0,e.str)`${_}${(0,n.getErrorPath)(p,n.Type.Str)}`:_;return[a.default.instancePath,(0,e.strConcat)(a.default.instancePath,b)]}function w({keyword:_,it:{errSchemaPath:p}},{schemaPath:b,parentSchema:v}){let j=v?p:(0,e.str)`${p}/${_}`;return b&&(j=(0,e.str)`${j}${(0,n.getErrorPath)(b,n.Type.Str)}`),[u.schemaPath,j]}function $(_,{params:p,message:b},v){const{keyword:j,data:U,schemaValue:B,it:T}=_,{opts:A,propertyName:ce,topSchemaRef:V,schemaPath:R}=T;v.push([u.keyword,j],[u.params,typeof p=="function"?p(_):p||(0,e._)`{}`]),A.messages&&v.push([u.message,typeof b=="function"?b(_):b]),A.verbose&&v.push([u.schema,B],[u.parentSchema,(0,e._)`${V}${R}`],[a.default.data,U]),ce&&v.push([u.propertyName,ce])}})(errors);Object.defineProperty(boolSchema,"__esModule",{value:!0});boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$3=errors,codegen_1$x=codegen,names_1$9=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(r){const{gen:e,schema:n,validateName:a}=r;n===!1?falseSchemaError(r,!1):typeof n=="object"&&n.$async===!0?e.return(names_1$9.default.data):(e.assign((0,codegen_1$x._)`${a}.errors`,null),e.return(!0))}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema;function boolOrEmptySchema(r,e){const{gen:n,schema:a}=r;a===!1?(n.var(e,!1),falseSchemaError(r)):n.var(e,!0)}boolSchema.boolOrEmptySchema=boolOrEmptySchema;function falseSchemaError(r,e){const{gen:n,data:a}=r,i={gen:n,keyword:"false schema",data:a,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:r};(0,errors_1$3.reportError)(i,boolError,void 0,e)}var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0});rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(r){return typeof r=="string"&&jsonTypes.has(r)}rules.isJSONType=isJSONType;function getRules(){const r={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...r,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},r.number,r.string,r.array,r.object],post:{rules:[]},all:{},keywords:{}}}rules.getRules=getRules;var applicability={};Object.defineProperty(applicability,"__esModule",{value:!0});applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function schemaHasRulesForType({schema:r,self:e},n){const a=e.RULES.types[n];return a&&a!==!0&&shouldUseGroup(r,a)}applicability.schemaHasRulesForType=schemaHasRulesForType;function shouldUseGroup(r,e){return e.rules.some(n=>shouldUseRule(r,n))}applicability.shouldUseGroup=shouldUseGroup;function shouldUseRule(r,e){var n;return r[e.keyword]!==void 0||((n=e.definition.implements)===null||n===void 0?void 0:n.some(a=>r[a]!==void 0))}applicability.shouldUseRule=shouldUseRule;Object.defineProperty(dataType,"__esModule",{value:!0});dataType.reportTypeError=dataType.checkDataTypes=dataType.checkDataType=dataType.coerceAndCheckDataType=dataType.getJSONTypes=dataType.getSchemaTypes=dataType.DataType=void 0;const rules_1=rules,applicability_1$1=applicability,errors_1$2=errors,codegen_1$w=codegen,util_1$u=util;var DataType;(function(r){r[r.Correct=0]="Correct",r[r.Wrong=1]="Wrong"})(DataType||(dataType.DataType=DataType={}));function getSchemaTypes(r){const e=getJSONTypes(r.type);if(e.includes("null")){if(r.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&r.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');r.nullable===!0&&e.push("null")}return e}dataType.getSchemaTypes=getSchemaTypes;function getJSONTypes(r){const e=Array.isArray(r)?r:r?[r]:[];if(e.every(rules_1.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}dataType.getJSONTypes=getJSONTypes;function coerceAndCheckDataType(r,e){const{gen:n,data:a,opts:i}=r,s=coerceToTypes(e,i.coerceTypes),o=e.length>0&&!(s.length===0&&e.length===1&&(0,applicability_1$1.schemaHasRulesForType)(r,e[0]));if(o){const l=checkDataTypes(e,a,i.strictNumbers,DataType.Wrong);n.if(l,()=>{s.length?coerceData(r,e,s):reportTypeError(r)})}return o}dataType.coerceAndCheckDataType=coerceAndCheckDataType;const COERCIBLE=new Set(["string","number","integer","boolean","null"]);function coerceToTypes(r,e){return e?r.filter(n=>COERCIBLE.has(n)||e==="array"&&n==="array"):[]}function coerceData(r,e,n){const{gen:a,data:i,opts:s}=r,o=a.let("dataType",(0,codegen_1$w._)`typeof ${i}`),l=a.let("coerced",(0,codegen_1$w._)`undefined`);s.coerceTypes==="array"&&a.if((0,codegen_1$w._)`${o} == 'object' && Array.isArray(${i}) && ${i}.length == 1`,()=>a.assign(i,(0,codegen_1$w._)`${i}[0]`).assign(o,(0,codegen_1$w._)`typeof ${i}`).if(checkDataTypes(e,i,s.strictNumbers),()=>a.assign(l,i))),a.if((0,codegen_1$w._)`${l} !== undefined`);for(const d of n)(COERCIBLE.has(d)||d==="array"&&s.coerceTypes==="array")&&c(d);a.else(),reportTypeError(r),a.endIf(),a.if((0,codegen_1$w._)`${l} !== undefined`,()=>{a.assign(i,l),assignParentData(r,l)});function c(d){switch(d){case"string":a.elseIf((0,codegen_1$w._)`${o} == "number" || ${o} == "boolean"`).assign(l,(0,codegen_1$w._)`"" + ${i}`).elseIf((0,codegen_1$w._)`${i} === null`).assign(l,(0,codegen_1$w._)`""`);return;case"number":a.elseIf((0,codegen_1$w._)`${o} == "boolean" || ${i} === null
              || (${o} == "string" && ${i} && ${i} == +${i})`).assign(l,(0,codegen_1$w._)`+${i}`);return;case"integer":a.elseIf((0,codegen_1$w._)`${o} === "boolean" || ${i} === null
              || (${o} === "string" && ${i} && ${i} == +${i} && !(${i} % 1))`).assign(l,(0,codegen_1$w._)`+${i}`);return;case"boolean":a.elseIf((0,codegen_1$w._)`${i} === "false" || ${i} === 0 || ${i} === null`).assign(l,!1).elseIf((0,codegen_1$w._)`${i} === "true" || ${i} === 1`).assign(l,!0);return;case"null":a.elseIf((0,codegen_1$w._)`${i} === "" || ${i} === 0 || ${i} === false`),a.assign(l,null);return;case"array":a.elseIf((0,codegen_1$w._)`${o} === "string" || ${o} === "number"
              || ${o} === "boolean" || ${i} === null`).assign(l,(0,codegen_1$w._)`[${i}]`)}}}function assignParentData({gen:r,parentData:e,parentDataProperty:n},a){r.if((0,codegen_1$w._)`${e} !== undefined`,()=>r.assign((0,codegen_1$w._)`${e}[${n}]`,a))}function checkDataType(r,e,n,a=DataType.Correct){const i=a===DataType.Correct?codegen_1$w.operators.EQ:codegen_1$w.operators.NEQ;let s;switch(r){case"null":return(0,codegen_1$w._)`${e} ${i} null`;case"array":s=(0,codegen_1$w._)`Array.isArray(${e})`;break;case"object":s=(0,codegen_1$w._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=o((0,codegen_1$w._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=o();break;default:return(0,codegen_1$w._)`typeof ${e} ${i} ${r}`}return a===DataType.Correct?s:(0,codegen_1$w.not)(s);function o(l=codegen_1$w.nil){return(0,codegen_1$w.and)((0,codegen_1$w._)`typeof ${e} == "number"`,l,n?(0,codegen_1$w._)`isFinite(${e})`:codegen_1$w.nil)}}dataType.checkDataType=checkDataType;function checkDataTypes(r,e,n,a){if(r.length===1)return checkDataType(r[0],e,n,a);let i;const s=(0,util_1$u.toHash)(r);if(s.array&&s.object){const o=(0,codegen_1$w._)`typeof ${e} != "object"`;i=s.null?o:(0,codegen_1$w._)`!${e} || ${o}`,delete s.null,delete s.array,delete s.object}else i=codegen_1$w.nil;s.number&&delete s.integer;for(const o in s)i=(0,codegen_1$w.and)(i,checkDataType(o,e,n,a));return i}dataType.checkDataTypes=checkDataTypes;const typeError={message:({schema:r})=>`must be ${r}`,params:({schema:r,schemaValue:e})=>typeof r=="string"?(0,codegen_1$w._)`{type: ${r}}`:(0,codegen_1$w._)`{type: ${e}}`};function reportTypeError(r){const e=getTypeErrorContext(r);(0,errors_1$2.reportError)(e,typeError)}dataType.reportTypeError=reportTypeError;function getTypeErrorContext(r){const{gen:e,data:n,schema:a}=r,i=(0,util_1$u.schemaRefOrVal)(r,a,"type");return{gen:e,keyword:"type",data:n,schema:a.type,schemaCode:i,schemaValue:i,parentSchema:a,params:{},it:r}}var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0});defaults.assignDefaults=void 0;const codegen_1$v=codegen,util_1$t=util;function assignDefaults(r,e){const{properties:n,items:a}=r.schema;if(e==="object"&&n)for(const i in n)assignDefault(r,i,n[i].default);else e==="array"&&Array.isArray(a)&&a.forEach((i,s)=>assignDefault(r,s,i.default))}defaults.assignDefaults=assignDefaults;function assignDefault(r,e,n){const{gen:a,compositeRule:i,data:s,opts:o}=r;if(n===void 0)return;const l=(0,codegen_1$v._)`${s}${(0,codegen_1$v.getProperty)(e)}`;if(i){(0,util_1$t.checkStrictMode)(r,`default is ignored for: ${l}`);return}let c=(0,codegen_1$v._)`${l} === undefined`;o.useDefaults==="empty"&&(c=(0,codegen_1$v._)`${c} || ${l} === null || ${l} === ""`),a.if(c,(0,codegen_1$v._)`${l} = ${(0,codegen_1$v.stringify)(n)}`)}var keyword={},code={};Object.defineProperty(code,"__esModule",{value:!0});code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const codegen_1$u=codegen,util_1$s=util,names_1$8=names$1,util_2$1=util;function checkReportMissingProp(r,e){const{gen:n,data:a,it:i}=r;n.if(noPropertyInData(n,a,e,i.opts.ownProperties),()=>{r.setParams({missingProperty:(0,codegen_1$u._)`${e}`},!0),r.error()})}code.checkReportMissingProp=checkReportMissingProp;function checkMissingProp({gen:r,data:e,it:{opts:n}},a,i){return(0,codegen_1$u.or)(...a.map(s=>(0,codegen_1$u.and)(noPropertyInData(r,e,s,n.ownProperties),(0,codegen_1$u._)`${i} = ${s}`)))}code.checkMissingProp=checkMissingProp;function reportMissingProp(r,e){r.setParams({missingProperty:e},!0),r.error()}code.reportMissingProp=reportMissingProp;function hasPropFunc(r){return r.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,codegen_1$u._)`Object.prototype.hasOwnProperty`})}code.hasPropFunc=hasPropFunc;function isOwnProperty(r,e,n){return(0,codegen_1$u._)`${hasPropFunc(r)}.call(${e}, ${n})`}code.isOwnProperty=isOwnProperty;function propertyInData(r,e,n,a){const i=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(n)} !== undefined`;return a?(0,codegen_1$u._)`${i} && ${isOwnProperty(r,e,n)}`:i}code.propertyInData=propertyInData;function noPropertyInData(r,e,n,a){const i=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(n)} === undefined`;return a?(0,codegen_1$u.or)(i,(0,codegen_1$u.not)(isOwnProperty(r,e,n))):i}code.noPropertyInData=noPropertyInData;function allSchemaProperties(r){return r?Object.keys(r).filter(e=>e!=="__proto__"):[]}code.allSchemaProperties=allSchemaProperties;function schemaProperties(r,e){return allSchemaProperties(e).filter(n=>!(0,util_1$s.alwaysValidSchema)(r,e[n]))}code.schemaProperties=schemaProperties;function callValidateCode({schemaCode:r,data:e,it:{gen:n,topSchemaRef:a,schemaPath:i,errorPath:s},it:o},l,c,d){const u=d?(0,codegen_1$u._)`${r}, ${e}, ${a}${i}`:e,f=[[names_1$8.default.instancePath,(0,codegen_1$u.strConcat)(names_1$8.default.instancePath,s)],[names_1$8.default.parentData,o.parentData],[names_1$8.default.parentDataProperty,o.parentDataProperty],[names_1$8.default.rootData,names_1$8.default.rootData]];o.opts.dynamicRef&&f.push([names_1$8.default.dynamicAnchors,names_1$8.default.dynamicAnchors]);const m=(0,codegen_1$u._)`${u}, ${n.object(...f)}`;return c!==codegen_1$u.nil?(0,codegen_1$u._)`${l}.call(${c}, ${m})`:(0,codegen_1$u._)`${l}(${m})`}code.callValidateCode=callValidateCode;const newRegExp=(0,codegen_1$u._)`new RegExp`;function usePattern({gen:r,it:{opts:e}},n){const a=e.unicodeRegExp?"u":"",{regExp:i}=e.code,s=i(n,a);return r.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,codegen_1$u._)`${i.code==="new RegExp"?newRegExp:(0,util_2$1.useFunc)(r,i)}(${n}, ${a})`})}code.usePattern=usePattern;function validateArray(r){const{gen:e,data:n,keyword:a,it:i}=r,s=e.name("valid");if(i.allErrors){const l=e.let("valid",!0);return o(()=>e.assign(l,!1)),l}return e.var(s,!0),o(()=>e.break()),s;function o(l){const c=e.const("len",(0,codegen_1$u._)`${n}.length`);e.forRange("i",0,c,d=>{r.subschema({keyword:a,dataProp:d,dataPropType:util_1$s.Type.Num},s),e.if((0,codegen_1$u.not)(s),l)})}}code.validateArray=validateArray;function validateUnion(r){const{gen:e,schema:n,keyword:a,it:i}=r;if(!Array.isArray(n))throw new Error("ajv implementation error");if(n.some(c=>(0,util_1$s.alwaysValidSchema)(i,c))&&!i.opts.unevaluated)return;const o=e.let("valid",!1),l=e.name("_valid");e.block(()=>n.forEach((c,d)=>{const u=r.subschema({keyword:a,schemaProp:d,compositeRule:!0},l);e.assign(o,(0,codegen_1$u._)`${o} || ${l}`),r.mergeValidEvaluated(u,l)||e.if((0,codegen_1$u.not)(o))})),r.result(o,()=>r.reset(),()=>r.error(!0))}code.validateUnion=validateUnion;Object.defineProperty(keyword,"__esModule",{value:!0});keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$t=codegen,names_1$7=names$1,code_1$9=code,errors_1$1=errors;function macroKeywordCode(r,e){const{gen:n,keyword:a,schema:i,parentSchema:s,it:o}=r,l=e.macro.call(o.self,i,s,o),c=useKeyword(n,a,l);o.opts.validateSchema!==!1&&o.self.validateSchema(l,!0);const d=n.name("valid");r.subschema({schema:l,schemaPath:codegen_1$t.nil,errSchemaPath:`${o.errSchemaPath}/${a}`,topSchemaRef:c,compositeRule:!0},d),r.pass(d,()=>r.error(!0))}keyword.macroKeywordCode=macroKeywordCode;function funcKeywordCode(r,e){var n;const{gen:a,keyword:i,schema:s,parentSchema:o,$data:l,it:c}=r;checkAsyncKeyword(c,e);const d=!l&&e.compile?e.compile.call(c.self,s,o,c):e.validate,u=useKeyword(a,i,d),f=a.let("valid");r.block$data(f,m),r.ok((n=e.valid)!==null&&n!==void 0?n:f);function m(){if(e.errors===!1)$(),e.modifying&&modifyData(r),_(()=>r.error());else{const p=e.async?h():w();e.modifying&&modifyData(r),_(()=>addErrs(r,p))}}function h(){const p=a.let("ruleErrs",null);return a.try(()=>$((0,codegen_1$t._)`await `),b=>a.assign(f,!1).if((0,codegen_1$t._)`${b} instanceof ${c.ValidationError}`,()=>a.assign(p,(0,codegen_1$t._)`${b}.errors`),()=>a.throw(b))),p}function w(){const p=(0,codegen_1$t._)`${u}.errors`;return a.assign(p,null),$(codegen_1$t.nil),p}function $(p=e.async?(0,codegen_1$t._)`await `:codegen_1$t.nil){const b=c.opts.passContext?names_1$7.default.this:names_1$7.default.self,v=!("compile"in e&&!l||e.schema===!1);a.assign(f,(0,codegen_1$t._)`${p}${(0,code_1$9.callValidateCode)(r,u,b,v)}`,e.modifying)}function _(p){var b;a.if((0,codegen_1$t.not)((b=e.valid)!==null&&b!==void 0?b:f),p)}}keyword.funcKeywordCode=funcKeywordCode;function modifyData(r){const{gen:e,data:n,it:a}=r;e.if(a.parentData,()=>e.assign(n,(0,codegen_1$t._)`${a.parentData}[${a.parentDataProperty}]`))}function addErrs(r,e){const{gen:n}=r;n.if((0,codegen_1$t._)`Array.isArray(${e})`,()=>{n.assign(names_1$7.default.vErrors,(0,codegen_1$t._)`${names_1$7.default.vErrors} === null ? ${e} : ${names_1$7.default.vErrors}.concat(${e})`).assign(names_1$7.default.errors,(0,codegen_1$t._)`${names_1$7.default.vErrors}.length`),(0,errors_1$1.extendErrors)(r)},()=>r.error())}function checkAsyncKeyword({schemaEnv:r},e){if(e.async&&!r.$async)throw new Error("async keyword in sync schema")}function useKeyword(r,e,n){if(n===void 0)throw new Error(`keyword "${e}" failed to compile`);return r.scopeValue("keyword",typeof n=="function"?{ref:n}:{ref:n,code:(0,codegen_1$t.stringify)(n)})}function validSchemaType(r,e,n=!1){return!e.length||e.some(a=>a==="array"?Array.isArray(r):a==="object"?r&&typeof r=="object"&&!Array.isArray(r):typeof r==a||n&&typeof r>"u")}keyword.validSchemaType=validSchemaType;function validateKeywordUsage({schema:r,opts:e,self:n,errSchemaPath:a},i,s){if(Array.isArray(i.keyword)?!i.keyword.includes(s):i.keyword!==s)throw new Error("ajv implementation error");const o=i.dependencies;if(o!=null&&o.some(l=>!Object.prototype.hasOwnProperty.call(r,l)))throw new Error(`parent schema must have dependencies of ${s}: ${o.join(",")}`);if(i.validateSchema&&!i.validateSchema(r[s])){const c=`keyword "${s}" value is invalid at path "${a}": `+n.errorsText(i.validateSchema.errors);if(e.validateSchema==="log")n.logger.error(c);else throw new Error(c)}}keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0});subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$s=codegen,util_1$r=util;function getSubschema(r,{keyword:e,schemaProp:n,schema:a,schemaPath:i,errSchemaPath:s,topSchemaRef:o}){if(e!==void 0&&a!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const l=r.schema[e];return n===void 0?{schema:l,schemaPath:(0,codegen_1$s._)`${r.schemaPath}${(0,codegen_1$s.getProperty)(e)}`,errSchemaPath:`${r.errSchemaPath}/${e}`}:{schema:l[n],schemaPath:(0,codegen_1$s._)`${r.schemaPath}${(0,codegen_1$s.getProperty)(e)}${(0,codegen_1$s.getProperty)(n)}`,errSchemaPath:`${r.errSchemaPath}/${e}/${(0,util_1$r.escapeFragment)(n)}`}}if(a!==void 0){if(i===void 0||s===void 0||o===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:a,schemaPath:i,topSchemaRef:o,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=getSubschema;function extendSubschemaData(r,e,{dataProp:n,dataPropType:a,data:i,dataTypes:s,propertyName:o}){if(i!==void 0&&n!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:l}=e;if(n!==void 0){const{errorPath:d,dataPathArr:u,opts:f}=e,m=l.let("data",(0,codegen_1$s._)`${e.data}${(0,codegen_1$s.getProperty)(n)}`,!0);c(m),r.errorPath=(0,codegen_1$s.str)`${d}${(0,util_1$r.getErrorPath)(n,a,f.jsPropertySyntax)}`,r.parentDataProperty=(0,codegen_1$s._)`${n}`,r.dataPathArr=[...u,r.parentDataProperty]}if(i!==void 0){const d=i instanceof codegen_1$s.Name?i:l.let("data",i,!0);c(d),o!==void 0&&(r.propertyName=o)}s&&(r.dataTypes=s);function c(d){r.data=d,r.dataLevel=e.dataLevel+1,r.dataTypes=[],e.definedProperties=new Set,r.parentData=e.data,r.dataNames=[...e.dataNames,d]}}subschema.extendSubschemaData=extendSubschemaData;function extendSubschemaMode(r,{jtdDiscriminator:e,jtdMetadata:n,compositeRule:a,createErrors:i,allErrors:s}){a!==void 0&&(r.compositeRule=a),i!==void 0&&(r.createErrors=i),s!==void 0&&(r.allErrors=s),r.jtdDiscriminator=e,r.jtdMetadata=n}subschema.extendSubschemaMode=extendSubschemaMode;var resolve$2={},fastDeepEqual=function r(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var a,i,s;if(Array.isArray(e)){if(a=e.length,a!=n.length)return!1;for(i=a;i--!==0;)if(!r(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),a=s.length,a!==Object.keys(n).length)return!1;for(i=a;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=a;i--!==0;){var o=s[i];if(!r(e[o],n[o]))return!1}return!0}return e!==e&&n!==n},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function(r,e,n){typeof e=="function"&&(n=e,e={}),n=e.cb||n;var a=typeof n=="function"?n:n.pre||function(){},i=n.post||function(){};_traverse(e,a,i,r,"",r)};traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function _traverse(r,e,n,a,i,s,o,l,c,d){if(a&&typeof a=="object"&&!Array.isArray(a)){e(a,i,s,o,l,c,d);for(var u in a){var f=a[u];if(Array.isArray(f)){if(u in traverse$1.arrayKeywords)for(var m=0;m<f.length;m++)_traverse(r,e,n,f[m],i+"/"+u+"/"+m,s,i,u,a,m)}else if(u in traverse$1.propsKeywords){if(f&&typeof f=="object")for(var h in f)_traverse(r,e,n,f[h],i+"/"+u+"/"+escapeJsonPtr(h),s,i,u,a,h)}else(u in traverse$1.keywords||r.allKeys&&!(u in traverse$1.skipKeywords))&&_traverse(r,e,n,f,i+"/"+u,s,i,u,a)}n(a,i,s,o,l,c,d)}}function escapeJsonPtr(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var jsonSchemaTraverseExports=jsonSchemaTraverse.exports;Object.defineProperty(resolve$2,"__esModule",{value:!0});resolve$2.getSchemaRefs=resolve$2.resolveUrl=resolve$2.normalizeId=resolve$2._getFullPath=resolve$2.getFullPath=resolve$2.inlineRef=void 0;const util_1$q=util,equal$3=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(r,e=!0){return typeof r=="boolean"?!0:e===!0?!hasRef(r):e?countKeys(r)<=e:!1}resolve$2.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(r){for(const e in r){if(REF_KEYWORDS.has(e))return!0;const n=r[e];if(Array.isArray(n)&&n.some(hasRef)||typeof n=="object"&&hasRef(n))return!0}return!1}function countKeys(r){let e=0;for(const n in r){if(n==="$ref")return 1/0;if(e++,!SIMPLE_INLINED.has(n)&&(typeof r[n]=="object"&&(0,util_1$q.eachItem)(r[n],a=>e+=countKeys(a)),e===1/0))return 1/0}return e}function getFullPath(r,e="",n){n!==!1&&(e=normalizeId(e));const a=r.parse(e);return _getFullPath(r,a)}resolve$2.getFullPath=getFullPath;function _getFullPath(r,e){return r.serialize(e).split("#")[0]+"#"}resolve$2._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(r){return r?r.replace(TRAILING_SLASH_HASH,""):""}resolve$2.normalizeId=normalizeId;function resolveUrl(r,e,n){return n=normalizeId(n),r.resolve(e,n)}resolve$2.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(r,e){if(typeof r=="boolean")return{};const{schemaId:n,uriResolver:a}=this.opts,i=normalizeId(r[n]||e),s={"":i},o=getFullPath(a,i,!1),l={},c=new Set;return traverse(r,{allKeys:!0},(f,m,h,w)=>{if(w===void 0)return;const $=o+m;let _=s[w];typeof f[n]=="string"&&(_=p.call(this,f[n])),b.call(this,f.$anchor),b.call(this,f.$dynamicAnchor),s[m]=_;function p(v){const j=this.opts.uriResolver.resolve;if(v=normalizeId(_?j(_,v):v),c.has(v))throw u(v);c.add(v);let U=this.refs[v];return typeof U=="string"&&(U=this.refs[U]),typeof U=="object"?d(f,U.schema,v):v!==normalizeId($)&&(v[0]==="#"?(d(f,l[v],v),l[v]=f):this.refs[v]=$),v}function b(v){if(typeof v=="string"){if(!ANCHOR.test(v))throw new Error(`invalid anchor "${v}"`);p.call(this,`#${v}`)}}}),l;function d(f,m,h){if(m!==void 0&&!equal$3(f,m))throw u(h)}function u(f){return new Error(`reference "${f}" resolves to more than one schema`)}}resolve$2.getSchemaRefs=getSchemaRefs;Object.defineProperty(validate,"__esModule",{value:!0});validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$r=codegen,names_1$6=names$1,resolve_1$2=resolve$2,util_1$p=util,errors_1=errors;function validateFunctionCode(r){if(isSchemaObj(r)&&(checkKeywords(r),schemaCxtHasRules(r))){topSchemaObjCode(r);return}validateFunction(r,()=>(0,boolSchema_1.topBoolOrEmptySchema)(r))}validate.validateFunctionCode=validateFunctionCode;function validateFunction({gen:r,validateName:e,schema:n,schemaEnv:a,opts:i},s){i.code.es5?r.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${names_1$6.default.valCxt}`,a.$async,()=>{r.code((0,codegen_1$r._)`"use strict"; ${funcSourceUrl(n,i)}`),destructureValCxtES5(r,i),r.code(s)}):r.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${destructureValCxt(i)}`,a.$async,()=>r.code(funcSourceUrl(n,i)).code(s))}function destructureValCxt(r){return(0,codegen_1$r._)`{${names_1$6.default.instancePath}="", ${names_1$6.default.parentData}, ${names_1$6.default.parentDataProperty}, ${names_1$6.default.rootData}=${names_1$6.default.data}${r.dynamicRef?(0,codegen_1$r._)`, ${names_1$6.default.dynamicAnchors}={}`:codegen_1$r.nil}}={}`}function destructureValCxtES5(r,e){r.if(names_1$6.default.valCxt,()=>{r.var(names_1$6.default.instancePath,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.instancePath}`),r.var(names_1$6.default.parentData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentData}`),r.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentDataProperty}`),r.var(names_1$6.default.rootData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.rootData}`),e.dynamicRef&&r.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.dynamicAnchors}`)},()=>{r.var(names_1$6.default.instancePath,(0,codegen_1$r._)`""`),r.var(names_1$6.default.parentData,(0,codegen_1$r._)`undefined`),r.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`undefined`),r.var(names_1$6.default.rootData,names_1$6.default.data),e.dynamicRef&&r.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`{}`)})}function topSchemaObjCode(r){const{schema:e,opts:n,gen:a}=r;validateFunction(r,()=>{n.$comment&&e.$comment&&commentKeyword(r),checkNoDefault(r),a.let(names_1$6.default.vErrors,null),a.let(names_1$6.default.errors,0),n.unevaluated&&resetEvaluated(r),typeAndKeywords(r),returnResults(r)})}function resetEvaluated(r){const{gen:e,validateName:n}=r;r.evaluated=e.const("evaluated",(0,codegen_1$r._)`${n}.evaluated`),e.if((0,codegen_1$r._)`${r.evaluated}.dynamicProps`,()=>e.assign((0,codegen_1$r._)`${r.evaluated}.props`,(0,codegen_1$r._)`undefined`)),e.if((0,codegen_1$r._)`${r.evaluated}.dynamicItems`,()=>e.assign((0,codegen_1$r._)`${r.evaluated}.items`,(0,codegen_1$r._)`undefined`))}function funcSourceUrl(r,e){const n=typeof r=="object"&&r[e.schemaId];return n&&(e.code.source||e.code.process)?(0,codegen_1$r._)`/*# sourceURL=${n} */`:codegen_1$r.nil}function subschemaCode(r,e){if(isSchemaObj(r)&&(checkKeywords(r),schemaCxtHasRules(r))){subSchemaObjCode(r,e);return}(0,boolSchema_1.boolOrEmptySchema)(r,e)}function schemaCxtHasRules({schema:r,self:e}){if(typeof r=="boolean")return!r;for(const n in r)if(e.RULES.all[n])return!0;return!1}function isSchemaObj(r){return typeof r.schema!="boolean"}function subSchemaObjCode(r,e){const{schema:n,gen:a,opts:i}=r;i.$comment&&n.$comment&&commentKeyword(r),updateContext(r),checkAsyncSchema(r);const s=a.const("_errs",names_1$6.default.errors);typeAndKeywords(r,s),a.var(e,(0,codegen_1$r._)`${s} === ${names_1$6.default.errors}`)}function checkKeywords(r){(0,util_1$p.checkUnknownRules)(r),checkRefsAndKeywords(r)}function typeAndKeywords(r,e){if(r.opts.jtd)return schemaKeywords(r,[],!1,e);const n=(0,dataType_1$1.getSchemaTypes)(r.schema),a=(0,dataType_1$1.coerceAndCheckDataType)(r,n);schemaKeywords(r,n,!a,e)}function checkRefsAndKeywords(r){const{schema:e,errSchemaPath:n,opts:a,self:i}=r;e.$ref&&a.ignoreKeywordsWithRef&&(0,util_1$p.schemaHasRulesButRef)(e,i.RULES)&&i.logger.warn(`$ref: keywords ignored in schema at path "${n}"`)}function checkNoDefault(r){const{schema:e,opts:n}=r;e.default!==void 0&&n.useDefaults&&n.strictSchema&&(0,util_1$p.checkStrictMode)(r,"default is ignored in the schema root")}function updateContext(r){const e=r.schema[r.opts.schemaId];e&&(r.baseId=(0,resolve_1$2.resolveUrl)(r.opts.uriResolver,r.baseId,e))}function checkAsyncSchema(r){if(r.schema.$async&&!r.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:r,schemaEnv:e,schema:n,errSchemaPath:a,opts:i}){const s=n.$comment;if(i.$comment===!0)r.code((0,codegen_1$r._)`${names_1$6.default.self}.logger.log(${s})`);else if(typeof i.$comment=="function"){const o=(0,codegen_1$r.str)`${a}/$comment`,l=r.scopeValue("root",{ref:e.root});r.code((0,codegen_1$r._)`${names_1$6.default.self}.opts.$comment(${s}, ${o}, ${l}.schema)`)}}function returnResults(r){const{gen:e,schemaEnv:n,validateName:a,ValidationError:i,opts:s}=r;n.$async?e.if((0,codegen_1$r._)`${names_1$6.default.errors} === 0`,()=>e.return(names_1$6.default.data),()=>e.throw((0,codegen_1$r._)`new ${i}(${names_1$6.default.vErrors})`)):(e.assign((0,codegen_1$r._)`${a}.errors`,names_1$6.default.vErrors),s.unevaluated&&assignEvaluated(r),e.return((0,codegen_1$r._)`${names_1$6.default.errors} === 0`))}function assignEvaluated({gen:r,evaluated:e,props:n,items:a}){n instanceof codegen_1$r.Name&&r.assign((0,codegen_1$r._)`${e}.props`,n),a instanceof codegen_1$r.Name&&r.assign((0,codegen_1$r._)`${e}.items`,a)}function schemaKeywords(r,e,n,a){const{gen:i,schema:s,data:o,allErrors:l,opts:c,self:d}=r,{RULES:u}=d;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,util_1$p.schemaHasRulesButRef)(s,u))){i.block(()=>keywordCode(r,"$ref",u.all.$ref.definition));return}c.jtd||checkStrictTypes(r,e),i.block(()=>{for(const m of u.rules)f(m);f(u.post)});function f(m){(0,applicability_1.shouldUseGroup)(s,m)&&(m.type?(i.if((0,dataType_2.checkDataType)(m.type,o,c.strictNumbers)),iterateKeywords(r,m),e.length===1&&e[0]===m.type&&n&&(i.else(),(0,dataType_2.reportTypeError)(r)),i.endIf()):iterateKeywords(r,m),l||i.if((0,codegen_1$r._)`${names_1$6.default.errors} === ${a||0}`))}}function iterateKeywords(r,e){const{gen:n,schema:a,opts:{useDefaults:i}}=r;i&&(0,defaults_1.assignDefaults)(r,e.type),n.block(()=>{for(const s of e.rules)(0,applicability_1.shouldUseRule)(a,s)&&keywordCode(r,s.keyword,s.definition,e.type)})}function checkStrictTypes(r,e){r.schemaEnv.meta||!r.opts.strictTypes||(checkContextTypes(r,e),r.opts.allowUnionTypes||checkMultipleTypes(r,e),checkKeywordTypes(r,r.dataTypes))}function checkContextTypes(r,e){if(e.length){if(!r.dataTypes.length){r.dataTypes=e;return}e.forEach(n=>{includesType(r.dataTypes,n)||strictTypesError(r,`type "${n}" not allowed by context "${r.dataTypes.join(",")}"`)}),narrowSchemaTypes(r,e)}}function checkMultipleTypes(r,e){e.length>1&&!(e.length===2&&e.includes("null"))&&strictTypesError(r,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(r,e){const n=r.self.RULES.all;for(const a in n){const i=n[a];if(typeof i=="object"&&(0,applicability_1.shouldUseRule)(r.schema,i)){const{type:s}=i.definition;s.length&&!s.some(o=>hasApplicableType(e,o))&&strictTypesError(r,`missing type "${s.join(",")}" for keyword "${a}"`)}}}function hasApplicableType(r,e){return r.includes(e)||e==="number"&&r.includes("integer")}function includesType(r,e){return r.includes(e)||e==="integer"&&r.includes("number")}function narrowSchemaTypes(r,e){const n=[];for(const a of r.dataTypes)includesType(e,a)?n.push(a):e.includes("integer")&&a==="number"&&n.push("integer");r.dataTypes=n}function strictTypesError(r,e){const n=r.schemaEnv.baseId+r.errSchemaPath;e+=` at "${n}" (strictTypes)`,(0,util_1$p.checkStrictMode)(r,e,r.opts.strictTypes)}class KeywordCxt{constructor(e,n,a){if((0,keyword_1.validateKeywordUsage)(e,n,a),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=a,this.data=e.data,this.schema=e.schema[a],this.$data=n.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$p.schemaRefOrVal)(e,this.schema,a,this.$data),this.schemaType=n.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=n,this.$data)this.schemaCode=e.gen.const("vSchema",getData(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,n.schemaType,n.allowUndefined))throw new Error(`${a} value must be ${JSON.stringify(n.schemaType)}`);("code"in n?n.trackErrors:n.errors!==!1)&&(this.errsCount=e.gen.const("_errs",names_1$6.default.errors))}result(e,n,a){this.failResult((0,codegen_1$r.not)(e),n,a)}failResult(e,n,a){this.gen.if(e),a?a():this.error(),n?(this.gen.else(),n(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,n){this.failResult((0,codegen_1$r.not)(e),void 0,n)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:n}=this;this.fail((0,codegen_1$r._)`${n} !== undefined && (${(0,codegen_1$r.or)(this.invalid$data(),e)})`)}error(e,n,a){if(n){this.setParams(n),this._error(e,a),this.setParams({});return}this._error(e,a)}_error(e,n){(e?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,n)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,n){n?Object.assign(this.params,e):this.params=e}block$data(e,n,a=codegen_1$r.nil){this.gen.block(()=>{this.check$data(e,a),n()})}check$data(e=codegen_1$r.nil,n=codegen_1$r.nil){if(!this.$data)return;const{gen:a,schemaCode:i,schemaType:s,def:o}=this;a.if((0,codegen_1$r.or)((0,codegen_1$r._)`${i} === undefined`,n)),e!==codegen_1$r.nil&&a.assign(e,!0),(s.length||o.validateSchema)&&(a.elseIf(this.invalid$data()),this.$dataError(),e!==codegen_1$r.nil&&a.assign(e,!1)),a.else()}invalid$data(){const{gen:e,schemaCode:n,schemaType:a,def:i,it:s}=this;return(0,codegen_1$r.or)(o(),l());function o(){if(a.length){if(!(n instanceof codegen_1$r.Name))throw new Error("ajv implementation error");const c=Array.isArray(a)?a:[a];return(0,codegen_1$r._)`${(0,dataType_2.checkDataTypes)(c,n,s.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$r.nil}function l(){if(i.validateSchema){const c=e.scopeValue("validate$data",{ref:i.validateSchema});return(0,codegen_1$r._)`!${c}(${n})`}return codegen_1$r.nil}}subschema(e,n){const a=(0,subschema_1.getSubschema)(this.it,e);(0,subschema_1.extendSubschemaData)(a,this.it,e),(0,subschema_1.extendSubschemaMode)(a,e);const i={...this.it,...a,items:void 0,props:void 0};return subschemaCode(i,n),i}mergeEvaluated(e,n){const{it:a,gen:i}=this;a.opts.unevaluated&&(a.props!==!0&&e.props!==void 0&&(a.props=util_1$p.mergeEvaluated.props(i,e.props,a.props,n)),a.items!==!0&&e.items!==void 0&&(a.items=util_1$p.mergeEvaluated.items(i,e.items,a.items,n)))}mergeValidEvaluated(e,n){const{it:a,gen:i}=this;if(a.opts.unevaluated&&(a.props!==!0||a.items!==!0))return i.if(n,()=>this.mergeEvaluated(e,codegen_1$r.Name)),!0}}validate.KeywordCxt=KeywordCxt;function keywordCode(r,e,n,a){const i=new KeywordCxt(r,n,e);"code"in n?n.code(i,a):i.$data&&n.validate?(0,keyword_1.funcKeywordCode)(i,n):"macro"in n?(0,keyword_1.macroKeywordCode)(i,n):(n.compile||n.validate)&&(0,keyword_1.funcKeywordCode)(i,n)}const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(r,{dataLevel:e,dataNames:n,dataPathArr:a}){let i,s;if(r==="")return names_1$6.default.rootData;if(r[0]==="/"){if(!JSON_POINTER.test(r))throw new Error(`Invalid JSON-pointer: ${r}`);i=r,s=names_1$6.default.rootData}else{const d=RELATIVE_JSON_POINTER.exec(r);if(!d)throw new Error(`Invalid JSON-pointer: ${r}`);const u=+d[1];if(i=d[2],i==="#"){if(u>=e)throw new Error(c("property/index",u));return a[e-u]}if(u>e)throw new Error(c("data",u));if(s=n[e-u],!i)return s}let o=s;const l=i.split("/");for(const d of l)d&&(s=(0,codegen_1$r._)`${s}${(0,codegen_1$r.getProperty)((0,util_1$p.unescapeJsonPointer)(d))}`,o=(0,codegen_1$r._)`${o} && ${s}`);return o;function c(d,u){return`Cannot access ${d} ${u} levels up, current level is ${e}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$2;class MissingRefError extends Error{constructor(e,n,a,i){super(i||`can't resolve reference ${a} from id ${n}`),this.missingRef=(0,resolve_1$1.resolveUrl)(e,n,a),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(e,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0});compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$q=codegen,validation_error_1=validation_error,names_1$5=names$1,resolve_1=resolve$2,util_1$o=util,validate_1$1=validate;class SchemaEnv{constructor(e){var n;this.refs={},this.dynamicAnchors={};let a;typeof e.schema=="object"&&(a=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(n=e.baseId)!==null&&n!==void 0?n:(0,resolve_1.normalizeId)(a==null?void 0:a[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=a==null?void 0:a.$async,this.refs={}}}compile.SchemaEnv=SchemaEnv;function compileSchema(r){const e=getCompilingSchema.call(this,r);if(e)return e;const n=(0,resolve_1.getFullPath)(this.opts.uriResolver,r.root.baseId),{es5:a,lines:i}=this.opts.code,{ownProperties:s}=this.opts,o=new codegen_1$q.CodeGen(this.scope,{es5:a,lines:i,ownProperties:s});let l;r.$async&&(l=o.scopeValue("Error",{ref:validation_error_1.default,code:(0,codegen_1$q._)`require("ajv/dist/runtime/validation_error").default`}));const c=o.scopeName("validate");r.validateName=c;const d={gen:o,allErrors:this.opts.allErrors,data:names_1$5.default.data,parentData:names_1$5.default.parentData,parentDataProperty:names_1$5.default.parentDataProperty,dataNames:[names_1$5.default.data],dataPathArr:[codegen_1$q.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:o.scopeValue("schema",this.opts.code.source===!0?{ref:r.schema,code:(0,codegen_1$q.stringify)(r.schema)}:{ref:r.schema}),validateName:c,ValidationError:l,schema:r.schema,schemaEnv:r,rootId:n,baseId:r.baseId||n,schemaPath:codegen_1$q.nil,errSchemaPath:r.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,codegen_1$q._)`""`,opts:this.opts,self:this};let u;try{this._compilations.add(r),(0,validate_1$1.validateFunctionCode)(d),o.optimize(this.opts.code.optimize);const f=o.toString();u=`${o.scopeRefs(names_1$5.default.scope)}return ${f}`,this.opts.code.process&&(u=this.opts.code.process(u,r));const h=new Function(`${names_1$5.default.self}`,`${names_1$5.default.scope}`,u)(this,this.scope.get());if(this.scope.value(c,{ref:h}),h.errors=null,h.schema=r.schema,h.schemaEnv=r,r.$async&&(h.$async=!0),this.opts.code.source===!0&&(h.source={validateName:c,validateCode:f,scopeValues:o._values}),this.opts.unevaluated){const{props:w,items:$}=d;h.evaluated={props:w instanceof codegen_1$q.Name?void 0:w,items:$ instanceof codegen_1$q.Name?void 0:$,dynamicProps:w instanceof codegen_1$q.Name,dynamicItems:$ instanceof codegen_1$q.Name},h.source&&(h.source.evaluated=(0,codegen_1$q.stringify)(h.evaluated))}return r.validate=h,r}catch(f){throw delete r.validate,delete r.validateName,u&&this.logger.error("Error compiling schema, function code:",u),f}finally{this._compilations.delete(r)}}compile.compileSchema=compileSchema;function resolveRef(r,e,n){var a;n=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,n);const i=r.refs[n];if(i)return i;let s=resolve$1.call(this,r,n);if(s===void 0){const o=(a=r.localRefs)===null||a===void 0?void 0:a[n],{schemaId:l}=this.opts;o&&(s=new SchemaEnv({schema:o,schemaId:l,root:r,baseId:e}))}if(s!==void 0)return r.refs[n]=inlineOrCompile.call(this,s)}compile.resolveRef=resolveRef;function inlineOrCompile(r){return(0,resolve_1.inlineRef)(r.schema,this.opts.inlineRefs)?r.schema:r.validate?r:compileSchema.call(this,r)}function getCompilingSchema(r){for(const e of this._compilations)if(sameSchemaEnv(e,r))return e}compile.getCompilingSchema=getCompilingSchema;function sameSchemaEnv(r,e){return r.schema===e.schema&&r.root===e.root&&r.baseId===e.baseId}function resolve$1(r,e){let n;for(;typeof(n=this.refs[e])=="string";)e=n;return n||this.schemas[e]||resolveSchema.call(this,r,e)}function resolveSchema(r,e){const n=this.opts.uriResolver.parse(e),a=(0,resolve_1._getFullPath)(this.opts.uriResolver,n);let i=(0,resolve_1.getFullPath)(this.opts.uriResolver,r.baseId,void 0);if(Object.keys(r.schema).length>0&&a===i)return getJsonPointer.call(this,n,r);const s=(0,resolve_1.normalizeId)(a),o=this.refs[s]||this.schemas[s];if(typeof o=="string"){const l=resolveSchema.call(this,r,o);return typeof(l==null?void 0:l.schema)!="object"?void 0:getJsonPointer.call(this,n,l)}if(typeof(o==null?void 0:o.schema)=="object"){if(o.validate||compileSchema.call(this,o),s===(0,resolve_1.normalizeId)(e)){const{schema:l}=o,{schemaId:c}=this.opts,d=l[c];return d&&(i=(0,resolve_1.resolveUrl)(this.opts.uriResolver,i,d)),new SchemaEnv({schema:l,schemaId:c,root:r,baseId:i})}return getJsonPointer.call(this,n,o)}}compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(r,{baseId:e,schema:n,root:a}){var i;if(((i=r.fragment)===null||i===void 0?void 0:i[0])!=="/")return;for(const l of r.fragment.slice(1).split("/")){if(typeof n=="boolean")return;const c=n[(0,util_1$o.unescapeFragment)(l)];if(c===void 0)return;n=c;const d=typeof n=="object"&&n[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(l)&&d&&(e=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,d))}let s;if(typeof n!="boolean"&&n.$ref&&!(0,util_1$o.schemaHasRulesButRef)(n,this.RULES)){const l=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,n.$ref);s=resolveSchema.call(this,a,l)}const{schemaId:o}=this.opts;if(s=s||new SchemaEnv({schema:n,schemaId:o,root:a,baseId:e}),s.schema!==s.root.schema)return s}const $id$9="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$9="object",required$1=["$data"],properties$a={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$9,description,type:type$9,required:required$1,properties:properties$a,additionalProperties:additionalProperties$1};var uri$1={},fastUri$1={exports:{}};const HEX$1={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};var scopedChars={HEX:HEX$1};const{HEX}=scopedChars,IPV4_REG=/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u;function normalizeIPv4$1(r){if(findToken(r,".")<3)return{host:r,isIPV4:!1};const e=r.match(IPV4_REG)||[],[n]=e;return n?{host:stripLeadingZeros(n,"."),isIPV4:!0}:{host:r,isIPV4:!1}}function stringArrayToHexStripped(r,e=!1){let n="",a=!0;for(const i of r){if(HEX[i]===void 0)return;i!=="0"&&a===!0&&(a=!1),a||(n+=i)}return e&&n.length===0&&(n="0"),n}function getIPV6(r){let e=0;const n={error:!1,address:"",zone:""},a=[],i=[];let s=!1,o=!1,l=!1;function c(){if(i.length){if(s===!1){const d=stringArrayToHexStripped(i);if(d!==void 0)a.push(d);else return n.error=!0,!1}i.length=0}return!0}for(let d=0;d<r.length;d++){const u=r[d];if(!(u==="["||u==="]"))if(u===":"){if(o===!0&&(l=!0),!c())break;if(e++,a.push(":"),e>7){n.error=!0;break}d-1>=0&&r[d-1]===":"&&(o=!0);continue}else if(u==="%"){if(!c())break;s=!0}else{i.push(u);continue}}return i.length&&(s?n.zone=i.join(""):l?a.push(i.join("")):a.push(stringArrayToHexStripped(i))),n.address=a.join(""),n}function normalizeIPv6$1(r){if(findToken(r,":")<2)return{host:r,isIPV6:!1};const e=getIPV6(r);if(e.error)return{host:r,isIPV6:!1};{let n=e.address,a=e.address;return e.zone&&(n+="%"+e.zone,a+="%25"+e.zone),{host:n,escapedHost:a,isIPV6:!0}}}function stripLeadingZeros(r,e){let n="",a=!0;const i=r.length;for(let s=0;s<i;s++){const o=r[s];o==="0"&&a?(s+1<=i&&r[s+1]===e||s+1===i)&&(n+=o,a=!1):(o===e?a=!0:a=!1,n+=o)}return n}function findToken(r,e){let n=0;for(let a=0;a<r.length;a++)r[a]===e&&n++;return n}const RDS1=/^\.\.?\//u,RDS2=/^\/\.(?:\/|$)/u,RDS3=/^\/\.\.(?:\/|$)/u,RDS5=/^\/?(?:.|\n)*?(?=\/|$)/u;function removeDotSegments$1(r){const e=[];for(;r.length;)if(r.match(RDS1))r=r.replace(RDS1,"");else if(r.match(RDS2))r=r.replace(RDS2,"/");else if(r.match(RDS3))r=r.replace(RDS3,"/"),e.pop();else if(r==="."||r==="..")r="";else{const n=r.match(RDS5);if(n){const a=n[0];r=r.slice(a.length),e.push(a)}else throw new Error("Unexpected dot segment condition")}return e.join("")}function normalizeComponentEncoding$1(r,e){const n=e!==!0?escape:unescape;return r.scheme!==void 0&&(r.scheme=n(r.scheme)),r.userinfo!==void 0&&(r.userinfo=n(r.userinfo)),r.host!==void 0&&(r.host=n(r.host)),r.path!==void 0&&(r.path=n(r.path)),r.query!==void 0&&(r.query=n(r.query)),r.fragment!==void 0&&(r.fragment=n(r.fragment)),r}function recomposeAuthority$1(r){const e=[];if(r.userinfo!==void 0&&(e.push(r.userinfo),e.push("@")),r.host!==void 0){let n=unescape(r.host);const a=normalizeIPv4$1(n);if(a.isIPV4)n=a.host;else{const i=normalizeIPv6$1(a.host);i.isIPV6===!0?n=`[${i.escapedHost}]`:n=r.host}e.push(n)}return(typeof r.port=="number"||typeof r.port=="string")&&(e.push(":"),e.push(String(r.port))),e.length?e.join(""):void 0}var utils={recomposeAuthority:recomposeAuthority$1,normalizeComponentEncoding:normalizeComponentEncoding$1,removeDotSegments:removeDotSegments$1,normalizeIPv4:normalizeIPv4$1,normalizeIPv6:normalizeIPv6$1};const UUID_REG=/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu,URN_REG=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu;function isSecure(r){return typeof r.secure=="boolean"?r.secure:String(r.scheme).toLowerCase()==="wss"}function httpParse(r){return r.host||(r.error=r.error||"HTTP URIs must have a host."),r}function httpSerialize(r){const e=String(r.scheme).toLowerCase()==="https";return(r.port===(e?443:80)||r.port==="")&&(r.port=void 0),r.path||(r.path="/"),r}function wsParse(r){return r.secure=isSecure(r),r.resourceName=(r.path||"/")+(r.query?"?"+r.query:""),r.path=void 0,r.query=void 0,r}function wsSerialize(r){if((r.port===(isSecure(r)?443:80)||r.port==="")&&(r.port=void 0),typeof r.secure=="boolean"&&(r.scheme=r.secure?"wss":"ws",r.secure=void 0),r.resourceName){const[e,n]=r.resourceName.split("?");r.path=e&&e!=="/"?e:void 0,r.query=n,r.resourceName=void 0}return r.fragment=void 0,r}function urnParse(r,e){if(!r.path)return r.error="URN can not be parsed",r;const n=r.path.match(URN_REG);if(n){const a=e.scheme||r.scheme||"urn";r.nid=n[1].toLowerCase(),r.nss=n[2];const i=`${a}:${e.nid||r.nid}`,s=SCHEMES$1[i];r.path=void 0,s&&(r=s.parse(r,e))}else r.error=r.error||"URN can not be parsed.";return r}function urnSerialize(r,e){const n=e.scheme||r.scheme||"urn",a=r.nid.toLowerCase(),i=`${n}:${e.nid||a}`,s=SCHEMES$1[i];s&&(r=s.serialize(r,e));const o=r,l=r.nss;return o.path=`${a||e.nid}:${l}`,e.skipEscape=!0,o}function urnuuidParse(r,e){const n=r;return n.uuid=n.nss,n.nss=void 0,!e.tolerant&&(!n.uuid||!UUID_REG.test(n.uuid))&&(n.error=n.error||"UUID is not valid."),n}function urnuuidSerialize(r){const e=r;return e.nss=(r.uuid||"").toLowerCase(),e}const http={scheme:"http",domainHost:!0,parse:httpParse,serialize:httpSerialize},https={scheme:"https",domainHost:http.domainHost,parse:httpParse,serialize:httpSerialize},ws={scheme:"ws",domainHost:!0,parse:wsParse,serialize:wsSerialize},wss={scheme:"wss",domainHost:ws.domainHost,parse:ws.parse,serialize:ws.serialize},urn={scheme:"urn",parse:urnParse,serialize:urnSerialize,skipNormalize:!0},urnuuid={scheme:"urn:uuid",parse:urnuuidParse,serialize:urnuuidSerialize,skipNormalize:!0},SCHEMES$1={http,https,ws,wss,urn,"urn:uuid":urnuuid};var schemes=SCHEMES$1;const{normalizeIPv6,normalizeIPv4,removeDotSegments,recomposeAuthority,normalizeComponentEncoding}=utils,SCHEMES=schemes;function normalize(r,e){return typeof r=="string"?r=serialize(parse$7(r,e),e):typeof r=="object"&&(r=parse$7(serialize(r,e),e)),r}function resolve(r,e,n){const a=Object.assign({scheme:"null"},n),i=resolveComponents(parse$7(r,a),parse$7(e,a),a,!0);return serialize(i,{...a,skipEscape:!0})}function resolveComponents(r,e,n,a){const i={};return a||(r=parse$7(serialize(r,n),n),e=parse$7(serialize(e,n),n)),n=n||{},!n.tolerant&&e.scheme?(i.scheme=e.scheme,i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=removeDotSegments(e.path||""),i.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(i.userinfo=e.userinfo,i.host=e.host,i.port=e.port,i.path=removeDotSegments(e.path||""),i.query=e.query):(e.path?(e.path.charAt(0)==="/"?i.path=removeDotSegments(e.path):((r.userinfo!==void 0||r.host!==void 0||r.port!==void 0)&&!r.path?i.path="/"+e.path:r.path?i.path=r.path.slice(0,r.path.lastIndexOf("/")+1)+e.path:i.path=e.path,i.path=removeDotSegments(i.path)),i.query=e.query):(i.path=r.path,e.query!==void 0?i.query=e.query:i.query=r.query),i.userinfo=r.userinfo,i.host=r.host,i.port=r.port),i.scheme=r.scheme),i.fragment=e.fragment,i}function equal$2(r,e,n){return typeof r=="string"?(r=unescape(r),r=serialize(normalizeComponentEncoding(parse$7(r,n),!0),{...n,skipEscape:!0})):typeof r=="object"&&(r=serialize(normalizeComponentEncoding(r,!0),{...n,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=serialize(normalizeComponentEncoding(parse$7(e,n),!0),{...n,skipEscape:!0})):typeof e=="object"&&(e=serialize(normalizeComponentEncoding(e,!0),{...n,skipEscape:!0})),r.toLowerCase()===e.toLowerCase()}function serialize(r,e){const n={host:r.host,scheme:r.scheme,userinfo:r.userinfo,port:r.port,path:r.path,query:r.query,nid:r.nid,nss:r.nss,uuid:r.uuid,fragment:r.fragment,reference:r.reference,resourceName:r.resourceName,secure:r.secure,error:""},a=Object.assign({},e),i=[],s=SCHEMES[(a.scheme||n.scheme||"").toLowerCase()];s&&s.serialize&&s.serialize(n,a),n.path!==void 0&&(a.skipEscape?n.path=unescape(n.path):(n.path=escape(n.path),n.scheme!==void 0&&(n.path=n.path.split("%3A").join(":")))),a.reference!=="suffix"&&n.scheme&&i.push(n.scheme,":");const o=recomposeAuthority(n);if(o!==void 0&&(a.reference!=="suffix"&&i.push("//"),i.push(o),n.path&&n.path.charAt(0)!=="/"&&i.push("/")),n.path!==void 0){let l=n.path;!a.absolutePath&&(!s||!s.absolutePath)&&(l=removeDotSegments(l)),o===void 0&&(l=l.replace(/^\/\//u,"/%2F")),i.push(l)}return n.query!==void 0&&i.push("?",n.query),n.fragment!==void 0&&i.push("#",n.fragment),i.join("")}const hexLookUp=Array.from({length:127},(r,e)=>/[^!"$&'()*+,\-.;=_`a-z{}~]/u.test(String.fromCharCode(e)));function nonSimpleDomain(r){let e=0;for(let n=0,a=r.length;n<a;++n)if(e=r.charCodeAt(n),e>126||hexLookUp[e])return!0;return!1}const URI_PARSE=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function parse$7(r,e){const n=Object.assign({},e),a={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},i=r.indexOf("%")!==-1;let s=!1;n.reference==="suffix"&&(r=(n.scheme?n.scheme+":":"")+"//"+r);const o=r.match(URI_PARSE);if(o){if(a.scheme=o[1],a.userinfo=o[3],a.host=o[4],a.port=parseInt(o[5],10),a.path=o[6]||"",a.query=o[7],a.fragment=o[8],isNaN(a.port)&&(a.port=o[5]),a.host){const c=normalizeIPv4(a.host);if(c.isIPV4===!1){const d=normalizeIPv6(c.host);a.host=d.host.toLowerCase(),s=d.isIPV6}else a.host=c.host,s=!0}a.scheme===void 0&&a.userinfo===void 0&&a.host===void 0&&a.port===void 0&&a.query===void 0&&!a.path?a.reference="same-document":a.scheme===void 0?a.reference="relative":a.fragment===void 0?a.reference="absolute":a.reference="uri",n.reference&&n.reference!=="suffix"&&n.reference!==a.reference&&(a.error=a.error||"URI is not a "+n.reference+" reference.");const l=SCHEMES[(n.scheme||a.scheme||"").toLowerCase()];if(!n.unicodeSupport&&(!l||!l.unicodeSupport)&&a.host&&(n.domainHost||l&&l.domainHost)&&s===!1&&nonSimpleDomain(a.host))try{a.host=URL.domainToASCII(a.host.toLowerCase())}catch(c){a.error=a.error||"Host's domain name can not be converted to ASCII: "+c}(!l||l&&!l.skipNormalize)&&(i&&a.scheme!==void 0&&(a.scheme=unescape(a.scheme)),i&&a.host!==void 0&&(a.host=unescape(a.host)),a.path&&(a.path=escape(unescape(a.path))),a.fragment&&(a.fragment=encodeURI(decodeURIComponent(a.fragment)))),l&&l.parse&&l.parse(a,n)}else a.error=a.error||"URI can not be parsed.";return a}const fastUri={SCHEMES,normalize,resolve,resolveComponents,equal:equal$2,serialize,parse:parse$7};fastUri$1.exports=fastUri;fastUri$1.exports.default=fastUri;fastUri$1.exports.fastUri=fastUri;var fastUriExports=fastUri$1.exports;Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=fastUriExports;uri.code='require("ajv/dist/runtime/uri").default';uri$1.default=uri;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CodeGen=r.Name=r.nil=r.stringify=r.str=r._=r.KeywordCxt=void 0;var e=validate;Object.defineProperty(r,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var n=codegen;Object.defineProperty(r,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(r,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(r,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(r,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(r,"Name",{enumerable:!0,get:function(){return n.Name}}),Object.defineProperty(r,"CodeGen",{enumerable:!0,get:function(){return n.CodeGen}});const a=validation_error,i=ref_error,s=rules,o=compile,l=codegen,c=resolve$2,d=dataType,u=util,f=require$$9,m=uri$1,h=(y,E)=>new RegExp(y,E);h.code="new RegExp";const w=["removeAdditional","useDefaults","coerceTypes"],$=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),_={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},p={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},b=200;function v(y){var E,C,S,g,k,G,ee,N,H,Q,le,ue,O,F,W,ie,ae,te,D,J,ne,Y,fe,_e,pe;const ge=y.strict,he=(E=y.code)===null||E===void 0?void 0:E.optimize,ye=he===!0||he===void 0?1:he||0,Ee=(S=(C=y.code)===null||C===void 0?void 0:C.regExp)!==null&&S!==void 0?S:h,Ce=(g=y.uriResolver)!==null&&g!==void 0?g:m.default;return{strictSchema:(G=(k=y.strictSchema)!==null&&k!==void 0?k:ge)!==null&&G!==void 0?G:!0,strictNumbers:(N=(ee=y.strictNumbers)!==null&&ee!==void 0?ee:ge)!==null&&N!==void 0?N:!0,strictTypes:(Q=(H=y.strictTypes)!==null&&H!==void 0?H:ge)!==null&&Q!==void 0?Q:"log",strictTuples:(ue=(le=y.strictTuples)!==null&&le!==void 0?le:ge)!==null&&ue!==void 0?ue:"log",strictRequired:(F=(O=y.strictRequired)!==null&&O!==void 0?O:ge)!==null&&F!==void 0?F:!1,code:y.code?{...y.code,optimize:ye,regExp:Ee}:{optimize:ye,regExp:Ee},loopRequired:(W=y.loopRequired)!==null&&W!==void 0?W:b,loopEnum:(ie=y.loopEnum)!==null&&ie!==void 0?ie:b,meta:(ae=y.meta)!==null&&ae!==void 0?ae:!0,messages:(te=y.messages)!==null&&te!==void 0?te:!0,inlineRefs:(D=y.inlineRefs)!==null&&D!==void 0?D:!0,schemaId:(J=y.schemaId)!==null&&J!==void 0?J:"$id",addUsedSchema:(ne=y.addUsedSchema)!==null&&ne!==void 0?ne:!0,validateSchema:(Y=y.validateSchema)!==null&&Y!==void 0?Y:!0,validateFormats:(fe=y.validateFormats)!==null&&fe!==void 0?fe:!0,unicodeRegExp:(_e=y.unicodeRegExp)!==null&&_e!==void 0?_e:!0,int32range:(pe=y.int32range)!==null&&pe!==void 0?pe:!0,uriResolver:Ce}}class j{constructor(E={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,E=this.opts={...E,...v(E)};const{es5:C,lines:S}=this.opts.code;this.scope=new l.ValueScope({scope:{},prefixes:$,es5:C,lines:S}),this.logger=z(E.logger);const g=E.validateFormats;E.validateFormats=!1,this.RULES=(0,s.getRules)(),U.call(this,_,E,"NOT SUPPORTED"),U.call(this,p,E,"DEPRECATED","warn"),this._metaOpts=V.call(this),E.formats&&A.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),E.keywords&&ce.call(this,E.keywords),typeof E.meta=="object"&&this.addMetaSchema(E.meta),T.call(this),E.validateFormats=g}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:E,meta:C,schemaId:S}=this.opts;let g=f;S==="id"&&(g={...f},g.id=g.$id,delete g.$id),C&&E&&this.addMetaSchema(g,g[S],!1)}defaultMeta(){const{meta:E,schemaId:C}=this.opts;return this.opts.defaultMeta=typeof E=="object"?E[C]||E:void 0}validate(E,C){let S;if(typeof E=="string"){if(S=this.getSchema(E),!S)throw new Error(`no schema with key or ref "${E}"`)}else S=this.compile(E);const g=S(C);return"$async"in S||(this.errors=S.errors),g}compile(E,C){const S=this._addSchema(E,C);return S.validate||this._compileSchemaEnv(S)}compileAsync(E,C){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:S}=this.opts;return g.call(this,E,C);async function g(Q,le){await k.call(this,Q.$schema);const ue=this._addSchema(Q,le);return ue.validate||G.call(this,ue)}async function k(Q){Q&&!this.getSchema(Q)&&await g.call(this,{$ref:Q},!0)}async function G(Q){try{return this._compileSchemaEnv(Q)}catch(le){if(!(le instanceof i.default))throw le;return ee.call(this,le),await N.call(this,le.missingSchema),G.call(this,Q)}}function ee({missingSchema:Q,missingRef:le}){if(this.refs[Q])throw new Error(`AnySchema ${Q} is loaded but ${le} cannot be resolved`)}async function N(Q){const le=await H.call(this,Q);this.refs[Q]||await k.call(this,le.$schema),this.refs[Q]||this.addSchema(le,Q,C)}async function H(Q){const le=this._loading[Q];if(le)return le;try{return await(this._loading[Q]=S(Q))}finally{delete this._loading[Q]}}}addSchema(E,C,S,g=this.opts.validateSchema){if(Array.isArray(E)){for(const G of E)this.addSchema(G,void 0,S,g);return this}let k;if(typeof E=="object"){const{schemaId:G}=this.opts;if(k=E[G],k!==void 0&&typeof k!="string")throw new Error(`schema ${G} must be string`)}return C=(0,c.normalizeId)(C||k),this._checkUnique(C),this.schemas[C]=this._addSchema(E,S,C,g,!0),this}addMetaSchema(E,C,S=this.opts.validateSchema){return this.addSchema(E,C,!0,S),this}validateSchema(E,C){if(typeof E=="boolean")return!0;let S;if(S=E.$schema,S!==void 0&&typeof S!="string")throw new Error("$schema must be a string");if(S=S||this.opts.defaultMeta||this.defaultMeta(),!S)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const g=this.validate(S,E);if(!g&&C){const k="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(k);else throw new Error(k)}return g}getSchema(E){let C;for(;typeof(C=B.call(this,E))=="string";)E=C;if(C===void 0){const{schemaId:S}=this.opts,g=new o.SchemaEnv({schema:{},schemaId:S});if(C=o.resolveSchema.call(this,g,E),!C)return;this.refs[E]=C}return C.validate||this._compileSchemaEnv(C)}removeSchema(E){if(E instanceof RegExp)return this._removeAllSchemas(this.schemas,E),this._removeAllSchemas(this.refs,E),this;switch(typeof E){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const C=B.call(this,E);return typeof C=="object"&&this._cache.delete(C.schema),delete this.schemas[E],delete this.refs[E],this}case"object":{const C=E;this._cache.delete(C);let S=E[this.opts.schemaId];return S&&(S=(0,c.normalizeId)(S),delete this.schemas[S],delete this.refs[S]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(E){for(const C of E)this.addKeyword(C);return this}addKeyword(E,C){let S;if(typeof E=="string")S=E,typeof C=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),C.keyword=S);else if(typeof E=="object"&&C===void 0){if(C=E,S=C.keyword,Array.isArray(S)&&!S.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(M.call(this,S,C),!C)return(0,u.eachItem)(S,k=>q.call(this,k)),this;Z.call(this,C);const g={...C,type:(0,d.getJSONTypes)(C.type),schemaType:(0,d.getJSONTypes)(C.schemaType)};return(0,u.eachItem)(S,g.type.length===0?k=>q.call(this,k,g):k=>g.type.forEach(G=>q.call(this,k,g,G))),this}getKeyword(E){const C=this.RULES.all[E];return typeof C=="object"?C.definition:!!C}removeKeyword(E){const{RULES:C}=this;delete C.keywords[E],delete C.all[E];for(const S of C.rules){const g=S.rules.findIndex(k=>k.keyword===E);g>=0&&S.rules.splice(g,1)}return this}addFormat(E,C){return typeof C=="string"&&(C=new RegExp(C)),this.formats[E]=C,this}errorsText(E=this.errors,{separator:C=", ",dataVar:S="data"}={}){return!E||E.length===0?"No errors":E.map(g=>`${S}${g.instancePath} ${g.message}`).reduce((g,k)=>g+C+k)}$dataMetaSchema(E,C){const S=this.RULES.all;E=JSON.parse(JSON.stringify(E));for(const g of C){const k=g.split("/").slice(1);let G=E;for(const ee of k)G=G[ee];for(const ee in S){const N=S[ee];if(typeof N!="object")continue;const{$data:H}=N.definition,Q=G[ee];H&&Q&&(G[ee]=K(Q))}}return E}_removeAllSchemas(E,C){for(const S in E){const g=E[S];(!C||C.test(S))&&(typeof g=="string"?delete E[S]:g&&!g.meta&&(this._cache.delete(g.schema),delete E[S]))}}_addSchema(E,C,S,g=this.opts.validateSchema,k=this.opts.addUsedSchema){let G;const{schemaId:ee}=this.opts;if(typeof E=="object")G=E[ee];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof E!="boolean")throw new Error("schema must be object or boolean")}let N=this._cache.get(E);if(N!==void 0)return N;S=(0,c.normalizeId)(G||S);const H=c.getSchemaRefs.call(this,E,S);return N=new o.SchemaEnv({schema:E,schemaId:ee,meta:C,baseId:S,localRefs:H}),this._cache.set(N.schema,N),k&&!S.startsWith("#")&&(S&&this._checkUnique(S),this.refs[S]=N),g&&this.validateSchema(E,!0),N}_checkUnique(E){if(this.schemas[E]||this.refs[E])throw new Error(`schema with key or id "${E}" already exists`)}_compileSchemaEnv(E){if(E.meta?this._compileMetaSchema(E):o.compileSchema.call(this,E),!E.validate)throw new Error("ajv implementation error");return E.validate}_compileMetaSchema(E){const C=this.opts;this.opts=this._metaOpts;try{o.compileSchema.call(this,E)}finally{this.opts=C}}}j.ValidationError=a.default,j.MissingRefError=i.default,r.default=j;function U(y,E,C,S="error"){for(const g in y){const k=g;k in E&&this.logger[S](`${C}: option ${g}. ${y[k]}`)}}function B(y){return y=(0,c.normalizeId)(y),this.schemas[y]||this.refs[y]}function T(){const y=this.opts.schemas;if(y)if(Array.isArray(y))this.addSchema(y);else for(const E in y)this.addSchema(y[E],E)}function A(){for(const y in this.opts.formats){const E=this.opts.formats[y];E&&this.addFormat(y,E)}}function ce(y){if(Array.isArray(y)){this.addVocabulary(y);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const E in y){const C=y[E];C.keyword||(C.keyword=E),this.addKeyword(C)}}function V(){const y={...this.opts};for(const E of w)delete y[E];return y}const R={log(){},warn(){},error(){}};function z(y){if(y===!1)return R;if(y===void 0)return console;if(y.log&&y.warn&&y.error)return y;throw new Error("logger must implement log, warn and error methods")}const x=/^[a-z_$][a-z0-9_$:-]*$/i;function M(y,E){const{RULES:C}=this;if((0,u.eachItem)(y,S=>{if(C.keywords[S])throw new Error(`Keyword ${S} is already defined`);if(!x.test(S))throw new Error(`Keyword ${S} has invalid name`)}),!!E&&E.$data&&!("code"in E||"validate"in E))throw new Error('$data keyword must have "code" or "validate" function')}function q(y,E,C){var S;const g=E==null?void 0:E.post;if(C&&g)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:k}=this;let G=g?k.post:k.rules.find(({type:N})=>N===C);if(G||(G={type:C,rules:[]},k.rules.push(G)),k.keywords[y]=!0,!E)return;const ee={keyword:y,definition:{...E,type:(0,d.getJSONTypes)(E.type),schemaType:(0,d.getJSONTypes)(E.schemaType)}};E.before?X.call(this,G,ee,E.before):G.rules.push(ee),k.all[y]=ee,(S=E.implements)===null||S===void 0||S.forEach(N=>this.addKeyword(N))}function X(y,E,C){const S=y.rules.findIndex(g=>g.keyword===C);S>=0?y.rules.splice(S,0,E):(y.rules.push(E),this.logger.warn(`rule ${C} is not defined`))}function Z(y){let{metaSchema:E}=y;E!==void 0&&(y.$data&&this.opts.$data&&(E=K(E)),y.validateSchema=this.compile(E,!0))}const L={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function K(y){return{anyOf:[y,L]}}})(core$3);var draft2020={},core$2={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$B={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$B;var ref={};Object.defineProperty(ref,"__esModule",{value:!0});ref.callRef=ref.getValidate=void 0;const ref_error_1$1=ref_error,code_1$8=code,codegen_1$p=codegen,names_1$4=names$1,compile_1$2=compile,util_1$n=util,def$A={keyword:"$ref",schemaType:"string",code(r){const{gen:e,schema:n,it:a}=r,{baseId:i,schemaEnv:s,validateName:o,opts:l,self:c}=a,{root:d}=s;if((n==="#"||n==="#/")&&i===d.baseId)return f();const u=compile_1$2.resolveRef.call(c,d,i,n);if(u===void 0)throw new ref_error_1$1.default(a.opts.uriResolver,i,n);if(u instanceof compile_1$2.SchemaEnv)return m(u);return h(u);function f(){if(s===d)return callRef(r,o,s,s.$async);const w=e.scopeValue("root",{ref:d});return callRef(r,(0,codegen_1$p._)`${w}.validate`,d,d.$async)}function m(w){const $=getValidate(r,w);callRef(r,$,w,w.$async)}function h(w){const $=e.scopeValue("schema",l.code.source===!0?{ref:w,code:(0,codegen_1$p.stringify)(w)}:{ref:w}),_=e.name("valid"),p=r.subschema({schema:w,dataTypes:[],schemaPath:codegen_1$p.nil,topSchemaRef:$,errSchemaPath:n},_);r.mergeEvaluated(p),r.ok(_)}}};function getValidate(r,e){const{gen:n}=r;return e.validate?n.scopeValue("validate",{ref:e.validate}):(0,codegen_1$p._)`${n.scopeValue("wrapper",{ref:e})}.validate`}ref.getValidate=getValidate;function callRef(r,e,n,a){const{gen:i,it:s}=r,{allErrors:o,schemaEnv:l,opts:c}=s,d=c.passContext?names_1$4.default.this:codegen_1$p.nil;a?u():f();function u(){if(!l.$async)throw new Error("async schema referenced by sync schema");const w=i.let("valid");i.try(()=>{i.code((0,codegen_1$p._)`await ${(0,code_1$8.callValidateCode)(r,e,d)}`),h(e),o||i.assign(w,!0)},$=>{i.if((0,codegen_1$p._)`!(${$} instanceof ${s.ValidationError})`,()=>i.throw($)),m($),o||i.assign(w,!1)}),r.ok(w)}function f(){r.result((0,code_1$8.callValidateCode)(r,e,d),()=>h(e),()=>m(e))}function m(w){const $=(0,codegen_1$p._)`${w}.errors`;i.assign(names_1$4.default.vErrors,(0,codegen_1$p._)`${names_1$4.default.vErrors} === null ? ${$} : ${names_1$4.default.vErrors}.concat(${$})`),i.assign(names_1$4.default.errors,(0,codegen_1$p._)`${names_1$4.default.vErrors}.length`)}function h(w){var $;if(!s.opts.unevaluated)return;const _=($=n==null?void 0:n.validate)===null||$===void 0?void 0:$.evaluated;if(s.props!==!0)if(_&&!_.dynamicProps)_.props!==void 0&&(s.props=util_1$n.mergeEvaluated.props(i,_.props,s.props));else{const p=i.var("props",(0,codegen_1$p._)`${w}.evaluated.props`);s.props=util_1$n.mergeEvaluated.props(i,p,s.props,codegen_1$p.Name)}if(s.items!==!0)if(_&&!_.dynamicItems)_.items!==void 0&&(s.items=util_1$n.mergeEvaluated.items(i,_.items,s.items));else{const p=i.var("items",(0,codegen_1$p._)`${w}.evaluated.items`);s.items=util_1$n.mergeEvaluated.items(i,p,s.items,codegen_1$p.Name)}}}ref.callRef=callRef;ref.default=def$A;Object.defineProperty(core$2,"__esModule",{value:!0});const id_1=id,ref_1$2=ref,core$1=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1$2.default];core$2.default=core$1;var validation$2={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$o=codegen,ops=codegen_1$o.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$k={message:({keyword:r,schemaCode:e})=>(0,codegen_1$o.str)`must be ${KWDs[r].okStr} ${e}`,params:({keyword:r,schemaCode:e})=>(0,codegen_1$o._)`{comparison: ${KWDs[r].okStr}, limit: ${e}}`},def$z={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$k,code(r){const{keyword:e,data:n,schemaCode:a}=r;r.fail$data((0,codegen_1$o._)`${n} ${KWDs[e].fail} ${a} || isNaN(${n})`)}};limitNumber.default=def$z;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$n=codegen,error$j={message:({schemaCode:r})=>(0,codegen_1$n.str)`must be multiple of ${r}`,params:({schemaCode:r})=>(0,codegen_1$n._)`{multipleOf: ${r}}`},def$y={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$j,code(r){const{gen:e,data:n,schemaCode:a,it:i}=r,s=i.opts.multipleOfPrecision,o=e.let("res"),l=s?(0,codegen_1$n._)`Math.abs(Math.round(${o}) - ${o}) > 1e-${s}`:(0,codegen_1$n._)`${o} !== parseInt(${o})`;r.fail$data((0,codegen_1$n._)`(${a} === 0 || (${o} = ${n}/${a}, ${l}))`)}};multipleOf.default=def$y;var limitLength={},ucs2length$1={};Object.defineProperty(ucs2length$1,"__esModule",{value:!0});function ucs2length(r){const e=r.length;let n=0,a=0,i;for(;a<e;)n++,i=r.charCodeAt(a++),i>=55296&&i<=56319&&a<e&&(i=r.charCodeAt(a),(i&64512)===56320&&a++);return n}ucs2length$1.default=ucs2length;ucs2length.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$m=codegen,util_1$m=util,ucs2length_1=ucs2length$1,error$i={message({keyword:r,schemaCode:e}){const n=r==="maxLength"?"more":"fewer";return(0,codegen_1$m.str)`must NOT have ${n} than ${e} characters`},params:({schemaCode:r})=>(0,codegen_1$m._)`{limit: ${r}}`},def$x={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$i,code(r){const{keyword:e,data:n,schemaCode:a,it:i}=r,s=e==="maxLength"?codegen_1$m.operators.GT:codegen_1$m.operators.LT,o=i.opts.unicode===!1?(0,codegen_1$m._)`${n}.length`:(0,codegen_1$m._)`${(0,util_1$m.useFunc)(r.gen,ucs2length_1.default)}(${n})`;r.fail$data((0,codegen_1$m._)`${o} ${s} ${a}`)}};limitLength.default=def$x;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code,codegen_1$l=codegen,error$h={message:({schemaCode:r})=>(0,codegen_1$l.str)`must match pattern "${r}"`,params:({schemaCode:r})=>(0,codegen_1$l._)`{pattern: ${r}}`},def$w={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$h,code(r){const{data:e,$data:n,schema:a,schemaCode:i,it:s}=r,o=s.opts.unicodeRegExp?"u":"",l=n?(0,codegen_1$l._)`(new RegExp(${i}, ${o}))`:(0,code_1$7.usePattern)(r,a);r.fail$data((0,codegen_1$l._)`!${l}.test(${e})`)}};pattern.default=def$w;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$k=codegen,error$g={message({keyword:r,schemaCode:e}){const n=r==="maxProperties"?"more":"fewer";return(0,codegen_1$k.str)`must NOT have ${n} than ${e} properties`},params:({schemaCode:r})=>(0,codegen_1$k._)`{limit: ${r}}`},def$v={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$g,code(r){const{keyword:e,data:n,schemaCode:a}=r,i=e==="maxProperties"?codegen_1$k.operators.GT:codegen_1$k.operators.LT;r.fail$data((0,codegen_1$k._)`Object.keys(${n}).length ${i} ${a}`)}};limitProperties.default=def$v;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code,codegen_1$j=codegen,util_1$l=util,error$f={message:({params:{missingProperty:r}})=>(0,codegen_1$j.str)`must have required property '${r}'`,params:({params:{missingProperty:r}})=>(0,codegen_1$j._)`{missingProperty: ${r}}`},def$u={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$f,code(r){const{gen:e,schema:n,schemaCode:a,data:i,$data:s,it:o}=r,{opts:l}=o;if(!s&&n.length===0)return;const c=n.length>=l.loopRequired;if(o.allErrors?d():u(),l.strictRequired){const h=r.parentSchema.properties,{definedProperties:w}=r.it;for(const $ of n)if((h==null?void 0:h[$])===void 0&&!w.has($)){const _=o.schemaEnv.baseId+o.errSchemaPath,p=`required property "${$}" is not defined at "${_}" (strictRequired)`;(0,util_1$l.checkStrictMode)(o,p,o.opts.strictRequired)}}function d(){if(c||s)r.block$data(codegen_1$j.nil,f);else for(const h of n)(0,code_1$6.checkReportMissingProp)(r,h)}function u(){const h=e.let("missing");if(c||s){const w=e.let("valid",!0);r.block$data(w,()=>m(h,w)),r.ok(w)}else e.if((0,code_1$6.checkMissingProp)(r,n,h)),(0,code_1$6.reportMissingProp)(r,h),e.else()}function f(){e.forOf("prop",a,h=>{r.setParams({missingProperty:h}),e.if((0,code_1$6.noPropertyInData)(e,i,h,l.ownProperties),()=>r.error())})}function m(h,w){r.setParams({missingProperty:h}),e.forOf(h,a,()=>{e.assign(w,(0,code_1$6.propertyInData)(e,i,h,l.ownProperties)),e.if((0,codegen_1$j.not)(w),()=>{r.error(),e.break()})},codegen_1$j.nil)}}};required.default=def$u;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$i=codegen,error$e={message({keyword:r,schemaCode:e}){const n=r==="maxItems"?"more":"fewer";return(0,codegen_1$i.str)`must NOT have ${n} than ${e} items`},params:({schemaCode:r})=>(0,codegen_1$i._)`{limit: ${r}}`},def$t={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$e,code(r){const{keyword:e,data:n,schemaCode:a}=r,i=e==="maxItems"?codegen_1$i.operators.GT:codegen_1$i.operators.LT;r.fail$data((0,codegen_1$i._)`${n}.length ${i} ${a}`)}};limitItems.default=def$t;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default';equal$1.default=equal;Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$h=codegen,util_1$k=util,equal_1$2=equal$1,error$d={message:({params:{i:r,j:e}})=>(0,codegen_1$h.str)`must NOT have duplicate items (items ## ${e} and ${r} are identical)`,params:({params:{i:r,j:e}})=>(0,codegen_1$h._)`{i: ${r}, j: ${e}}`},def$s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$d,code(r){const{gen:e,data:n,$data:a,schema:i,parentSchema:s,schemaCode:o,it:l}=r;if(!a&&!i)return;const c=e.let("valid"),d=s.items?(0,dataType_1.getSchemaTypes)(s.items):[];r.block$data(c,u,(0,codegen_1$h._)`${o} === false`),r.ok(c);function u(){const w=e.let("i",(0,codegen_1$h._)`${n}.length`),$=e.let("j");r.setParams({i:w,j:$}),e.assign(c,!0),e.if((0,codegen_1$h._)`${w} > 1`,()=>(f()?m:h)(w,$))}function f(){return d.length>0&&!d.some(w=>w==="object"||w==="array")}function m(w,$){const _=e.name("item"),p=(0,dataType_1.checkDataTypes)(d,_,l.opts.strictNumbers,dataType_1.DataType.Wrong),b=e.const("indices",(0,codegen_1$h._)`{}`);e.for((0,codegen_1$h._)`;${w}--;`,()=>{e.let(_,(0,codegen_1$h._)`${n}[${w}]`),e.if(p,(0,codegen_1$h._)`continue`),d.length>1&&e.if((0,codegen_1$h._)`typeof ${_} == "string"`,(0,codegen_1$h._)`${_} += "_"`),e.if((0,codegen_1$h._)`typeof ${b}[${_}] == "number"`,()=>{e.assign($,(0,codegen_1$h._)`${b}[${_}]`),r.error(),e.assign(c,!1).break()}).code((0,codegen_1$h._)`${b}[${_}] = ${w}`)})}function h(w,$){const _=(0,util_1$k.useFunc)(e,equal_1$2.default),p=e.name("outer");e.label(p).for((0,codegen_1$h._)`;${w}--;`,()=>e.for((0,codegen_1$h._)`${$} = ${w}; ${$}--;`,()=>e.if((0,codegen_1$h._)`${_}(${n}[${w}], ${n}[${$}])`,()=>{r.error(),e.assign(c,!1).break(p)})))}}};uniqueItems.default=def$s;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$g=codegen,util_1$j=util,equal_1$1=equal$1,error$c={message:"must be equal to constant",params:({schemaCode:r})=>(0,codegen_1$g._)`{allowedValue: ${r}}`},def$r={keyword:"const",$data:!0,error:error$c,code(r){const{gen:e,data:n,$data:a,schemaCode:i,schema:s}=r;a||s&&typeof s=="object"?r.fail$data((0,codegen_1$g._)`!${(0,util_1$j.useFunc)(e,equal_1$1.default)}(${n}, ${i})`):r.fail((0,codegen_1$g._)`${s} !== ${n}`)}};_const.default=def$r;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$f=codegen,util_1$i=util,equal_1=equal$1,error$b={message:"must be equal to one of the allowed values",params:({schemaCode:r})=>(0,codegen_1$f._)`{allowedValues: ${r}}`},def$q={keyword:"enum",schemaType:"array",$data:!0,error:error$b,code(r){const{gen:e,data:n,$data:a,schema:i,schemaCode:s,it:o}=r;if(!a&&i.length===0)throw new Error("enum must have non-empty array");const l=i.length>=o.opts.loopEnum;let c;const d=()=>c??(c=(0,util_1$i.useFunc)(e,equal_1.default));let u;if(l||a)u=e.let("valid"),r.block$data(u,f);else{if(!Array.isArray(i))throw new Error("ajv implementation error");const h=e.const("vSchema",s);u=(0,codegen_1$f.or)(...i.map((w,$)=>m(h,$)))}r.pass(u);function f(){e.assign(u,!1),e.forOf("v",s,h=>e.if((0,codegen_1$f._)`${d()}(${n}, ${h})`,()=>e.assign(u,!0).break()))}function m(h,w){const $=i[w];return typeof $=="object"&&$!==null?(0,codegen_1$f._)`${d()}(${n}, ${h}[${w}])`:(0,codegen_1$f._)`${n} === ${$}`}}};_enum.default=def$q;Object.defineProperty(validation$2,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation$1=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$2.default=validation$1;var applicator$1={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0});additionalItems.validateAdditionalItems=void 0;const codegen_1$e=codegen,util_1$h=util,error$a={message:({params:{len:r}})=>(0,codegen_1$e.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,codegen_1$e._)`{limit: ${r}}`},def$p={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$a,code(r){const{parentSchema:e,it:n}=r,{items:a}=e;if(!Array.isArray(a)){(0,util_1$h.checkStrictMode)(n,'"additionalItems" is ignored when "items" is not an array of schemas');return}validateAdditionalItems(r,a)}};function validateAdditionalItems(r,e){const{gen:n,schema:a,data:i,keyword:s,it:o}=r;o.items=!0;const l=n.const("len",(0,codegen_1$e._)`${i}.length`);if(a===!1)r.setParams({len:e.length}),r.pass((0,codegen_1$e._)`${l} <= ${e.length}`);else if(typeof a=="object"&&!(0,util_1$h.alwaysValidSchema)(o,a)){const d=n.var("valid",(0,codegen_1$e._)`${l} <= ${e.length}`);n.if((0,codegen_1$e.not)(d),()=>c(d)),r.ok(d)}function c(d){n.forRange("i",e.length,l,u=>{r.subschema({keyword:s,dataProp:u,dataPropType:util_1$h.Type.Num},d),o.allErrors||n.if((0,codegen_1$e.not)(d),()=>n.break())})}}additionalItems.validateAdditionalItems=validateAdditionalItems;additionalItems.default=def$p;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0});items.validateTuple=void 0;const codegen_1$d=codegen,util_1$g=util,code_1$5=code,def$o={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(r){const{schema:e,it:n}=r;if(Array.isArray(e))return validateTuple(r,"additionalItems",e);n.items=!0,!(0,util_1$g.alwaysValidSchema)(n,e)&&r.ok((0,code_1$5.validateArray)(r))}};function validateTuple(r,e,n=r.schema){const{gen:a,parentSchema:i,data:s,keyword:o,it:l}=r;u(i),l.opts.unevaluated&&n.length&&l.items!==!0&&(l.items=util_1$g.mergeEvaluated.items(a,n.length,l.items));const c=a.name("valid"),d=a.const("len",(0,codegen_1$d._)`${s}.length`);n.forEach((f,m)=>{(0,util_1$g.alwaysValidSchema)(l,f)||(a.if((0,codegen_1$d._)`${d} > ${m}`,()=>r.subschema({keyword:o,schemaProp:m,dataProp:m},c)),r.ok(c))});function u(f){const{opts:m,errSchemaPath:h}=l,w=n.length,$=w===f.minItems&&(w===f.maxItems||f[e]===!1);if(m.strictTuples&&!$){const _=`"${o}" is ${w}-tuple, but minItems or maxItems/${e} are not specified or different at path "${h}"`;(0,util_1$g.checkStrictMode)(l,_,m.strictTuples)}}}items.validateTuple=validateTuple;items.default=def$o;Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$n={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,items_1$1.validateTuple)(r,"items")};prefixItems.default=def$n;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util,code_1$4=code,additionalItems_1$1=additionalItems,error$9={message:({params:{len:r}})=>(0,codegen_1$c.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,codegen_1$c._)`{limit: ${r}}`},def$m={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$9,code(r){const{schema:e,parentSchema:n,it:a}=r,{prefixItems:i}=n;a.items=!0,!(0,util_1$f.alwaysValidSchema)(a,e)&&(i?(0,additionalItems_1$1.validateAdditionalItems)(r,i):r.ok((0,code_1$4.validateArray)(r)))}};items2020.default=def$m;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util,error$8={message:({params:{min:r,max:e}})=>e===void 0?(0,codegen_1$b.str)`must contain at least ${r} valid item(s)`:(0,codegen_1$b.str)`must contain at least ${r} and no more than ${e} valid item(s)`,params:({params:{min:r,max:e}})=>e===void 0?(0,codegen_1$b._)`{minContains: ${r}}`:(0,codegen_1$b._)`{minContains: ${r}, maxContains: ${e}}`},def$l={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$8,code(r){const{gen:e,schema:n,parentSchema:a,data:i,it:s}=r;let o,l;const{minContains:c,maxContains:d}=a;s.opts.next?(o=c===void 0?1:c,l=d):o=1;const u=e.const("len",(0,codegen_1$b._)`${i}.length`);if(r.setParams({min:o,max:l}),l===void 0&&o===0){(0,util_1$e.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(l!==void 0&&o>l){(0,util_1$e.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),r.fail();return}if((0,util_1$e.alwaysValidSchema)(s,n)){let $=(0,codegen_1$b._)`${u} >= ${o}`;l!==void 0&&($=(0,codegen_1$b._)`${$} && ${u} <= ${l}`),r.pass($);return}s.items=!0;const f=e.name("valid");l===void 0&&o===1?h(f,()=>e.if(f,()=>e.break())):o===0?(e.let(f,!0),l!==void 0&&e.if((0,codegen_1$b._)`${i}.length > 0`,m)):(e.let(f,!1),m()),r.result(f,()=>r.reset());function m(){const $=e.name("_valid"),_=e.let("count",0);h($,()=>e.if($,()=>w(_)))}function h($,_){e.forRange("i",0,u,p=>{r.subschema({keyword:"contains",dataProp:p,dataPropType:util_1$e.Type.Num,compositeRule:!0},$),_()})}function w($){e.code((0,codegen_1$b._)`${$}++`),l===void 0?e.if((0,codegen_1$b._)`${$} >= ${o}`,()=>e.assign(f,!0).break()):(e.if((0,codegen_1$b._)`${$} > ${l}`,()=>e.assign(f,!1).break()),o===1?e.assign(f,!0):e.if((0,codegen_1$b._)`${$} >= ${o}`,()=>e.assign(f,!0)))}}};contains.default=def$l;var dependencies={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.validateSchemaDeps=r.validatePropertyDeps=r.error=void 0;const e=codegen,n=util,a=code;r.error={message:({params:{property:c,depsCount:d,deps:u}})=>{const f=d===1?"property":"properties";return(0,e.str)`must have ${f} ${u} when property ${c} is present`},params:({params:{property:c,depsCount:d,deps:u,missingProperty:f}})=>(0,e._)`{property: ${c},
    missingProperty: ${f},
    depsCount: ${d},
    deps: ${u}}`};const i={keyword:"dependencies",type:"object",schemaType:"object",error:r.error,code(c){const[d,u]=s(c);o(c,d),l(c,u)}};function s({schema:c}){const d={},u={};for(const f in c){if(f==="__proto__")continue;const m=Array.isArray(c[f])?d:u;m[f]=c[f]}return[d,u]}function o(c,d=c.schema){const{gen:u,data:f,it:m}=c;if(Object.keys(d).length===0)return;const h=u.let("missing");for(const w in d){const $=d[w];if($.length===0)continue;const _=(0,a.propertyInData)(u,f,w,m.opts.ownProperties);c.setParams({property:w,depsCount:$.length,deps:$.join(", ")}),m.allErrors?u.if(_,()=>{for(const p of $)(0,a.checkReportMissingProp)(c,p)}):(u.if((0,e._)`${_} && (${(0,a.checkMissingProp)(c,$,h)})`),(0,a.reportMissingProp)(c,h),u.else())}}r.validatePropertyDeps=o;function l(c,d=c.schema){const{gen:u,data:f,keyword:m,it:h}=c,w=u.name("valid");for(const $ in d)(0,n.alwaysValidSchema)(h,d[$])||(u.if((0,a.propertyInData)(u,f,$,h.opts.ownProperties),()=>{const _=c.subschema({keyword:m,schemaProp:$},w);c.mergeValidEvaluated(_,w)},()=>u.var(w,!0)),c.ok(w))}r.validateSchemaDeps=l,r.default=i})(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$a=codegen,util_1$d=util,error$7={message:"property name must be valid",params:({params:r})=>(0,codegen_1$a._)`{propertyName: ${r.propertyName}}`},def$k={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$7,code(r){const{gen:e,schema:n,data:a,it:i}=r;if((0,util_1$d.alwaysValidSchema)(i,n))return;const s=e.name("valid");e.forIn("key",a,o=>{r.setParams({propertyName:o}),r.subschema({keyword:"propertyNames",data:o,dataTypes:["string"],propertyName:o,compositeRule:!0},s),e.if((0,codegen_1$a.not)(s),()=>{r.error(!0),i.allErrors||e.break()})}),r.ok(s)}};propertyNames.default=def$k;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code,codegen_1$9=codegen,names_1$3=names$1,util_1$c=util,error$6={message:"must NOT have additional properties",params:({params:r})=>(0,codegen_1$9._)`{additionalProperty: ${r.additionalProperty}}`},def$j={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$6,code(r){const{gen:e,schema:n,parentSchema:a,data:i,errsCount:s,it:o}=r;if(!s)throw new Error("ajv implementation error");const{allErrors:l,opts:c}=o;if(o.props=!0,c.removeAdditional!=="all"&&(0,util_1$c.alwaysValidSchema)(o,n))return;const d=(0,code_1$3.allSchemaProperties)(a.properties),u=(0,code_1$3.allSchemaProperties)(a.patternProperties);f(),r.ok((0,codegen_1$9._)`${s} === ${names_1$3.default.errors}`);function f(){e.forIn("key",i,_=>{!d.length&&!u.length?w(_):e.if(m(_),()=>w(_))})}function m(_){let p;if(d.length>8){const b=(0,util_1$c.schemaRefOrVal)(o,a.properties,"properties");p=(0,code_1$3.isOwnProperty)(e,b,_)}else d.length?p=(0,codegen_1$9.or)(...d.map(b=>(0,codegen_1$9._)`${_} === ${b}`)):p=codegen_1$9.nil;return u.length&&(p=(0,codegen_1$9.or)(p,...u.map(b=>(0,codegen_1$9._)`${(0,code_1$3.usePattern)(r,b)}.test(${_})`))),(0,codegen_1$9.not)(p)}function h(_){e.code((0,codegen_1$9._)`delete ${i}[${_}]`)}function w(_){if(c.removeAdditional==="all"||c.removeAdditional&&n===!1){h(_);return}if(n===!1){r.setParams({additionalProperty:_}),r.error(),l||e.break();return}if(typeof n=="object"&&!(0,util_1$c.alwaysValidSchema)(o,n)){const p=e.name("valid");c.removeAdditional==="failing"?($(_,p,!1),e.if((0,codegen_1$9.not)(p),()=>{r.reset(),h(_)})):($(_,p),l||e.if((0,codegen_1$9.not)(p),()=>e.break()))}}function $(_,p,b){const v={keyword:"additionalProperties",dataProp:_,dataPropType:util_1$c.Type.Str};b===!1&&Object.assign(v,{compositeRule:!0,createErrors:!1,allErrors:!1}),r.subschema(v,p)}}};additionalProperties.default=def$j;var properties$9={};Object.defineProperty(properties$9,"__esModule",{value:!0});const validate_1=validate,code_1$2=code,util_1$b=util,additionalProperties_1$1=additionalProperties,def$i={keyword:"properties",type:"object",schemaType:"object",code(r){const{gen:e,schema:n,parentSchema:a,data:i,it:s}=r;s.opts.removeAdditional==="all"&&a.additionalProperties===void 0&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(s,additionalProperties_1$1.default,"additionalProperties"));const o=(0,code_1$2.allSchemaProperties)(n);for(const f of o)s.definedProperties.add(f);s.opts.unevaluated&&o.length&&s.props!==!0&&(s.props=util_1$b.mergeEvaluated.props(e,(0,util_1$b.toHash)(o),s.props));const l=o.filter(f=>!(0,util_1$b.alwaysValidSchema)(s,n[f]));if(l.length===0)return;const c=e.name("valid");for(const f of l)d(f)?u(f):(e.if((0,code_1$2.propertyInData)(e,i,f,s.opts.ownProperties)),u(f),s.allErrors||e.else().var(c,!0),e.endIf()),r.it.definedProperties.add(f),r.ok(c);function d(f){return s.opts.useDefaults&&!s.compositeRule&&n[f].default!==void 0}function u(f){r.subschema({keyword:"properties",schemaProp:f,dataProp:f},c)}}};properties$9.default=def$i;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code,codegen_1$8=codegen,util_1$a=util,util_2=util,def$h={keyword:"patternProperties",type:"object",schemaType:"object",code(r){const{gen:e,schema:n,data:a,parentSchema:i,it:s}=r,{opts:o}=s,l=(0,code_1$1.allSchemaProperties)(n),c=l.filter($=>(0,util_1$a.alwaysValidSchema)(s,n[$]));if(l.length===0||c.length===l.length&&(!s.opts.unevaluated||s.props===!0))return;const d=o.strictSchema&&!o.allowMatchingProperties&&i.properties,u=e.name("valid");s.props!==!0&&!(s.props instanceof codegen_1$8.Name)&&(s.props=(0,util_2.evaluatedPropsToName)(e,s.props));const{props:f}=s;m();function m(){for(const $ of l)d&&h($),s.allErrors?w($):(e.var(u,!0),w($),e.if(u))}function h($){for(const _ in d)new RegExp($).test(_)&&(0,util_1$a.checkStrictMode)(s,`property ${_} matches pattern ${$} (use allowMatchingProperties)`)}function w($){e.forIn("key",a,_=>{e.if((0,codegen_1$8._)`${(0,code_1$1.usePattern)(r,$)}.test(${_})`,()=>{const p=c.includes($);p||r.subschema({keyword:"patternProperties",schemaProp:$,dataProp:_,dataPropType:util_2.Type.Str},u),s.opts.unevaluated&&f!==!0?e.assign((0,codegen_1$8._)`${f}[${_}]`,!0):!p&&!s.allErrors&&e.if((0,codegen_1$8.not)(u),()=>e.break())})})}}};patternProperties.default=def$h;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$9=util,def$g={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:e,schema:n,it:a}=r;if((0,util_1$9.alwaysValidSchema)(a,n)){r.fail();return}const i=e.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},i),r.failResult(i,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};not.default=def$g;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code,def$f={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$f;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$8=util,error$5={message:"must match exactly one schema in oneOf",params:({params:r})=>(0,codegen_1$7._)`{passingSchemas: ${r.passing}}`},def$e={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$5,code(r){const{gen:e,schema:n,parentSchema:a,it:i}=r;if(!Array.isArray(n))throw new Error("ajv implementation error");if(i.opts.discriminator&&a.discriminator)return;const s=n,o=e.let("valid",!1),l=e.let("passing",null),c=e.name("_valid");r.setParams({passing:l}),e.block(d),r.result(o,()=>r.reset(),()=>r.error(!0));function d(){s.forEach((u,f)=>{let m;(0,util_1$8.alwaysValidSchema)(i,u)?e.var(c,!0):m=r.subschema({keyword:"oneOf",schemaProp:f,compositeRule:!0},c),f>0&&e.if((0,codegen_1$7._)`${c} && ${o}`).assign(o,!1).assign(l,(0,codegen_1$7._)`[${l}, ${f}]`).else(),e.if(c,()=>{e.assign(o,!0),e.assign(l,f),m&&r.mergeEvaluated(m,codegen_1$7.Name)})})}}};oneOf.default=def$e;var allOf$1={};Object.defineProperty(allOf$1,"__esModule",{value:!0});const util_1$7=util,def$d={keyword:"allOf",schemaType:"array",code(r){const{gen:e,schema:n,it:a}=r;if(!Array.isArray(n))throw new Error("ajv implementation error");const i=e.name("valid");n.forEach((s,o)=>{if((0,util_1$7.alwaysValidSchema)(a,s))return;const l=r.subschema({keyword:"allOf",schemaProp:o},i);r.ok(i),r.mergeEvaluated(l)})}};allOf$1.default=def$d;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$6=util,error$4={message:({params:r})=>(0,codegen_1$6.str)`must match "${r.ifClause}" schema`,params:({params:r})=>(0,codegen_1$6._)`{failingKeyword: ${r.ifClause}}`},def$c={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$4,code(r){const{gen:e,parentSchema:n,it:a}=r;n.then===void 0&&n.else===void 0&&(0,util_1$6.checkStrictMode)(a,'"if" without "then" and "else" is ignored');const i=hasSchema(a,"then"),s=hasSchema(a,"else");if(!i&&!s)return;const o=e.let("valid",!0),l=e.name("_valid");if(c(),r.reset(),i&&s){const u=e.let("ifClause");r.setParams({ifClause:u}),e.if(l,d("then",u),d("else",u))}else i?e.if(l,d("then")):e.if((0,codegen_1$6.not)(l),d("else"));r.pass(o,()=>r.error(!0));function c(){const u=r.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},l);r.mergeEvaluated(u)}function d(u,f){return()=>{const m=r.subschema({keyword:u},l);e.assign(o,l),r.mergeValidEvaluated(m,o),f?e.assign(f,(0,codegen_1$6._)`${u}`):r.setParams({ifClause:u})}}}};function hasSchema(r,e){const n=r.schema[e];return n!==void 0&&!(0,util_1$6.alwaysValidSchema)(r,n)}_if.default=def$c;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$5=util,def$b={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:e,it:n}){e.if===void 0&&(0,util_1$5.checkStrictMode)(n,`"${r}" without "if" is ignored`)}};thenElse.default=def$b;Object.defineProperty(applicator$1,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1$2=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$9,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf$1,if_1=_if,thenElse_1=thenElse;function getApplicator(r=!1){const e=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1$2.default,properties_1.default,patternProperties_1.default];return r?e.push(prefixItems_1.default,items2020_1.default):e.push(additionalItems_1.default,items_1.default),e.push(contains_1.default),e}applicator$1.default=getApplicator;var dynamic$1={},dynamicAnchor$1={};Object.defineProperty(dynamicAnchor$1,"__esModule",{value:!0});dynamicAnchor$1.dynamicAnchor=void 0;const codegen_1$5=codegen,names_1$2=names$1,compile_1$1=compile,ref_1$1=ref,def$a={keyword:"$dynamicAnchor",schemaType:"string",code:r=>dynamicAnchor(r,r.schema)};function dynamicAnchor(r,e){const{gen:n,it:a}=r;a.schemaEnv.root.dynamicAnchors[e]=!0;const i=(0,codegen_1$5._)`${names_1$2.default.dynamicAnchors}${(0,codegen_1$5.getProperty)(e)}`,s=a.errSchemaPath==="#"?a.validateName:_getValidate(r);n.if((0,codegen_1$5._)`!${i}`,()=>n.assign(i,s))}dynamicAnchor$1.dynamicAnchor=dynamicAnchor;function _getValidate(r){const{schemaEnv:e,schema:n,self:a}=r.it,{root:i,baseId:s,localRefs:o,meta:l}=e.root,{schemaId:c}=a.opts,d=new compile_1$1.SchemaEnv({schema:n,schemaId:c,root:i,baseId:s,localRefs:o,meta:l});return compile_1$1.compileSchema.call(a,d),(0,ref_1$1.getValidate)(r,d)}dynamicAnchor$1.default=def$a;var dynamicRef$1={};Object.defineProperty(dynamicRef$1,"__esModule",{value:!0});dynamicRef$1.dynamicRef=void 0;const codegen_1$4=codegen,names_1$1=names$1,ref_1=ref,def$9={keyword:"$dynamicRef",schemaType:"string",code:r=>dynamicRef(r,r.schema)};function dynamicRef(r,e){const{gen:n,keyword:a,it:i}=r;if(e[0]!=="#")throw new Error(`"${a}" only supports hash fragment reference`);const s=e.slice(1);if(i.allErrors)o();else{const c=n.let("valid",!1);o(c),r.ok(c)}function o(c){if(i.schemaEnv.root.dynamicAnchors[s]){const d=n.let("_v",(0,codegen_1$4._)`${names_1$1.default.dynamicAnchors}${(0,codegen_1$4.getProperty)(s)}`);n.if(d,l(d,c),l(i.validateName,c))}else l(i.validateName,c)()}function l(c,d){return d?()=>n.block(()=>{(0,ref_1.callRef)(r,c),n.let(d,!0)}):()=>(0,ref_1.callRef)(r,c)}}dynamicRef$1.dynamicRef=dynamicRef;dynamicRef$1.default=def$9;var recursiveAnchor={};Object.defineProperty(recursiveAnchor,"__esModule",{value:!0});const dynamicAnchor_1$1=dynamicAnchor$1,util_1$4=util,def$8={keyword:"$recursiveAnchor",schemaType:"boolean",code(r){r.schema?(0,dynamicAnchor_1$1.dynamicAnchor)(r,""):(0,util_1$4.checkStrictMode)(r.it,"$recursiveAnchor: false is ignored")}};recursiveAnchor.default=def$8;var recursiveRef={};Object.defineProperty(recursiveRef,"__esModule",{value:!0});const dynamicRef_1$1=dynamicRef$1,def$7={keyword:"$recursiveRef",schemaType:"string",code:r=>(0,dynamicRef_1$1.dynamicRef)(r,r.schema)};recursiveRef.default=def$7;Object.defineProperty(dynamic$1,"__esModule",{value:!0});const dynamicAnchor_1=dynamicAnchor$1,dynamicRef_1=dynamicRef$1,recursiveAnchor_1=recursiveAnchor,recursiveRef_1=recursiveRef,dynamic=[dynamicAnchor_1.default,dynamicRef_1.default,recursiveAnchor_1.default,recursiveRef_1.default];dynamic$1.default=dynamic;var next$1={},dependentRequired={};Object.defineProperty(dependentRequired,"__esModule",{value:!0});const dependencies_1$1=dependencies,def$6={keyword:"dependentRequired",type:"object",schemaType:"object",error:dependencies_1$1.error,code:r=>(0,dependencies_1$1.validatePropertyDeps)(r)};dependentRequired.default=def$6;var dependentSchemas={};Object.defineProperty(dependentSchemas,"__esModule",{value:!0});const dependencies_1=dependencies,def$5={keyword:"dependentSchemas",type:"object",schemaType:"object",code:r=>(0,dependencies_1.validateSchemaDeps)(r)};dependentSchemas.default=def$5;var limitContains={};Object.defineProperty(limitContains,"__esModule",{value:!0});const util_1$3=util,def$4={keyword:["maxContains","minContains"],type:"array",schemaType:"number",code({keyword:r,parentSchema:e,it:n}){e.contains===void 0&&(0,util_1$3.checkStrictMode)(n,`"${r}" without "contains" is ignored`)}};limitContains.default=def$4;Object.defineProperty(next$1,"__esModule",{value:!0});const dependentRequired_1=dependentRequired,dependentSchemas_1=dependentSchemas,limitContains_1=limitContains,next=[dependentRequired_1.default,dependentSchemas_1.default,limitContains_1.default];next$1.default=next;var unevaluated$2={},unevaluatedProperties={};Object.defineProperty(unevaluatedProperties,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$2=util,names_1=names$1,error$3={message:"must NOT have unevaluated properties",params:({params:r})=>(0,codegen_1$3._)`{unevaluatedProperty: ${r.unevaluatedProperty}}`},def$3={keyword:"unevaluatedProperties",type:"object",schemaType:["boolean","object"],trackErrors:!0,error:error$3,code(r){const{gen:e,schema:n,data:a,errsCount:i,it:s}=r;if(!i)throw new Error("ajv implementation error");const{allErrors:o,props:l}=s;l instanceof codegen_1$3.Name?e.if((0,codegen_1$3._)`${l} !== true`,()=>e.forIn("key",a,f=>e.if(d(l,f),()=>c(f)))):l!==!0&&e.forIn("key",a,f=>l===void 0?c(f):e.if(u(l,f),()=>c(f))),s.props=!0,r.ok((0,codegen_1$3._)`${i} === ${names_1.default.errors}`);function c(f){if(n===!1){r.setParams({unevaluatedProperty:f}),r.error(),o||e.break();return}if(!(0,util_1$2.alwaysValidSchema)(s,n)){const m=e.name("valid");r.subschema({keyword:"unevaluatedProperties",dataProp:f,dataPropType:util_1$2.Type.Str},m),o||e.if((0,codegen_1$3.not)(m),()=>e.break())}}function d(f,m){return(0,codegen_1$3._)`!${f} || !${f}[${m}]`}function u(f,m){const h=[];for(const w in f)f[w]===!0&&h.push((0,codegen_1$3._)`${m} !== ${w}`);return(0,codegen_1$3.and)(...h)}}};unevaluatedProperties.default=def$3;var unevaluatedItems={};Object.defineProperty(unevaluatedItems,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$1=util,error$2={message:({params:{len:r}})=>(0,codegen_1$2.str)`must NOT have more than ${r} items`,params:({params:{len:r}})=>(0,codegen_1$2._)`{limit: ${r}}`},def$2={keyword:"unevaluatedItems",type:"array",schemaType:["boolean","object"],error:error$2,code(r){const{gen:e,schema:n,data:a,it:i}=r,s=i.items||0;if(s===!0)return;const o=e.const("len",(0,codegen_1$2._)`${a}.length`);if(n===!1)r.setParams({len:s}),r.fail((0,codegen_1$2._)`${o} > ${s}`);else if(typeof n=="object"&&!(0,util_1$1.alwaysValidSchema)(i,n)){const c=e.var("valid",(0,codegen_1$2._)`${o} <= ${s}`);e.if((0,codegen_1$2.not)(c),()=>l(c,s)),r.ok(c)}i.items=!0;function l(c,d){e.forRange("i",d,o,u=>{r.subschema({keyword:"unevaluatedItems",dataProp:u,dataPropType:util_1$1.Type.Num},c),i.allErrors||e.if((0,codegen_1$2.not)(c),()=>e.break())})}}};unevaluatedItems.default=def$2;Object.defineProperty(unevaluated$2,"__esModule",{value:!0});const unevaluatedProperties_1=unevaluatedProperties,unevaluatedItems_1=unevaluatedItems,unevaluated$1=[unevaluatedProperties_1.default,unevaluatedItems_1.default];unevaluated$2.default=unevaluated$1;var format$3={},format$2={};Object.defineProperty(format$2,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:r})=>(0,codegen_1$1.str)`must match format "${r}"`,params:({schemaCode:r})=>(0,codegen_1$1._)`{format: ${r}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(r,e){const{gen:n,data:a,$data:i,schema:s,schemaCode:o,it:l}=r,{opts:c,errSchemaPath:d,schemaEnv:u,self:f}=l;if(!c.validateFormats)return;i?m():h();function m(){const w=n.scopeValue("formats",{ref:f.formats,code:c.code.formats}),$=n.const("fDef",(0,codegen_1$1._)`${w}[${o}]`),_=n.let("fType"),p=n.let("format");n.if((0,codegen_1$1._)`typeof ${$} == "object" && !(${$} instanceof RegExp)`,()=>n.assign(_,(0,codegen_1$1._)`${$}.type || "string"`).assign(p,(0,codegen_1$1._)`${$}.validate`),()=>n.assign(_,(0,codegen_1$1._)`"string"`).assign(p,$)),r.fail$data((0,codegen_1$1.or)(b(),v()));function b(){return c.strictSchema===!1?codegen_1$1.nil:(0,codegen_1$1._)`${o} && !${p}`}function v(){const j=u.$async?(0,codegen_1$1._)`(${$}.async ? await ${p}(${a}) : ${p}(${a}))`:(0,codegen_1$1._)`${p}(${a})`,U=(0,codegen_1$1._)`(typeof ${p} == "function" ? ${j} : ${p}.test(${a}))`;return(0,codegen_1$1._)`${p} && ${p} !== true && ${_} === ${e} && !${U}`}}function h(){const w=f.formats[s];if(!w){b();return}if(w===!0)return;const[$,_,p]=v(w);$===e&&r.pass(j());function b(){if(c.strictSchema===!1){f.logger.warn(U());return}throw new Error(U());function U(){return`unknown format "${s}" ignored in schema at path "${d}"`}}function v(U){const B=U instanceof RegExp?(0,codegen_1$1.regexpCode)(U):c.code.formats?(0,codegen_1$1._)`${c.code.formats}${(0,codegen_1$1.getProperty)(s)}`:void 0,T=n.scopeValue("formats",{key:s,ref:U,code:B});return typeof U=="object"&&!(U instanceof RegExp)?[U.type||"string",U.validate,(0,codegen_1$1._)`${T}.validate`]:["string",U,T]}function j(){if(typeof w=="object"&&!(w instanceof RegExp)&&w.async){if(!u.$async)throw new Error("async format in sync schema");return(0,codegen_1$1._)`await ${p}(${a})`}return typeof _=="function"?(0,codegen_1$1._)`${p}(${a})`:(0,codegen_1$1._)`${p}.test(${a})`}}}};format$2.default=def$1;Object.defineProperty(format$3,"__esModule",{value:!0});const format_1$2=format$2,format$1=[format_1$2.default];format$3.default=format$1;var metadata$1={};Object.defineProperty(metadata$1,"__esModule",{value:!0});metadata$1.contentVocabulary=metadata$1.metadataVocabulary=void 0;metadata$1.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];metadata$1.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(draft2020,"__esModule",{value:!0});const core_1$1=core$2,validation_1$1=validation$2,applicator_1$1=applicator$1,dynamic_1=dynamic$1,next_1=next$1,unevaluated_1=unevaluated$2,format_1$1=format$3,metadata_1$1=metadata$1,draft2020Vocabularies=[dynamic_1.default,core_1$1.default,validation_1$1.default,(0,applicator_1$1.default)(!0),format_1$1.default,metadata_1$1.metadataVocabulary,metadata_1$1.contentVocabulary,next_1.default,unevaluated_1.default];draft2020.default=draft2020Vocabularies;var discriminator={},types={};Object.defineProperty(types,"__esModule",{value:!0});types.DiscrError=void 0;var DiscrError;(function(r){r.Tag="tag",r.Mapping="mapping"})(DiscrError||(types.DiscrError=DiscrError={}));Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,ref_error_1=ref_error,util_1=util,error={message:({params:{discrError:r,tagName:e}})=>r===types_1.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:r,tag:e,tagName:n}})=>(0,codegen_1._)`{error: ${r}, tag: ${n}, tagValue: ${e}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error,code(r){const{gen:e,data:n,schema:a,parentSchema:i,it:s}=r,{oneOf:o}=i;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");const l=a.propertyName;if(typeof l!="string")throw new Error("discriminator: requires propertyName");if(a.mapping)throw new Error("discriminator: mapping is not supported");if(!o)throw new Error("discriminator: requires oneOf keyword");const c=e.let("valid",!1),d=e.const("tag",(0,codegen_1._)`${n}${(0,codegen_1.getProperty)(l)}`);e.if((0,codegen_1._)`typeof ${d} == "string"`,()=>u(),()=>r.error(!1,{discrError:types_1.DiscrError.Tag,tag:d,tagName:l})),r.ok(c);function u(){const h=m();e.if(!1);for(const w in h)e.elseIf((0,codegen_1._)`${d} === ${w}`),e.assign(c,f(h[w]));e.else(),r.error(!1,{discrError:types_1.DiscrError.Mapping,tag:d,tagName:l}),e.endIf()}function f(h){const w=e.name("valid"),$=r.subschema({keyword:"oneOf",schemaProp:h},w);return r.mergeEvaluated($,codegen_1.Name),w}function m(){var h;const w={},$=p(i);let _=!0;for(let j=0;j<o.length;j++){let U=o[j];if(U!=null&&U.$ref&&!(0,util_1.schemaHasRulesButRef)(U,s.self.RULES)){const T=U.$ref;if(U=compile_1.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,T),U instanceof compile_1.SchemaEnv&&(U=U.schema),U===void 0)throw new ref_error_1.default(s.opts.uriResolver,s.baseId,T)}const B=(h=U==null?void 0:U.properties)===null||h===void 0?void 0:h[l];if(typeof B!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${l}"`);_=_&&($||p(U)),b(B,j)}if(!_)throw new Error(`discriminator: "${l}" must be required`);return w;function p({required:j}){return Array.isArray(j)&&j.includes(l)}function b(j,U){if(j.const)v(j.const,U);else if(j.enum)for(const B of j.enum)v(B,U);else throw new Error(`discriminator: "properties/${l}" must have "const" or "enum"`)}function v(j,U){if(typeof j!="string"||j in w)throw new Error(`discriminator: "${l}" values must be unique strings`);w[j]=U}}}};discriminator.default=def;var jsonSchema202012={};const $schema$8="https://json-schema.org/draft/2020-12/schema",$id$8="https://json-schema.org/draft/2020-12/schema",$vocabulary$7={"https://json-schema.org/draft/2020-12/vocab/core":!0,"https://json-schema.org/draft/2020-12/vocab/applicator":!0,"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0,"https://json-schema.org/draft/2020-12/vocab/validation":!0,"https://json-schema.org/draft/2020-12/vocab/meta-data":!0,"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0,"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$7="meta",title$8="Core and Validation specifications meta-schema",allOf=[{$ref:"meta/core"},{$ref:"meta/applicator"},{$ref:"meta/unevaluated"},{$ref:"meta/validation"},{$ref:"meta/meta-data"},{$ref:"meta/format-annotation"},{$ref:"meta/content"}],type$8=["object","boolean"],$comment="This meta-schema also defines keywords that have appeared in previous drafts in order to prevent incompatible extensions as they remain in common use.",properties$8={definitions:{$comment:'"definitions" has been replaced by "$defs".',type:"object",additionalProperties:{$dynamicRef:"#meta"},deprecated:!0,default:{}},dependencies:{$comment:'"dependencies" has been split and replaced by "dependentSchemas" and "dependentRequired" in order to serve their differing semantics.',type:"object",additionalProperties:{anyOf:[{$dynamicRef:"#meta"},{$ref:"meta/validation#/$defs/stringArray"}]},deprecated:!0,default:{}},$recursiveAnchor:{$comment:'"$recursiveAnchor" has been replaced by "$dynamicAnchor".',$ref:"meta/core#/$defs/anchorString",deprecated:!0},$recursiveRef:{$comment:'"$recursiveRef" has been replaced by "$dynamicRef".',$ref:"meta/core#/$defs/uriReferenceString",deprecated:!0}},require$$0={$schema:$schema$8,$id:$id$8,$vocabulary:$vocabulary$7,$dynamicAnchor:$dynamicAnchor$7,title:title$8,allOf,type:type$8,$comment,properties:properties$8},$schema$7="https://json-schema.org/draft/2020-12/schema",$id$7="https://json-schema.org/draft/2020-12/meta/applicator",$vocabulary$6={"https://json-schema.org/draft/2020-12/vocab/applicator":!0},$dynamicAnchor$6="meta",title$7="Applicator vocabulary meta-schema",type$7=["object","boolean"],properties$7={prefixItems:{$ref:"#/$defs/schemaArray"},items:{$dynamicRef:"#meta"},contains:{$dynamicRef:"#meta"},additionalProperties:{$dynamicRef:"#meta"},properties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},patternProperties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},propertyNames:{format:"regex"},default:{}},dependentSchemas:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},propertyNames:{$dynamicRef:"#meta"},if:{$dynamicRef:"#meta"},then:{$dynamicRef:"#meta"},else:{$dynamicRef:"#meta"},allOf:{$ref:"#/$defs/schemaArray"},anyOf:{$ref:"#/$defs/schemaArray"},oneOf:{$ref:"#/$defs/schemaArray"},not:{$dynamicRef:"#meta"}},$defs$2={schemaArray:{type:"array",minItems:1,items:{$dynamicRef:"#meta"}}},require$$1={$schema:$schema$7,$id:$id$7,$vocabulary:$vocabulary$6,$dynamicAnchor:$dynamicAnchor$6,title:title$7,type:type$7,properties:properties$7,$defs:$defs$2},$schema$6="https://json-schema.org/draft/2020-12/schema",$id$6="https://json-schema.org/draft/2020-12/meta/unevaluated",$vocabulary$5={"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0},$dynamicAnchor$5="meta",title$6="Unevaluated applicator vocabulary meta-schema",type$6=["object","boolean"],properties$6={unevaluatedItems:{$dynamicRef:"#meta"},unevaluatedProperties:{$dynamicRef:"#meta"}},require$$2={$schema:$schema$6,$id:$id$6,$vocabulary:$vocabulary$5,$dynamicAnchor:$dynamicAnchor$5,title:title$6,type:type$6,properties:properties$6},$schema$5="https://json-schema.org/draft/2020-12/schema",$id$5="https://json-schema.org/draft/2020-12/meta/content",$vocabulary$4={"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$4="meta",title$5="Content vocabulary meta-schema",type$5=["object","boolean"],properties$5={contentEncoding:{type:"string"},contentMediaType:{type:"string"},contentSchema:{$dynamicRef:"#meta"}},require$$3$1={$schema:$schema$5,$id:$id$5,$vocabulary:$vocabulary$4,$dynamicAnchor:$dynamicAnchor$4,title:title$5,type:type$5,properties:properties$5},$schema$4="https://json-schema.org/draft/2020-12/schema",$id$4="https://json-schema.org/draft/2020-12/meta/core",$vocabulary$3={"https://json-schema.org/draft/2020-12/vocab/core":!0},$dynamicAnchor$3="meta",title$4="Core vocabulary meta-schema",type$4=["object","boolean"],properties$4={$id:{$ref:"#/$defs/uriReferenceString",$comment:"Non-empty fragments not allowed.",pattern:"^[^#]*#?$"},$schema:{$ref:"#/$defs/uriString"},$ref:{$ref:"#/$defs/uriReferenceString"},$anchor:{$ref:"#/$defs/anchorString"},$dynamicRef:{$ref:"#/$defs/uriReferenceString"},$dynamicAnchor:{$ref:"#/$defs/anchorString"},$vocabulary:{type:"object",propertyNames:{$ref:"#/$defs/uriString"},additionalProperties:{type:"boolean"}},$comment:{type:"string"},$defs:{type:"object",additionalProperties:{$dynamicRef:"#meta"}}},$defs$1={anchorString:{type:"string",pattern:"^[A-Za-z_][-A-Za-z0-9._]*$"},uriString:{type:"string",format:"uri"},uriReferenceString:{type:"string",format:"uri-reference"}},require$$4={$schema:$schema$4,$id:$id$4,$vocabulary:$vocabulary$3,$dynamicAnchor:$dynamicAnchor$3,title:title$4,type:type$4,properties:properties$4,$defs:$defs$1},$schema$3="https://json-schema.org/draft/2020-12/schema",$id$3="https://json-schema.org/draft/2020-12/meta/format-annotation",$vocabulary$2={"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0},$dynamicAnchor$2="meta",title$3="Format vocabulary meta-schema for annotation results",type$3=["object","boolean"],properties$3={format:{type:"string"}},require$$5={$schema:$schema$3,$id:$id$3,$vocabulary:$vocabulary$2,$dynamicAnchor:$dynamicAnchor$2,title:title$3,type:type$3,properties:properties$3},$schema$2="https://json-schema.org/draft/2020-12/schema",$id$2="https://json-schema.org/draft/2020-12/meta/meta-data",$vocabulary$1={"https://json-schema.org/draft/2020-12/vocab/meta-data":!0},$dynamicAnchor$1="meta",title$2="Meta-data vocabulary meta-schema",type$2=["object","boolean"],properties$2={title:{type:"string"},description:{type:"string"},default:!0,deprecated:{type:"boolean",default:!1},readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0}},require$$6={$schema:$schema$2,$id:$id$2,$vocabulary:$vocabulary$1,$dynamicAnchor:$dynamicAnchor$1,title:title$2,type:type$2,properties:properties$2},$schema$1="https://json-schema.org/draft/2020-12/schema",$id$1="https://json-schema.org/draft/2020-12/meta/validation",$vocabulary={"https://json-schema.org/draft/2020-12/vocab/validation":!0},$dynamicAnchor="meta",title$1="Validation vocabulary meta-schema",type$1=["object","boolean"],properties$1={type:{anyOf:[{$ref:"#/$defs/simpleTypes"},{type:"array",items:{$ref:"#/$defs/simpleTypes"},minItems:1,uniqueItems:!0}]},const:!0,enum:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/$defs/nonNegativeInteger"},minLength:{$ref:"#/$defs/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},maxItems:{$ref:"#/$defs/nonNegativeInteger"},minItems:{$ref:"#/$defs/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxContains:{$ref:"#/$defs/nonNegativeInteger"},minContains:{$ref:"#/$defs/nonNegativeInteger",default:1},maxProperties:{$ref:"#/$defs/nonNegativeInteger"},minProperties:{$ref:"#/$defs/nonNegativeIntegerDefault0"},required:{$ref:"#/$defs/stringArray"},dependentRequired:{type:"object",additionalProperties:{$ref:"#/$defs/stringArray"}}},$defs={nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{$ref:"#/$defs/nonNegativeInteger",default:0},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},require$$7={$schema:$schema$1,$id:$id$1,$vocabulary,$dynamicAnchor,title:title$1,type:type$1,properties:properties$1,$defs};Object.defineProperty(jsonSchema202012,"__esModule",{value:!0});const metaSchema=require$$0,applicator=require$$1,unevaluated=require$$2,content=require$$3$1,core=require$$4,format=require$$5,metadata=require$$6,validation=require$$7,META_SUPPORT_DATA=["/properties"];function addMetaSchema2020(r){return[metaSchema,applicator,unevaluated,content,core,e(this,format),metadata,e(this,validation)].forEach(n=>this.addMetaSchema(n,void 0,!1)),this;function e(n,a){return r?n.$dataMetaSchema(a,META_SUPPORT_DATA):a}}jsonSchema202012.default=addMetaSchema2020;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv2020=void 0;const n=core$3,a=draft2020,i=discriminator,s=jsonSchema202012,o="https://json-schema.org/draft/2020-12/schema";class l extends n.default{constructor(h={}){super({...h,dynamicRef:!0,next:!0,unevaluated:!0})}_addVocabularies(){super._addVocabularies(),a.default.forEach(h=>this.addVocabulary(h)),this.opts.discriminator&&this.addKeyword(i.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema();const{$data:h,meta:w}=this.opts;w&&(s.default.call(this,h),this.refs["http://json-schema.org/schema"]=o)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(o)?o:void 0)}}e.Ajv2020=l,r.exports=e=l,r.exports.Ajv2020=l,Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var c=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return c.KeywordCxt}});var d=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var u=validation_error;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return u.default}});var f=ref_error;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return f.default}})})(_2020,_2020.exports);var _2020Exports=_2020.exports,dist={exports:{}},formats={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.formatNames=r.fastFormats=r.fullFormats=void 0;function e(R,z){return{validate:R,compare:z}}r.fullFormats={date:e(s,o),time:e(c(!0),d),"date-time":e(m(!0),h),"iso-time":e(c(),u),"iso-date-time":e(m(),w),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:p,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:V,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:v,int32:{type:"number",validate:B},int64:{type:"number",validate:T},float:{type:"number",validate:A},double:{type:"number",validate:A},password:!0,binary:!0},r.fastFormats={...r.fullFormats,date:e(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,o),time:e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,d),"date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,h),"iso-time":e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,u),"iso-date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,w),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},r.formatNames=Object.keys(r.fullFormats);function n(R){return R%4===0&&(R%100!==0||R%400===0)}const a=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,i=[0,31,28,31,30,31,30,31,31,30,31,30,31];function s(R){const z=a.exec(R);if(!z)return!1;const x=+z[1],M=+z[2],q=+z[3];return M>=1&&M<=12&&q>=1&&q<=(M===2&&n(x)?29:i[M])}function o(R,z){if(R&&z)return R>z?1:R<z?-1:0}const l=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function c(R){return function(x){const M=l.exec(x);if(!M)return!1;const q=+M[1],X=+M[2],Z=+M[3],L=M[4],K=M[5]==="-"?-1:1,y=+(M[6]||0),E=+(M[7]||0);if(y>23||E>59||R&&!L)return!1;if(q<=23&&X<=59&&Z<60)return!0;const C=X-E*K,S=q-y*K-(C<0?1:0);return(S===23||S===-1)&&(C===59||C===-1)&&Z<61}}function d(R,z){if(!(R&&z))return;const x=new Date("2020-01-01T"+R).valueOf(),M=new Date("2020-01-01T"+z).valueOf();if(x&&M)return x-M}function u(R,z){if(!(R&&z))return;const x=l.exec(R),M=l.exec(z);if(x&&M)return R=x[1]+x[2]+x[3],z=M[1]+M[2]+M[3],R>z?1:R<z?-1:0}const f=/t|\s/i;function m(R){const z=c(R);return function(M){const q=M.split(f);return q.length===2&&s(q[0])&&z(q[1])}}function h(R,z){if(!(R&&z))return;const x=new Date(R).valueOf(),M=new Date(z).valueOf();if(x&&M)return x-M}function w(R,z){if(!(R&&z))return;const[x,M]=R.split(f),[q,X]=z.split(f),Z=o(x,q);if(Z!==void 0)return Z||d(M,X)}const $=/\/|:/,_=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function p(R){return $.test(R)&&_.test(R)}const b=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function v(R){return b.lastIndex=0,b.test(R)}const j=-2147483648,U=2**31-1;function B(R){return Number.isInteger(R)&&R<=U&&R>=j}function T(R){return Number.isInteger(R)}function A(){return!0}const ce=/[^\\]\\Z/;function V(R){if(ce.test(R))return!1;try{return new RegExp(R),!0}catch{return!1}}})(formats);var limit={},ajv={exports:{}},draft7={};Object.defineProperty(draft7,"__esModule",{value:!0});const core_1=core$2,validation_1=validation$2,applicator_1=applicator$1,format_1=format$3,metadata_1=metadata$1,draft7Vocabularies=[core_1.default,validation_1.default,(0,applicator_1.default)(),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary];draft7.default=draft7Vocabularies;const $schema="http://json-schema.org/draft-07/schema#",$id="http://json-schema.org/draft-07/schema#",title="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type=["object","boolean"],properties={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema,$id,title,definitions,type,properties,default:!0};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=e.Ajv=void 0;const n=core$3,a=draft7,i=discriminator,s=require$$3,o=["/properties"],l="http://json-schema.org/draft-07/schema";class c extends n.default{_addVocabularies(){super._addVocabularies(),a.default.forEach(w=>this.addVocabulary(w)),this.opts.discriminator&&this.addKeyword(i.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const w=this.opts.$data?this.$dataMetaSchema(s,o):s;this.addMetaSchema(w,l,!1),this.refs["http://json-schema.org/schema"]=l}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(l)?l:void 0)}}e.Ajv=c,r.exports=e=c,r.exports.Ajv=c,Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var d=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return d.KeywordCxt}});var u=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return u._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return u.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return u.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return u.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return u.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return u.CodeGen}});var f=validation_error;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return f.default}});var m=ref_error;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return m.default}})})(ajv,ajv.exports);var ajvExports=ajv.exports;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.formatLimitDefinition=void 0;const e=ajvExports,n=codegen,a=n.operators,i={formatMaximum:{okStr:"<=",ok:a.LTE,fail:a.GT},formatMinimum:{okStr:">=",ok:a.GTE,fail:a.LT},formatExclusiveMaximum:{okStr:"<",ok:a.LT,fail:a.GTE},formatExclusiveMinimum:{okStr:">",ok:a.GT,fail:a.LTE}},s={message:({keyword:l,schemaCode:c})=>(0,n.str)`should be ${i[l].okStr} ${c}`,params:({keyword:l,schemaCode:c})=>(0,n._)`{comparison: ${i[l].okStr}, limit: ${c}}`};r.formatLimitDefinition={keyword:Object.keys(i),type:"string",schemaType:"string",$data:!0,error:s,code(l){const{gen:c,data:d,schemaCode:u,keyword:f,it:m}=l,{opts:h,self:w}=m;if(!h.validateFormats)return;const $=new e.KeywordCxt(m,w.RULES.all.format.definition,"format");$.$data?_():p();function _(){const v=c.scopeValue("formats",{ref:w.formats,code:h.code.formats}),j=c.const("fmt",(0,n._)`${v}[${$.schemaCode}]`);l.fail$data((0,n.or)((0,n._)`typeof ${j} != "object"`,(0,n._)`${j} instanceof RegExp`,(0,n._)`typeof ${j}.compare != "function"`,b(j)))}function p(){const v=$.schema,j=w.formats[v];if(!j||j===!0)return;if(typeof j!="object"||j instanceof RegExp||typeof j.compare!="function")throw new Error(`"${f}": format "${v}" does not define "compare" function`);const U=c.scopeValue("formats",{key:v,ref:j,code:h.code.formats?(0,n._)`${h.code.formats}${(0,n.getProperty)(v)}`:void 0});l.fail$data(b(U))}function b(v){return(0,n._)`${v}.compare(${d}, ${u}) ${i[f].fail} 0`}},dependencies:["format"]};const o=l=>(l.addKeyword(r.formatLimitDefinition),l);r.default=o})(limit);(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});const n=formats,a=limit,i=codegen,s=new i.Name("fullFormats"),o=new i.Name("fastFormats"),l=(d,u={keywords:!0})=>{if(Array.isArray(u))return c(d,u,n.fullFormats,s),d;const[f,m]=u.mode==="fast"?[n.fastFormats,o]:[n.fullFormats,s],h=u.formats||n.formatNames;return c(d,h,f,m),u.keywords&&(0,a.default)(d),d};l.get=(d,u="full")=>{const m=(u==="fast"?n.fastFormats:n.fullFormats)[d];if(!m)throw new Error(`Unknown format "${d}"`);return m};function c(d,u,f,m){var h,w;(h=(w=d.opts.code).formats)!==null&&h!==void 0||(w.formats=(0,i._)`require("ajv-formats/dist/formats").${m}`);for(const $ of u)d.addFormat($,f[$])}r.exports=e=l,Object.defineProperty(e,"__esModule",{value:!0}),e.default=l})(dist,dist.exports);var distExports=dist.exports;const ajvFormatsModule=getDefaultExportFromCjs(distExports),copyProperty=(r,e,n,a)=>{if(n==="length"||n==="prototype"||n==="arguments"||n==="caller")return;const i=Object.getOwnPropertyDescriptor(r,n),s=Object.getOwnPropertyDescriptor(e,n);!canCopyProperty(i,s)&&a||Object.defineProperty(r,n,s)},canCopyProperty=function(r,e){return r===void 0||r.configurable||r.writable===e.writable&&r.enumerable===e.enumerable&&r.configurable===e.configurable&&(r.writable||r.value===e.value)},changePrototype=(r,e)=>{const n=Object.getPrototypeOf(e);n!==Object.getPrototypeOf(r)&&Object.setPrototypeOf(r,n)},wrappedToString=(r,e)=>`/* Wrapped ${r}*/
${e}`,toStringDescriptor=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),toStringName=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),changeToString=(r,e,n)=>{const a=n===""?"":`with ${n.trim()}() `,i=wrappedToString.bind(null,a,e.toString());Object.defineProperty(i,"name",toStringName);const{writable:s,enumerable:o,configurable:l}=toStringDescriptor;Object.defineProperty(r,"toString",{value:i,writable:s,enumerable:o,configurable:l})};function mimicFunction(r,e,{ignoreNonConfigurable:n=!1}={}){const{name:a}=r;for(const i of Reflect.ownKeys(e))copyProperty(r,e,i,n);return changePrototype(r,e),changeToString(r,e,a),r}const debounceFunction=(r,e={})=>{if(typeof r!="function")throw new TypeError(`Expected the first argument to be a function, got \`${typeof r}\``);const{wait:n=0,maxWait:a=Number.POSITIVE_INFINITY,before:i=!1,after:s=!0}=e;if(n<0||a<0)throw new RangeError("`wait` and `maxWait` must not be negative.");if(!i&&!s)throw new Error("Both `before` and `after` are false, function wouldn't be called.");let o,l,c;const d=function(...u){const f=this,m=()=>{o=void 0,l&&(clearTimeout(l),l=void 0),s&&(c=r.apply(f,u))},h=()=>{l=void 0,o&&(clearTimeout(o),o=void 0),s&&(c=r.apply(f,u))},w=i&&!o;return clearTimeout(o),o=setTimeout(m,n),a>0&&a!==Number.POSITIVE_INFINITY&&!l&&(l=setTimeout(h,a)),w&&(c=r.apply(f,u)),c};return mimicFunction(d,r),d.cancel=()=>{o&&(clearTimeout(o),o=void 0),l&&(clearTimeout(l),l=void 0)},d};var re$2={exports:{}};const SEMVER_SPEC_VERSION="2.0.0",MAX_LENGTH$1=256,MAX_SAFE_INTEGER$1=Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH=16,MAX_SAFE_BUILD_LENGTH=MAX_LENGTH$1-6,RELEASE_TYPES=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var constants$1={MAX_LENGTH:MAX_LENGTH$1,MAX_SAFE_COMPONENT_LENGTH,MAX_SAFE_BUILD_LENGTH,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER$1,RELEASE_TYPES,SEMVER_SPEC_VERSION,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const debug$1=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var debug_1=debug$1;(function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:i}=constants$1,s=debug_1;e=r.exports={};const o=e.re=[],l=e.safeRe=[],c=e.src=[],d=e.safeSrc=[],u=e.t={};let f=0;const m="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[m,a]],w=_=>{for(const[p,b]of h)_=_.split(`${p}*`).join(`${p}{0,${b}}`).split(`${p}+`).join(`${p}{1,${b}}`);return _},$=(_,p,b)=>{const v=w(p),j=f++;s(_,j,p),u[_]=j,c[j]=p,d[j]=v,o[j]=new RegExp(p,b?"g":void 0),l[j]=new RegExp(v,b?"g":void 0)};$("NUMERICIDENTIFIER","0|[1-9]\\d*"),$("NUMERICIDENTIFIERLOOSE","\\d+"),$("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${m}*`),$("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),$("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),$("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),$("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),$("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),$("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),$("BUILDIDENTIFIER",`${m}+`),$("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),$("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),$("FULL",`^${c[u.FULLPLAIN]}$`),$("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),$("LOOSE",`^${c[u.LOOSEPLAIN]}$`),$("GTLT","((?:<|>)?=?)"),$("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),$("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),$("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),$("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),$("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),$("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),$("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),$("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),$("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?(?:${c[u.BUILD]})?(?:$|[^\\d])`),$("COERCERTL",c[u.COERCE],!0),$("COERCERTLFULL",c[u.COERCEFULL],!0),$("LONETILDE","(?:~>?)"),$("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",$("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),$("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),$("LONECARET","(?:\\^)"),$("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",$("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),$("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),$("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),$("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),$("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",$("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),$("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),$("STAR","(<|>)?=?\\s*\\*"),$("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),$("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(re$2,re$2.exports);var reExports=re$2.exports;const looseOption=Object.freeze({loose:!0}),emptyOpts=Object.freeze({}),parseOptions$1=r=>r?typeof r!="object"?looseOption:r:emptyOpts;var parseOptions_1=parseOptions$1;const numeric=/^[0-9]+$/,compareIdentifiers$1=(r,e)=>{const n=numeric.test(r),a=numeric.test(e);return n&&a&&(r=+r,e=+e),r===e?0:n&&!a?-1:a&&!n?1:r<e?-1:1},rcompareIdentifiers=(r,e)=>compareIdentifiers$1(e,r);var identifiers$1={compareIdentifiers:compareIdentifiers$1,rcompareIdentifiers};const debug=debug_1,{MAX_LENGTH,MAX_SAFE_INTEGER}=constants$1,{safeRe:re$1,safeSrc:src,t:t$1}=reExports,parseOptions=parseOptions_1,{compareIdentifiers}=identifiers$1;let SemVer$d=class we{constructor(e,n){if(n=parseOptions(n),e instanceof we){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>MAX_LENGTH)throw new TypeError(`version is longer than ${MAX_LENGTH} characters`);debug("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const a=e.trim().match(n.loose?re$1[t$1.LOOSE]:re$1[t$1.FULL]);if(!a)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+a[1],this.minor=+a[2],this.patch=+a[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");a[4]?this.prerelease=a[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<MAX_SAFE_INTEGER)return s}return i}):this.prerelease=[],this.build=a[5]?a[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(debug("SemVer.compare",this.version,this.options,e),!(e instanceof we)){if(typeof e=="string"&&e===this.version)return 0;e=new we(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof we||(e=new we(e,this.options)),compareIdentifiers(this.major,e.major)||compareIdentifiers(this.minor,e.minor)||compareIdentifiers(this.patch,e.patch)}comparePre(e){if(e instanceof we||(e=new we(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const a=this.prerelease[n],i=e.prerelease[n];if(debug("prerelease compare",n,a,i),a===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(a===void 0)return-1;if(a===i)continue;return compareIdentifiers(a,i)}while(++n)}compareBuild(e){e instanceof we||(e=new we(e,this.options));let n=0;do{const a=this.build[n],i=e.build[n];if(debug("build compare",n,a,i),a===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(a===void 0)return-1;if(a===i)continue;return compareIdentifiers(a,i)}while(++n)}inc(e,n,a){if(e.startsWith("pre")){if(!n&&a===!1)throw new Error("invalid increment argument: identifier is empty");if(n){const i=new RegExp(`^${this.options.loose?src[t$1.PRERELEASELOOSE]:src[t$1.PRERELEASE]}$`),s=`-${n}`.match(i);if(!s||s[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,a);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,a);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,a),this.inc("pre",n,a);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,a),this.inc("pre",n,a);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(a)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&a===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(n){let s=[n,i];a===!1&&(s=[n]),compareIdentifiers(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var semver$2=SemVer$d;const SemVer$c=semver$2,parse$6=(r,e,n=!1)=>{if(r instanceof SemVer$c)return r;try{return new SemVer$c(r,e)}catch(a){if(!n)return null;throw a}};var parse_1=parse$6;const parse$5=parse_1,valid$2=(r,e)=>{const n=parse$5(r,e);return n?n.version:null};var valid_1=valid$2;const parse$4=parse_1,clean$1=(r,e)=>{const n=parse$4(r.trim().replace(/^[=v]+/,""),e);return n?n.version:null};var clean_1=clean$1;const SemVer$b=semver$2,inc$1=(r,e,n,a,i)=>{typeof n=="string"&&(i=a,a=n,n=void 0);try{return new SemVer$b(r instanceof SemVer$b?r.version:r,n).inc(e,a,i).version}catch{return null}};var inc_1=inc$1;const parse$3=parse_1,diff$1=(r,e)=>{const n=parse$3(r,null,!0),a=parse$3(e,null,!0),i=n.compare(a);if(i===0)return null;const s=i>0,o=s?n:a,l=s?a:n,c=!!o.prerelease.length;if(!!l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(l.compareMain(o)===0)return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return n.major!==a.major?u+"major":n.minor!==a.minor?u+"minor":n.patch!==a.patch?u+"patch":"prerelease"};var diff_1=diff$1;const SemVer$a=semver$2,major$1=(r,e)=>new SemVer$a(r,e).major;var major_1=major$1;const SemVer$9=semver$2,minor$1=(r,e)=>new SemVer$9(r,e).minor;var minor_1=minor$1;const SemVer$8=semver$2,patch$1=(r,e)=>new SemVer$8(r,e).patch;var patch_1=patch$1;const parse$2=parse_1,prerelease$1=(r,e)=>{const n=parse$2(r,e);return n&&n.prerelease.length?n.prerelease:null};var prerelease_1=prerelease$1;const SemVer$7=semver$2,compare$b=(r,e,n)=>new SemVer$7(r,n).compare(new SemVer$7(e,n));var compare_1=compare$b;const compare$a=compare_1,rcompare$1=(r,e,n)=>compare$a(e,r,n);var rcompare_1=rcompare$1;const compare$9=compare_1,compareLoose$1=(r,e)=>compare$9(r,e,!0);var compareLoose_1=compareLoose$1;const SemVer$6=semver$2,compareBuild$3=(r,e,n)=>{const a=new SemVer$6(r,n),i=new SemVer$6(e,n);return a.compare(i)||a.compareBuild(i)};var compareBuild_1=compareBuild$3;const compareBuild$2=compareBuild_1,sort$1=(r,e)=>r.sort((n,a)=>compareBuild$2(n,a,e));var sort_1=sort$1;const compareBuild$1=compareBuild_1,rsort$1=(r,e)=>r.sort((n,a)=>compareBuild$1(a,n,e));var rsort_1=rsort$1;const compare$8=compare_1,gt$4=(r,e,n)=>compare$8(r,e,n)>0;var gt_1=gt$4;const compare$7=compare_1,lt$3=(r,e,n)=>compare$7(r,e,n)<0;var lt_1=lt$3;const compare$6=compare_1,eq$2=(r,e,n)=>compare$6(r,e,n)===0;var eq_1=eq$2;const compare$5=compare_1,neq$2=(r,e,n)=>compare$5(r,e,n)!==0;var neq_1=neq$2;const compare$4=compare_1,gte$3=(r,e,n)=>compare$4(r,e,n)>=0;var gte_1=gte$3;const compare$3=compare_1,lte$3=(r,e,n)=>compare$3(r,e,n)<=0;var lte_1=lte$3;const eq$1=eq_1,neq$1=neq_1,gt$3=gt_1,gte$2=gte_1,lt$2=lt_1,lte$2=lte_1,cmp$1=(r,e,n,a)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof n=="object"&&(n=n.version),r===n;case"!==":return typeof r=="object"&&(r=r.version),typeof n=="object"&&(n=n.version),r!==n;case"":case"=":case"==":return eq$1(r,n,a);case"!=":return neq$1(r,n,a);case">":return gt$3(r,n,a);case">=":return gte$2(r,n,a);case"<":return lt$2(r,n,a);case"<=":return lte$2(r,n,a);default:throw new TypeError(`Invalid operator: ${e}`)}};var cmp_1=cmp$1;const SemVer$5=semver$2,parse$1=parse_1,{safeRe:re,t}=reExports,coerce$1=(r,e)=>{if(r instanceof SemVer$5)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let n=null;if(!e.rtl)n=r.match(e.includePrerelease?re[t.COERCEFULL]:re[t.COERCE]);else{const c=e.includePrerelease?re[t.COERCERTLFULL]:re[t.COERCERTL];let d;for(;(d=c.exec(r))&&(!n||n.index+n[0].length!==r.length);)(!n||d.index+d[0].length!==n.index+n[0].length)&&(n=d),c.lastIndex=d.index+d[1].length+d[2].length;c.lastIndex=-1}if(n===null)return null;const a=n[2],i=n[3]||"0",s=n[4]||"0",o=e.includePrerelease&&n[5]?`-${n[5]}`:"",l=e.includePrerelease&&n[6]?`+${n[6]}`:"";return parse$1(`${a}.${i}.${s}${o}${l}`,e)};var coerce_1=coerce$1;class LRUCache{constructor(){this.max=1e3,this.map=new Map}get(e){const n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(e,n)}return this}}var lrucache=LRUCache,range,hasRequiredRange;function requireRange(){if(hasRequiredRange)return range;hasRequiredRange=1;const r=/\s+/g;class e{constructor(q,X){if(X=i(X),q instanceof e)return q.loose===!!X.loose&&q.includePrerelease===!!X.includePrerelease?q:new e(q.raw,X);if(q instanceof s)return this.raw=q.value,this.set=[[q]],this.formatted=void 0,this;if(this.options=X,this.loose=!!X.loose,this.includePrerelease=!!X.includePrerelease,this.raw=q.trim().replace(r," "),this.set=this.raw.split("||").map(Z=>this.parseRange(Z.trim())).filter(Z=>Z.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const Z=this.set[0];if(this.set=this.set.filter(L=>!$(L[0])),this.set.length===0)this.set=[Z];else if(this.set.length>1){for(const L of this.set)if(L.length===1&&_(L[0])){this.set=[L];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let q=0;q<this.set.length;q++){q>0&&(this.formatted+="||");const X=this.set[q];for(let Z=0;Z<X.length;Z++)Z>0&&(this.formatted+=" "),this.formatted+=X[Z].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(q){const Z=((this.options.includePrerelease&&h)|(this.options.loose&&w))+":"+q,L=a.get(Z);if(L)return L;const K=this.options.loose,y=K?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];q=q.replace(y,z(this.options.includePrerelease)),o("hyphen replace",q),q=q.replace(c[d.COMPARATORTRIM],u),o("comparator trim",q),q=q.replace(c[d.TILDETRIM],f),o("tilde trim",q),q=q.replace(c[d.CARETTRIM],m),o("caret trim",q);let E=q.split(" ").map(k=>b(k,this.options)).join(" ").split(/\s+/).map(k=>R(k,this.options));K&&(E=E.filter(k=>(o("loose invalid filter",k,this.options),!!k.match(c[d.COMPARATORLOOSE])))),o("range list",E);const C=new Map,S=E.map(k=>new s(k,this.options));for(const k of S){if($(k))return[k];C.set(k.value,k)}C.size>1&&C.has("")&&C.delete("");const g=[...C.values()];return a.set(Z,g),g}intersects(q,X){if(!(q instanceof e))throw new TypeError("a Range is required");return this.set.some(Z=>p(Z,X)&&q.set.some(L=>p(L,X)&&Z.every(K=>L.every(y=>K.intersects(y,X)))))}test(q){if(!q)return!1;if(typeof q=="string")try{q=new l(q,this.options)}catch{return!1}for(let X=0;X<this.set.length;X++)if(x(this.set[X],q,this.options))return!0;return!1}}range=e;const n=lrucache,a=new n,i=parseOptions_1,s=requireComparator(),o=debug_1,l=semver$2,{safeRe:c,t:d,comparatorTrimReplace:u,tildeTrimReplace:f,caretTrimReplace:m}=reExports,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:w}=constants$1,$=M=>M.value==="<0.0.0-0",_=M=>M.value==="",p=(M,q)=>{let X=!0;const Z=M.slice();let L=Z.pop();for(;X&&Z.length;)X=Z.every(K=>L.intersects(K,q)),L=Z.pop();return X},b=(M,q)=>(o("comp",M,q),M=B(M,q),o("caret",M),M=j(M,q),o("tildes",M),M=A(M,q),o("xrange",M),M=V(M,q),o("stars",M),M),v=M=>!M||M.toLowerCase()==="x"||M==="*",j=(M,q)=>M.trim().split(/\s+/).map(X=>U(X,q)).join(" "),U=(M,q)=>{const X=q.loose?c[d.TILDELOOSE]:c[d.TILDE];return M.replace(X,(Z,L,K,y,E)=>{o("tilde",M,Z,L,K,y,E);let C;return v(L)?C="":v(K)?C=`>=${L}.0.0 <${+L+1}.0.0-0`:v(y)?C=`>=${L}.${K}.0 <${L}.${+K+1}.0-0`:E?(o("replaceTilde pr",E),C=`>=${L}.${K}.${y}-${E} <${L}.${+K+1}.0-0`):C=`>=${L}.${K}.${y} <${L}.${+K+1}.0-0`,o("tilde return",C),C})},B=(M,q)=>M.trim().split(/\s+/).map(X=>T(X,q)).join(" "),T=(M,q)=>{o("caret",M,q);const X=q.loose?c[d.CARETLOOSE]:c[d.CARET],Z=q.includePrerelease?"-0":"";return M.replace(X,(L,K,y,E,C)=>{o("caret",M,L,K,y,E,C);let S;return v(K)?S="":v(y)?S=`>=${K}.0.0${Z} <${+K+1}.0.0-0`:v(E)?K==="0"?S=`>=${K}.${y}.0${Z} <${K}.${+y+1}.0-0`:S=`>=${K}.${y}.0${Z} <${+K+1}.0.0-0`:C?(o("replaceCaret pr",C),K==="0"?y==="0"?S=`>=${K}.${y}.${E}-${C} <${K}.${y}.${+E+1}-0`:S=`>=${K}.${y}.${E}-${C} <${K}.${+y+1}.0-0`:S=`>=${K}.${y}.${E}-${C} <${+K+1}.0.0-0`):(o("no pr"),K==="0"?y==="0"?S=`>=${K}.${y}.${E}${Z} <${K}.${y}.${+E+1}-0`:S=`>=${K}.${y}.${E}${Z} <${K}.${+y+1}.0-0`:S=`>=${K}.${y}.${E} <${+K+1}.0.0-0`),o("caret return",S),S})},A=(M,q)=>(o("replaceXRanges",M,q),M.split(/\s+/).map(X=>ce(X,q)).join(" ")),ce=(M,q)=>{M=M.trim();const X=q.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return M.replace(X,(Z,L,K,y,E,C)=>{o("xRange",M,Z,L,K,y,E,C);const S=v(K),g=S||v(y),k=g||v(E),G=k;return L==="="&&G&&(L=""),C=q.includePrerelease?"-0":"",S?L===">"||L==="<"?Z="<0.0.0-0":Z="*":L&&G?(g&&(y=0),E=0,L===">"?(L=">=",g?(K=+K+1,y=0,E=0):(y=+y+1,E=0)):L==="<="&&(L="<",g?K=+K+1:y=+y+1),L==="<"&&(C="-0"),Z=`${L+K}.${y}.${E}${C}`):g?Z=`>=${K}.0.0${C} <${+K+1}.0.0-0`:k&&(Z=`>=${K}.${y}.0${C} <${K}.${+y+1}.0-0`),o("xRange return",Z),Z})},V=(M,q)=>(o("replaceStars",M,q),M.trim().replace(c[d.STAR],"")),R=(M,q)=>(o("replaceGTE0",M,q),M.trim().replace(c[q.includePrerelease?d.GTE0PRE:d.GTE0],"")),z=M=>(q,X,Z,L,K,y,E,C,S,g,k,G)=>(v(Z)?X="":v(L)?X=`>=${Z}.0.0${M?"-0":""}`:v(K)?X=`>=${Z}.${L}.0${M?"-0":""}`:y?X=`>=${X}`:X=`>=${X}${M?"-0":""}`,v(S)?C="":v(g)?C=`<${+S+1}.0.0-0`:v(k)?C=`<${S}.${+g+1}.0-0`:G?C=`<=${S}.${g}.${k}-${G}`:M?C=`<${S}.${g}.${+k+1}-0`:C=`<=${C}`,`${X} ${C}`.trim()),x=(M,q,X)=>{for(let Z=0;Z<M.length;Z++)if(!M[Z].test(q))return!1;if(q.prerelease.length&&!X.includePrerelease){for(let Z=0;Z<M.length;Z++)if(o(M[Z].semver),M[Z].semver!==s.ANY&&M[Z].semver.prerelease.length>0){const L=M[Z].semver;if(L.major===q.major&&L.minor===q.minor&&L.patch===q.patch)return!0}return!1}return!0};return range}var comparator,hasRequiredComparator;function requireComparator(){if(hasRequiredComparator)return comparator;hasRequiredComparator=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(u,f){if(f=n(f),u instanceof e){if(u.loose===!!f.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),o("comparator",u,f),this.options=f,this.loose=!!f.loose,this.parse(u),this.semver===r?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(u){const f=this.options.loose?a[i.COMPARATORLOOSE]:a[i.COMPARATOR],m=u.match(f);if(!m)throw new TypeError(`Invalid comparator: ${u}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new l(m[2],this.options.loose):this.semver=r}toString(){return this.value}test(u){if(o("Comparator.test",u,this.options.loose),this.semver===r||u===r)return!0;if(typeof u=="string")try{u=new l(u,this.options)}catch{return!1}return s(u,this.operator,this.semver,this.options)}intersects(u,f){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(u.value,f).test(this.value):u.operator===""?u.value===""?!0:new c(this.value,f).test(u.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||s(this.semver,"<",u.semver,f)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||s(this.semver,">",u.semver,f)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}comparator=e;const n=parseOptions_1,{safeRe:a,t:i}=reExports,s=cmp_1,o=debug_1,l=semver$2,c=requireRange();return comparator}const Range$9=requireRange(),satisfies$4=(r,e,n)=>{try{e=new Range$9(e,n)}catch{return!1}return e.test(r)};var satisfies_1=satisfies$4;const Range$8=requireRange(),toComparators$1=(r,e)=>new Range$8(r,e).set.map(n=>n.map(a=>a.value).join(" ").trim().split(" "));var toComparators_1=toComparators$1;const SemVer$4=semver$2,Range$7=requireRange(),maxSatisfying$1=(r,e,n)=>{let a=null,i=null,s=null;try{s=new Range$7(e,n)}catch{return null}return r.forEach(o=>{s.test(o)&&(!a||i.compare(o)===-1)&&(a=o,i=new SemVer$4(a,n))}),a};var maxSatisfying_1=maxSatisfying$1;const SemVer$3=semver$2,Range$6=requireRange(),minSatisfying$1=(r,e,n)=>{let a=null,i=null,s=null;try{s=new Range$6(e,n)}catch{return null}return r.forEach(o=>{s.test(o)&&(!a||i.compare(o)===1)&&(a=o,i=new SemVer$3(a,n))}),a};var minSatisfying_1=minSatisfying$1;const SemVer$2=semver$2,Range$5=requireRange(),gt$2=gt_1,minVersion$1=(r,e)=>{r=new Range$5(r,e);let n=new SemVer$2("0.0.0");if(r.test(n)||(n=new SemVer$2("0.0.0-0"),r.test(n)))return n;n=null;for(let a=0;a<r.set.length;++a){const i=r.set[a];let s=null;i.forEach(o=>{const l=new SemVer$2(o.semver.version);switch(o.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!s||gt$2(l,s))&&(s=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||gt$2(n,s))&&(n=s)}return n&&r.test(n)?n:null};var minVersion_1=minVersion$1;const Range$4=requireRange(),validRange$1=(r,e)=>{try{return new Range$4(r,e).range||"*"}catch{return null}};var valid$1=validRange$1;const SemVer$1=semver$2,Comparator$2=requireComparator(),{ANY:ANY$1}=Comparator$2,Range$3=requireRange(),satisfies$3=satisfies_1,gt$1=gt_1,lt$1=lt_1,lte$1=lte_1,gte$1=gte_1,outside$3=(r,e,n,a)=>{r=new SemVer$1(r,a),e=new Range$3(e,a);let i,s,o,l,c;switch(n){case">":i=gt$1,s=lte$1,o=lt$1,l=">",c=">=";break;case"<":i=lt$1,s=gte$1,o=gt$1,l="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies$3(r,e,a))return!1;for(let d=0;d<e.set.length;++d){const u=e.set[d];let f=null,m=null;if(u.forEach(h=>{h.semver===ANY$1&&(h=new Comparator$2(">=0.0.0")),f=f||h,m=m||h,i(h.semver,f.semver,a)?f=h:o(h.semver,m.semver,a)&&(m=h)}),f.operator===l||f.operator===c||(!m.operator||m.operator===l)&&s(r,m.semver))return!1;if(m.operator===c&&o(r,m.semver))return!1}return!0};var outside_1=outside$3;const outside$2=outside_1,gtr$1=(r,e,n)=>outside$2(r,e,">",n);var gtr_1=gtr$1;const outside$1=outside_1,ltr$1=(r,e,n)=>outside$1(r,e,"<",n);var ltr_1=ltr$1;const Range$2=requireRange(),intersects$1=(r,e,n)=>(r=new Range$2(r,n),e=new Range$2(e,n),r.intersects(e,n));var intersects_1=intersects$1;const satisfies$2=satisfies_1,compare$2=compare_1;var simplify=(r,e,n)=>{const a=[];let i=null,s=null;const o=r.sort((u,f)=>compare$2(u,f,n));for(const u of o)satisfies$2(u,e,n)?(s=u,i||(i=u)):(s&&a.push([i,s]),s=null,i=null);i&&a.push([i,null]);const l=[];for(const[u,f]of a)u===f?l.push(u):!f&&u===o[0]?l.push("*"):f?u===o[0]?l.push(`<=${f}`):l.push(`${u} - ${f}`):l.push(`>=${u}`);const c=l.join(" || "),d=typeof e.raw=="string"?e.raw:String(e);return c.length<d.length?c:e};const Range$1=requireRange(),Comparator$1=requireComparator(),{ANY}=Comparator$1,satisfies$1=satisfies_1,compare$1=compare_1,subset$1=(r,e,n={})=>{if(r===e)return!0;r=new Range$1(r,n),e=new Range$1(e,n);let a=!1;e:for(const i of r.set){for(const s of e.set){const o=simpleSubset(i,s,n);if(a=a||o!==null,o)continue e}if(a)return!1}return!0},minimumVersionWithPreRelease=[new Comparator$1(">=0.0.0-0")],minimumVersion=[new Comparator$1(">=0.0.0")],simpleSubset=(r,e,n)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===ANY){if(e.length===1&&e[0].semver===ANY)return!0;n.includePrerelease?r=minimumVersionWithPreRelease:r=minimumVersion}if(e.length===1&&e[0].semver===ANY){if(n.includePrerelease)return!0;e=minimumVersion}const a=new Set;let i,s;for(const h of r)h.operator===">"||h.operator===">="?i=higherGT(i,h,n):h.operator==="<"||h.operator==="<="?s=lowerLT(s,h,n):a.add(h.semver);if(a.size>1)return null;let o;if(i&&s){if(o=compare$1(i.semver,s.semver,n),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const h of a){if(i&&!satisfies$1(h,String(i),n)||s&&!satisfies$1(h,String(s),n))return null;for(const w of e)if(!satisfies$1(h,String(w),n))return!1;return!0}let l,c,d,u,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,m=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const h of e){if(u=u||h.operator===">"||h.operator===">=",d=d||h.operator==="<"||h.operator==="<=",i){if(m&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===m.major&&h.semver.minor===m.minor&&h.semver.patch===m.patch&&(m=!1),h.operator===">"||h.operator===">="){if(l=higherGT(i,h,n),l===h&&l!==i)return!1}else if(i.operator===">="&&!satisfies$1(i.semver,String(h),n))return!1}if(s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator==="<"||h.operator==="<="){if(c=lowerLT(s,h,n),c===h&&c!==s)return!1}else if(s.operator==="<="&&!satisfies$1(s.semver,String(h),n))return!1}if(!h.operator&&(s||i)&&o!==0)return!1}return!(i&&d&&!s&&o!==0||s&&u&&!i&&o!==0||m||f)},higherGT=(r,e,n)=>{if(!r)return e;const a=compare$1(r.semver,e.semver,n);return a>0?r:a<0||e.operator===">"&&r.operator===">="?e:r},lowerLT=(r,e,n)=>{if(!r)return e;const a=compare$1(r.semver,e.semver,n);return a<0?r:a>0||e.operator==="<"&&r.operator==="<="?e:r};var subset_1=subset$1;const internalRe=reExports,constants=constants$1,SemVer=semver$2,identifiers=identifiers$1,parse=parse_1,valid=valid_1,clean=clean_1,inc=inc_1,diff=diff_1,major=major_1,minor=minor_1,patch=patch_1,prerelease=prerelease_1,compare=compare_1,rcompare=rcompare_1,compareLoose=compareLoose_1,compareBuild=compareBuild_1,sort=sort_1,rsort=rsort_1,gt=gt_1,lt=lt_1,eq=eq_1,neq=neq_1,gte=gte_1,lte=lte_1,cmp=cmp_1,coerce=coerce_1,Comparator=requireComparator(),Range=requireRange(),satisfies=satisfies_1,toComparators=toComparators_1,maxSatisfying=maxSatisfying_1,minSatisfying=minSatisfying_1,minVersion=minVersion_1,validRange=valid$1,outside=outside_1,gtr=gtr_1,ltr=ltr_1,intersects=intersects_1,simplifyRange=simplify,subset=subset_1;var semver={parse,valid,clean,inc,diff,major,minor,patch,prerelease,compare,rcompare,compareLoose,compareBuild,sort,rsort,gt,lt,eq,neq,gte,lte,cmp,coerce,Comparator,Range,satisfies,toComparators,maxSatisfying,minSatisfying,minVersion,validRange,outside,gtr,ltr,intersects,simplifyRange,subset,SemVer,re:internalRe.re,src:internalRe.src,tokens:internalRe.t,SEMVER_SPEC_VERSION:constants.SEMVER_SPEC_VERSION,RELEASE_TYPES:constants.RELEASE_TYPES,compareIdentifiers:identifiers.compareIdentifiers,rcompareIdentifiers:identifiers.rcompareIdentifiers};const semver$1=getDefaultExportFromCjs(semver),objectToString=Object.prototype.toString,uint8ArrayStringified="[object Uint8Array]",arrayBufferStringified="[object ArrayBuffer]";function isType(r,e,n){return r?r.constructor===e?!0:objectToString.call(r)===n:!1}function isUint8Array(r){return isType(r,Uint8Array,uint8ArrayStringified)}function isArrayBuffer(r){return isType(r,ArrayBuffer,arrayBufferStringified)}function isUint8ArrayOrArrayBuffer(r){return isUint8Array(r)||isArrayBuffer(r)}function assertUint8Array(r){if(!isUint8Array(r))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof r}\``)}function assertUint8ArrayOrArrayBuffer(r){if(!isUint8ArrayOrArrayBuffer(r))throw new TypeError(`Expected \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof r}\``)}function concatUint8Arrays(r,e){if(r.length===0)return new Uint8Array(0);e??(e=r.reduce((i,s)=>i+s.length,0));const n=new Uint8Array(e);let a=0;for(const i of r)assertUint8Array(i),n.set(i,a),a+=i.length;return n}const cachedDecoders={utf8:new globalThis.TextDecoder("utf8")};function uint8ArrayToString(r,e="utf8"){return assertUint8ArrayOrArrayBuffer(r),cachedDecoders[e]??(cachedDecoders[e]=new globalThis.TextDecoder(e)),cachedDecoders[e].decode(r)}function assertString(r){if(typeof r!="string")throw new TypeError(`Expected \`string\`, got \`${typeof r}\``)}const cachedEncoder=new globalThis.TextEncoder;function stringToUint8Array(r){return assertString(r),cachedEncoder.encode(r)}Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));const ajvFormats=ajvFormatsModule.default,encryptionAlgorithm="aes-256-cbc",createPlainObject=()=>Object.create(null),isExist=r=>r!=null,checkValueType=(r,e)=>{const n=new Set(["undefined","symbol","function"]),a=typeof e;if(n.has(a))throw new TypeError(`Setting a value of type \`${a}\` for key \`${r}\` is not allowed as it's not supported by JSON`)},INTERNAL_KEY="__internal__",MIGRATION_KEY=`${INTERNAL_KEY}.migrations.version`;var Pe,Ie,Te,ke;class Conf{constructor(e={}){xe(this,"path");xe(this,"events");Oe(this,Pe);Oe(this,Ie);Oe(this,Te);Oe(this,ke,{});xe(this,"_deserialize",e=>JSON.parse(e));xe(this,"_serialize",e=>JSON.stringify(e,void 0,"	"));const n={configName:"config",fileExtension:"json",projectSuffix:"nodejs",clearInvalidConfig:!1,accessPropertiesByDotNotation:!0,configFileMode:438,...e};if(!n.cwd){if(!n.projectName)throw new Error("Please specify the `projectName` option.");n.cwd=envPaths(n.projectName,{suffix:n.projectSuffix}).config}if(Me(this,Te,n),n.schema??n.ajvOptions??n.rootSchema){if(n.schema&&typeof n.schema!="object")throw new TypeError("The `schema` option must be an object.");const o=new _2020Exports.Ajv2020({allErrors:!0,useDefaults:!0,...n.ajvOptions});ajvFormats(o);const l={...n.rootSchema,type:"object",properties:n.schema};Me(this,Pe,o.compile(l));for(const[c,d]of Object.entries(n.schema??{}))d!=null&&d.default&&(me(this,ke)[c]=d.default)}n.defaults&&Me(this,ke,{...me(this,ke),...n.defaults}),n.serialize&&(this._serialize=n.serialize),n.deserialize&&(this._deserialize=n.deserialize),this.events=new EventTarget,Me(this,Ie,n.encryptionKey);const a=n.fileExtension?`.${n.fileExtension}`:"";this.path=path.resolve(n.cwd,`${n.configName??"config"}${a}`);const i=this.store,s=Object.assign(createPlainObject(),n.defaults,i);if(n.migrations){if(!n.projectVersion)throw new Error("Please specify the `projectVersion` option.");this._migrate(n.migrations,n.projectVersion,n.beforeEachMigration)}this._validate(s);try{assert.deepEqual(i,s)}catch{this.store=s}n.watch&&this._watch()}get(e,n){if(me(this,Te).accessPropertiesByDotNotation)return this._get(e,n);const{store:a}=this;return e in a?a[e]:n}set(e,n){if(typeof e!="string"&&typeof e!="object")throw new TypeError(`Expected \`key\` to be of type \`string\` or \`object\`, got ${typeof e}`);if(typeof e!="object"&&n===void 0)throw new TypeError("Use `delete()` to clear values");if(this._containsReservedKey(e))throw new TypeError(`Please don't use the ${INTERNAL_KEY} key, as it's used to manage this module internal operations.`);const{store:a}=this,i=(s,o)=>{checkValueType(s,o),me(this,Te).accessPropertiesByDotNotation?setProperty(a,s,o):a[s]=o};if(typeof e=="object"){const s=e;for(const[o,l]of Object.entries(s))i(o,l)}else i(e,n);this.store=a}has(e){return me(this,Te).accessPropertiesByDotNotation?hasProperty(this.store,e):e in this.store}reset(...e){for(const n of e)isExist(me(this,ke)[n])&&this.set(n,me(this,ke)[n])}delete(e){const{store:n}=this;me(this,Te).accessPropertiesByDotNotation?deleteProperty(n,e):delete n[e],this.store=n}clear(){this.store=createPlainObject();for(const e of Object.keys(me(this,ke)))this.reset(e)}onDidChange(e,n){if(typeof e!="string")throw new TypeError(`Expected \`key\` to be of type \`string\`, got ${typeof e}`);if(typeof n!="function")throw new TypeError(`Expected \`callback\` to be of type \`function\`, got ${typeof n}`);return this._handleChange(()=>this.get(e),n)}onDidAnyChange(e){if(typeof e!="function")throw new TypeError(`Expected \`callback\` to be of type \`function\`, got ${typeof e}`);return this._handleChange(()=>this.store,e)}get size(){return Object.keys(this.store).length}get store(){try{const e=fs.readFileSync(this.path,me(this,Ie)?null:"utf8"),n=this._encryptData(e),a=this._deserialize(n);return this._validate(a),Object.assign(createPlainObject(),a)}catch(e){if((e==null?void 0:e.code)==="ENOENT")return this._ensureDirectory(),createPlainObject();if(me(this,Te).clearInvalidConfig&&e.name==="SyntaxError")return createPlainObject();throw e}}set store(e){this._ensureDirectory(),this._validate(e),this._write(e),this.events.dispatchEvent(new Event("change"))}*[Symbol.iterator](){for(const[e,n]of Object.entries(this.store))yield[e,n]}_encryptData(e){if(!me(this,Ie))return typeof e=="string"?e:uint8ArrayToString(e);try{const n=e.slice(0,16),a=crypto.pbkdf2Sync(me(this,Ie),n.toString(),1e4,32,"sha512"),i=crypto.createDecipheriv(encryptionAlgorithm,a,n),s=e.slice(17),o=typeof s=="string"?stringToUint8Array(s):s;return uint8ArrayToString(concatUint8Arrays([i.update(o),i.final()]))}catch{}return e.toString()}_handleChange(e,n){let a=e();const i=()=>{const s=a,o=e();node_util.isDeepStrictEqual(o,s)||(a=o,n.call(this,o,s))};return this.events.addEventListener("change",i),()=>{this.events.removeEventListener("change",i)}}_validate(e){if(!me(this,Pe)||me(this,Pe).call(this,e)||!me(this,Pe).errors)return;const a=me(this,Pe).errors.map(({instancePath:i,message:s=""})=>`\`${i.slice(1)}\` ${s}`);throw new Error("Config schema violation: "+a.join("; "))}_ensureDirectory(){fs.mkdirSync(path.dirname(this.path),{recursive:!0})}_write(e){let n=this._serialize(e);if(me(this,Ie)){const a=crypto.randomBytes(16),i=crypto.pbkdf2Sync(me(this,Ie),a.toString(),1e4,32,"sha512"),s=crypto.createCipheriv(encryptionAlgorithm,i,a);n=concatUint8Arrays([a,stringToUint8Array(":"),s.update(stringToUint8Array(n)),s.final()])}if(process$2.env.SNAP)fs.writeFileSync(this.path,n,{mode:me(this,Te).configFileMode});else try{writeFileSync(this.path,n,{mode:me(this,Te).configFileMode})}catch(a){if((a==null?void 0:a.code)==="EXDEV"){fs.writeFileSync(this.path,n,{mode:me(this,Te).configFileMode});return}throw a}}_watch(){this._ensureDirectory(),fs.existsSync(this.path)||this._write(createPlainObject()),process$2.platform==="win32"?fs.watch(this.path,{persistent:!1},debounceFunction(()=>{this.events.dispatchEvent(new Event("change"))},{wait:100})):fs.watchFile(this.path,{persistent:!1},debounceFunction(()=>{this.events.dispatchEvent(new Event("change"))},{wait:5e3}))}_migrate(e,n,a){let i=this._get(MIGRATION_KEY,"0.0.0");const s=Object.keys(e).filter(l=>this._shouldPerformMigration(l,i,n));let o={...this.store};for(const l of s)try{a&&a(this,{fromVersion:i,toVersion:l,finalVersion:n,versions:s});const c=e[l];c==null||c(this),this._set(MIGRATION_KEY,l),i=l,o={...this.store}}catch(c){throw this.store=o,new Error(`Something went wrong during the migration! Changes applied to the store until this failed migration will be restored. ${c}`)}(this._isVersionInRangeFormat(i)||!semver$1.eq(i,n))&&this._set(MIGRATION_KEY,n)}_containsReservedKey(e){return typeof e=="object"&&Object.keys(e)[0]===INTERNAL_KEY?!0:typeof e!="string"?!1:me(this,Te).accessPropertiesByDotNotation?!!e.startsWith(`${INTERNAL_KEY}.`):!1}_isVersionInRangeFormat(e){return semver$1.clean(e)===null}_shouldPerformMigration(e,n,a){return this._isVersionInRangeFormat(e)?n!=="0.0.0"&&semver$1.satisfies(n,e)?!1:semver$1.satisfies(a,e):!(semver$1.lte(e,n)||semver$1.gt(e,a))}_get(e,n){return getProperty(this.store,e,n)}_set(e,n){const{store:a}=this;setProperty(a,e,n),this.store=a}}Pe=new WeakMap,Ie=new WeakMap,Te=new WeakMap,ke=new WeakMap;const{app,ipcMain,shell}=electron;let isInitialized=!1;const initDataListener=()=>{if(!ipcMain||!app)throw new Error("Electron Store: You need to call `.initRenderer()` from the main process.");const r={defaultCwd:app.getPath("userData"),appVersion:app.getVersion()};return isInitialized||(ipcMain.on("electron-store-get-data",e=>{e.returnValue=r}),isInitialized=!0),r};class ElectronStore extends Conf{constructor(e){let n,a;if(process$2.type==="renderer"){const i=electron.ipcRenderer.sendSync("electron-store-get-data");if(!i)throw new Error("Electron Store: You need to call `.initRenderer()` from the main process.");({defaultCwd:n,appVersion:a}=i)}else ipcMain&&app&&({defaultCwd:n,appVersion:a}=initDataListener());e={name:"config",...e},e.projectVersion||(e.projectVersion=a),e.cwd?e.cwd=path.isAbsolute(e.cwd)?e.cwd:path.join(n,e.cwd):e.cwd=n,e.configName=e.name,delete e.name,super(e)}static initRenderer(){initDataListener()}async openInEditor(){const e=await shell.openPath(this.path);if(e)throw new Error(e)}}const Store=new ElectronStore;Store.set("is_login",!1);const findMp3Files=async()=>{var a,i;const r=path.resolve(musicFolder),e=fs.readdirSync(r),n=[];for(const s of e){const o=path.join(r,s);if(fs.statSync(o).isDirectory())console.warn(`忽略子文件夹: ${o}`);else if(path.extname(s).toLowerCase()===".mp3"){console.log("找到的 MP3 文件:",o);try{const c=fs.readFileSync(o),d=await lib$3.parseBlob(new Blob([c]));console.log("元数据:",d),n.push({filepath:`file://${path.resolve(o).replace(/\\/g,"/")}`,metadata:{title:d.common.title||"未知",artist:d.common.artist||"未知",album:d.common.album||"未知",year:d.common.year||"未知",track:d.common.track||"未知",genre:d.common.genre||"未知",duration:d.format.duration?`${d.format.duration.toFixed(2)} 秒`:"未知",bitrate:d.format.bitrate?`${(d.format.bitrate/1e3).toFixed(2)} kbps`:"未知",cover:((i=(a=d.common.picture)==null?void 0:a[0])==null?void 0:i.data)||null}})}catch(c){console.error(`解析文件 ${o} 的元数据时出错:`,c)}}}return n},__dirname$1=path.dirname(node_url.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:_documentCurrentScript&&_documentCurrentScript.tagName.toUpperCase()==="SCRIPT"&&_documentCurrentScript.src||new URL("main.js",document.baseURI).href));let windows_list=[];const musicFolder="./resources/assets/musics";process.env.APP_ROOT=path.join(__dirname$1,"..");const VITE_DEV_SERVER_URL=process.env.VITE_DEV_SERVER_URL,MAIN_DIST=path.join(process.env.APP_ROOT,"dist-electron"),RENDERER_DIST=path.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=VITE_DEV_SERVER_URL?path.join(process.env.APP_ROOT,"public"):RENDERER_DIST;let win;function createWindow(){win=new electron.BrowserWindow({width:400,height:600,frame:!1,resizable:!1,autoHideMenuBar:!0,icon:path.join(process.env.VITE_PUBLIC,"1.ico"),webPreferences:{preload:path.join(__dirname$1,"preload.js"),contextIsolation:!0,nodeIntegration:!0}}),electron.ipcMain.handle("resize",async(r,e)=>(console.log("Received args from renderer:",e),console.log("Event sender ID:",r.sender.id),windows_list[0].setSize(400,e),"ok")),electron.ipcMain.handle("login",async(r,e)=>{console.log("login success!:",e),console.log("Event sender ID:",r.sender.id),e==="ok"&&(Store.set("is_login",!0),console.log("Updated is_login:",Store.get("is_login")),r.sender.send("login-success",{status:!0}),await createWindow_2(),windows_list[0].close())}),electron.ipcMain.handle("Storeget",async(r,e)=>{if(console.log("从electron-store里获取:",e),console.log("is_login::",Store.get("is_login")),console.log("Event sender ID:",r.sender.id),e==="is_login")return Store.get("is_login")}),win.webContents.on("did-finish-load",()=>{win==null||win.webContents.send("main-process-message",new Date().toLocaleString())}),VITE_DEV_SERVER_URL?win.loadURL(VITE_DEV_SERVER_URL):win.loadFile(path.join(RENDERER_DIST,"index.html"),{hash:"/login"}),windows_list.push(win)}const createWindow_2=()=>{const r=new electron.BrowserWindow({width:1e3,height:600,minWidth:850,minHeight:500,frame:!1,autoHideMenuBar:!0,icon:path.join(process.env.VITE_PUBLIC,"1.ico"),webPreferences:{preload:path.join(__dirname$1,"preload.js"),contextIsolation:!0,nodeIntegration:!0,sandbox:!1}});r.loadFile(path.join(RENDERER_DIST,"index.html")),r.on("closed",()=>{windows_list.splice(1)}),windows_list.push(r),console.log(windows_list),electron.ipcMain.handle("scan-music",()=>(console.log("触发运行 扫描mp3 文件"),findMp3Files()))};electron.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(electron.app.quit(),win=null)});electron.app.on("activate",()=>{electron.BrowserWindow.getAllWindows().length===0&&createWindow()});electron.app.whenReady().then(createWindow);exports.MAIN_DIST=MAIN_DIST;exports.RENDERER_DIST=RENDERER_DIST;exports.VITE_DEV_SERVER_URL=VITE_DEV_SERVER_URL;exports.findMp3Files=findMp3Files;
